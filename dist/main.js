(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let r=0;r<10;r+=1){const o=document.createElement("div");o.classList.add("square"),o.dataset.row=e,o.dataset.col=r,t.appendChild(o)}},n=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))};var s=r(776);(()=>{const e=(0,s.Br)(),t=(0,s.Br)(),r=(0,s.oP)("computer"),l=[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}];let c=0,i=!0,d=!1;const u=a=>{if(!i){const n=a.target,s=parseInt(n.dataset.row,10),l=parseInt(n.dataset.col,10),c=o.r.convertToAlphanumeric([s,l]);if(!t.getAttackedCoordinates().includes(c)){const o=t.receiveAttack(c);o?(n.classList.add("hit"),o.isSunk()&&console.log(`Player sank the ${o.length}-unit ship!`)):n.classList.add("miss"),t.allShipsSunk()&&console.log("Player wins!"),(()=>{if(!i){const t=r.attack(e),o=e.receiveAttack(t),a=parseInt(t.slice(1),10)-1,n=t.charCodeAt(0)-65,s=document.querySelector(`.gameboard.player [data-row="${a}"][data-col="${n}"]`);o?(s.classList.add("hit"),o.isSunk()&&console.log(`Computer sank the ${o.length}-unit ship!`)):s.classList.add("miss"),e.allShipsSunk()&&console.log("Computer wins!")}})()}}},h=()=>{d=!d},p=[{eventType:"mouseover",handler:e=>{if(i){const t=e.target,r=parseInt(t.dataset.row,10),o=parseInt(t.dataset.col,10),{length:a}=l[c];Array.from({length:a},((e,t)=>{const a=d?r+t:r,n=d?o:o+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-row="${a}"][data-col="${n}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:r=>{if(i){const a=r.target,n=parseInt(a.dataset.row,10),u=parseInt(a.dataset.col,10),{length:h}=l[c],p=Array.from({length:h},((e,t)=>[d?n+t:n,d?u:u+t])),m=(0,s._V)(h);if(e.placeShip(m,p))if(a.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),c+=1,c===l.length)i=!1,(()=>{const e=l.map((e=>{const{length:r}=e;let o=[],a=!1;for(;!a;){const e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());d=Math.random()<.5,o=[],d?e+r-1<10&&(o=Array.from({length:r},((t,r)=>[e+r,n]))):n+r-1<10&&(o=Array.from({length:r},((t,r)=>[e,n+r]))),o.length>0&&(a=t.placeShip((0,s._V)(r),o))}return o.forEach((([e,t])=>{document.querySelector(`.gameboard.computer [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),{type:e.type,coordinates:o}}));console.log("Computer ships:",e)})(),setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=l[c].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),n(".gameboard.initial",p),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",u)})),document.querySelector("#rotateBtn").addEventListener("click",h)}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>n,_V:()=>a,oP:()=>s});var o=r(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},n=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null))),r=[],a=[],n=()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const a=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),n=o.some((([e,r])=>null!==t[e][r])),s=o.some((([r,o])=>[[r-1,o],[r+1,o],[r,o-1],[r,o+1],[r-1,o-1],[r-1,o+1],[r+1,o-1],[r+1,o+1]].some((([r,o])=>r>=0&&r<e&&o>=0&&o<e&&null!==t[r]?.[o]))));if(a&&!n&&!s){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:n,getShipCoordinates:r=>{const a=[];for(let n=0;n<e;n+=1)for(let s=0;s<e;s+=1){const e=t[n][s];e&&e.ship===r&&a.push(o.r.convertToAlphanumeric([n,s]))}return a},receiveAttack:e=>{const[o,n]=e,s=parseInt(n,10)-1,l=o.charCodeAt(0)-65,c=t[s][l];if(null!==c){const{ship:t}=c;return t.hit(),r.push(e),t}return a.push(e),r.push(e),null},getMissedAttacks:()=>a,getAttackedCoordinates:()=>r,allShipsSunk:()=>{const e=n().every((e=>e.isSunk()));return console.log("All ships sunk:",e),e}}},s=e=>{const t=new Set;return{name:e,attack:e=>{const r=e.getGrid().length,a=o.r.getAllValidCoordinates(r);let n="";do{n=a[Math.floor(Math.random()*a.length)]}while(t.has(n)||e.getAttackedCoordinates().includes(n));return t.add(n),e.receiveAttack(n),n}}}},555:(e,t,r)=>{r.d(t,{U:()=>a,r:()=>o});const o=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let r=0;r<t;r+=1)for(let a=0;a<t;a+=1){const t=o.convertToAlphanumeric([r,a]);e.push(t)}return e}}})(),a={toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQVV2RSxHQUFPLEVBQUcsQ0FDMUMsTUFBTTBHLEVBQXlCTCxFQUFlekUsc0JBQXNCLENBQ2xFN0IsRUFDQUMsSUFFRmtHLEVBQWlCbkIsS0FBSzJCLEVBQ3hCLENBR0YsT0FBT1IsQ0FBZ0IsRUFRMUIsRUFqQzZCLEdBbUNqQlMsRUFXSixDQUNMM0MsWUFYa0IsQ0FBQzRDLEVBQU9DLEtBQzFCLE1BQU1DLEVBQWVGLEVBR2ZHLEVBQTBCLFNBQVhGLEVBQW9CLE9BQVMsT0FEbENELEVBQU1JLFFBQVEsWUFHdEJDLE1BQU1DLFFBQVVILEVBQ3hCRCxFQUFhRyxNQUFNQyxRQUFVSCxDQUFZLEUsR0MxQ3pDSSxFQUEyQixDQUFDLEVBR2hDLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUJFLElBQWpCRCxFQUNILE9BQU9BLEVBQWFFLFFBR3JCLElBQUlDLEVBQVNOLEVBQXlCRSxHQUFZLENBR2pERyxRQUFTLENBQUMsR0FPWCxPQUhBRSxFQUFvQkwsR0FBVUksRUFBUUEsRUFBT0QsUUFBU0osR0FHL0NLLEVBQU9ELE9BQ2YsQ0NyQkFKLEVBQW9CTyxFQUFJLENBQUNILEVBQVNJLEtBQ2pDLElBQUksSUFBSUMsS0FBT0QsRUFDWFIsRUFBb0JVLEVBQUVGLEVBQVlDLEtBQVNULEVBQW9CVSxFQUFFTixFQUFTSyxJQUM1RUUsT0FBT0MsZUFBZVIsRUFBU0ssRUFBSyxDQUFFSSxZQUFZLEVBQU1DLElBQUtOLEVBQVdDLElBRTFFLEVDTkRULEVBQW9CVSxFQUFJLENBQUNLLEVBQUtDLElBQVVMLE9BQU9NLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDRWxGaEIsRUFBb0IsS0FFTUEsRUFBb0IsSSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcmVuZGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYXBwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBtb2R1bGUgY2FuIGJlIHJlc3BvbnNpYmxlIGZvciByZW5kZXJpbmcgY29udGVudCBvbiB0aGUgcGFnZS5cbi8vIEl0IGNhbiBpbmNsdWRlIGZ1bmN0aW9ucyB0byB1cGRhdGUgdGhlIERPTSBlbGVtZW50cyByZXByZXNlbnRpbmcgdGhlXG4vLyBnYW1lIGJvYXJkcywgc2hpcHMsIGF0dGFja3MsIG1lc3NhZ2VzLCBhbmQgb3RoZXIgVUkgY29tcG9uZW50cy4gSXQgc2hvdWxkXG4vLyBlbmNhcHN1bGF0ZSB0aGUgRE9NIG1hbmlwdWxhdGlvbiBjb2RlIGFuZCBwcm92aWRlIGEgY2xlYW4gaW50ZXJmYWNlIGZvclxuLy8gdXBkYXRpbmcgdGhlIFVJIGJhc2VkIG9uIHRoZSBnYW1lIHN0YXRlLiBJdCBjYW4gYmUgdGhlIGJyaWRnZSBiZXR3ZWVuIHRoZVxuLy8gZ2FtZSBsb2dpYyBhbmQgdGhlIGFjdHVhbCBET00gbWFuaXB1bGF0aW9uLlxuXG5jb25zdCBSZW5kZXJlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHJlbmRlckdhbWVib2FyZCA9IChjb250YWluZXJFbGVtZW50KSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcblxuICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9IFwiXCI7XG5cbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IDEwOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInNxdWFyZVwiKTtcbiAgICAgICAgc3F1YXJlLmRhdGFzZXQucm93ID0gcm93O1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5jb2wgPSBjb2w7XG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGF0dGFjaEV2ZW50TGlzdGVuZXJzID0gKGNvbnRhaW5lckVsZW1lbnQsIGV2ZW50TGlzdGVuZXJzKSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcblxuICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiLnNxdWFyZVwiKS5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XG4gICAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKGxpc3RlbmVyLmV2ZW50VHlwZSwgbGlzdGVuZXIuaGFuZGxlcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckdhbWVib2FyZCxcbiAgICBhdHRhY2hFdmVudExpc3RlbmVycyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFJlbmRlcmVyO1xuIiwiLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG5pbXBvcnQgeyBBcHBIZWxwZXJzLCBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSBcIi4vcmVuZGVyXCI7XG5pbXBvcnQgeyBTaGlwRmFjdG9yeSwgR2FtZWJvYXJkRmFjdG9yeSwgUGxheWVyRmFjdG9yeSB9IGZyb20gXCIuL2ZhY3Rvcmllc1wiO1xuXG4vLyAxLiAtLS1cbi8vIDIuIC0tLVxuLy8gMy4gLS0tXG4vLyA0LiAtLS1cbi8vIDUuIC0tLVxuLy8gNi4gLS0tXG4vLyA3LiBoYW5kbGUgd2lubmVyXG4vLyA4LiBkaXNwbGF5IHdpbm5lclxuXG5jb25zdCBDb250cm9sbGVyID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyR2FtZWJvYXJkID0gR2FtZWJvYXJkRmFjdG9yeSgpO1xuICBjb25zdCBjb21wdXRlckdhbWVib2FyZCA9IEdhbWVib2FyZEZhY3RvcnkoKTtcblxuICBjb25zdCBjb21wdXRlciA9IFBsYXllckZhY3RvcnkoXCJjb21wdXRlclwiKTtcblxuICBjb25zdCBzaGlwVHlwZXMgPSBbXG4gICAgeyB0eXBlOiBcImNhcnJpZXJcIiwgbGVuZ3RoOiA1IH0sXG4gICAgeyB0eXBlOiBcImJhdHRsZXNoaXBcIiwgbGVuZ3RoOiA0IH0sXG4gICAgeyB0eXBlOiBcImRlc3Ryb3llclwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwic3VibWFyaW5lXCIsIGxlbmd0aDogMyB9LFxuICAgIHsgdHlwZTogXCJwYXRyb2wgYm9hdFwiLCBsZW5ndGg6IDIgfSxcbiAgXTtcblxuICBsZXQgY3VycmVudFNoaXBJbmRleCA9IDA7XG4gIGxldCBzaGlwUGxhY2VtZW50TW9kZSA9IHRydWU7XG4gIGxldCBpc1ZlcnRpY2FsID0gZmFsc2U7XG5cbiAgY29uc3QgcGxhY2VDb21wdXRlclNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvbXB1dGVyU2hpcHMgPSBzaGlwVHlwZXMubWFwKChzaGlwVHlwZSkgPT4ge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlO1xuICAgICAgbGV0IGNvb3JkaW5hdGVzID0gW107XG4gICAgICBsZXQgcGxhY2VkID0gZmFsc2U7XG5cbiAgICAgIHdoaWxlICghcGxhY2VkKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0Um93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICBjb25zdCBzdGFydENvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgaXNWZXJ0aWNhbCA9IE1hdGgucmFuZG9tKCkgPCAwLjU7XG4gICAgICAgIGNvb3JkaW5hdGVzID0gW107XG5cbiAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBlbm91Z2ggc3BhY2UgdmVydGljYWxseVxuICAgICAgICAgIGlmIChzdGFydFJvdyArIGxlbmd0aCAtIDEgPCAxMCkge1xuICAgICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiBbXG4gICAgICAgICAgICAgIHN0YXJ0Um93ICsgaSxcbiAgICAgICAgICAgICAgc3RhcnRDb2wsXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgZW5vdWdoIHNwYWNlIGhvcml6b250YWxseVxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1sb25lbHktaWZcbiAgICAgICAgICBpZiAoc3RhcnRDb2wgKyBsZW5ndGggLSAxIDwgMTApIHtcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4gW1xuICAgICAgICAgICAgICBzdGFydFJvdyxcbiAgICAgICAgICAgICAgc3RhcnRDb2wgKyBpLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwbGFjZWQgPSBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoXG4gICAgICAgICAgICBTaGlwRmFjdG9yeShsZW5ndGgpLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIHBsYWNlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7IHR5cGU6IHNoaXBUeXBlLnR5cGUsIGNvb3JkaW5hdGVzIH07XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIHNoaXBzOlwiLCBjb21wdXRlclNoaXBzKTtcbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50SGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIGNvbnN0IGNvbCA9IGlzVmVydGljYWwgPyBzdGFydENvbCA6IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIFtyb3csIGNvbF07XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2hpcCA9IFNoaXBGYWN0b3J5KGxlbmd0aCk7XG4gICAgICBjb25zdCBwbGFjZWQgPSBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHNoaXBDb29yZGluYXRlcyk7XG5cbiAgICAgIGlmIChwbGFjZWQpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjdXJyZW50U2hpcEluZGV4ICs9IDE7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRTaGlwSW5kZXggPT09IHNoaXBUeXBlcy5sZW5ndGgpIHtcbiAgICAgICAgICBzaGlwUGxhY2VtZW50TW9kZSA9IGZhbHNlO1xuICAgICAgICAgIHBsYWNlQ29tcHV0ZXJTaGlwcygpO1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLFxuICAgICAgICAgICAgICBcImhpZGVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XS50eXBlO1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gbmV4dFNoaXBUeXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluaXRpYWxTcXVhcmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLmdhbWVib2FyZC5pbml0aWFsIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgICApLFxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGhvdmVyZWRTcXVhcmVzLmZvckVhY2goKHsgaW5pdGlhbFNxdWFyZSB9KSA9PiB7XG4gICAgICAgIGlmIChpbml0aWFsU3F1YXJlKSB7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lYm9hcmQgLmhvdmVyZWRcIik7XG4gICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgaG92ZXJlZFNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBjb21wdXRlckF0dGFjayA9ICgpID0+IHtcbiAgICBpZiAoIXNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBjb29yZGluYXRlID0gY29tcHV0ZXIuYXR0YWNrKHBsYXllckdhbWVib2FyZCk7XG4gICAgICBjb25zdCBhdHRhY2tlZFNoaXAgPSBwbGF5ZXJHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcblxuICAgICAgY29uc3Qgcm93ID0gcGFyc2VJbnQoY29vcmRpbmF0ZS5zbGljZSgxKSwgMTApIC0gMTtcbiAgICAgIGNvbnN0IGNvbCA9IGNvb3JkaW5hdGUuY2hhckNvZGVBdCgwKSAtIDY1O1xuXG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgLmdhbWVib2FyZC5wbGF5ZXIgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgKTtcblxuICAgICAgaWYgKGF0dGFja2VkU2hpcCkge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcblxuICAgICAgICBpZiAoYXR0YWNrZWRTaGlwLmlzU3VuaygpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYENvbXB1dGVyIHNhbmsgdGhlICR7YXR0YWNrZWRTaGlwLmxlbmd0aH0tdW5pdCBzaGlwIWApO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChwbGF5ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJDb21wdXRlciB3aW5zIVwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgcGxheWVyQXR0YWNrID0gKGUpID0+IHtcbiAgICBpZiAoIXNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LnJvdywgMTApO1xuICAgICAgY29uc3QgY29sID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQuY29sLCAxMCk7XG4gICAgICBjb25zdCBjb29yZGluYXRlID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtyb3csIGNvbF0pO1xuXG4gICAgICBpZiAoIWNvbXB1dGVyR2FtZWJvYXJkLmdldEF0dGFja2VkQ29vcmRpbmF0ZXMoKS5pbmNsdWRlcyhjb29yZGluYXRlKSkge1xuICAgICAgICBjb25zdCBhdHRhY2tlZFNoaXAgPSBjb21wdXRlckdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuXG4gICAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcblxuICAgICAgICAgIGlmIChhdHRhY2tlZFNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBQbGF5ZXIgc2FuayB0aGUgJHthdHRhY2tlZFNoaXAubGVuZ3RofS11bml0IHNoaXAhYCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21wdXRlckdhbWVib2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxheWVyIHdpbnMhXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcHV0ZXJBdHRhY2soKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgcm90YXRlU2hpcHMgPSAoKSA9PiB7XG4gICAgaXNWZXJ0aWNhbCA9ICFpc1ZlcnRpY2FsO1xuICB9O1xuXG4gIGNvbnN0IGV2ZW50TGlzdGVuZXJzID0gW1xuICAgIHsgZXZlbnRUeXBlOiBcIm1vdXNlb3ZlclwiLCBoYW5kbGVyOiBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgfSxcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZWxlYXZlXCIsIGhhbmRsZXI6IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwiY2xpY2tcIiwgaGFuZGxlcjogc2hpcFBsYWNlbWVudEhhbmRsZXIgfSxcbiAgXTtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLCBcImhpZGVcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5pbml0aWFsXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQucGxheWVyXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuY29tcHV0ZXJcIik7XG4gICAgUmVuZGVyZXIuYXR0YWNoRXZlbnRMaXN0ZW5lcnMoXCIuZ2FtZWJvYXJkLmluaXRpYWxcIiwgZXZlbnRMaXN0ZW5lcnMpO1xuXG4gICAgY29uc3QgY29tcHV0ZXJTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgIFwiLmdhbWVib2FyZC5jb21wdXRlciAuc3F1YXJlXCJcbiAgICApO1xuICAgIGNvbXB1dGVyU3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxheWVyQXR0YWNrKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHJvdGF0ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcm90YXRlQnRuXCIpO1xuICAgIHJvdGF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcm90YXRlU2hpcHMpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdCxcbiAgfTtcbn0pKCk7XG5cbkNvbnRyb2xsZXIuaW5pdCgpO1xuIiwiaW1wb3J0IHsgRmFjdG9yeUhlbHBlcnMgfSBmcm9tIFwiLi91dGlsc1wiO1xuXG5leHBvcnQgY29uc3QgU2hpcEZhY3RvcnkgPSAobGVuZ3RoKSA9PiB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgaGl0cyArPSAxO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IGhpdHMgPj0gbGVuZ3RoOyAvLyBSZXR1cm4gdHJ1ZSBpZiBoaXRzIGlzIGVxdWFsIHRvIG9yIGdyZWF0ZXIgdGhhbiBsZW5ndGhcblxuICByZXR1cm4ge1xuICAgIGxlbmd0aCxcbiAgICBoaXQsXG4gICAgaXNTdW5rLFxuICAgIGdldCBoaXRzKCkge1xuICAgICAgLy8gR2V0dGVyIGZ1bmN0aW9uIGZvciBoaXRzLiBVc2luZyBmdW5jdGlvbiBkZWNsYXJhdGlvbiB0byBlbnN1cmUgaXQgaGFzIGFjY2VzcyB0byB0aGVcbiAgICAgIC8vIGBoaXRzYCB2YXJpYWJsZSBkeW5hbWljYWxseSwgc2luY2UgZnVuY3Rpb24gZGVjbGFyYXRpb25zIGFyZSBob2lzdGVkIGFuZCBjYW4gYmUgdXNlZFxuICAgICAgLy8gYmVmb3JlIHRoZXkgYXJlIGRlZmluZWQuIFRoaXMgYWxsb3dzIGFjY2Vzc2luZyB0aGUgY3VycmVudCB2YWx1ZSBvZiBgaGl0c2AgZXZlbiBiZWZvcmVcbiAgICAgIC8vIGNhbGxpbmcgdGhlIGBoaXRgIGZ1bmN0aW9uXG4gICAgICByZXR1cm4gaGl0cztcbiAgICB9LFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IEdhbWVib2FyZEZhY3RvcnkgPSAoKSA9PiB7XG4gIGNvbnN0IGdyaWRTaXplID0gMTA7XG4gIGNvbnN0IGdyaWQgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBncmlkU2l6ZSB9LCAoKSA9PlxuICAgIEFycmF5KGdyaWRTaXplKS5maWxsKG51bGwpXG4gICk7XG5cbiAgY29uc3QgYXR0YWNrZWRDb29yZGluYXRlcyA9IFtdO1xuICBjb25zdCBtaXNzZWRBdHRhY2tzID0gW107XG5cbiAgY29uc3QgZ2V0R3JpZCA9ICgpID0+IGdyaWQ7XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgYWxsIGNvb3JkaW5hdGVzIGFyZSB3aXRoaW4gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIGdyaWRcbiAgICBjb25zdCB3aXRoaW5Cb3VuZGFyaWVzID0gY29vcmRpbmF0ZXMuZXZlcnkoXG4gICAgICAoW3JvdywgY29sXSkgPT4gcm93ID49IDAgJiYgcm93IDwgZ3JpZFNpemUgJiYgY29sID49IDAgJiYgY29sIDwgZ3JpZFNpemVcbiAgICApO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBjb25mbGljdHMgPSBjb29yZGluYXRlcy5zb21lKChbcm93LCBjb2xdKSA9PiBncmlkW3Jvd11bY29sXSAhPT0gbnVsbCk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGFkamFjZW50IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGFkamFjZW50Q29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgY29uc3QgYWRqYWNlbnRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3JvdyAtIDEsIGNvbF0sIC8vIFVwXG4gICAgICAgIFtyb3cgKyAxLCBjb2xdLCAvLyBEb3duXG4gICAgICAgIFtyb3csIGNvbCAtIDFdLCAvLyBMZWZ0XG4gICAgICAgIFtyb3csIGNvbCArIDFdLCAvLyBSaWdodFxuICAgICAgICBbcm93IC0gMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIFVwLUxlZnRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBVcC1SaWdodFxuICAgICAgICBbcm93ICsgMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIERvd24tTGVmdFxuICAgICAgICBbcm93ICsgMSwgY29sICsgMV0sIC8vIERpYWdvbmFsIERvd24tUmlnaHRcbiAgICAgIF07XG5cbiAgICAgIHJldHVybiBhZGphY2VudENvb3JkaW5hdGVzLnNvbWUoXG4gICAgICAgIChbYWRqUm93LCBhZGpDb2xdKSA9PlxuICAgICAgICAgIGFkalJvdyA+PSAwICYmXG4gICAgICAgICAgYWRqUm93IDwgZ3JpZFNpemUgJiZcbiAgICAgICAgICBhZGpDb2wgPj0gMCAmJlxuICAgICAgICAgIGFkakNvbCA8IGdyaWRTaXplICYmXG4gICAgICAgICAgZ3JpZFthZGpSb3ddPy5bYWRqQ29sXSAhPT0gbnVsbFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIC8vIElmIHRoZSBzaGlwIHBsYWNlbWVudCBpcyB3aXRoaW4gZ3JpZCBib3VuZGFyaWVzLCBoYXMgbm8gY29uZmxpY3RzIGFuZCBubyBhZGphY2VudFxuICAgIC8vIGNvbmZsaWN0cy4uLlxuICAgIGlmICh3aXRoaW5Cb3VuZGFyaWVzICYmICFjb25mbGljdHMgJiYgIWFkamFjZW50Q29uZmxpY3RzKSB7XG4gICAgICAvLyBDcmVhdGUgYW4gb2JqZWN0IGNvbnRhaW5pbmcgc2hpcCBpbmZvcm1hdGlvbiBhbmQgY29vcmRpbmF0ZXNcbiAgICAgIGNvbnN0IHNoaXBJbmZvID0ge1xuICAgICAgICBzaGlwLFxuICAgICAgICBjb29yZGluYXRlcyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFBsYWNlIHRoZSBzaGlwIG9uIHRoZSBncmlkIGJ5IHVwZGF0aW5nIHRoZSBjb3JyZXNwb25kaW5nIGNlbGxzXG4gICAgICBzaGlwSW5mby5jb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgIGdyaWRbcm93XVtjb2xdID0gc2hpcEluZm87XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRydWU7IC8vIFNoaXAgcGxhY2VtZW50IHN1Y2Nlc3NmdWxcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIE90aGVyd2lzZSwgc2hpcCBwbGFjZW1lbnQgZmFpbGVkXG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGNvbnRhaW5zIGEgc2hpcCBhbmQgaXQncyBub3QgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNlbGwgIT09IG51bGwgJiZcbiAgICAgICAgICBjZWxsLnNoaXAgJiZcbiAgICAgICAgICAhc2hpcHMuaW5jbHVkZXMoY2VsbC5zaGlwKSAmJlxuICAgICAgICAgICFjZWxsLnNoaXAuaXNTdW5rKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSBzaGlwIHRvIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICAgIHNoaXBzLnB1c2goY2VsbC5zaGlwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzaGlwcztcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwQ29vcmRpbmF0ZXMgPSAoc2hpcCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW107XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBjZWxsIG9mIHRoZSBncmlkXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2VsbCBleGlzdHMgYW5kIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgc2hpcFxuICAgICAgICBpZiAoY2VsbCAmJiBjZWxsLnNoaXAgPT09IHNoaXApIHtcbiAgICAgICAgICAvLyBDb252ZXJ0IHRoZSByb3cgYW5kIGNvbHVtbiBpbmRpY2VzIHRvIGFscGhhbnVtZXJpYyBjb29yZGluYXRlcyBhbmQgYWRkIHRoZW0gdG9cbiAgICAgICAgICAvLyB0aGUgY29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgICAgICBjb29yZGluYXRlcy5wdXNoKEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgW2NvbHVtbkxldHRlciwgcm93TnVtYmVyXSA9IGNvb3JkaW5hdGU7XG4gICAgY29uc3Qgcm93ID0gcGFyc2VJbnQocm93TnVtYmVyLCAxMCkgLSAxO1xuICAgIGNvbnN0IGNvbCA9IGNvbHVtbkxldHRlci5jaGFyQ29kZUF0KDApIC0gNjU7XG4gICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuXG4gICAgaWYgKGNlbGwgIT09IG51bGwpIHtcbiAgICAgIC8vIFNoaXAgYXQgY29vcmRpbmF0ZSwgaXQncyBhIGhpdFxuICAgICAgY29uc3QgeyBzaGlwIH0gPSBjZWxsO1xuICAgICAgc2hpcC5oaXQoKTsgLy8gSW5jcmVtZW50IGhpdCBjb3VudCBvZiB0aGUgc2hpcFxuICAgICAgYXR0YWNrZWRDb29yZGluYXRlcy5wdXNoKGNvb3JkaW5hdGUpO1xuICAgICAgcmV0dXJuIHNoaXA7IC8vIFJldHVybiB0aGUgc2hpcCBvYmplY3Qgd2hlbiBpdCBpcyBoaXRcbiAgICB9XG4gICAgLy8gTm8gc2hpcCBhdCBjb29yZGluYXRlLCBpdCdzIGEgbWlzc1xuICAgIG1pc3NlZEF0dGFja3MucHVzaChjb29yZGluYXRlKTtcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIHdoZW4gaXQncyBhIG1pc3NcbiAgfTtcblxuICBjb25zdCBnZXRNaXNzZWRBdHRhY2tzID0gKCkgPT4gbWlzc2VkQXR0YWNrcztcblxuICBjb25zdCBnZXRBdHRhY2tlZENvb3JkaW5hdGVzID0gKCkgPT4gYXR0YWNrZWRDb29yZGluYXRlcztcblxuICBjb25zdCBhbGxTaGlwc1N1bmsgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBnZXRTaGlwcygpOyAvLyBSZXRyaWV2ZSBhbGwgdGhlIHNoaXBzIG9uIHRoZSBnYW1lYm9hcmRcblxuICAgIC8vIENoZWNrIGlmIGFsbCBzaGlwcyBhcmUgc3VuaywgcmV0dXJuIHRydWUgaWYgeWVzLCBhbmQgcmV0dXJuIGZhbHNlIGlmIG5vXG4gICAgY29uc3QgcmVzdWx0ID0gc2hpcHMuZXZlcnkoKHNoaXApID0+IHNoaXAuaXNTdW5rKCkpO1xuXG4gICAgY29uc29sZS5sb2coXCJBbGwgc2hpcHMgc3VuazpcIiwgcmVzdWx0KTsgLy8gTG9nIHRoZSByZXN1bHQgdG8gdGVzdFxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldEdyaWQsXG4gICAgcGxhY2VTaGlwLFxuICAgIGdldFNoaXBzLFxuICAgIGdldFNoaXBDb29yZGluYXRlcyxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGdldE1pc3NlZEF0dGFja3MsXG4gICAgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyxcbiAgICBhbGxTaGlwc1N1bmssXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgUGxheWVyRmFjdG9yeSA9IChuYW1lKSA9PiB7XG4gIGNvbnN0IGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBuZXcgU2V0KCk7IC8vIFNldCB0byBrZWVwIHRyYWNrIG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG5cbiAgY29uc3QgYXR0YWNrID0gKGVuZW15R2FtZWJvYXJkKSA9PiB7XG4gICAgY29uc3QgZ3JpZFNpemUgPSBlbmVteUdhbWVib2FyZC5nZXRHcmlkKCkubGVuZ3RoO1xuICAgIGNvbnN0IHZhbGlkQ29vcmRpbmF0ZXMgPSBGYWN0b3J5SGVscGVycy5nZXRBbGxWYWxpZENvb3JkaW5hdGVzKGdyaWRTaXplKTtcblxuICAgIGxldCBjb29yZGluYXRlID0gXCJcIjtcblxuICAgIC8vIFBlcmZvcm0gYSBkby13aGlsZSBsb29wIHVudGlsIGEgdW5pcXVlIGNvb3JkaW5hdGUgaXMgZm91bmRcbiAgICBkbyB7XG4gICAgICAvLyBHZW5lcmF0ZSBhIHJhbmRvbSBpbmRleCBiYXNlZCBvbiB0aGUgbGVuZ3RoIG9mIHZhbGlkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdmFsaWRDb29yZGluYXRlcy5sZW5ndGgpO1xuXG4gICAgICAvLyBHZXQgdGhlIGNvb3JkaW5hdGUgYXQgdGhlIHJhbmRvbSBpbmRleFxuICAgICAgY29vcmRpbmF0ZSA9IHZhbGlkQ29vcmRpbmF0ZXNbcmFuZG9tSW5kZXhdO1xuICAgIH0gd2hpbGUgKFxuICAgICAgLy8gQ29udGludWUgbG9vcGluZyB3aXRob3V0IHBlcmZvcm1pbmcgYW55IGFjdGlvbnMgaWYgdGhlIGNvb3JkaW5hdGUgaXMgYWxyZWFkeVxuICAgICAgLy8gaW4gdGhlIHBsYXllcnMgYXR0YWNrZWRDb29yZGluYXRlcyBzZXQgb3IgaXMgaW5jbHVkZWQgaW4gdGhlIGVuZW15R2FtZWJvYXJkc1xuICAgICAgLy8gYXR0YWNrZWRDb29yZGluYXRlcyBhcnJheVxuICAgICAgYXR0YWNrZWRDb29yZGluYXRlcy5oYXMoY29vcmRpbmF0ZSkgfHxcbiAgICAgIGVuZW15R2FtZWJvYXJkLmdldEF0dGFja2VkQ29vcmRpbmF0ZXMoKS5pbmNsdWRlcyhjb29yZGluYXRlKVxuICAgICk7XG5cbiAgICAvLyBBZGQgdGhlIGF0dGFja2VkIGNvb3JkaW5hdGUgdG8gdGhlIHBsYXllcnMgc2V0IG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5hZGQoY29vcmRpbmF0ZSk7XG5cbiAgICAvLyBQZXJmb3JtIHRoZSBhdHRhY2sgb24gdGhlIGVuZW15IGdhbWVib2FyZFxuICAgIGVuZW15R2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG5cbiAgICByZXR1cm4gY29vcmRpbmF0ZTsgLy8gUmV0dXJuIHRoZSBjb29yZGluYXRlIGFzIGFuIGFycmF5XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGF0dGFjayxcbiAgfTtcbn07XG4iLCJleHBvcnQgY29uc3QgRmFjdG9yeUhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gW107XG5cbiAgY29uc3QgY29udmVydFRvSW5kaWNlcyA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgY29sdW1uID0gY29vcmRpbmF0ZS5jaGFyQ29kZUF0KDApIC0gNjU7IC8vIENvbnZlcnQgY29sdW1uIGxldHRlciB0byBpbmRleFxuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7IC8vIENvbnZlcnQgcm93IG51bWJlciB0byBpbmRleCB3aXRoIHJhZGl4IDEwXG4gICAgcmV0dXJuIFtyb3csIGNvbHVtbl07XG4gIH07XG5cbiAgY29uc3QgY29udmVydFRvQWxwaGFudW1lcmljID0gKFtyb3csIGNvbHVtbl0pID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2x1bW4gKyA2NSk7IC8vIENvbnZlcnQgY29sdW1uIGluZGV4IHRvIGxldHRlclxuICAgIHJldHVybiBjb29yZGluYXRlICsgKHJvdyArIDEpOyAvLyBDb252ZXJ0IHJvdyBpbmRleCB0byBudW1iZXJcbiAgfTtcblxuICBjb25zdCBnZXRBbGxWYWxpZENvb3JkaW5hdGVzID0gKGdyaWRTaXplKSA9PiB7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgYWxwaGFudW1lcmljQ29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbXG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGNvbCxcbiAgICAgICAgXSk7XG4gICAgICAgIHZhbGlkQ29vcmRpbmF0ZXMucHVzaChhbHBoYW51bWVyaWNDb29yZGluYXRlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRDb29yZGluYXRlcztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNvbnZlcnRUb0luZGljZXMsXG4gICAgY29udmVydFRvQWxwaGFudW1lcmljLFxuICAgIGdldEFsbFZhbGlkQ29vcmRpbmF0ZXMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgY29uc3QgQXBwSGVscGVycyA9ICgoKSA9PiB7XG4gIGNvbnN0IHRvZ2dsZU1vZGFsID0gKG1vZGFsLCBjaG9pY2UpID0+IHtcbiAgICBjb25zdCB0b2dnbGVkTW9kYWwgPSBtb2RhbDtcblxuICAgIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5jbG9zZXN0KFwiLm92ZXJsYXlcIik7XG4gICAgY29uc3QgZGlzcGxheVZhbHVlID0gY2hvaWNlID09PSBcInNob3dcIiA/IFwiZmxleFwiIDogXCJub25lXCI7XG5cbiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gICAgdG9nZ2xlZE1vZGFsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICB0b2dnbGVNb2RhbCxcbiAgfTtcbn0pKCk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXygzODApO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzYpO1xuIl0sIm5hbWVzIjpbImNvbnRhaW5lckVsZW1lbnQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsInJvdyIsImNvbCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkYXRhc2V0IiwiYXBwZW5kQ2hpbGQiLCJldmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRUeXBlIiwiaGFuZGxlciIsInBsYXllckdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwiY29tcHV0ZXIiLCJzaGlwVHlwZXMiLCJ0eXBlIiwibGVuZ3RoIiwiY3VycmVudFNoaXBJbmRleCIsInNoaXBQbGFjZW1lbnRNb2RlIiwiaXNWZXJ0aWNhbCIsInBsYXllckF0dGFjayIsImUiLCJ0YXJnZXQiLCJwYXJzZUludCIsImNvb3JkaW5hdGUiLCJjb252ZXJ0VG9BbHBoYW51bWVyaWMiLCJnZXRBdHRhY2tlZENvb3JkaW5hdGVzIiwiaW5jbHVkZXMiLCJhdHRhY2tlZFNoaXAiLCJyZWNlaXZlQXR0YWNrIiwiaXNTdW5rIiwiY29uc29sZSIsImxvZyIsImFsbFNoaXBzU3VuayIsImF0dGFjayIsInNsaWNlIiwiY2hhckNvZGVBdCIsImNvbXB1dGVyQXR0YWNrIiwicm90YXRlU2hpcHMiLCJzdGFydFJvdyIsInN0YXJ0Q29sIiwiQXJyYXkiLCJmcm9tIiwiXyIsImkiLCJpbml0aWFsU3F1YXJlIiwiaG92ZXJlZFNxdWFyZSIsInJlbW92ZSIsInNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJwbGFjZVNoaXAiLCJjb21wdXRlclNoaXBzIiwibWFwIiwic2hpcFR5cGUiLCJjb29yZGluYXRlcyIsInBsYWNlZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInBsYWNlQ29tcHV0ZXJTaGlwcyIsInNldFRpbWVvdXQiLCJ0b2dnbGVNb2RhbCIsIm5leHRTaGlwVHlwZSIsImluaXQiLCJTaGlwRmFjdG9yeSIsImhpdHMiLCJoaXQiLCJHYW1lYm9hcmRGYWN0b3J5IiwiZ3JpZFNpemUiLCJncmlkIiwiZmlsbCIsImF0dGFja2VkQ29vcmRpbmF0ZXMiLCJtaXNzZWRBdHRhY2tzIiwiZ2V0U2hpcHMiLCJzaGlwcyIsImNlbGwiLCJwdXNoIiwiZ2V0R3JpZCIsIndpdGhpbkJvdW5kYXJpZXMiLCJldmVyeSIsImNvbmZsaWN0cyIsInNvbWUiLCJhZGphY2VudENvbmZsaWN0cyIsImFkalJvdyIsImFkakNvbCIsInNoaXBJbmZvIiwiZ2V0U2hpcENvb3JkaW5hdGVzIiwiY29sdW1uTGV0dGVyIiwicm93TnVtYmVyIiwiZ2V0TWlzc2VkQXR0YWNrcyIsInJlc3VsdCIsIlBsYXllckZhY3RvcnkiLCJuYW1lIiwiU2V0IiwiZW5lbXlHYW1lYm9hcmQiLCJ2YWxpZENvb3JkaW5hdGVzIiwiZ2V0QWxsVmFsaWRDb29yZGluYXRlcyIsImhhcyIsIkZhY3RvcnlIZWxwZXJzIiwiY29udmVydFRvSW5kaWNlcyIsImNvbHVtbiIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImFscGhhbnVtZXJpY0Nvb3JkaW5hdGUiLCJBcHBIZWxwZXJzIiwibW9kYWwiLCJjaG9pY2UiLCJ0b2dnbGVkTW9kYWwiLCJkaXNwbGF5VmFsdWUiLCJjbG9zZXN0Iiwic3R5bGUiLCJkaXNwbGF5IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIl0sInNvdXJjZVJvb3QiOiIifQ==