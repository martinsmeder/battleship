(()=>{"use strict";var e={380:(e,t,o)=>{var r=o(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let o=0;o<10;o+=1){const r=document.createElement("div");r.classList.add("square"),r.dataset.row=e,r.dataset.col=o,t.appendChild(r)}},n=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))};var s=o(776);(()=>{const e=(0,s.Br)(),t=(0,s.Br)(),o=(0,s.oP)("computer"),l=[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}];let c=0,i=!0,d=!1;const u=a=>{if(!i){const n=a.target,s=parseInt(n.dataset.row,10),l=parseInt(n.dataset.col,10),c=r.r.convertToAlphanumeric([s,l]);if(!t.getAttackedCoordinates().includes(c)){const r=t.receiveAttack(c);r?(n.classList.add("hit"),console.log(`Player hit Computer at: ${c}`),r.isSunk()&&console.log(`Player sank Computer's ${r}!`)):(n.classList.add("miss"),console.log(`Player missed at: ${c}`)),t.allShipsSunk()&&console.log("Player wins!"),(()=>{if(!i){const t=o.attack(e),r=e.receiveAttack(t),a=parseInt(t[1],10)-1,n=t[0].charCodeAt(0)-65,s=document.querySelector(`.gameboard.player [data-row="${a}"][data-col="${n}"]`);r?(s.classList.add("hit"),console.log(`Computer hit Player at: ${t}`),r.isSunk()&&console.log(`Computer sank Player's ${r}!`)):(s.classList.add("miss"),console.log(`Computer missed at: ${t}`)),e.allShipsSunk()&&console.log("Computer wins!")}})()}}},p=()=>{d=!d},h=[{eventType:"mouseover",handler:e=>{if(i){const t=e.target,o=parseInt(t.dataset.row,10),r=parseInt(t.dataset.col,10),{length:a}=l[c];Array.from({length:a},((e,t)=>{const a=d?o+t:o,n=d?r:r+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-row="${a}"][data-col="${n}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:o=>{if(i){const a=o.target,n=parseInt(a.dataset.row,10),u=parseInt(a.dataset.col,10),{length:p}=l[c],h=Array.from({length:p},((e,t)=>[d?n+t:n,d?u:u+t])),m=(0,s._V)(p);if(e.placeShip(m,h))if(a.classList.add("placed"),h.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),c+=1,c===l.length)i=!1,(()=>{const o=[];for(let e=0;e<l.length;e+=1){const{type:r,length:a}=l[e];let n=[],c=!1;for(;!c;){const e=Math.floor(10*Math.random()),o=Math.floor(10*Math.random());d=Math.random()<.5,n=[],d?e+a-1<10&&(n=Array.from({length:a},((t,r)=>[e+r,o]))):o+a-1<10&&(n=Array.from({length:a},((t,r)=>[e,o+r]))),n.length>0&&(c=t.placeShip((0,s._V)(a),n))}n.forEach((([e,t])=>{document.querySelector(`.gameboard.computer [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),o.push({type:r,coordinates:n})}e.getShips().forEach(((t,o)=>{const r=e.getShipCoordinates(t);console.log(`Player's ${l[o].type} coordinates: ${r.join(", ")}`)})),o.sort(((e,t)=>l.findIndex((t=>t.type===e.type))-l.findIndex((e=>e.type===t.type)))).forEach((e=>{const t=e.coordinates.map((([e,t])=>r.r.convertToAlphanumeric([e,t])));console.log(`Computer's ${e.type} coordinates: ${t.join(", ")}`)}))})(),setTimeout((()=>{r.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=l[c].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{r.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),n(".gameboard.initial",h),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",u)})),document.querySelector("#rotateBtn").addEventListener("click",p)}}})().init()},776:(e,t,o)=>{o.d(t,{Br:()=>n,_V:()=>a,oP:()=>s});var r=o(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},n=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null))),o=[],a=[],n=()=>{const o=[];for(let r=0;r<e;r+=1)for(let a=0;a<e;a+=1){const e=t[r][a];null===e||!e.ship||o.includes(e.ship)||e.ship.isSunk()||o.push(e.ship)}return o};return{getGrid:()=>t,placeShip:(o,r)=>{const a=r.every((([t,o])=>t>=0&&t<e&&o>=0&&o<e)),n=r.some((([e,o])=>null!==t[e][o])),s=r.some((([o,r])=>[[o-1,r],[o+1,r],[o,r-1],[o,r+1],[o-1,r-1],[o-1,r+1],[o+1,r-1],[o+1,r+1]].some((([o,r])=>o>=0&&o<e&&r>=0&&r<e&&null!==t[o]?.[r]))));if(a&&!n&&!s){const e={ship:o,coordinates:r};return e.coordinates.forEach((([o,r])=>{t[o][r]=e})),!0}return!1},getShips:n,getShipCoordinates:o=>{const a=[];for(let n=0;n<e;n+=1)for(let s=0;s<e;s+=1){const e=t[n][s];e&&e.ship===o&&a.push(r.r.convertToAlphanumeric([n,s]))}return a},receiveAttack:e=>{const[r,n]=e,s=parseInt(n,10)-1,l=r.charCodeAt(0)-65,c=t[s][l];if(null!==c){const{ship:t}=c;return t.hit(),o.push(e),t}return a.push(e),o.push(e),null},getMissedAttacks:()=>a,getAttackedCoordinates:()=>o,allShipsSunk:()=>{const e=n().every((e=>e.isSunk()));return console.log("All ships sunk:",e),e}}},s=e=>{const t=new Set;return{name:e,attack:e=>{const o=e.getGrid().length,a=r.r.getAllValidCoordinates(o);let n="";do{n=a[Math.floor(Math.random()*a.length)]}while(t.has(n)||e.getAttackedCoordinates().includes(n));return t.add(n),e.receiveAttack(n),n}}}},555:(e,t,o)=>{o.d(t,{U:()=>a,r:()=>r});const r=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let o=0;o<t;o+=1)for(let a=0;a<t;a+=1){const t=r.convertToAlphanumeric([o,a]);e.push(t)}return e}}})(),a={toggleModal:(e,t)=>{const o=e,r="show"===t?"flex":"none";e.closest(".overlay").style.display=r,o.style.display=r}}}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(380),o(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBakJELEVBQ0gsT0FBT0EsRUFBYUUsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJFLEdBQVksQ0FHakRHLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CTCxHQUFVSSxFQUFRQSxFQUFPRCxRQUFTSixHQUcvQ0ssRUFBT0QsT0FDZixDQ3JCQUosRUFBb0JPLEVBQUksQ0FBQ0gsRUFBU0ksS0FDakMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYUixFQUFvQlUsRUFBRUYsRUFBWUMsS0FBU1QsRUFBb0JVLEVBQUVOLEVBQVNLLElBQzVFRSxPQUFPQyxlQUFlUixFQUFTSyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JVLEVBQUksQ0FBQ0ssRUFBS0MsSUFBVUwsT0FBT00sVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NFbEZoQixFQUFvQixLQUVNQSxFQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9yZW5kZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hcHAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy91dGlscy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGlzIG1vZHVsZSBjYW4gYmUgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBjb250ZW50IG9uIHRoZSBwYWdlLlxuLy8gSXQgY2FuIGluY2x1ZGUgZnVuY3Rpb25zIHRvIHVwZGF0ZSB0aGUgRE9NIGVsZW1lbnRzIHJlcHJlc2VudGluZyB0aGVcbi8vIGdhbWUgYm9hcmRzLCBzaGlwcywgYXR0YWNrcywgbWVzc2FnZXMsIGFuZCBvdGhlciBVSSBjb21wb25lbnRzLiBJdCBzaG91bGRcbi8vIGVuY2Fwc3VsYXRlIHRoZSBET00gbWFuaXB1bGF0aW9uIGNvZGUgYW5kIHByb3ZpZGUgYSBjbGVhbiBpbnRlcmZhY2UgZm9yXG4vLyB1cGRhdGluZyB0aGUgVUkgYmFzZWQgb24gdGhlIGdhbWUgc3RhdGUuIEl0IGNhbiBiZSB0aGUgYnJpZGdlIGJldHdlZW4gdGhlXG4vLyBnYW1lIGxvZ2ljIGFuZCB0aGUgYWN0dWFsIERPTSBtYW5pcHVsYXRpb24uXG5cbmNvbnN0IFJlbmRlcmVyID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgMTA7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlXCIpO1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5yb3cgPSByb3c7XG4gICAgICAgIHNxdWFyZS5kYXRhc2V0LmNvbCA9IGNvbDtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYXR0YWNoRXZlbnRMaXN0ZW5lcnMgPSAoY29udGFpbmVyRWxlbWVudCwgZXZlbnRMaXN0ZW5lcnMpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3F1YXJlXCIpLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgZXZlbnRMaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcbiAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIobGlzdGVuZXIuZXZlbnRUeXBlLCBsaXN0ZW5lci5oYW5kbGVyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHNldFdpbm5lckhlYWRpbmcgPSAod2lubmVyKSA9PiB7XG4gICAgY29uc3Qgd2lubmVySGVhZGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd2lubmVyXCIpO1xuICAgIHdpbm5lckhlYWRpbmcudGV4dENvbnRlbnQgPSBgJHt3aW5uZXJ9IHdvbiFgO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkLFxuICAgIGF0dGFjaEV2ZW50TGlzdGVuZXJzLFxuICAgIHNldFdpbm5lckhlYWRpbmcsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBSZW5kZXJlcjtcbiIsIi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuaW1wb3J0IHsgQXBwSGVscGVycywgRmFjdG9yeUhlbHBlcnMgfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IFJlbmRlcmVyIGZyb20gXCIuL3JlbmRlclwiO1xuaW1wb3J0IHsgU2hpcEZhY3RvcnksIEdhbWVib2FyZEZhY3RvcnksIFBsYXllckZhY3RvcnkgfSBmcm9tIFwiLi9mYWN0b3JpZXNcIjtcblxuLy8gMS4gLS0tXG4vLyAyLiAtLS1cbi8vIDMuIC0tLVxuLy8gNC4gLS0tXG4vLyA1LiAtLS1cbi8vIDYuIC0tLVxuLy8gNy4gaGFuZGxlIHdpbm5lclxuLy8gOC4gZGlzcGxheSB3aW5uZXJcblxuY29uc3QgQ29udHJvbGxlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHBsYXllckdhbWVib2FyZCA9IEdhbWVib2FyZEZhY3RvcnkoKTtcbiAgY29uc3QgY29tcHV0ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmRGYWN0b3J5KCk7XG5cbiAgY29uc3QgY29tcHV0ZXIgPSBQbGF5ZXJGYWN0b3J5KFwiY29tcHV0ZXJcIik7XG5cbiAgY29uc3Qgc2hpcFR5cGVzID0gW1xuICAgIHsgdHlwZTogXCJjYXJyaWVyXCIsIGxlbmd0aDogNSB9LFxuICAgIHsgdHlwZTogXCJiYXR0bGVzaGlwXCIsIGxlbmd0aDogNCB9LFxuICAgIHsgdHlwZTogXCJkZXN0cm95ZXJcIiwgbGVuZ3RoOiAzIH0sXG4gICAgeyB0eXBlOiBcInN1Ym1hcmluZVwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwicGF0cm9sIGJvYXRcIiwgbGVuZ3RoOiAyIH0sXG4gIF07XG5cbiAgbGV0IGN1cnJlbnRTaGlwSW5kZXggPSAwO1xuICBsZXQgc2hpcFBsYWNlbWVudE1vZGUgPSB0cnVlO1xuICBsZXQgaXNWZXJ0aWNhbCA9IGZhbHNlO1xuXG4gIGNvbnN0IHBsYWNlQ29tcHV0ZXJTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBjb21wdXRlclNoaXBzID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNoaXBUeXBlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgY29uc3QgeyB0eXBlLCBsZW5ndGggfSA9IHNoaXBUeXBlc1tpXTtcbiAgICAgIGxldCBjb29yZGluYXRlcyA9IFtdO1xuICAgICAgbGV0IHBsYWNlZCA9IGZhbHNlO1xuXG4gICAgICB3aGlsZSAoIXBsYWNlZCkge1xuICAgICAgICBjb25zdCBzdGFydFJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgY29uc3Qgc3RhcnRDb2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIGlzVmVydGljYWwgPSBNYXRoLnJhbmRvbSgpIDwgMC41O1xuICAgICAgICBjb29yZGluYXRlcyA9IFtdO1xuXG4gICAgICAgIGlmIChpc1ZlcnRpY2FsKSB7XG4gICAgICAgICAgaWYgKHN0YXJ0Um93ICsgbGVuZ3RoIC0gMSA8IDEwKSB7XG4gICAgICAgICAgICBjb29yZGluYXRlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGopID0+IFtcbiAgICAgICAgICAgICAgc3RhcnRSb3cgKyBqLFxuICAgICAgICAgICAgICBzdGFydENvbCxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChzdGFydENvbCArIGxlbmd0aCAtIDEgPCAxMCkge1xuICAgICAgICAgIGNvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaikgPT4gW1xuICAgICAgICAgICAgc3RhcnRSb3csXG4gICAgICAgICAgICBzdGFydENvbCArIGosXG4gICAgICAgICAgXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29vcmRpbmF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHBsYWNlZCA9IGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChcbiAgICAgICAgICAgIFNoaXBGYWN0b3J5KGxlbmd0aCksXG4gICAgICAgICAgICBjb29yZGluYXRlc1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29vcmRpbmF0ZXMuZm9yRWFjaCgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgICBjb25zdCBwbGFjZWRTcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIGAuZ2FtZWJvYXJkLmNvbXB1dGVyIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgKTtcbiAgICAgICAgcGxhY2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICB9KTtcblxuICAgICAgY29tcHV0ZXJTaGlwcy5wdXNoKHsgdHlwZSwgY29vcmRpbmF0ZXMgfSk7XG4gICAgfVxuXG4gICAgY29uc3QgcGxheWVyU2hpcHMgPSBwbGF5ZXJHYW1lYm9hcmQuZ2V0U2hpcHMoKTtcbiAgICBwbGF5ZXJTaGlwcy5mb3JFYWNoKChzaGlwLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgY29vcmRpbmF0ZXMgPSBwbGF5ZXJHYW1lYm9hcmQuZ2V0U2hpcENvb3JkaW5hdGVzKHNoaXApO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBQbGF5ZXIncyAke3NoaXBUeXBlc1tpbmRleF0udHlwZX0gY29vcmRpbmF0ZXM6ICR7Y29vcmRpbmF0ZXMuam9pbihcbiAgICAgICAgICBcIiwgXCJcbiAgICAgICAgKX1gXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgc29ydGVkQ29tcHV0ZXJTaGlwcyA9IGNvbXB1dGVyU2hpcHMuc29ydChcbiAgICAgIChhLCBiKSA9PlxuICAgICAgICBzaGlwVHlwZXMuZmluZEluZGV4KChzKSA9PiBzLnR5cGUgPT09IGEudHlwZSkgLVxuICAgICAgICBzaGlwVHlwZXMuZmluZEluZGV4KChzKSA9PiBzLnR5cGUgPT09IGIudHlwZSlcbiAgICApO1xuXG4gICAgc29ydGVkQ29tcHV0ZXJTaGlwcy5mb3JFYWNoKChzaGlwKSA9PiB7XG4gICAgICBjb25zdCBjb29yZGluYXRlcyA9IHNoaXAuY29vcmRpbmF0ZXMubWFwKChbcm93LCBjb2xdKSA9PlxuICAgICAgICBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW3JvdywgY29sXSlcbiAgICAgICk7XG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYENvbXB1dGVyJ3MgJHtzaGlwLnR5cGV9IGNvb3JkaW5hdGVzOiAke2Nvb3JkaW5hdGVzLmpvaW4oXCIsIFwiKX1gXG4gICAgICApO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHNoaXBQbGFjZW1lbnRIYW5kbGVyID0gKGUpID0+IHtcbiAgICBpZiAoc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0O1xuICAgICAgY29uc3Qgc3RhcnRSb3cgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5yb3csIDEwKTtcbiAgICAgIGNvbnN0IHN0YXJ0Q29sID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQuY29sLCAxMCk7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdO1xuXG4gICAgICBjb25zdCBzaGlwQ29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4gW3JvdywgY29sXTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzaGlwID0gU2hpcEZhY3RvcnkobGVuZ3RoKTtcbiAgICAgIGNvbnN0IHBsYWNlZCA9IHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcCwgc2hpcENvb3JkaW5hdGVzKTtcblxuICAgICAgaWYgKHBsYWNlZCkge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgc2hpcENvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgICBjb25zdCBwbGFjZWRTcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgICApO1xuICAgICAgICAgIHBsYWNlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICAgIGNvbnN0IGluaXRpYWxTcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYC5nYW1lYm9hcmQuaW5pdGlhbCBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpbml0aWFsU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGN1cnJlbnRTaGlwSW5kZXggKz0gMTtcblxuICAgICAgICBpZiAoY3VycmVudFNoaXBJbmRleCA9PT0gc2hpcFR5cGVzLmxlbmd0aCkge1xuICAgICAgICAgIHNoaXBQbGFjZW1lbnRNb2RlID0gZmFsc2U7XG4gICAgICAgICAgcGxhY2VDb21wdXRlclNoaXBzKCk7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmluaXRpYWxcIiksXG4gICAgICAgICAgICAgIFwiaGlkZVwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgbmV4dFNoaXBUeXBlID0gc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdLnR5cGU7XG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zaGlwLXR5cGVcIikudGV4dENvbnRlbnQgPSBuZXh0U2hpcFR5cGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2FtZWJvYXJkSG92ZXJIYW5kbGVyID0gKGUpID0+IHtcbiAgICBpZiAoc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0O1xuICAgICAgY29uc3Qgc3RhcnRSb3cgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5yb3csIDEwKTtcbiAgICAgIGNvbnN0IHN0YXJ0Q29sID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQuY29sLCAxMCk7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdO1xuXG4gICAgICBjb25zdCBob3ZlcmVkU3F1YXJlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGkpID0+IHtcbiAgICAgICAgY29uc3Qgcm93ID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Um93ICsgaSA6IHN0YXJ0Um93O1xuICAgICAgICBjb25zdCBjb2wgPSBpc1ZlcnRpY2FsID8gc3RhcnRDb2wgOiBzdGFydENvbCArIGk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZTogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICksXG4gICAgICAgIH07XG4gICAgICB9KTtcblxuICAgICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoeyBpbml0aWFsU3F1YXJlIH0pID0+IHtcbiAgICAgICAgaWYgKGluaXRpYWxTcXVhcmUpIHtcbiAgICAgICAgICBpbml0aWFsU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJob3ZlcmVkXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2FtZWJvYXJkTW91c2VMZWF2ZUhhbmRsZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWVib2FyZCAuaG92ZXJlZFwiKTtcbiAgICBob3ZlcmVkU3F1YXJlcy5mb3JFYWNoKChob3ZlcmVkU3F1YXJlKSA9PiB7XG4gICAgICBob3ZlcmVkU3F1YXJlLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlcmVkXCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNvbXB1dGVyQXR0YWNrID0gKCkgPT4ge1xuICAgIGlmICghc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBjb21wdXRlci5hdHRhY2socGxheWVyR2FtZWJvYXJkKTtcbiAgICAgIGNvbnN0IGF0dGFja2VkU2hpcCA9IHBsYXllckdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuXG4gICAgICBjb25zdCByb3cgPSBwYXJzZUludChjb29yZGluYXRlWzFdLCAxMCkgLSAxO1xuICAgICAgY29uc3QgY29sID0gY29vcmRpbmF0ZVswXS5jaGFyQ29kZUF0KDApIC0gNjU7XG5cbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAuZ2FtZWJvYXJkLnBsYXllciBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICApO1xuXG4gICAgICBpZiAoYXR0YWNrZWRTaGlwKSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhgQ29tcHV0ZXIgaGl0IFBsYXllciBhdDogJHtjb29yZGluYXRlfWApO1xuXG4gICAgICAgIGlmIChhdHRhY2tlZFNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgQ29tcHV0ZXIgc2FuayBQbGF5ZXIncyAke2F0dGFja2VkU2hpcH0hYCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgICAgICAgY29uc29sZS5sb2coYENvbXB1dGVyIG1pc3NlZCBhdDogJHtjb29yZGluYXRlfWApO1xuICAgICAgfVxuXG4gICAgICBpZiAocGxheWVyR2FtZWJvYXJkLmFsbFNoaXBzU3VuaygpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ29tcHV0ZXIgd2lucyFcIik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHBsYXllckF0dGFjayA9IChlKSA9PiB7XG4gICAgaWYgKCFzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCByb3cgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5yb3csIDEwKTtcbiAgICAgIGNvbnN0IGNvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKTtcblxuICAgICAgaWYgKCFjb21wdXRlckdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSkpIHtcbiAgICAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gY29tcHV0ZXJHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcblxuICAgICAgICBpZiAoYXR0YWNrZWRTaGlwKSB7XG4gICAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coYFBsYXllciBoaXQgQ29tcHV0ZXIgYXQ6ICR7Y29vcmRpbmF0ZX1gKTtcblxuICAgICAgICAgIGlmIChhdHRhY2tlZFNoaXAuaXNTdW5rKCkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBQbGF5ZXIgc2FuayBDb21wdXRlcidzICR7YXR0YWNrZWRTaGlwfSFgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJtaXNzXCIpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBQbGF5ZXIgbWlzc2VkIGF0OiAke2Nvb3JkaW5hdGV9YCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcHV0ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlBsYXllciB3aW5zIVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbXB1dGVyQXR0YWNrKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJvdGF0ZVNoaXBzID0gKCkgPT4ge1xuICAgIGlzVmVydGljYWwgPSAhaXNWZXJ0aWNhbDtcbiAgfTtcblxuICBjb25zdCBldmVudExpc3RlbmVycyA9IFtcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZW92ZXJcIiwgaGFuZGxlcjogZ2FtZWJvYXJkSG92ZXJIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwibW91c2VsZWF2ZVwiLCBoYW5kbGVyOiBnYW1lYm9hcmRNb3VzZUxlYXZlSGFuZGxlciB9LFxuICAgIHsgZXZlbnRUeXBlOiBcImNsaWNrXCIsIGhhbmRsZXI6IHNoaXBQbGFjZW1lbnRIYW5kbGVyIH0sXG4gIF07XG5cbiAgY29uc3QgaW5pdCA9ICgpID0+IHtcbiAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSwgXCJoaWRlXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuaW5pdGlhbFwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLnBsYXllclwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmNvbXB1dGVyXCIpO1xuICAgIFJlbmRlcmVyLmF0dGFjaEV2ZW50TGlzdGVuZXJzKFwiLmdhbWVib2FyZC5pbml0aWFsXCIsIGV2ZW50TGlzdGVuZXJzKTtcblxuICAgIGNvbnN0IGNvbXB1dGVyU3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBcIi5nYW1lYm9hcmQuY29tcHV0ZXIgLnNxdWFyZVwiXG4gICAgKTtcbiAgICBjb21wdXRlclNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHBsYXllckF0dGFjayk7XG4gICAgfSk7XG5cbiAgICBjb25zdCByb3RhdGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JvdGF0ZUJ0blwiKTtcbiAgICByb3RhdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJvdGF0ZVNoaXBzKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gIH07XG59KSgpO1xuXG5Db250cm9sbGVyLmluaXQoKTtcbiIsImltcG9ydCB7IEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGNvbnN0IFNoaXBGYWN0b3J5ID0gKGxlbmd0aCkgPT4ge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdHMgKz0gMTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBoaXRzID49IGxlbmd0aDsgLy8gUmV0dXJuIHRydWUgaWYgaGl0cyBpcyBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gbGVuZ3RoXG5cbiAgcmV0dXJuIHtcbiAgICBsZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXQgaGl0cygpIHtcbiAgICAgIC8vIEdldHRlciBmdW5jdGlvbiBmb3IgaGl0cy4gVXNpbmcgZnVuY3Rpb24gZGVjbGFyYXRpb24gdG8gZW5zdXJlIGl0IGhhcyBhY2Nlc3MgdG8gdGhlXG4gICAgICAvLyBgaGl0c2AgdmFyaWFibGUgZHluYW1pY2FsbHksIHNpbmNlIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBhcmUgaG9pc3RlZCBhbmQgY2FuIGJlIHVzZWRcbiAgICAgIC8vIGJlZm9yZSB0aGV5IGFyZSBkZWZpbmVkLiBUaGlzIGFsbG93cyBhY2Nlc3NpbmcgdGhlIGN1cnJlbnQgdmFsdWUgb2YgYGhpdHNgIGV2ZW4gYmVmb3JlXG4gICAgICAvLyBjYWxsaW5nIHRoZSBgaGl0YCBmdW5jdGlvblxuICAgICAgcmV0dXJuIGhpdHM7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBHYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBjb25zdCBncmlkU2l6ZSA9IDEwO1xuICBjb25zdCBncmlkID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogZ3JpZFNpemUgfSwgKCkgPT5cbiAgICBBcnJheShncmlkU2l6ZSkuZmlsbChudWxsKVxuICApO1xuXG4gIGNvbnN0IGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBbXTtcbiAgY29uc3QgbWlzc2VkQXR0YWNrcyA9IFtdO1xuXG4gIGNvbnN0IGdldEdyaWQgPSAoKSA9PiBncmlkO1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb29yZGluYXRlcykgPT4ge1xuICAgIC8vIENoZWNrIGlmIGFsbCBjb29yZGluYXRlcyBhcmUgd2l0aGluIHRoZSBib3VuZGFyaWVzIG9mIHRoZSBncmlkXG4gICAgY29uc3Qgd2l0aGluQm91bmRhcmllcyA9IGNvb3JkaW5hdGVzLmV2ZXJ5KFxuICAgICAgKFtyb3csIGNvbF0pID0+IHJvdyA+PSAwICYmIHJvdyA8IGdyaWRTaXplICYmIGNvbCA+PSAwICYmIGNvbCA8IGdyaWRTaXplXG4gICAgKTtcblxuICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgY29uZmxpY3RzIHdpdGggZXhpc3Rpbmcgc2hpcCBwbGFjZW1lbnRzIG9uIHRoZSBncmlkXG4gICAgY29uc3QgY29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4gZ3JpZFtyb3ddW2NvbF0gIT09IG51bGwpO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBhZGphY2VudCBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBhZGphY2VudENvbmZsaWN0cyA9IGNvb3JkaW5hdGVzLnNvbWUoKFtyb3csIGNvbF0pID0+IHtcbiAgICAgIGNvbnN0IGFkamFjZW50Q29vcmRpbmF0ZXMgPSBbXG4gICAgICAgIFtyb3cgLSAxLCBjb2xdLCAvLyBVcFxuICAgICAgICBbcm93ICsgMSwgY29sXSwgLy8gRG93blxuICAgICAgICBbcm93LCBjb2wgLSAxXSwgLy8gTGVmdFxuICAgICAgICBbcm93LCBjb2wgKyAxXSwgLy8gUmlnaHRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCAtIDFdLCAvLyBEaWFnb25hbCBVcC1MZWZ0XG4gICAgICAgIFtyb3cgLSAxLCBjb2wgKyAxXSwgLy8gRGlhZ29uYWwgVXAtUmlnaHRcbiAgICAgICAgW3JvdyArIDEsIGNvbCAtIDFdLCAvLyBEaWFnb25hbCBEb3duLUxlZnRcbiAgICAgICAgW3JvdyArIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBEb3duLVJpZ2h0XG4gICAgICBdO1xuXG4gICAgICByZXR1cm4gYWRqYWNlbnRDb29yZGluYXRlcy5zb21lKFxuICAgICAgICAoW2FkalJvdywgYWRqQ29sXSkgPT5cbiAgICAgICAgICBhZGpSb3cgPj0gMCAmJlxuICAgICAgICAgIGFkalJvdyA8IGdyaWRTaXplICYmXG4gICAgICAgICAgYWRqQ29sID49IDAgJiZcbiAgICAgICAgICBhZGpDb2wgPCBncmlkU2l6ZSAmJlxuICAgICAgICAgIGdyaWRbYWRqUm93XT8uW2FkakNvbF0gIT09IG51bGxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBJZiB0aGUgc2hpcCBwbGFjZW1lbnQgaXMgd2l0aGluIGdyaWQgYm91bmRhcmllcywgaGFzIG5vIGNvbmZsaWN0cyBhbmQgbm8gYWRqYWNlbnRcbiAgICAvLyBjb25mbGljdHMuLi5cbiAgICBpZiAod2l0aGluQm91bmRhcmllcyAmJiAhY29uZmxpY3RzICYmICFhZGphY2VudENvbmZsaWN0cykge1xuICAgICAgLy8gQ3JlYXRlIGFuIG9iamVjdCBjb250YWluaW5nIHNoaXAgaW5mb3JtYXRpb24gYW5kIGNvb3JkaW5hdGVzXG4gICAgICBjb25zdCBzaGlwSW5mbyA9IHtcbiAgICAgICAgc2hpcCxcbiAgICAgICAgY29vcmRpbmF0ZXMsXG4gICAgICB9O1xuXG4gICAgICAvLyBQbGFjZSB0aGUgc2hpcCBvbiB0aGUgZ3JpZCBieSB1cGRhdGluZyB0aGUgY29ycmVzcG9uZGluZyBjZWxsc1xuICAgICAgc2hpcEluZm8uY29vcmRpbmF0ZXMuZm9yRWFjaCgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgICBncmlkW3Jvd11bY29sXSA9IHNoaXBJbmZvO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cnVlOyAvLyBTaGlwIHBsYWNlbWVudCBzdWNjZXNzZnVsXG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBPdGhlcndpc2UsIHNoaXAgcGxhY2VtZW50IGZhaWxlZFxuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gW107XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBjZWxsIG9mIHRoZSBncmlkXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2VsbCBjb250YWlucyBhIHNoaXAgYW5kIGl0J3Mgbm90IGFscmVhZHkgaW5jbHVkZWQgaW4gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjZWxsICE9PSBudWxsICYmXG4gICAgICAgICAgY2VsbC5zaGlwICYmXG4gICAgICAgICAgIXNoaXBzLmluY2x1ZGVzKGNlbGwuc2hpcCkgJiZcbiAgICAgICAgICAhY2VsbC5zaGlwLmlzU3VuaygpXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIEFkZCB0aGUgc2hpcCB0byB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgICBzaGlwcy5wdXNoKGNlbGwuc2hpcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc2hpcHM7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcENvb3JkaW5hdGVzID0gKHNoaXApID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgZXhpc3RzIGFuZCBjb250YWlucyB0aGUgc3BlY2lmaWVkIHNoaXBcbiAgICAgICAgaWYgKGNlbGwgJiYgY2VsbC5zaGlwID09PSBzaGlwKSB7XG4gICAgICAgICAgLy8gQ29udmVydCB0aGUgcm93IGFuZCBjb2x1bW4gaW5kaWNlcyB0byBhbHBoYW51bWVyaWMgY29vcmRpbmF0ZXMgYW5kIGFkZCB0aGVtIHRvXG4gICAgICAgICAgLy8gdGhlIGNvb3JkaW5hdGVzIGFycmF5XG4gICAgICAgICAgY29vcmRpbmF0ZXMucHVzaChGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW3JvdywgY29sXSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IFtjb2x1bW5MZXR0ZXIsIHJvd051bWJlcl0gPSBjb29yZGluYXRlO1xuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KHJvd051bWJlciwgMTApIC0gMTtcbiAgICBjb25zdCBjb2wgPSBjb2x1bW5MZXR0ZXIuY2hhckNvZGVBdCgwKSAtIDY1O1xuICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcblxuICAgIGlmIChjZWxsICE9PSBudWxsKSB7XG4gICAgICAvLyBTaGlwIGF0IGNvb3JkaW5hdGUsIGl0J3MgYSBoaXRcbiAgICAgIGNvbnN0IHsgc2hpcCB9ID0gY2VsbDtcbiAgICAgIHNoaXAuaGl0KCk7IC8vIEluY3JlbWVudCBoaXQgY291bnQgb2YgdGhlIHNoaXBcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMucHVzaChjb29yZGluYXRlKTtcbiAgICAgIHJldHVybiBzaGlwOyAvLyBSZXR1cm4gdGhlIHNoaXAgb2JqZWN0IHdoZW4gaXQgaXMgaGl0XG4gICAgfVxuICAgIC8vIE5vIHNoaXAgYXQgY29vcmRpbmF0ZSwgaXQncyBhIG1pc3NcbiAgICBtaXNzZWRBdHRhY2tzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5wdXNoKGNvb3JkaW5hdGUpO1xuICAgIHJldHVybiBudWxsOyAvLyBSZXR1cm4gbnVsbCB3aGVuIGl0J3MgYSBtaXNzXG4gIH07XG5cbiAgY29uc3QgZ2V0TWlzc2VkQXR0YWNrcyA9ICgpID0+IG1pc3NlZEF0dGFja3M7XG5cbiAgY29uc3QgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyA9ICgpID0+IGF0dGFja2VkQ29vcmRpbmF0ZXM7XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gZ2V0U2hpcHMoKTsgLy8gUmV0cmlldmUgYWxsIHRoZSBzaGlwcyBvbiB0aGUgZ2FtZWJvYXJkXG5cbiAgICAvLyBDaGVjayBpZiBhbGwgc2hpcHMgYXJlIHN1bmssIHJldHVybiB0cnVlIGlmIHllcywgYW5kIHJldHVybiBmYWxzZSBpZiBub1xuICAgIGNvbnN0IHJlc3VsdCA9IHNoaXBzLmV2ZXJ5KChzaGlwKSA9PiBzaGlwLmlzU3VuaygpKTtcblxuICAgIGNvbnNvbGUubG9nKFwiQWxsIHNoaXBzIHN1bms6XCIsIHJlc3VsdCk7IC8vIExvZyB0aGUgcmVzdWx0IHRvIHRlc3RcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRHcmlkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRTaGlwcyxcbiAgICBnZXRTaGlwQ29vcmRpbmF0ZXMsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBnZXRNaXNzZWRBdHRhY2tzLFxuICAgIGdldEF0dGFja2VkQ29vcmRpbmF0ZXMsXG4gICAgYWxsU2hpcHNTdW5rLFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IFBsYXllckZhY3RvcnkgPSAobmFtZSkgPT4ge1xuICBjb25zdCBhdHRhY2tlZENvb3JkaW5hdGVzID0gbmV3IFNldCgpOyAvLyBTZXQgdG8ga2VlcCB0cmFjayBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuXG4gIGNvbnN0IGF0dGFjayA9IChlbmVteUdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IGdyaWRTaXplID0gZW5lbXlHYW1lYm9hcmQuZ2V0R3JpZCgpLmxlbmd0aDtcbiAgICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gRmFjdG9yeUhlbHBlcnMuZ2V0QWxsVmFsaWRDb29yZGluYXRlcyhncmlkU2l6ZSk7XG5cbiAgICBsZXQgY29vcmRpbmF0ZSA9IFwiXCI7XG5cbiAgICAvLyBQZXJmb3JtIGEgZG8td2hpbGUgbG9vcCB1bnRpbCBhIHVuaXF1ZSBjb29yZGluYXRlIGlzIGZvdW5kXG4gICAgZG8ge1xuICAgICAgLy8gR2VuZXJhdGUgYSByYW5kb20gaW5kZXggYmFzZWQgb24gdGhlIGxlbmd0aCBvZiB2YWxpZENvb3JkaW5hdGVzIGFycmF5XG4gICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkQ29vcmRpbmF0ZXMubGVuZ3RoKTtcblxuICAgICAgLy8gR2V0IHRoZSBjb29yZGluYXRlIGF0IHRoZSByYW5kb20gaW5kZXhcbiAgICAgIGNvb3JkaW5hdGUgPSB2YWxpZENvb3JkaW5hdGVzW3JhbmRvbUluZGV4XTtcbiAgICB9IHdoaWxlIChcbiAgICAgIC8vIENvbnRpbnVlIGxvb3Bpbmcgd2l0aG91dCBwZXJmb3JtaW5nIGFueSBhY3Rpb25zIGlmIHRoZSBjb29yZGluYXRlIGlzIGFscmVhZHlcbiAgICAgIC8vIGluIHRoZSBwbGF5ZXJzIGF0dGFja2VkQ29vcmRpbmF0ZXMgc2V0IG9yIGlzIGluY2x1ZGVkIGluIHRoZSBlbmVteUdhbWVib2FyZHNcbiAgICAgIC8vIGF0dGFja2VkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuaGFzKGNvb3JkaW5hdGUpIHx8XG4gICAgICBlbmVteUdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSlcbiAgICApO1xuXG4gICAgLy8gQWRkIHRoZSBhdHRhY2tlZCBjb29yZGluYXRlIHRvIHRoZSBwbGF5ZXJzIHNldCBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuYWRkKGNvb3JkaW5hdGUpO1xuXG4gICAgLy8gUGVyZm9ybSB0aGUgYXR0YWNrIG9uIHRoZSBlbmVteSBnYW1lYm9hcmRcbiAgICBlbmVteUdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGU7IC8vIFJldHVybiB0aGUgY29vcmRpbmF0ZSBhcyBhbiBhcnJheVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICBhdHRhY2ssXG4gIH07XG59O1xuIiwiZXhwb3J0IGNvbnN0IEZhY3RvcnlIZWxwZXJzID0gKCgpID0+IHtcbiAgY29uc3QgdmFsaWRDb29yZGluYXRlcyA9IFtdO1xuXG4gIGNvbnN0IGNvbnZlcnRUb0luZGljZXMgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IGNvbHVtbiA9IGNvb3JkaW5hdGUuY2hhckNvZGVBdCgwKSAtIDY1OyAvLyBDb252ZXJ0IGNvbHVtbiBsZXR0ZXIgdG8gaW5kZXhcbiAgICBjb25zdCByb3cgPSBwYXJzZUludChjb29yZGluYXRlLnNsaWNlKDEpLCAxMCkgLSAxOyAvLyBDb252ZXJ0IHJvdyBudW1iZXIgdG8gaW5kZXggd2l0aCByYWRpeCAxMFxuICAgIHJldHVybiBbcm93LCBjb2x1bW5dO1xuICB9O1xuXG4gIGNvbnN0IGNvbnZlcnRUb0FscGhhbnVtZXJpYyA9IChbcm93LCBjb2x1bW5dKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29sdW1uICsgNjUpOyAvLyBDb252ZXJ0IGNvbHVtbiBpbmRleCB0byBsZXR0ZXJcbiAgICByZXR1cm4gY29vcmRpbmF0ZSArIChyb3cgKyAxKTsgLy8gQ29udmVydCByb3cgaW5kZXggdG8gbnVtYmVyXG4gIH07XG5cbiAgY29uc3QgZ2V0QWxsVmFsaWRDb29yZGluYXRlcyA9IChncmlkU2l6ZSkgPT4ge1xuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGFscGhhbnVtZXJpY0Nvb3JkaW5hdGUgPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW1xuICAgICAgICAgIHJvdyxcbiAgICAgICAgICBjb2wsXG4gICAgICAgIF0pO1xuICAgICAgICB2YWxpZENvb3JkaW5hdGVzLnB1c2goYWxwaGFudW1lcmljQ29vcmRpbmF0ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkQ29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBjb252ZXJ0VG9JbmRpY2VzLFxuICAgIGNvbnZlcnRUb0FscGhhbnVtZXJpYyxcbiAgICBnZXRBbGxWYWxpZENvb3JkaW5hdGVzLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGNvbnN0IEFwcEhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB0b2dnbGVNb2RhbCA9IChtb2RhbCwgY2hvaWNlKSA9PiB7XG4gICAgY29uc3QgdG9nZ2xlZE1vZGFsID0gbW9kYWw7XG5cbiAgICBjb25zdCBvdmVybGF5ID0gbW9kYWwuY2xvc2VzdChcIi5vdmVybGF5XCIpO1xuICAgIGNvbnN0IGRpc3BsYXlWYWx1ZSA9IGNob2ljZSA9PT0gXCJzaG93XCIgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVZhbHVlO1xuICAgIHRvZ2dsZWRNb2RhbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVZhbHVlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgdG9nZ2xlTW9kYWwsXG4gIH07XG59KSgpO1xuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18oMzgwKTtcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNzc2KTtcbiJdLCJuYW1lcyI6WyJjb250YWluZXJFbGVtZW50IiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidGV4dENvbnRlbnQiLCJyb3ciLCJjb2wiLCJzcXVhcmUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsImFwcGVuZENoaWxkIiwiZXZlbnRMaXN0ZW5lcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImxpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50VHlwZSIsImhhbmRsZXIiLCJwbGF5ZXJHYW1lYm9hcmQiLCJjb21wdXRlckdhbWVib2FyZCIsImNvbXB1dGVyIiwic2hpcFR5cGVzIiwidHlwZSIsImxlbmd0aCIsImN1cnJlbnRTaGlwSW5kZXgiLCJzaGlwUGxhY2VtZW50TW9kZSIsImlzVmVydGljYWwiLCJwbGF5ZXJBdHRhY2siLCJlIiwidGFyZ2V0IiwicGFyc2VJbnQiLCJjb29yZGluYXRlIiwiY29udmVydFRvQWxwaGFudW1lcmljIiwiZ2V0QXR0YWNrZWRDb29yZGluYXRlcyIsImluY2x1ZGVzIiwiYXR0YWNrZWRTaGlwIiwicmVjZWl2ZUF0dGFjayIsImNvbnNvbGUiLCJsb2ciLCJpc1N1bmsiLCJhbGxTaGlwc1N1bmsiLCJhdHRhY2siLCJjaGFyQ29kZUF0IiwiY29tcHV0ZXJBdHRhY2siLCJyb3RhdGVTaGlwcyIsInN0YXJ0Um93Iiwic3RhcnRDb2wiLCJBcnJheSIsImZyb20iLCJfIiwiaSIsImluaXRpYWxTcXVhcmUiLCJob3ZlcmVkU3F1YXJlIiwicmVtb3ZlIiwic2hpcENvb3JkaW5hdGVzIiwic2hpcCIsInBsYWNlU2hpcCIsImNvbXB1dGVyU2hpcHMiLCJjb29yZGluYXRlcyIsInBsYWNlZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImoiLCJwdXNoIiwiZ2V0U2hpcHMiLCJpbmRleCIsImdldFNoaXBDb29yZGluYXRlcyIsImpvaW4iLCJzb3J0IiwiYSIsImIiLCJmaW5kSW5kZXgiLCJzIiwibWFwIiwicGxhY2VDb21wdXRlclNoaXBzIiwic2V0VGltZW91dCIsInRvZ2dsZU1vZGFsIiwibmV4dFNoaXBUeXBlIiwiaW5pdCIsIlNoaXBGYWN0b3J5IiwiaGl0cyIsImhpdCIsIkdhbWVib2FyZEZhY3RvcnkiLCJncmlkU2l6ZSIsImdyaWQiLCJmaWxsIiwiYXR0YWNrZWRDb29yZGluYXRlcyIsIm1pc3NlZEF0dGFja3MiLCJzaGlwcyIsImNlbGwiLCJnZXRHcmlkIiwid2l0aGluQm91bmRhcmllcyIsImV2ZXJ5IiwiY29uZmxpY3RzIiwic29tZSIsImFkamFjZW50Q29uZmxpY3RzIiwiYWRqUm93IiwiYWRqQ29sIiwic2hpcEluZm8iLCJjb2x1bW5MZXR0ZXIiLCJyb3dOdW1iZXIiLCJnZXRNaXNzZWRBdHRhY2tzIiwicmVzdWx0IiwiUGxheWVyRmFjdG9yeSIsIm5hbWUiLCJTZXQiLCJlbmVteUdhbWVib2FyZCIsInZhbGlkQ29vcmRpbmF0ZXMiLCJnZXRBbGxWYWxpZENvb3JkaW5hdGVzIiwiaGFzIiwiRmFjdG9yeUhlbHBlcnMiLCJjb252ZXJ0VG9JbmRpY2VzIiwiY29sdW1uIiwic2xpY2UiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhbHBoYW51bWVyaWNDb29yZGluYXRlIiwiQXBwSGVscGVycyIsIm1vZGFsIiwiY2hvaWNlIiwidG9nZ2xlZE1vZGFsIiwiZGlzcGxheVZhbHVlIiwiY2xvc2VzdCIsInN0eWxlIiwiZGlzcGxheSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=