(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let r=0;r<10;r+=1){const o=document.createElement("div");o.classList.add("square"),o.dataset.row=e,o.dataset.col=r,t.appendChild(o)}},l=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))},n=e=>{document.querySelector("#winner").textContent=`${e} won!`},s=e=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{e.className="square"}))};var c=r(776);(()=>{const e=(0,c.Br)(),t=(0,c.Br)(),r=(0,c.oP)("computer");let d=0,i=!0,u=!1,h=null;const p=a=>{if(!i){const l=a.target,s=parseInt(l.dataset.row,10),c=parseInt(l.dataset.col,10),d=o.r.convertToAlphanumeric([s,c]);t.getAttackedCoordinates().includes(d)||(t.receiveAttack(d)?l.classList.add("hit"):l.classList.add("miss"),t.allShipsSunk()&&(h="You",n(h),o.U.toggleModal(document.querySelector(".modal.endgame"),"show")),(()=>{if(!i){const t=r.attack(e),a=e.receiveAttack(t),l=parseInt(t.slice(1),10)-1,s=t[0].charCodeAt(0)-65,c=document.querySelector(`.gameboard.player [data-row="${l}"][data-col="${s}"]`);a?c.classList.add("hit"):c.classList.add("miss"),e.allShipsSunk()&&(h="The computer",n(h),o.U.toggleModal(document.querySelector(".modal.endgame"),"show"))}})())}},m=()=>{u=!u},g=[{eventType:"mouseover",handler:e=>{if(i){const t=e.target,r=parseInt(t.dataset.row,10),a=parseInt(t.dataset.col,10),{length:l}=o.U.shipTypes[d];Array.from({length:l},((e,t)=>{const o=u?r+t:r,l=u?a:a+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-row="${o}"][data-col="${l}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:r=>{if(i){const a=r.target,l=parseInt(a.dataset.row,10),n=parseInt(a.dataset.col,10),{length:s}=o.U.shipTypes[d],h=Array.from({length:s},((e,t)=>[u?l+t:l,u?n:n+t])),p=(0,c._V)(s);if(e.placeShip(p,h))if(a.classList.add("placed"),h.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),d+=1,d===o.U.shipTypes.length)i=!1,(()=>{const e=[];for(let r=0;r<o.U.shipTypes.length;r+=1){const{type:a,length:l}=o.U.shipTypes[r];let n=[],s=!1;for(;!s;){const e=Math.floor(10*Math.random()),r=Math.floor(10*Math.random());u=Math.random()<.5,n=[],u?e+l-1<10&&(n=Array.from({length:l},((t,o)=>[e+o,r]))):r+l-1<10&&(n=Array.from({length:l},((t,o)=>[e,r+o]))),n.length>0&&(s=t.placeShip((0,c._V)(l),n))}n.forEach((([e,t])=>{document.querySelector(`.gameboard.computer [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),e.push({type:a,coordinates:n})}})(),setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=o.U.shipTypes[d].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),l(".gameboard.initial",g),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",p)})),document.querySelector("#rotateBtn").addEventListener("click",m),document.querySelector("#newGame").addEventListener("click",(()=>{d=0,i=!0,u=!1,h=null,e.reset(),t.reset(),r.clearSet(),s(".gameboard.initial"),s(".gameboard.player"),s(".gameboard.computer"),document.querySelector(".ship-type").textContent=o.U.shipTypes[0].type,o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),o.U.toggleModal(document.querySelector(".modal.initial"),"show")}))}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>l,_V:()=>a,oP:()=>n});var o=r(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},l=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null)));let r=[],o=[];const a=()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const a=o.every((([e,t])=>e>0&&e<9&&t>0&&t<9)),l=o.some((([e,r])=>null!==t[e][r])),n=o.some((([r,o])=>[[r-1,o],[r+1,o],[r,o-1],[r,o+1],[r-1,o-1],[r-1,o+1],[r+1,o-1],[r+1,o+1]].some((([r,o])=>r>=0&&r<e&&o>=0&&o<e&&null!==t[r]?.[o]))));if(a&&!l&&!n){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:a,getAllShips:()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null!==e&&e.ship&&!r.includes(e.ship)&&r.push(e.ship)}return console.log(r),r},getShipCoordinates:r=>{const o=[];for(let a=0;a<e;a+=1)for(let l=0;l<e;l+=1){const e=t[a][l];e&&e.ship===r&&o.push([a,l])}return o},receiveAttack:e=>{const[a,l]=e,n=parseInt(l,10)-1,s=a.charCodeAt(0)-65,c=t[n][s];if(null!==c){const{ship:t}=c;return t.hit(),r.push(e),t}return o.push(e),r.push(e),null},getMissedAttacks:()=>o,getAttackedCoordinates:()=>r,allShipsSunk:()=>a().every((e=>e.isSunk())),reset:()=>{t.forEach(((e,r)=>{e.forEach(((e,o)=>{t[r][o]=null}))})),r=[],o=[]}}},n=e=>{const t=new Set;return{name:e,attack:e=>{const r=e.getGrid().length,a=o.r.getAllValidCoordinates(r);let l="";do{l=a[Math.floor(Math.random()*a.length)]}while(t.has(l)||e.getAttackedCoordinates().includes(l));return t.add(l),l},getAttackedSet:()=>t,clearSet:()=>{t.clear()}}}},555:(e,t,r)=>{r.d(t,{U:()=>a,r:()=>o});const o=(()=>{const e=[],t=([e,t])=>String.fromCharCode(t+65)+(e+1);return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:t,getAllValidCoordinates:r=>{for(let o=0;o<r;o+=1)for(let a=0;a<r;a+=1){const r=t([o,a]);e.push(r)}return e}}})(),a={shipTypes:[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}],toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,r),l.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFRLEdBQzlCLENBQUVhLEtBQU0sWUFBYWIsT0FBUSxHQUM3QixDQUFFYSxLQUFNLFlBQWFiLE9BQVEsR0FDN0IsQ0FBRWEsS0FBTSxjQUFlYixPQUFRLElBZS9CVCxZQVprQixDQUFDbUYsRUFBT0MsS0FDMUIsTUFBTUMsRUFBZUYsRUFHZkcsRUFBMEIsU0FBWEYsRUFBb0IsT0FBUyxPQURsQ0QsRUFBTUksUUFBUSxZQUd0QkMsTUFBTUMsUUFBVUgsRUFDeEJELEVBQWFHLE1BQU1DLFFBQVVILENBQVksRSxHQy9DekNJLEVBQTJCLENBQUMsRUFHaEMsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYUUsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJFLEdBQVksQ0FHakRHLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CTCxHQUFVSSxFQUFRQSxFQUFPRCxRQUFTSixHQUcvQ0ssRUFBT0QsT0FDZixDQ3JCQUosRUFBb0JPLEVBQUksQ0FBQ0gsRUFBU0ksS0FDakMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYUixFQUFvQlUsRUFBRUYsRUFBWUMsS0FBU1QsRUFBb0JVLEVBQUVOLEVBQVNLLElBQzVFRSxPQUFPQyxlQUFlUixFQUFTSyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JVLEVBQUksQ0FBQ0ssRUFBS0MsSUFBVUwsT0FBT00sVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NFbEZoQixFQUFvQixLQUVNQSxFQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9yZW5kZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hcHAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy91dGlscy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGlzIG1vZHVsZSBjYW4gYmUgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBjb250ZW50IG9uIHRoZSBwYWdlLlxuLy8gSXQgY2FuIGluY2x1ZGUgZnVuY3Rpb25zIHRvIHVwZGF0ZSB0aGUgRE9NIGVsZW1lbnRzIHJlcHJlc2VudGluZyB0aGVcbi8vIGdhbWUgYm9hcmRzLCBzaGlwcywgYXR0YWNrcywgbWVzc2FnZXMsIGFuZCBvdGhlciBVSSBjb21wb25lbnRzLiBJdCBzaG91bGRcbi8vIGVuY2Fwc3VsYXRlIHRoZSBET00gbWFuaXB1bGF0aW9uIGNvZGUgYW5kIHByb3ZpZGUgYSBjbGVhbiBpbnRlcmZhY2UgZm9yXG4vLyB1cGRhdGluZyB0aGUgVUkgYmFzZWQgb24gdGhlIGdhbWUgc3RhdGUuIEl0IGNhbiBiZSB0aGUgYnJpZGdlIGJldHdlZW4gdGhlXG4vLyBnYW1lIGxvZ2ljIGFuZCB0aGUgYWN0dWFsIERPTSBtYW5pcHVsYXRpb24uXG5cbmNvbnN0IFJlbmRlcmVyID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgMTA7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlXCIpO1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5yb3cgPSByb3c7XG4gICAgICAgIHNxdWFyZS5kYXRhc2V0LmNvbCA9IGNvbDtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYXR0YWNoRXZlbnRMaXN0ZW5lcnMgPSAoY29udGFpbmVyRWxlbWVudCwgZXZlbnRMaXN0ZW5lcnMpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3F1YXJlXCIpLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgZXZlbnRMaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcbiAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIobGlzdGVuZXIuZXZlbnRUeXBlLCBsaXN0ZW5lci5oYW5kbGVyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHNldFdpbm5lckhlYWRpbmcgPSAod2lubmVyKSA9PiB7XG4gICAgY29uc3Qgd2lubmVySGVhZGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd2lubmVyXCIpO1xuICAgIHdpbm5lckhlYWRpbmcudGV4dENvbnRlbnQgPSBgJHt3aW5uZXJ9IHdvbiFgO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuICAgIGNvbnN0IHNxdWFyZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5zcXVhcmVcIik7XG5cbiAgICBzcXVhcmVzLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgY29uc3QgcmVzZXRTcXVhcmUgPSBzcXVhcmU7XG4gICAgICByZXNldFNxdWFyZS5jbGFzc05hbWUgPSBcInNxdWFyZVwiOyAvLyBSZXNldCB0aGUgY2xhc3NOYW1lIHRvIHJlbW92ZSBhbGwgY2xhc3Nlc1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkLFxuICAgIGF0dGFjaEV2ZW50TGlzdGVuZXJzLFxuICAgIHNldFdpbm5lckhlYWRpbmcsXG4gICAgY2xlYXJHYW1lYm9hcmQsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBSZW5kZXJlcjtcbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLWxvbmVseS1pZiAqL1xuaW1wb3J0IHsgQXBwSGVscGVycywgRmFjdG9yeUhlbHBlcnMgfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IFJlbmRlcmVyIGZyb20gXCIuL3JlbmRlclwiO1xuaW1wb3J0IHsgU2hpcEZhY3RvcnksIEdhbWVib2FyZEZhY3RvcnksIFBsYXllckZhY3RvcnkgfSBmcm9tIFwiLi9mYWN0b3JpZXNcIjtcblxuLy8gMS4gLS0tXG4vLyAyLiAtLS1cbi8vIDMuIC0tLVxuLy8gNC4gU3R5bGVcbi8vIDUuIFB1c2ggdG8gZ2gtcGFnZXMgYW5kIGFkZCByZWFkbWVcblxuY29uc3QgQ29udHJvbGxlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHBsYXllckdhbWVib2FyZCA9IEdhbWVib2FyZEZhY3RvcnkoKTtcbiAgY29uc3QgY29tcHV0ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmRGYWN0b3J5KCk7XG5cbiAgY29uc3QgY29tcHV0ZXIgPSBQbGF5ZXJGYWN0b3J5KFwiY29tcHV0ZXJcIik7XG5cbiAgbGV0IGN1cnJlbnRTaGlwSW5kZXggPSAwO1xuICBsZXQgc2hpcFBsYWNlbWVudE1vZGUgPSB0cnVlO1xuICBsZXQgaXNWZXJ0aWNhbCA9IGZhbHNlO1xuICBsZXQgd2lubmVyID0gbnVsbDtcblxuICBjb25zdCBwbGFjZUNvbXB1dGVyU2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3QgY29tcHV0ZXJTaGlwcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBBcHBIZWxwZXJzLnNoaXBUeXBlcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgLy8gTG9vcCB0aHJvdWdoIHNoaXBUeXBlcyBhcnJheVxuICAgICAgY29uc3QgeyB0eXBlLCBsZW5ndGggfSA9IEFwcEhlbHBlcnMuc2hpcFR5cGVzW2ldOyAvLyBHZXQgc2hpcCB0eXBlIGFuZCBsZW5ndGhcbiAgICAgIGxldCBjb29yZGluYXRlcyA9IFtdO1xuICAgICAgbGV0IHBsYWNlZCA9IGZhbHNlOyAvLyBGbGFnIHRvIHRyYWNrIGlmIHNoaXAgcGxhY2VtZW50IGlzIHN1Y2Nlc3NmdWxcblxuICAgICAgd2hpbGUgKCFwbGFjZWQpIHtcbiAgICAgICAgLy8gTG9vcCB1bnRpbCBzaGlwIGlzIHBsYWNlZFxuICAgICAgICBjb25zdCBzdGFydFJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTsgLy8gR2VuZXJhdGUgYSByYW5kb20gc3RhcnQgcm93ICgwIHRvIDkpXG4gICAgICAgIGNvbnN0IHN0YXJ0Q29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApOyAvLyBHZW5lcmF0ZSBhIHJhbmRvbSBzdGFydCBjb2x1bW4gKDAgdG8gOSlcbiAgICAgICAgaXNWZXJ0aWNhbCA9IE1hdGgucmFuZG9tKCkgPCAwLjU7IC8vIFJhbmRvbWx5IGRldGVybWluZSBpZiBzaGlwIHNob3VsZCBiZSBwbGFjZWQgdmVydGljYWxseVxuXG4gICAgICAgIGNvb3JkaW5hdGVzID0gW107IC8vIFJlc2V0IGNvb3JkaW5hdGVzIGFycmF5XG5cbiAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAvLyBJZiBzaGlwIGlzIHZlcnRpY2FsXG4gICAgICAgICAgaWYgKHN0YXJ0Um93ICsgbGVuZ3RoIC0gMSA8IDEwKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBzaGlwIGNhbiBmaXQgdmVydGljYWxseSB3aXRoaW4gdGhlIGdhbWVib2FyZCBib3VuZGFyaWVzXG4gICAgICAgICAgICBjb29yZGluYXRlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGopID0+IFtcbiAgICAgICAgICAgICAgc3RhcnRSb3cgKyBqLFxuICAgICAgICAgICAgICBzdGFydENvbCxcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBJZiBzaGlwIGlzIGhvcml6b250YWxcbiAgICAgICAgICBpZiAoc3RhcnRDb2wgKyBsZW5ndGggLSAxIDwgMTApIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHNoaXAgY2FuIGZpdCBob3Jpem9udGFsbHkgd2l0aGluIHRoZSBnYW1lYm9hcmQgYm91bmRhcmllc1xuICAgICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBqKSA9PiBbXG4gICAgICAgICAgICAgIHN0YXJ0Um93LFxuICAgICAgICAgICAgICBzdGFydENvbCArIGosXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29vcmRpbmF0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIElmIHZhbGlkIHNoaXAgY29vcmRpbmF0ZXMgYXJlIGdlbmVyYXRlZFxuICAgICAgICAgIHBsYWNlZCA9IGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChcbiAgICAgICAgICAgIFNoaXBGYWN0b3J5KGxlbmd0aCksXG4gICAgICAgICAgICBjb29yZGluYXRlc1xuICAgICAgICAgICk7IC8vIEF0dGVtcHQgdG8gcGxhY2UgdGhlIHNoaXAgb24gdGhlIGNvbXB1dGVyIGdhbWVib2FyZFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgLy8gQWRkICdwbGFjZWQnIGNsYXNzIHRvIHRoZSBjb3JyZXNwb25kaW5nIHNxdWFyZXMgb24gdGhlIGdhbWVib2FyZCBVSSB0byBpbmRpY2F0ZSBzaGlwIHBsYWNlbWVudFxuICAgICAgICBjb25zdCBwbGFjZWRTcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIGAuZ2FtZWJvYXJkLmNvbXB1dGVyIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgKTtcbiAgICAgICAgcGxhY2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICB9KTtcblxuICAgICAgY29tcHV0ZXJTaGlwcy5wdXNoKHsgdHlwZSwgY29vcmRpbmF0ZXMgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHNoaXBQbGFjZW1lbnRIYW5kbGVyID0gKGUpID0+IHtcbiAgICBpZiAoc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0OyAvLyBHZXQgdGhlIGNsaWNrZWQgc3F1YXJlIGVsZW1lbnRcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7IC8vIEdldCB0aGUgc3RhcnRpbmcgcm93XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApOyAvLyBHZXQgdGhlIHN0YXJ0aW5nIGNvbHVtblxuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IEFwcEhlbHBlcnMuc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdOyAvLyBHZXQgdGhlIGxlbmd0aCBvZiB0aGUgc2hpcFxuXG4gICAgICAvLyBHZW5lcmF0ZSBhbiBhcnJheSBvZiBzaGlwIGNvb3JkaW5hdGVzIGJhc2VkIG9uIHRoZSBzaGlwIGxlbmd0aFxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHJvdyBjb29yZGluYXRlIGJhc2VkIG9uIHZlcnRpY2FsIG9yIGhvcml6b250YWwgcGxhY2VtZW50XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBjb2x1bW4gY29vcmRpbmF0ZSBiYXNlZCBvbiB2ZXJ0aWNhbCBvciBob3Jpem9udGFsIHBsYWNlbWVudFxuICAgICAgICBjb25zdCBjb2wgPSBpc1ZlcnRpY2FsID8gc3RhcnRDb2wgOiBzdGFydENvbCArIGk7XG4gICAgICAgIHJldHVybiBbcm93LCBjb2xdOyAvLyBSZXR1cm4gdGhlIGNvb3JkaW5hdGUgcGFpclxuICAgICAgfSk7XG5cbiAgICAgIC8vIEF0dGVtcHQgdG8gcGxhY2UgdGhlIHNoaXAgb24gdGhlIHBsYXllciBnYW1lYm9hcmRcbiAgICAgIGNvbnN0IHNoaXAgPSBTaGlwRmFjdG9yeShsZW5ndGgpO1xuICAgICAgY29uc3QgcGxhY2VkID0gcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcChzaGlwLCBzaGlwQ29vcmRpbmF0ZXMpO1xuXG4gICAgICBpZiAocGxhY2VkKSB7XG4gICAgICAgIC8vIElmIHNoaXAgcGxhY2VtZW50IGlzIHN1Y2Nlc3NmdWxcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBzaGlwIGNvb3JkaW5hdGVzXG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTsgLy8gR2V0IHRoZSBjb3JyZXNwb25kaW5nIHNxdWFyZSBlbGVtZW50IG9uIHRoZSBnYW1lYm9hcmQgVUlcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICk7IC8vIEdldCB0aGUgY29ycmVzcG9uZGluZyBzcXVhcmUgZWxlbWVudCBvbiB0aGUgaW5pdGlhbCBzaGlwIHBsYWNlbWVudCBVSVxuICAgICAgICAgIGluaXRpYWxTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY3VycmVudFNoaXBJbmRleCArPSAxOyAvLyBJbmNyZW1lbnQgdGhlIGN1cnJlbnRTaGlwSW5kZXggdG8gbW92ZSB0byB0aGUgbmV4dCBzaGlwXG5cbiAgICAgICAgaWYgKGN1cnJlbnRTaGlwSW5kZXggPT09IEFwcEhlbHBlcnMuc2hpcFR5cGVzLmxlbmd0aCkge1xuICAgICAgICAgIC8vIElmIGFsbCBzaGlwcyBoYXZlIGJlZW4gcGxhY2VkXG4gICAgICAgICAgc2hpcFBsYWNlbWVudE1vZGUgPSBmYWxzZTsgLy8gRGlzYWJsZSBzaGlwIHBsYWNlbWVudCBtb2RlXG4gICAgICAgICAgcGxhY2VDb21wdXRlclNoaXBzKCk7IC8vIFBsYWNlIHRoZSBjb21wdXRlcidzIHNoaXBzXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBTZXQgYSB0aW1lb3V0IHRvIGRlbGF5IGhpZGluZyB0aGUgaW5pdGlhbCBzaGlwIHBsYWNlbWVudCBtb2RhbFxuICAgICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLFxuICAgICAgICAgICAgICBcImhpZGVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBzdGlsbCBzaGlwcyB0byBiZSBwbGFjZWRcbiAgICAgICAgICAvLyBHZXQgdGhlIHR5cGUgb2YgdGhlIG5leHQgc2hpcCBiYXNlZCBvbiB0aGUgY3VycmVudFNoaXBJbmRleFxuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IEFwcEhlbHBlcnMuc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdLnR5cGU7XG4gICAgICAgICAgLy8gVXBkYXRlIHRoZSBzaGlwIHR5cGUgdGV4dCBvbiB0aGUgVUlcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNoaXAtdHlwZVwiKS50ZXh0Q29udGVudCA9IG5leHRTaGlwVHlwZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgPSAoZSkgPT4ge1xuICAgIGlmIChzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgLy8gQ2hlY2sgaWYgc2hpcCBwbGFjZW1lbnQgbW9kZSBpcyBhY3RpdmVcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0OyAvLyBHZXQgdGhlIGhvdmVyZWQgc3F1YXJlIGVsZW1lbnRcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7IC8vIEdldCB0aGUgc3RhcnRpbmcgcm93XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApOyAvLyBHZXQgdGhlIHN0YXJ0aW5nIGNvbHVtblxuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IEFwcEhlbHBlcnMuc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdOyAvLyBHZXQgdGhlIGxlbmd0aCBvZiB0aGUgc2hpcFxuXG4gICAgICAvLyBHZW5lcmF0ZSBhbiBhcnJheSBvZiBob3ZlcmVkIHNxdWFyZXMgYmFzZWQgb24gdGhlIHNoaXAgbGVuZ3RoXG4gICAgICBjb25zdCBob3ZlcmVkU3F1YXJlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGkpID0+IHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSByb3cgY29vcmRpbmF0ZSBiYXNlZCBvbiB2ZXJ0aWNhbCBvciBob3Jpem9udGFsIHBsYWNlbWVudFxuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgY29sdW1uIGNvb3JkaW5hdGUgYmFzZWQgb24gdmVydGljYWwgb3IgaG9yaXpvbnRhbCBwbGFjZW1lbnRcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluaXRpYWxTcXVhcmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLmdhbWVib2FyZC5pbml0aWFsIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgICApLCAvLyBHZXQgdGhlIGNvcnJlc3BvbmRpbmcgc3F1YXJlIGVsZW1lbnQgb24gdGhlIGluaXRpYWwgc2hpcCBwbGFjZW1lbnQgVUlcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICBob3ZlcmVkU3F1YXJlcy5mb3JFYWNoKCh7IGluaXRpYWxTcXVhcmUgfSkgPT4ge1xuICAgICAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIGhvdmVyZWQgc3F1YXJlc1xuICAgICAgICBpZiAoaW5pdGlhbFNxdWFyZSkge1xuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBpbml0aWFsIHNxdWFyZSBleGlzdHNcbiAgICAgICAgICBpbml0aWFsU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJob3ZlcmVkXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2FtZWJvYXJkTW91c2VMZWF2ZUhhbmRsZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWVib2FyZCAuaG92ZXJlZFwiKTtcbiAgICBob3ZlcmVkU3F1YXJlcy5mb3JFYWNoKChob3ZlcmVkU3F1YXJlKSA9PiB7XG4gICAgICBob3ZlcmVkU3F1YXJlLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlcmVkXCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNvbXB1dGVyQXR0YWNrID0gKCkgPT4ge1xuICAgIGlmICghc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIC8vIFBlcmZvcm0gYSBjb21wdXRlciBhdHRhY2sgYW5kIGdldCB0aGUgY29vcmRpbmF0ZVxuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IGNvbXB1dGVyLmF0dGFjayhwbGF5ZXJHYW1lYm9hcmQpO1xuICAgICAgLy8gUmVjZWl2ZSB0aGUgYXR0YWNrIG9uIHRoZSBwbGF5ZXIncyBnYW1lYm9hcmQgYW5kIGdldCB0aGUgYXR0YWNrZWQgc2hpcCAoaWYgYW55KVxuICAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gcGxheWVyR2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG4gICAgICAvLyBFeHRyYWN0IHRoZSByb3cgbnVtYmVyIGZyb20gdGhlIGNvb3JkaW5hdGUgYW5kIGNvbnZlcnQgaXQgdG8gYW4gaW5kZXhcbiAgICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7XG4gICAgICAvLyBFeHRyYWN0IHRoZSBjb2x1bW4gbGV0dGVyIGZyb20gdGhlIGNvb3JkaW5hdGUgYW5kIGNvbnZlcnQgaXQgdG8gYSBjb2x1bW4gaW5kZXhcbiAgICAgIGNvbnN0IGNvbCA9IGNvb3JkaW5hdGVbMF0uY2hhckNvZGVBdCgwKSAtIDY1O1xuXG4gICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICBgLmdhbWVib2FyZC5wbGF5ZXIgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgKTsgLy8gR2V0IHRoZSBjb3JyZXNwb25kaW5nIHNxdWFyZSBlbGVtZW50IG9uIHRoZSBwbGF5ZXIncyBnYW1lYm9hcmRcblxuICAgICAgaWYgKGF0dGFja2VkU2hpcCkge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHBsYXllckdhbWVib2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICB3aW5uZXIgPSBcIlRoZSBjb21wdXRlclwiO1xuICAgICAgICBSZW5kZXJlci5zZXRXaW5uZXJIZWFkaW5nKHdpbm5lcik7XG4gICAgICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoXG4gICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLFxuICAgICAgICAgIFwic2hvd1wiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHBsYXllckF0dGFjayA9IChlKSA9PiB7XG4gICAgaWYgKCFzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7IC8vIEdldCB0aGUgY2xpY2tlZCBzcXVhcmUgZWxlbWVudFxuICAgICAgY29uc3Qgcm93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7IC8vIEV4dHJhY3QgdGhlIHJvdyBpbmRleFxuICAgICAgY29uc3QgY29sID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQuY29sLCAxMCk7IC8vIEV4dHJhY3QgdGhlIGNvbHVtbiBpbmRleFxuICAgICAgLy8gQ29udmVydCB0aGUgcm93IGFuZCBjb2x1bW4gaW5kaWNlcyB0byBhbiBhbHBoYW51bWVyaWMgY29vcmRpbmF0ZVxuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvb3JkaW5hdGUgaGFzIG5vdCBiZWVuIHByZXZpb3VzbHkgYXR0YWNrZWRcbiAgICAgIGlmICghY29tcHV0ZXJHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpKSB7XG4gICAgICAgIC8vIFJlY2VpdmUgdGhlIGF0dGFjayBvbiB0aGUgY29tcHV0ZXIncyBnYW1lYm9hcmQgYW5kIGdldCB0aGUgYXR0YWNrZWQgc2hpcCAoaWYgYW55KVxuICAgICAgICBjb25zdCBhdHRhY2tlZFNoaXAgPSBjb21wdXRlckdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuXG4gICAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcHV0ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICB3aW5uZXIgPSBcIllvdVwiO1xuICAgICAgICAgIFJlbmRlcmVyLnNldFdpbm5lckhlYWRpbmcod2lubmVyKTtcbiAgICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLFxuICAgICAgICAgICAgXCJzaG93XCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcHV0ZXJBdHRhY2soKTsgLy8gUGVyZm9ybSB0aGUgY29tcHV0ZXIncyBhdHRhY2tcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgcm90YXRlU2hpcHMgPSAoKSA9PiB7XG4gICAgaXNWZXJ0aWNhbCA9ICFpc1ZlcnRpY2FsO1xuICB9O1xuXG4gIGNvbnN0IGV2ZW50TGlzdGVuZXJzID0gW1xuICAgIHsgZXZlbnRUeXBlOiBcIm1vdXNlb3ZlclwiLCBoYW5kbGVyOiBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgfSxcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZWxlYXZlXCIsIGhhbmRsZXI6IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwiY2xpY2tcIiwgaGFuZGxlcjogc2hpcFBsYWNlbWVudEhhbmRsZXIgfSxcbiAgXTtcblxuICBjb25zdCByZXNldEdhbWUgPSAoKSA9PiB7XG4gICAgLy8gUmVzZXQgZ2FtZS1yZWxhdGVkIHZhcmlhYmxlc1xuICAgIGN1cnJlbnRTaGlwSW5kZXggPSAwO1xuICAgIHNoaXBQbGFjZW1lbnRNb2RlID0gdHJ1ZTtcbiAgICBpc1ZlcnRpY2FsID0gZmFsc2U7XG4gICAgd2lubmVyID0gbnVsbDtcblxuICAgIC8vIFJlc2V0IGdhbWVib2FyZCBvYmplY3RzXG4gICAgcGxheWVyR2FtZWJvYXJkLnJlc2V0KCk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucmVzZXQoKTtcblxuICAgIC8vIENsZWFyIGNvbXB1dGVycyBhdHRhY2tlZENvb3JkaW5hdGVzIHNldFxuICAgIGNvbXB1dGVyLmNsZWFyU2V0KCk7XG5cbiAgICAvLyBSZW1vdmUgaGl0IGFuZCBtaXNzIGNsYXNzZXMgZnJvbSBhbGwgc3F1YXJlc1xuICAgIFJlbmRlcmVyLmNsZWFyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5pbml0aWFsXCIpO1xuICAgIFJlbmRlcmVyLmNsZWFyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5wbGF5ZXJcIik7XG4gICAgUmVuZGVyZXIuY2xlYXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmNvbXB1dGVyXCIpO1xuXG4gICAgLy8gUmVzZXQgc2hpcFR5cGVzXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zaGlwLXR5cGVcIikudGV4dENvbnRlbnQgPVxuICAgICAgQXBwSGVscGVycy5zaGlwVHlwZXNbMF0udHlwZTtcbiAgfTtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLCBcImhpZGVcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5pbml0aWFsXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQucGxheWVyXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuY29tcHV0ZXJcIik7XG4gICAgUmVuZGVyZXIuYXR0YWNoRXZlbnRMaXN0ZW5lcnMoXCIuZ2FtZWJvYXJkLmluaXRpYWxcIiwgZXZlbnRMaXN0ZW5lcnMpO1xuXG4gICAgY29uc3QgY29tcHV0ZXJTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgIFwiLmdhbWVib2FyZC5jb21wdXRlciAuc3F1YXJlXCJcbiAgICApO1xuICAgIGNvbXB1dGVyU3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxheWVyQXR0YWNrKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHJvdGF0ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcm90YXRlQnRuXCIpO1xuICAgIHJvdGF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcm90YXRlU2hpcHMpO1xuXG4gICAgY29uc3QgcGxheUFnYWluQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXdHYW1lXCIpO1xuICAgIHBsYXlBZ2FpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgcmVzZXRHYW1lKCk7XG4gICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSwgXCJoaWRlXCIpO1xuICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmluaXRpYWxcIiksIFwic2hvd1wiKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gIH07XG59KSgpO1xuXG5Db250cm9sbGVyLmluaXQoKTtcbiIsImltcG9ydCB7IEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGNvbnN0IFNoaXBGYWN0b3J5ID0gKGxlbmd0aCkgPT4ge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdHMgKz0gMTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBoaXRzID49IGxlbmd0aDsgLy8gUmV0dXJuIHRydWUgaWYgaGl0cyBpcyBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gbGVuZ3RoXG5cbiAgcmV0dXJuIHtcbiAgICBsZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXQgaGl0cygpIHtcbiAgICAgIC8vIEdldHRlciBmdW5jdGlvbiBmb3IgaGl0cy4gVXNpbmcgZnVuY3Rpb24gZGVjbGFyYXRpb24gdG8gZW5zdXJlIGl0IGhhcyBhY2Nlc3MgdG8gdGhlXG4gICAgICAvLyBgaGl0c2AgdmFyaWFibGUgZHluYW1pY2FsbHksIHNpbmNlIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBhcmUgaG9pc3RlZCBhbmQgY2FuIGJlIHVzZWRcbiAgICAgIC8vIGJlZm9yZSB0aGV5IGFyZSBkZWZpbmVkLiBUaGlzIGFsbG93cyBhY2Nlc3NpbmcgdGhlIGN1cnJlbnQgdmFsdWUgb2YgYGhpdHNgIGV2ZW4gYmVmb3JlXG4gICAgICAvLyBjYWxsaW5nIHRoZSBgaGl0YCBmdW5jdGlvblxuICAgICAgcmV0dXJuIGhpdHM7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBHYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBjb25zdCBncmlkU2l6ZSA9IDEwO1xuICBjb25zdCBncmlkID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogZ3JpZFNpemUgfSwgKCkgPT5cbiAgICBBcnJheShncmlkU2l6ZSkuZmlsbChudWxsKVxuICApO1xuXG4gIGxldCBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gIGxldCBtaXNzZWRBdHRhY2tzID0gW107XG5cbiAgY29uc3QgZ2V0R3JpZCA9ICgpID0+IGdyaWQ7XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgYWxsIGNvb3JkaW5hdGVzIGFyZSB3aXRoaW4gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIGdyaWRcbiAgICBjb25zdCB3aXRoaW5Cb3VuZGFyaWVzID0gY29vcmRpbmF0ZXMuZXZlcnkoXG4gICAgICAoW3JvdywgY29sXSkgPT5cbiAgICAgICAgcm93ID4gMCAmJiByb3cgPCBncmlkU2l6ZSAtIDEgJiYgY29sID4gMCAmJiBjb2wgPCBncmlkU2l6ZSAtIDFcbiAgICApO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBjb25mbGljdHMgPSBjb29yZGluYXRlcy5zb21lKChbcm93LCBjb2xdKSA9PiBncmlkW3Jvd11bY29sXSAhPT0gbnVsbCk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGFkamFjZW50IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGFkamFjZW50Q29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgLy8gRGVmaW5lIHRoZSBhZGphY2VudCBjb29yZGluYXRlcyBhcm91bmQgdGhlIGN1cnJlbnQgY29vcmRpbmF0ZVxuICAgICAgY29uc3QgYWRqYWNlbnRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3JvdyAtIDEsIGNvbF0sIC8vIFVwXG4gICAgICAgIFtyb3cgKyAxLCBjb2xdLCAvLyBEb3duXG4gICAgICAgIFtyb3csIGNvbCAtIDFdLCAvLyBMZWZ0XG4gICAgICAgIFtyb3csIGNvbCArIDFdLCAvLyBSaWdodFxuICAgICAgICBbcm93IC0gMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIFVwLUxlZnRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBVcC1SaWdodFxuICAgICAgICBbcm93ICsgMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIERvd24tTGVmdFxuICAgICAgICBbcm93ICsgMSwgY29sICsgMV0sIC8vIERpYWdvbmFsIERvd24tUmlnaHRcbiAgICAgIF07XG5cbiAgICAgIC8vIENoZWNrIGlmIGFueSBhZGphY2VudCBjb29yZGluYXRlIGhhcyBhIHNoaXAgcGxhY2VkIG9uIGl0XG4gICAgICByZXR1cm4gYWRqYWNlbnRDb29yZGluYXRlcy5zb21lKFxuICAgICAgICAoW2FkalJvdywgYWRqQ29sXSkgPT5cbiAgICAgICAgICBhZGpSb3cgPj0gMCAmJlxuICAgICAgICAgIGFkalJvdyA8IGdyaWRTaXplICYmXG4gICAgICAgICAgYWRqQ29sID49IDAgJiZcbiAgICAgICAgICBhZGpDb2wgPCBncmlkU2l6ZSAmJlxuICAgICAgICAgIGdyaWRbYWRqUm93XT8uW2FkakNvbF0gIT09IG51bGxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBJZiB0aGUgc2hpcCBwbGFjZW1lbnQgaXMgd2l0aGluIGdyaWQgYm91bmRhcmllcywgaGFzIG5vIGNvbmZsaWN0cywgYW5kIG5vIGFkamFjZW50IGNvbmZsaWN0cy4uLlxuICAgIGlmICh3aXRoaW5Cb3VuZGFyaWVzICYmICFjb25mbGljdHMgJiYgIWFkamFjZW50Q29uZmxpY3RzKSB7XG4gICAgICAvLyBDcmVhdGUgYW4gb2JqZWN0IGNvbnRhaW5pbmcgc2hpcCBpbmZvcm1hdGlvbiBhbmQgY29vcmRpbmF0ZXNcbiAgICAgIGNvbnN0IHNoaXBJbmZvID0ge1xuICAgICAgICBzaGlwLFxuICAgICAgICBjb29yZGluYXRlcyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFBsYWNlIHRoZSBzaGlwIG9uIHRoZSBncmlkIGJ5IHVwZGF0aW5nIHRoZSBjb3JyZXNwb25kaW5nIGNlbGxzXG4gICAgICBzaGlwSW5mby5jb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgIGdyaWRbcm93XVtjb2xdID0gc2hpcEluZm87XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRydWU7IC8vIFNoaXAgcGxhY2VtZW50IHN1Y2Nlc3NmdWxcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIE90aGVyd2lzZSwgc2hpcCBwbGFjZW1lbnQgZmFpbGVkXG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGNvbnRhaW5zIGEgc2hpcCBhbmQgaXQncyBub3QgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNlbGwgIT09IG51bGwgJiZcbiAgICAgICAgICBjZWxsLnNoaXAgJiZcbiAgICAgICAgICAhc2hpcHMuaW5jbHVkZXMoY2VsbC5zaGlwKSAmJlxuICAgICAgICAgICFjZWxsLnNoaXAuaXNTdW5rKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSBzaGlwIHRvIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICAgIHNoaXBzLnB1c2goY2VsbC5zaGlwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzaGlwcztcbiAgfTtcblxuICBjb25zdCBnZXRBbGxTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgY29udGFpbnMgYSBzaGlwIGFuZCBpdCdzIG5vdCBhbHJlYWR5IGluY2x1ZGVkIGluIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICBpZiAoY2VsbCAhPT0gbnVsbCAmJiBjZWxsLnNoaXAgJiYgIXNoaXBzLmluY2x1ZGVzKGNlbGwuc2hpcCkpIHtcbiAgICAgICAgICAvLyBBZGQgdGhlIHNoaXAgdG8gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgICAgc2hpcHMucHVzaChjZWxsLnNoaXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coc2hpcHMpO1xuICAgIHJldHVybiBzaGlwcztcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwQ29vcmRpbmF0ZXMgPSAoc2hpcCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW107XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBjZWxsIG9mIHRoZSBncmlkXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2VsbCBleGlzdHMgYW5kIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgc2hpcFxuICAgICAgICBpZiAoY2VsbCAmJiBjZWxsLnNoaXAgPT09IHNoaXApIHtcbiAgICAgICAgICAvLyBBZGQgdG8gY29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgICAgICBjb29yZGluYXRlcy5wdXNoKFtyb3csIGNvbF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IFtjb2x1bW5MZXR0ZXIsIHJvd051bWJlcl0gPSBjb29yZGluYXRlO1xuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KHJvd051bWJlciwgMTApIC0gMTtcbiAgICBjb25zdCBjb2wgPSBjb2x1bW5MZXR0ZXIuY2hhckNvZGVBdCgwKSAtIDY1O1xuICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcblxuICAgIGlmIChjZWxsICE9PSBudWxsKSB7XG4gICAgICAvLyBTaGlwIGF0IGNvb3JkaW5hdGUsIGl0J3MgYSBoaXRcbiAgICAgIGNvbnN0IHsgc2hpcCB9ID0gY2VsbDtcbiAgICAgIHNoaXAuaGl0KCk7IC8vIEluY3JlbWVudCBoaXQgY291bnQgb2YgdGhlIHNoaXBcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMucHVzaChjb29yZGluYXRlKTtcbiAgICAgIHJldHVybiBzaGlwOyAvLyBSZXR1cm4gdGhlIHNoaXAgb2JqZWN0IHdoZW4gaXQgaXMgaGl0XG4gICAgfVxuICAgIC8vIE5vIHNoaXAgYXQgY29vcmRpbmF0ZSwgaXQncyBhIG1pc3NcbiAgICBtaXNzZWRBdHRhY2tzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5wdXNoKGNvb3JkaW5hdGUpO1xuICAgIHJldHVybiBudWxsOyAvLyBSZXR1cm4gbnVsbCB3aGVuIGl0J3MgYSBtaXNzXG4gIH07XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gZ2V0U2hpcHMoKTsgLy8gUmV0cmlldmUgYWxsIHRoZSBzaGlwcyBvbiB0aGUgZ2FtZWJvYXJkXG5cbiAgICAvLyBDaGVjayBpZiBhbGwgc2hpcHMgYXJlIHN1bmssIHJldHVybiB0cnVlIGlmIHllcywgYW5kIHJldHVybiBmYWxzZSBpZiBub1xuICAgIGNvbnN0IHJlc3VsdCA9IHNoaXBzLmV2ZXJ5KChzaGlwKSA9PiBzaGlwLmlzU3VuaygpKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgLy8gQ2xlYXIgdGhlIGdyaWQgYnkgc2V0dGluZyBhbGwgY2VsbHMgdG8gbnVsbFxuICAgIGdyaWQuZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4ge1xuICAgICAgcm93LmZvckVhY2goKF8sIGNvbEluZGV4KSA9PiB7XG4gICAgICAgIGdyaWRbcm93SW5kZXhdW2NvbEluZGV4XSA9IG51bGw7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFJlYXNzaWduIGVtcHR5IGFycmF5cyB0byBjbGVhciB0aGUgY29udGVudHMgb2YgYXR0YWNrZWRDb29yZGluYXRlcyBhbmQgbWlzc2VkQXR0YWNrc1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICBtaXNzZWRBdHRhY2tzID0gW107XG4gIH07XG5cbiAgY29uc3QgZ2V0TWlzc2VkQXR0YWNrcyA9ICgpID0+IG1pc3NlZEF0dGFja3M7XG5cbiAgY29uc3QgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyA9ICgpID0+IGF0dGFja2VkQ29vcmRpbmF0ZXM7XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRHcmlkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRTaGlwcyxcbiAgICBnZXRBbGxTaGlwcyxcbiAgICBnZXRTaGlwQ29vcmRpbmF0ZXMsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBnZXRNaXNzZWRBdHRhY2tzLFxuICAgIGdldEF0dGFja2VkQ29vcmRpbmF0ZXMsXG4gICAgYWxsU2hpcHNTdW5rLFxuICAgIHJlc2V0LFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IFBsYXllckZhY3RvcnkgPSAobmFtZSkgPT4ge1xuICBjb25zdCBhdHRhY2tlZENvb3JkaW5hdGVzID0gbmV3IFNldCgpOyAvLyBTZXQgdG8ga2VlcCB0cmFjayBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuXG4gIGNvbnN0IGF0dGFjayA9IChlbmVteUdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IGdyaWRTaXplID0gZW5lbXlHYW1lYm9hcmQuZ2V0R3JpZCgpLmxlbmd0aDtcbiAgICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gRmFjdG9yeUhlbHBlcnMuZ2V0QWxsVmFsaWRDb29yZGluYXRlcyhncmlkU2l6ZSk7XG5cbiAgICBsZXQgY29vcmRpbmF0ZSA9IFwiXCI7XG5cbiAgICAvLyBQZXJmb3JtIGEgZG8td2hpbGUgbG9vcCB1bnRpbCBhIHVuaXF1ZSBjb29yZGluYXRlIGlzIGZvdW5kXG4gICAgZG8ge1xuICAgICAgLy8gR2VuZXJhdGUgYSByYW5kb20gaW5kZXggYmFzZWQgb24gdGhlIGxlbmd0aCBvZiB2YWxpZENvb3JkaW5hdGVzIGFycmF5XG4gICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkQ29vcmRpbmF0ZXMubGVuZ3RoKTtcblxuICAgICAgLy8gR2V0IHRoZSBjb29yZGluYXRlIGF0IHRoZSByYW5kb20gaW5kZXhcbiAgICAgIGNvb3JkaW5hdGUgPSB2YWxpZENvb3JkaW5hdGVzW3JhbmRvbUluZGV4XTtcbiAgICB9IHdoaWxlIChcbiAgICAgIC8vIENvbnRpbnVlIGxvb3Bpbmcgd2l0aG91dCBwZXJmb3JtaW5nIGFueSBhY3Rpb25zIGlmIHRoZSBjb29yZGluYXRlIGlzIGFscmVhZHlcbiAgICAgIC8vIGluIHRoZSBwbGF5ZXJzIGF0dGFja2VkQ29vcmRpbmF0ZXMgc2V0IG9yIGlzIGluY2x1ZGVkIGluIHRoZSBlbmVteUdhbWVib2FyZHNcbiAgICAgIC8vIGF0dGFja2VkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuaGFzKGNvb3JkaW5hdGUpIHx8XG4gICAgICBlbmVteUdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSlcbiAgICApO1xuXG4gICAgLy8gQWRkIHRoZSBhdHRhY2tlZCBjb29yZGluYXRlIHRvIHRoZSBwbGF5ZXJzIHNldCBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuYWRkKGNvb3JkaW5hdGUpO1xuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGU7IC8vIFJldHVybiB0aGUgY29vcmRpbmF0ZSBhcyBhbiBhcnJheVxuICB9O1xuXG4gIGNvbnN0IGdldEF0dGFja2VkU2V0ID0gKCkgPT4gYXR0YWNrZWRDb29yZGluYXRlcztcblxuICBjb25zdCBjbGVhclNldCA9ICgpID0+IHtcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmNsZWFyKCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGF0dGFjayxcbiAgICBnZXRBdHRhY2tlZFNldCxcbiAgICBjbGVhclNldCxcbiAgfTtcbn07XG4iLCJleHBvcnQgY29uc3QgRmFjdG9yeUhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gW107XG5cbiAgY29uc3QgY29udmVydFRvSW5kaWNlcyA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgY29sdW1uID0gY29vcmRpbmF0ZS5jaGFyQ29kZUF0KDApIC0gNjU7IC8vIENvbnZlcnQgY29sdW1uIGxldHRlciB0byBpbmRleFxuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7IC8vIENvbnZlcnQgcm93IG51bWJlciB0byBpbmRleCB3aXRoIHJhZGl4IDEwXG4gICAgcmV0dXJuIFtyb3csIGNvbHVtbl07XG4gIH07XG5cbiAgY29uc3QgY29udmVydFRvQWxwaGFudW1lcmljID0gKFtyb3csIGNvbHVtbl0pID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2x1bW4gKyA2NSk7IC8vIENvbnZlcnQgY29sdW1uIGluZGV4IHRvIGxldHRlclxuICAgIHJldHVybiBjb29yZGluYXRlICsgKHJvdyArIDEpOyAvLyBDb252ZXJ0IHJvdyBpbmRleCB0byBudW1iZXJcbiAgfTtcblxuICBjb25zdCBnZXRBbGxWYWxpZENvb3JkaW5hdGVzID0gKGdyaWRTaXplKSA9PiB7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgYWxwaGFudW1lcmljQ29vcmRpbmF0ZSA9IGNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKTtcbiAgICAgICAgdmFsaWRDb29yZGluYXRlcy5wdXNoKGFscGhhbnVtZXJpY0Nvb3JkaW5hdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWxpZENvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY29udmVydFRvSW5kaWNlcyxcbiAgICBjb252ZXJ0VG9BbHBoYW51bWVyaWMsXG4gICAgZ2V0QWxsVmFsaWRDb29yZGluYXRlcyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBjb25zdCBBcHBIZWxwZXJzID0gKCgpID0+IHtcbiAgY29uc3Qgc2hpcFR5cGVzID0gW1xuICAgIHsgdHlwZTogXCJjYXJyaWVyXCIsIGxlbmd0aDogNSB9LFxuICAgIHsgdHlwZTogXCJiYXR0bGVzaGlwXCIsIGxlbmd0aDogNCB9LFxuICAgIHsgdHlwZTogXCJkZXN0cm95ZXJcIiwgbGVuZ3RoOiAzIH0sXG4gICAgeyB0eXBlOiBcInN1Ym1hcmluZVwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwicGF0cm9sIGJvYXRcIiwgbGVuZ3RoOiAyIH0sXG4gIF07XG5cbiAgY29uc3QgdG9nZ2xlTW9kYWwgPSAobW9kYWwsIGNob2ljZSkgPT4ge1xuICAgIGNvbnN0IHRvZ2dsZWRNb2RhbCA9IG1vZGFsO1xuXG4gICAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLmNsb3Nlc3QoXCIub3ZlcmxheVwiKTtcbiAgICBjb25zdCBkaXNwbGF5VmFsdWUgPSBjaG9pY2UgPT09IFwic2hvd1wiID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcblxuICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlWYWx1ZTtcbiAgICB0b2dnbGVkTW9kYWwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlWYWx1ZTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHNoaXBUeXBlcyxcbiAgICB0b2dnbGVNb2RhbCxcbiAgfTtcbn0pKCk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXygzODApO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzYpO1xuIl0sIm5hbWVzIjpbImNvbnRhaW5lckVsZW1lbnQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsInJvdyIsImNvbCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkYXRhc2V0IiwiYXBwZW5kQ2hpbGQiLCJldmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRUeXBlIiwiaGFuZGxlciIsIndpbm5lciIsImNsYXNzTmFtZSIsInBsYXllckdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwiY29tcHV0ZXIiLCJjdXJyZW50U2hpcEluZGV4Iiwic2hpcFBsYWNlbWVudE1vZGUiLCJpc1ZlcnRpY2FsIiwicGxheWVyQXR0YWNrIiwiZSIsInRhcmdldCIsInBhcnNlSW50IiwiY29vcmRpbmF0ZSIsImNvbnZlcnRUb0FscGhhbnVtZXJpYyIsImdldEF0dGFja2VkQ29vcmRpbmF0ZXMiLCJpbmNsdWRlcyIsInJlY2VpdmVBdHRhY2siLCJhbGxTaGlwc1N1bmsiLCJ0b2dnbGVNb2RhbCIsImF0dGFjayIsImF0dGFja2VkU2hpcCIsInNsaWNlIiwiY2hhckNvZGVBdCIsImNvbXB1dGVyQXR0YWNrIiwicm90YXRlU2hpcHMiLCJzdGFydFJvdyIsInN0YXJ0Q29sIiwibGVuZ3RoIiwic2hpcFR5cGVzIiwiQXJyYXkiLCJmcm9tIiwiXyIsImkiLCJpbml0aWFsU3F1YXJlIiwiaG92ZXJlZFNxdWFyZSIsInJlbW92ZSIsInNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJwbGFjZVNoaXAiLCJjb21wdXRlclNoaXBzIiwidHlwZSIsImNvb3JkaW5hdGVzIiwicGxhY2VkIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiaiIsInB1c2giLCJwbGFjZUNvbXB1dGVyU2hpcHMiLCJzZXRUaW1lb3V0IiwibmV4dFNoaXBUeXBlIiwiaW5pdCIsInJlc2V0IiwiY2xlYXJTZXQiLCJTaGlwRmFjdG9yeSIsImhpdHMiLCJoaXQiLCJpc1N1bmsiLCJHYW1lYm9hcmRGYWN0b3J5IiwiZ3JpZFNpemUiLCJncmlkIiwiZmlsbCIsImF0dGFja2VkQ29vcmRpbmF0ZXMiLCJtaXNzZWRBdHRhY2tzIiwiZ2V0U2hpcHMiLCJzaGlwcyIsImNlbGwiLCJnZXRHcmlkIiwid2l0aGluQm91bmRhcmllcyIsImV2ZXJ5IiwiY29uZmxpY3RzIiwic29tZSIsImFkamFjZW50Q29uZmxpY3RzIiwiYWRqUm93IiwiYWRqQ29sIiwic2hpcEluZm8iLCJnZXRBbGxTaGlwcyIsImNvbnNvbGUiLCJsb2ciLCJnZXRTaGlwQ29vcmRpbmF0ZXMiLCJjb2x1bW5MZXR0ZXIiLCJyb3dOdW1iZXIiLCJnZXRNaXNzZWRBdHRhY2tzIiwicm93SW5kZXgiLCJjb2xJbmRleCIsIlBsYXllckZhY3RvcnkiLCJuYW1lIiwiU2V0IiwiZW5lbXlHYW1lYm9hcmQiLCJ2YWxpZENvb3JkaW5hdGVzIiwiZ2V0QWxsVmFsaWRDb29yZGluYXRlcyIsImhhcyIsImdldEF0dGFja2VkU2V0IiwiY2xlYXIiLCJGYWN0b3J5SGVscGVycyIsImNvbHVtbiIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsImNvbnZlcnRUb0luZGljZXMiLCJhbHBoYW51bWVyaWNDb29yZGluYXRlIiwiQXBwSGVscGVycyIsIm1vZGFsIiwiY2hvaWNlIiwidG9nZ2xlZE1vZGFsIiwiZGlzcGxheVZhbHVlIiwiY2xvc2VzdCIsInN0eWxlIiwiZGlzcGxheSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=