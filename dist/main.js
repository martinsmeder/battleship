(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const n=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let r=0;r<10;r+=1){const n=o.r.convertToAlphanumeric([e,r]),a=document.createElement("div");a.classList.add("square"),a.dataset.coordinate=n,t.appendChild(a)}},a=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))},l=e=>{document.querySelector("#winner").textContent=`${e} won!`},c=e=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{e.className="square"}))};var s=r(776);(()=>{const e=(0,s.Br)(),t=(0,s.Br)(),r=(0,s.oP)("computer");let i=0,d=!0,u=!1,h=null;const p=n=>{if(!d){const a=n.target,c=a.dataset.coordinate;t.getAttackedCoordinates().includes(c)||(t.receiveAttack(c)?a.classList.add("hit"):a.classList.add("miss"),t.allShipsSunk()&&(h="You",l(h),o.U.toggleModal(document.querySelector(".modal.endgame"),"show")),(()=>{if(!d){const t=r.attack(e,r.lastHitCoordinate,r.currentDirection),n=e.receiveAttack(t),a=document.querySelector(`.gameboard.player [data-coordinate="${t}"]`);n?(a.classList.add("hit"),r.lastHitCoordinate=t,null===r.currentDirection&&(r.currentDirection="up")):!n&&r.lastHitCoordinate?a.classList.add("miss"):n||r.lastHitCoordinate||(a.classList.add("miss"),r.lastHitCoordinate=null,r.currentDirection=null),e.allShipsSunk()&&(h="The computer",l(h),o.U.toggleModal(document.querySelector(".modal.endgame"),"show"))}})())}},m=()=>{u=!u},g=[{eventType:"mouseover",handler:e=>{if(d){const t=e.target.dataset.coordinate,{length:r}=o.U.shipTypes[i],[n,a]=o.r.convertToIndices(t);Array.from({length:r},((e,t)=>{const r=u?n+t:n,l=u?a:a+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-coordinate="${o.r.convertToAlphanumeric([r,l])}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:r=>{if(d){const n=r.target,{coordinate:a}=n.dataset,{length:l}=o.U.shipTypes[i],[c,h]=o.r.convertToIndices(a),p=Array.from({length:l},((e,t)=>[u?c+t:c,u?h:h+t])),m=(0,s._V)(l);if(e.placeShip(m,p))if(n.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-coordinate="${o.r.convertToAlphanumeric([e,t])}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-coordinate="${o.r.convertToAlphanumeric([e,t])}"]`).classList.add("placed")})),i+=1,i===o.U.shipTypes.length)d=!1,(()=>{for(const e of o.U.shipTypes){const{length:r}=e,o=(0,s._V)(r),n=10;let a,l=!1;for(;!l;){const e=Math.floor(Math.random()*n),c=Math.floor(Math.random()*n);u=Math.random()<.5,u&&e+r<=n?a=Array.from({length:r},((t,r)=>[e+r,c])):!u&&c+r<=n&&(a=Array.from({length:r},((t,r)=>[e,c+r]))),a&&(l=t.placeShip(o,a))}}})(),setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=o.U.shipTypes[i].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),n(".gameboard.initial"),n(".gameboard.player"),n(".gameboard.computer"),a(".gameboard.initial",g),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",p)})),document.querySelector("#rotateBtn").addEventListener("click",m),document.querySelector("#newGame").addEventListener("click",(()=>{i=0,d=!0,u=!1,h=null,r.lastHitCoordinate=null,r.currentDirection=null,e.reset(),t.reset(),r.clearSet(),c(".gameboard.initial"),c(".gameboard.player"),c(".gameboard.computer"),document.querySelector(".ship-type").textContent=o.U.shipTypes[0].type,o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),o.U.toggleModal(document.querySelector(".modal.initial"),"show")}))}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>a,_V:()=>n,oP:()=>l});var o=r(555);const n=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},a=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null)));let r=[],o=[];const n=()=>{const r=[];for(let o=0;o<e;o+=1)for(let n=0;n<e;n+=1){const e=t[o][n];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const n=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),a=o.some((([e,r])=>null!==t[e][r])),l=o.some((([r,o])=>[[r-1,o],[r+1,o],[r,o-1],[r,o+1],[r-1,o-1],[r-1,o+1],[r+1,o-1],[r+1,o+1]].some((([r,o])=>r>=0&&r<e&&o>=0&&o<e&&null!==t[r]?.[o]))));if(n&&!a&&!l){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:n,getAllShips:()=>{const r=[];for(let o=0;o<e;o+=1)for(let n=0;n<e;n+=1){const e=t[o][n];null!==e&&e.ship&&!r.includes(e.ship)&&r.push(e.ship)}return r},getShipCoordinates:r=>{const o=[];for(let n=0;n<e;n+=1)for(let a=0;a<e;a+=1){const e=t[n][a];e&&e.ship===r&&o.push([n,a])}return o},receiveAttack:e=>{const[n,a]=e,l=parseInt(a,10),c=n.charCodeAt(0)-65,s=t[l][c];if(null!==s){const{ship:t}=s;return t.hit(),r.push(e),t}return o.push(e),r.push(e),null},getMissedAttacks:()=>o,getAttackedCoordinates:()=>r,allShipsSunk:()=>n().every((e=>e.isSunk())),reset:()=>{t.forEach(((e,r)=>{e.forEach(((e,o)=>{t[r][o]=null}))})),r=[],o=[]}}},l=(e,t,r)=>{const n=new Set,a=(e,t)=>{const[r,n]=o.r.convertToIndices(e);let a=r,l=n;switch(t){case"up":a-=1;break;case"down":a+=1;break;case"left":l-=1;break;case"right":l+=1}return o.r.convertToAlphanumeric([a,l])};return{name:e,lastHitCoordinate:r,currentDirection:t,attack:(e,t,r)=>{const l=e.getGrid().length,c=o.r.getAllValidCoordinates(l);let s="";if(t&&r){const o=["up","down","left","right"];for(const l of o)if(s=a(t,l),c.includes(s)&&!n.has(s)&&!e.getAttackedCoordinates().includes(s))return n.add(s),t=s,r=l,s}do{s=c[Math.floor(Math.random()*c.length)]}while(n.has(s)||e.getAttackedCoordinates().includes(s));return n.add(s),s},getAttackedSet:()=>n,clearSet:()=>{n.clear()}}}},555:(e,t,r)=>{r.d(t,{U:()=>n,r:()=>o});const o=(()=>{const e=[],t=([e,t])=>String.fromCharCode(t+65)+e;return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10),t]},convertToAlphanumeric:t,getAllValidCoordinates:r=>{for(let o=0;o<r;o+=1)for(let n=0;n<r;n+=1){const r=t([o,n]);e.push(r)}return e}}})(),n={shipTypes:[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}],toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBU0ksS0FDakMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYUixFQUFvQlUsRUFBRUYsRUFBWUMsS0FBU1QsRUFBb0JVLEVBQUVOLEVBQVNLLElBQzVFRSxPQUFPQyxlQUFlUixFQUFTSyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JVLEVBQUksQ0FBQ0ssRUFBS0MsSUFBVUwsT0FBT00sVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NFbEZoQixFQUFvQixLQUVNQSxFQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9yZW5kZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hcHAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy91dGlscy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5cbmNvbnN0IFJlbmRlcmVyID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgMTA7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW3JvdywgY29sXSk7XG4gICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlXCIpO1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYXR0YWNoRXZlbnRMaXN0ZW5lcnMgPSAoY29udGFpbmVyRWxlbWVudCwgZXZlbnRMaXN0ZW5lcnMpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3F1YXJlXCIpLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgZXZlbnRMaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcbiAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIobGlzdGVuZXIuZXZlbnRUeXBlLCBsaXN0ZW5lci5oYW5kbGVyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IHNldFdpbm5lckhlYWRpbmcgPSAod2lubmVyKSA9PiB7XG4gICAgY29uc3Qgd2lubmVySGVhZGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjd2lubmVyXCIpO1xuICAgIHdpbm5lckhlYWRpbmcudGV4dENvbnRlbnQgPSBgJHt3aW5uZXJ9IHdvbiFgO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuICAgIGNvbnN0IHNxdWFyZXMgPSBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5zcXVhcmVcIik7XG5cbiAgICBzcXVhcmVzLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgY29uc3QgcmVzZXRTcXVhcmUgPSBzcXVhcmU7XG4gICAgICByZXNldFNxdWFyZS5jbGFzc05hbWUgPSBcInNxdWFyZVwiOyAvLyBSZXNldCB0aGUgY2xhc3NOYW1lIHRvIHJlbW92ZSBhbGwgY2xhc3Nlc1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkLFxuICAgIGF0dGFjaEV2ZW50TGlzdGVuZXJzLFxuICAgIHNldFdpbm5lckhlYWRpbmcsXG4gICAgY2xlYXJHYW1lYm9hcmQsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgZGVmYXVsdCBSZW5kZXJlcjtcbiIsIi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtc3ludGF4ICovXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1sb25lbHktaWYgKi9cbmltcG9ydCB7IEFwcEhlbHBlcnMsIEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCBSZW5kZXJlciBmcm9tIFwiLi9yZW5kZXJcIjtcbmltcG9ydCB7IFNoaXBGYWN0b3J5LCBHYW1lYm9hcmRGYWN0b3J5LCBQbGF5ZXJGYWN0b3J5IH0gZnJvbSBcIi4vZmFjdG9yaWVzXCI7XG5cbmNvbnN0IENvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmRGYWN0b3J5KCk7XG4gIGNvbnN0IGNvbXB1dGVyR2FtZWJvYXJkID0gR2FtZWJvYXJkRmFjdG9yeSgpO1xuXG4gIGNvbnN0IGNvbXB1dGVyID0gUGxheWVyRmFjdG9yeShcImNvbXB1dGVyXCIpO1xuXG4gIGxldCBjdXJyZW50U2hpcEluZGV4ID0gMDtcbiAgbGV0IHNoaXBQbGFjZW1lbnRNb2RlID0gdHJ1ZTtcbiAgbGV0IGlzVmVydGljYWwgPSBmYWxzZTtcbiAgbGV0IHdpbm5lciA9IG51bGw7XG5cbiAgY29uc3QgcGxhY2VDb21wdXRlclNoaXBzID0gKCkgPT4ge1xuICAgIGZvciAoY29uc3Qgc2hpcFR5cGUgb2YgQXBwSGVscGVycy5zaGlwVHlwZXMpIHtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBzaGlwVHlwZTtcbiAgICAgIGNvbnN0IHNoaXAgPSBTaGlwRmFjdG9yeShsZW5ndGgpO1xuXG4gICAgICBjb25zdCBncmlkU2l6ZSA9IDEwO1xuICAgICAgbGV0IGNvb3JkaW5hdGVzO1xuICAgICAgbGV0IHBsYWNlZCA9IGZhbHNlO1xuXG4gICAgICB3aGlsZSAoIXBsYWNlZCkge1xuICAgICAgICAvLyBHZW5lcmF0ZSByYW5kb20gc3RhcnRSb3cgYW5kIHN0YXJ0Q29sIHdpdGhpbiB0aGUgZ3JpZCBib3VuZGFyaWVzXG4gICAgICAgIGNvbnN0IHN0YXJ0Um93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogZ3JpZFNpemUpO1xuICAgICAgICBjb25zdCBzdGFydENvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGdyaWRTaXplKTtcblxuICAgICAgICAvLyBSYW5kb21seSBjaG9vc2Ugd2hldGhlciB0aGUgc2hpcCB3aWxsIGJlIHBsYWNlZCB2ZXJ0aWNhbGx5IG9yIGhvcml6b250YWxseVxuICAgICAgICBpc1ZlcnRpY2FsID0gTWF0aC5yYW5kb20oKSA8IDAuNTtcblxuICAgICAgICBpZiAoaXNWZXJ0aWNhbCAmJiBzdGFydFJvdyArIGxlbmd0aCA8PSBncmlkU2l6ZSkge1xuICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSBjb29yZGluYXRlcyBmb3IgYSB2ZXJ0aWNhbGx5IHBsYWNlZCBzaGlwXG4gICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiBbXG4gICAgICAgICAgICBzdGFydFJvdyArIGksXG4gICAgICAgICAgICBzdGFydENvbCxcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSBlbHNlIGlmICghaXNWZXJ0aWNhbCAmJiBzdGFydENvbCArIGxlbmd0aCA8PSBncmlkU2l6ZSkge1xuICAgICAgICAgIC8vIEdlbmVyYXRlIHRoZSBjb29yZGluYXRlcyBmb3IgYSBob3Jpem9udGFsbHkgcGxhY2VkIHNoaXBcbiAgICAgICAgICBjb29yZGluYXRlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGkpID0+IFtcbiAgICAgICAgICAgIHN0YXJ0Um93LFxuICAgICAgICAgICAgc3RhcnRDb2wgKyBpLFxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvb3JkaW5hdGVzKSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIHNoaXAgY2FuIGJlIHBsYWNlZCBhdCB0aGUgZ2VuZXJhdGVkIGNvb3JkaW5hdGVzXG4gICAgICAgICAgcGxhY2VkID0gY29tcHV0ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIGNvb3JkaW5hdGVzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50SGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHsgY29vcmRpbmF0ZSB9ID0gc3F1YXJlLmRhdGFzZXQ7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gQXBwSGVscGVycy5zaGlwVHlwZXNbY3VycmVudFNoaXBJbmRleF07XG5cbiAgICAgIGNvbnN0IFtzdGFydFJvdywgc3RhcnRDb2xdID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvSW5kaWNlcyhjb29yZGluYXRlKTtcblxuICAgICAgLy8gR2VuZXJhdGUgYW4gYXJyYXkgb2Ygc2hpcCBjb29yZGluYXRlcyBiYXNlZCBvbiB0aGUgc2hpcCBsZW5ndGhcbiAgICAgIGNvbnN0IHNoaXBDb29yZGluYXRlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGkpID0+IHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSByb3cgY29vcmRpbmF0ZSBiYXNlZCBvbiB2ZXJ0aWNhbCBvciBob3Jpem9udGFsIHBsYWNlbWVudFxuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgY29sdW1uIGNvb3JkaW5hdGUgYmFzZWQgb24gdmVydGljYWwgb3IgaG9yaXpvbnRhbCBwbGFjZW1lbnRcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4gW3JvdywgY29sXTsgLy8gUmV0dXJuIHRoZSBjb29yZGluYXRlIHBhaXJcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBdHRlbXB0IHRvIHBsYWNlIHRoZSBzaGlwIG9uIHRoZSBwbGF5ZXIgZ2FtZWJvYXJkXG4gICAgICBjb25zdCBzaGlwID0gU2hpcEZhY3RvcnkobGVuZ3RoKTtcbiAgICAgIGNvbnN0IHBsYWNlZCA9IHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcCwgc2hpcENvb3JkaW5hdGVzKTtcblxuICAgICAgaWYgKHBsYWNlZCkge1xuICAgICAgICAvLyBJZiBzaGlwIHBsYWNlbWVudCBpcyBzdWNjZXNzZnVsXG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICBzaGlwQ29vcmRpbmF0ZXMuZm9yRWFjaCgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHBsYWNlZFNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgW2RhdGEtY29vcmRpbmF0ZT1cIiR7RmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtcbiAgICAgICAgICAgICAgcm93LFxuICAgICAgICAgICAgICBjb2wsXG4gICAgICAgICAgICBdKX1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtY29vcmRpbmF0ZT1cIiR7RmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFxuICAgICAgICAgICAgICBbcm93LCBjb2xdXG4gICAgICAgICAgICApfVwiXWBcbiAgICAgICAgICApO1xuICAgICAgICAgIGluaXRpYWxTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY3VycmVudFNoaXBJbmRleCArPSAxOyAvLyBJbmNyZW1lbnQgdGhlIGN1cnJlbnRTaGlwSW5kZXggdG8gbW92ZSB0byB0aGUgbmV4dCBzaGlwXG5cbiAgICAgICAgaWYgKGN1cnJlbnRTaGlwSW5kZXggPT09IEFwcEhlbHBlcnMuc2hpcFR5cGVzLmxlbmd0aCkge1xuICAgICAgICAgIC8vIElmIGFsbCBzaGlwcyBoYXZlIGJlZW4gcGxhY2VkXG4gICAgICAgICAgc2hpcFBsYWNlbWVudE1vZGUgPSBmYWxzZTsgLy8gRGlzYWJsZSBzaGlwIHBsYWNlbWVudCBtb2RlXG4gICAgICAgICAgcGxhY2VDb21wdXRlclNoaXBzKCk7IC8vIFBsYWNlIHRoZSBjb21wdXRlcidzIHNoaXBzXG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBTZXQgYSB0aW1lb3V0IHRvIGRlbGF5IGhpZGluZyB0aGUgaW5pdGlhbCBzaGlwIHBsYWNlbWVudCBtb2RhbFxuICAgICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLFxuICAgICAgICAgICAgICBcImhpZGVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBzdGlsbCBzaGlwcyB0byBiZSBwbGFjZWRcbiAgICAgICAgICAvLyBHZXQgdGhlIHR5cGUgb2YgdGhlIG5leHQgc2hpcCBiYXNlZCBvbiB0aGUgY3VycmVudFNoaXBJbmRleFxuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IEFwcEhlbHBlcnMuc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdLnR5cGU7XG4gICAgICAgICAgLy8gVXBkYXRlIHRoZSBzaGlwIHR5cGUgdGV4dCBvbiB0aGUgVUlcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNoaXAtdHlwZVwiKS50ZXh0Q29udGVudCA9IG5leHRTaGlwVHlwZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgPSAoZSkgPT4ge1xuICAgIGlmIChzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgLy8gQ2hlY2sgaWYgc2hpcCBwbGFjZW1lbnQgbW9kZSBpcyBhY3RpdmVcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0O1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByZWZlci1kZXN0cnVjdHVyaW5nXG4gICAgICBjb25zdCBjb29yZGluYXRlID0gc3F1YXJlLmRhdGFzZXQuY29vcmRpbmF0ZTtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBBcHBIZWxwZXJzLnNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTsgLy8gR2V0IHRoZSBsZW5ndGggb2YgdGhlIHNoaXBcblxuICAgICAgY29uc3QgW3N0YXJ0Um93LCBzdGFydENvbF0gPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9JbmRpY2VzKGNvb3JkaW5hdGUpO1xuICAgICAgLy8gR2VuZXJhdGUgYW4gYXJyYXkgb2YgaG92ZXJlZCBzcXVhcmVzIGJhc2VkIG9uIHRoZSBzaGlwIGxlbmd0aFxuICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgcm93IGNvb3JkaW5hdGUgYmFzZWQgb24gdmVydGljYWwgb3IgaG9yaXpvbnRhbCBwbGFjZW1lbnRcbiAgICAgICAgY29uc3Qgcm93ID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Um93ICsgaSA6IHN0YXJ0Um93O1xuICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGNvbHVtbiBjb29yZGluYXRlIGJhc2VkIG9uIHZlcnRpY2FsIG9yIGhvcml6b250YWwgcGxhY2VtZW50XG4gICAgICAgIGNvbnN0IGNvbCA9IGlzVmVydGljYWwgPyBzdGFydENvbCA6IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBpbml0aWFsU3F1YXJlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYC5nYW1lYm9hcmQuaW5pdGlhbCBbZGF0YS1jb29yZGluYXRlPVwiJHtGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoXG4gICAgICAgICAgICAgIFtyb3csIGNvbF1cbiAgICAgICAgICAgICl9XCJdYFxuICAgICAgICAgICksXG4gICAgICAgIH07XG4gICAgICB9KTtcblxuICAgICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoeyBpbml0aWFsU3F1YXJlIH0pID0+IHtcbiAgICAgICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBob3ZlcmVkIHNxdWFyZXNcbiAgICAgICAgaWYgKGluaXRpYWxTcXVhcmUpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgaW5pdGlhbCBzcXVhcmUgZXhpc3RzXG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lYm9hcmQgLmhvdmVyZWRcIik7XG4gICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgaG92ZXJlZFNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBjb21wdXRlckF0dGFjayA9ICgpID0+IHtcbiAgICBpZiAoIXNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBjb29yZGluYXRlID0gY29tcHV0ZXIuYXR0YWNrKFxuICAgICAgICBwbGF5ZXJHYW1lYm9hcmQsXG4gICAgICAgIGNvbXB1dGVyLmxhc3RIaXRDb29yZGluYXRlLFxuICAgICAgICBjb21wdXRlci5jdXJyZW50RGlyZWN0aW9uXG4gICAgICApO1xuICAgICAgLy8gUmVjZWl2ZSB0aGUgYXR0YWNrIG9uIHRoZSBwbGF5ZXIncyBnYW1lYm9hcmQgYW5kIGdldCB0aGUgYXR0YWNrZWQgc2hpcCAoaWYgYW55KVxuICAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gcGxheWVyR2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG5cbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAuZ2FtZWJvYXJkLnBsYXllciBbZGF0YS1jb29yZGluYXRlPVwiJHtjb29yZGluYXRlfVwiXWBcbiAgICAgICk7IC8vIEdldCB0aGUgY29ycmVzcG9uZGluZyBzcXVhcmUgZWxlbWVudCBvbiB0aGUgcGxheWVyJ3MgZ2FtZWJvYXJkXG5cbiAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICAgIC8vIElmIHRoZXJlIHdhcyBhIGhpdCwgdXBkYXRlIHRoZSBsYXN0SGl0Q29vcmRpbmF0ZSBhbmQgY3VycmVudERpcmVjdGlvblxuICAgICAgICBjb21wdXRlci5sYXN0SGl0Q29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG4gICAgICAgIC8vIFRvIGtlZXAgdGhlIGNvbXB1dGVyJ3MgYXR0YWNrIGNvbnNpc3RlbnQsIHNldCB0aGUgY3VycmVudERpcmVjdGlvbiBpbml0aWFsbHkgdG8gXCJ1cFwiXG4gICAgICAgIGlmIChjb21wdXRlci5jdXJyZW50RGlyZWN0aW9uID09PSBudWxsKSB7XG4gICAgICAgICAgY29tcHV0ZXIuY3VycmVudERpcmVjdGlvbiA9IFwidXBcIjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghYXR0YWNrZWRTaGlwICYmIGNvbXB1dGVyLmxhc3RIaXRDb29yZGluYXRlKSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwibWlzc1wiKTtcbiAgICAgIH0gZWxzZSBpZiAoIWF0dGFja2VkU2hpcCAmJiAhY29tcHV0ZXIubGFzdEhpdENvb3JkaW5hdGUpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJtaXNzXCIpO1xuICAgICAgICAvLyBJZiB0aGVyZSB3YXMgYSBtaXNzLCByZXNldCB0aGUgbGFzdEhpdENvb3JkaW5hdGUgYW5kIGN1cnJlbnREaXJlY3Rpb25cbiAgICAgICAgY29tcHV0ZXIubGFzdEhpdENvb3JkaW5hdGUgPSBudWxsO1xuICAgICAgICBjb21wdXRlci5jdXJyZW50RGlyZWN0aW9uID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChwbGF5ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgd2lubmVyID0gXCJUaGUgY29tcHV0ZXJcIjtcbiAgICAgICAgUmVuZGVyZXIuc2V0V2lubmVySGVhZGluZyh3aW5uZXIpO1xuICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSxcbiAgICAgICAgICBcInNob3dcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBwbGF5ZXJBdHRhY2sgPSAoZSkgPT4ge1xuICAgIGlmICghc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0OyAvLyBHZXQgdGhlIGNsaWNrZWQgc3F1YXJlIGVsZW1lbnRcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItZGVzdHJ1Y3R1cmluZ1xuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IHNxdWFyZS5kYXRhc2V0LmNvb3JkaW5hdGU7XG4gICAgICAvLyBDb252ZXJ0IHRoZSByb3cgYW5kIGNvbHVtbiBpbmRpY2VzIHRvIGFuIGFscGhhbnVtZXJpYyBjb29yZGluYXRlXG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSBjb29yZGluYXRlIGhhcyBub3QgYmVlbiBwcmV2aW91c2x5IGF0dGFja2VkXG4gICAgICBpZiAoIWNvbXB1dGVyR2FtZWJvYXJkLmdldEF0dGFja2VkQ29vcmRpbmF0ZXMoKS5pbmNsdWRlcyhjb29yZGluYXRlKSkge1xuICAgICAgICAvLyBSZWNlaXZlIHRoZSBhdHRhY2sgb24gdGhlIGNvbXB1dGVyJ3MgZ2FtZWJvYXJkIGFuZCBnZXQgdGhlIGF0dGFja2VkIHNoaXAgKGlmIGFueSlcbiAgICAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gY29tcHV0ZXJHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcblxuICAgICAgICBpZiAoYXR0YWNrZWRTaGlwKSB7XG4gICAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJtaXNzXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbXB1dGVyR2FtZWJvYXJkLmFsbFNoaXBzU3VuaygpKSB7XG4gICAgICAgICAgd2lubmVyID0gXCJZb3VcIjtcbiAgICAgICAgICBSZW5kZXJlci5zZXRXaW5uZXJIZWFkaW5nKHdpbm5lcik7XG4gICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSxcbiAgICAgICAgICAgIFwic2hvd1wiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbXB1dGVyQXR0YWNrKCk7IC8vIFBlcmZvcm0gdGhlIGNvbXB1dGVyJ3MgYXR0YWNrXG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJvdGF0ZVNoaXBzID0gKCkgPT4ge1xuICAgIGlzVmVydGljYWwgPSAhaXNWZXJ0aWNhbDtcbiAgfTtcblxuICBjb25zdCBldmVudExpc3RlbmVycyA9IFtcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZW92ZXJcIiwgaGFuZGxlcjogZ2FtZWJvYXJkSG92ZXJIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwibW91c2VsZWF2ZVwiLCBoYW5kbGVyOiBnYW1lYm9hcmRNb3VzZUxlYXZlSGFuZGxlciB9LFxuICAgIHsgZXZlbnRUeXBlOiBcImNsaWNrXCIsIGhhbmRsZXI6IHNoaXBQbGFjZW1lbnRIYW5kbGVyIH0sXG4gIF07XG5cbiAgY29uc3QgcmVzZXRHYW1lID0gKCkgPT4ge1xuICAgIC8vIFJlc2V0IGdhbWUtcmVsYXRlZCB2YXJpYWJsZXNcbiAgICBjdXJyZW50U2hpcEluZGV4ID0gMDtcbiAgICBzaGlwUGxhY2VtZW50TW9kZSA9IHRydWU7XG4gICAgaXNWZXJ0aWNhbCA9IGZhbHNlO1xuICAgIHdpbm5lciA9IG51bGw7XG4gICAgY29tcHV0ZXIubGFzdEhpdENvb3JkaW5hdGUgPSBudWxsO1xuICAgIGNvbXB1dGVyLmN1cnJlbnREaXJlY3Rpb24gPSBudWxsO1xuXG4gICAgLy8gUmVzZXQgZ2FtZWJvYXJkIG9iamVjdHNcbiAgICBwbGF5ZXJHYW1lYm9hcmQucmVzZXQoKTtcbiAgICBjb21wdXRlckdhbWVib2FyZC5yZXNldCgpO1xuXG4gICAgLy8gQ2xlYXIgY29tcHV0ZXJzIGF0dGFja2VkQ29vcmRpbmF0ZXMgc2V0XG4gICAgY29tcHV0ZXIuY2xlYXJTZXQoKTtcblxuICAgIC8vIFJlbW92ZSBoaXQgYW5kIG1pc3MgY2xhc3NlcyBmcm9tIGFsbCBzcXVhcmVzXG4gICAgUmVuZGVyZXIuY2xlYXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmluaXRpYWxcIik7XG4gICAgUmVuZGVyZXIuY2xlYXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLnBsYXllclwiKTtcbiAgICBSZW5kZXJlci5jbGVhckdhbWVib2FyZChcIi5nYW1lYm9hcmQuY29tcHV0ZXJcIik7XG5cbiAgICAvLyBSZXNldCBzaGlwVHlwZXNcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNoaXAtdHlwZVwiKS50ZXh0Q29udGVudCA9XG4gICAgICBBcHBIZWxwZXJzLnNoaXBUeXBlc1swXS50eXBlO1xuICB9O1xuXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmVuZGdhbWVcIiksIFwiaGlkZVwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmluaXRpYWxcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5wbGF5ZXJcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5jb21wdXRlclwiKTtcbiAgICBSZW5kZXJlci5hdHRhY2hFdmVudExpc3RlbmVycyhcIi5nYW1lYm9hcmQuaW5pdGlhbFwiLCBldmVudExpc3RlbmVycyk7XG5cbiAgICBjb25zdCBjb21wdXRlclNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgICAgXCIuZ2FtZWJvYXJkLmNvbXB1dGVyIC5zcXVhcmVcIlxuICAgICk7XG4gICAgY29tcHV0ZXJTcXVhcmVzLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5ZXJBdHRhY2spO1xuICAgIH0pO1xuXG4gICAgY29uc3Qgcm90YXRlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNyb3RhdGVCdG5cIik7XG4gICAgcm90YXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCByb3RhdGVTaGlwcyk7XG5cbiAgICBjb25zdCBwbGF5QWdhaW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ld0dhbWVcIik7XG4gICAgcGxheUFnYWluQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICByZXNldEdhbWUoKTtcbiAgICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLCBcImhpZGVcIik7XG4gICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuaW5pdGlhbFwiKSwgXCJzaG93XCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdCxcbiAgfTtcbn0pKCk7XG5cbkNvbnRyb2xsZXIuaW5pdCgpO1xuIiwiLyogZXNsaW50LWRpc2FibGUgbm8tcGFyYW0tcmVhc3NpZ24gKi9cbmltcG9ydCB7IEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGNvbnN0IFNoaXBGYWN0b3J5ID0gKGxlbmd0aCkgPT4ge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdHMgKz0gMTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBoaXRzID49IGxlbmd0aDsgLy8gUmV0dXJuIHRydWUgaWYgaGl0cyBpcyBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gbGVuZ3RoXG5cbiAgcmV0dXJuIHtcbiAgICBsZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXQgaGl0cygpIHtcbiAgICAgIC8vIEdldHRlciBmdW5jdGlvbiBmb3IgaGl0cy4gVXNpbmcgZnVuY3Rpb24gZGVjbGFyYXRpb24gdG8gZW5zdXJlIGl0IGhhcyBhY2Nlc3MgdG8gdGhlXG4gICAgICAvLyBgaGl0c2AgdmFyaWFibGUgZHluYW1pY2FsbHksIHNpbmNlIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBhcmUgaG9pc3RlZCBhbmQgY2FuIGJlIHVzZWRcbiAgICAgIC8vIGJlZm9yZSB0aGV5IGFyZSBkZWZpbmVkLiBUaGlzIGFsbG93cyBhY2Nlc3NpbmcgdGhlIGN1cnJlbnQgdmFsdWUgb2YgYGhpdHNgIGV2ZW4gYmVmb3JlXG4gICAgICAvLyBjYWxsaW5nIHRoZSBgaGl0YCBmdW5jdGlvblxuICAgICAgcmV0dXJuIGhpdHM7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBHYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBjb25zdCBncmlkU2l6ZSA9IDEwO1xuICBjb25zdCBncmlkID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogZ3JpZFNpemUgfSwgKCkgPT5cbiAgICBBcnJheShncmlkU2l6ZSkuZmlsbChudWxsKVxuICApO1xuXG4gIGxldCBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gIGxldCBtaXNzZWRBdHRhY2tzID0gW107XG5cbiAgY29uc3QgZ2V0R3JpZCA9ICgpID0+IGdyaWQ7XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgYWxsIGNvb3JkaW5hdGVzIGFyZSB3aXRoaW4gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIGdyaWRcbiAgICBjb25zdCB3aXRoaW5Cb3VuZGFyaWVzID0gY29vcmRpbmF0ZXMuZXZlcnkoXG4gICAgICAoW3JvdywgY29sXSkgPT4gcm93ID49IDAgJiYgcm93IDwgZ3JpZFNpemUgJiYgY29sID49IDAgJiYgY29sIDwgZ3JpZFNpemVcbiAgICApO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBjb25mbGljdHMgPSBjb29yZGluYXRlcy5zb21lKChbcm93LCBjb2xdKSA9PiBncmlkW3Jvd11bY29sXSAhPT0gbnVsbCk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGFkamFjZW50IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGFkamFjZW50Q29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgLy8gRGVmaW5lIHRoZSBhZGphY2VudCBjb29yZGluYXRlcyBhcm91bmQgdGhlIGN1cnJlbnQgY29vcmRpbmF0ZVxuICAgICAgY29uc3QgYWRqYWNlbnRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3JvdyAtIDEsIGNvbF0sIC8vIFVwXG4gICAgICAgIFtyb3cgKyAxLCBjb2xdLCAvLyBEb3duXG4gICAgICAgIFtyb3csIGNvbCAtIDFdLCAvLyBMZWZ0XG4gICAgICAgIFtyb3csIGNvbCArIDFdLCAvLyBSaWdodFxuICAgICAgICBbcm93IC0gMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIFVwLUxlZnRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBVcC1SaWdodFxuICAgICAgICBbcm93ICsgMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIERvd24tTGVmdFxuICAgICAgICBbcm93ICsgMSwgY29sICsgMV0sIC8vIERpYWdvbmFsIERvd24tUmlnaHRcbiAgICAgIF07XG5cbiAgICAgIC8vIENoZWNrIGlmIGFueSBhZGphY2VudCBjb29yZGluYXRlIGhhcyBhIHNoaXAgcGxhY2VkIG9uIGl0XG4gICAgICByZXR1cm4gYWRqYWNlbnRDb29yZGluYXRlcy5zb21lKFxuICAgICAgICAoW2FkalJvdywgYWRqQ29sXSkgPT5cbiAgICAgICAgICBhZGpSb3cgPj0gMCAmJlxuICAgICAgICAgIGFkalJvdyA8IGdyaWRTaXplICYmXG4gICAgICAgICAgYWRqQ29sID49IDAgJiZcbiAgICAgICAgICBhZGpDb2wgPCBncmlkU2l6ZSAmJlxuICAgICAgICAgIGdyaWRbYWRqUm93XT8uW2FkakNvbF0gIT09IG51bGxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBJZiB0aGUgc2hpcCBwbGFjZW1lbnQgaXMgd2l0aGluIGdyaWQgYm91bmRhcmllcywgaGFzIG5vIGNvbmZsaWN0cywgYW5kIG5vIGFkamFjZW50IGNvbmZsaWN0cy4uLlxuICAgIGlmICh3aXRoaW5Cb3VuZGFyaWVzICYmICFjb25mbGljdHMgJiYgIWFkamFjZW50Q29uZmxpY3RzKSB7XG4gICAgICAvLyBDcmVhdGUgYW4gb2JqZWN0IGNvbnRhaW5pbmcgc2hpcCBpbmZvcm1hdGlvbiBhbmQgY29vcmRpbmF0ZXNcbiAgICAgIGNvbnN0IHNoaXBJbmZvID0ge1xuICAgICAgICBzaGlwLFxuICAgICAgICBjb29yZGluYXRlcyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFBsYWNlIHRoZSBzaGlwIG9uIHRoZSBncmlkIGJ5IHVwZGF0aW5nIHRoZSBjb3JyZXNwb25kaW5nIGNlbGxzXG4gICAgICBzaGlwSW5mby5jb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgIGdyaWRbcm93XVtjb2xdID0gc2hpcEluZm87XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRydWU7IC8vIFNoaXAgcGxhY2VtZW50IHN1Y2Nlc3NmdWxcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIE90aGVyd2lzZSwgc2hpcCBwbGFjZW1lbnQgZmFpbGVkXG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGNvbnRhaW5zIGEgc2hpcCBhbmQgaXQncyBub3QgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNlbGwgIT09IG51bGwgJiZcbiAgICAgICAgICBjZWxsLnNoaXAgJiZcbiAgICAgICAgICAhc2hpcHMuaW5jbHVkZXMoY2VsbC5zaGlwKSAmJlxuICAgICAgICAgICFjZWxsLnNoaXAuaXNTdW5rKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSBzaGlwIHRvIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICAgIHNoaXBzLnB1c2goY2VsbC5zaGlwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzaGlwcztcbiAgfTtcblxuICBjb25zdCBnZXRBbGxTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgY29udGFpbnMgYSBzaGlwIGFuZCBpdCdzIG5vdCBhbHJlYWR5IGluY2x1ZGVkIGluIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICBpZiAoY2VsbCAhPT0gbnVsbCAmJiBjZWxsLnNoaXAgJiYgIXNoaXBzLmluY2x1ZGVzKGNlbGwuc2hpcCkpIHtcbiAgICAgICAgICAvLyBBZGQgdGhlIHNoaXAgdG8gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgICAgc2hpcHMucHVzaChjZWxsLnNoaXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNoaXBzO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBDb29yZGluYXRlcyA9IChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGV4aXN0cyBhbmQgY29udGFpbnMgdGhlIHNwZWNpZmllZCBzaGlwXG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwuc2hpcCA9PT0gc2hpcCkge1xuICAgICAgICAgIC8vIEFkZCB0byBjb29yZGluYXRlcyBhcnJheVxuICAgICAgICAgIGNvb3JkaW5hdGVzLnB1c2goW3JvdywgY29sXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgW2NvbHVtbkxldHRlciwgcm93TnVtYmVyXSA9IGNvb3JkaW5hdGU7XG4gICAgY29uc3Qgcm93ID0gcGFyc2VJbnQocm93TnVtYmVyLCAxMCk7XG4gICAgY29uc3QgY29sID0gY29sdW1uTGV0dGVyLmNoYXJDb2RlQXQoMCkgLSA2NTtcbiAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG5cbiAgICBpZiAoY2VsbCAhPT0gbnVsbCkge1xuICAgICAgLy8gU2hpcCBhdCBjb29yZGluYXRlLCBpdCdzIGEgaGl0XG4gICAgICBjb25zdCB7IHNoaXAgfSA9IGNlbGw7XG4gICAgICBzaGlwLmhpdCgpOyAvLyBJbmNyZW1lbnQgaGl0IGNvdW50IG9mIHRoZSBzaGlwXG4gICAgICBhdHRhY2tlZENvb3JkaW5hdGVzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgICByZXR1cm4gc2hpcDsgLy8gUmV0dXJuIHRoZSBzaGlwIG9iamVjdCB3aGVuIGl0IGlzIGhpdFxuICAgIH1cbiAgICAvLyBObyBzaGlwIGF0IGNvb3JkaW5hdGUsIGl0J3MgYSBtaXNzXG4gICAgbWlzc2VkQXR0YWNrcy5wdXNoKGNvb3JkaW5hdGUpO1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMucHVzaChjb29yZGluYXRlKTtcbiAgICByZXR1cm4gbnVsbDsgLy8gUmV0dXJuIG51bGwgd2hlbiBpdCdzIGEgbWlzc1xuICB9O1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IGdldFNoaXBzKCk7IC8vIFJldHJpZXZlIGFsbCB0aGUgc2hpcHMgb24gdGhlIGdhbWVib2FyZFxuXG4gICAgLy8gQ2hlY2sgaWYgYWxsIHNoaXBzIGFyZSBzdW5rLCByZXR1cm4gdHJ1ZSBpZiB5ZXMsIGFuZCByZXR1cm4gZmFsc2UgaWYgbm9cbiAgICBjb25zdCByZXN1bHQgPSBzaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgIC8vIENsZWFyIHRoZSBncmlkIGJ5IHNldHRpbmcgYWxsIGNlbGxzIHRvIG51bGxcbiAgICBncmlkLmZvckVhY2goKHJvdywgcm93SW5kZXgpID0+IHtcbiAgICAgIHJvdy5mb3JFYWNoKChfLCBjb2xJbmRleCkgPT4ge1xuICAgICAgICBncmlkW3Jvd0luZGV4XVtjb2xJbmRleF0gPSBudWxsO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBSZWFzc2lnbiBlbXB0eSBhcnJheXMgdG8gY2xlYXIgdGhlIGNvbnRlbnRzIG9mIGF0dGFja2VkQ29vcmRpbmF0ZXMgYW5kIG1pc3NlZEF0dGFja3NcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gICAgbWlzc2VkQXR0YWNrcyA9IFtdO1xuICB9O1xuXG4gIGNvbnN0IGdldE1pc3NlZEF0dGFja3MgPSAoKSA9PiBtaXNzZWRBdHRhY2tzO1xuXG4gIGNvbnN0IGdldEF0dGFja2VkQ29vcmRpbmF0ZXMgPSAoKSA9PiBhdHRhY2tlZENvb3JkaW5hdGVzO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0R3JpZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgZ2V0U2hpcHMsXG4gICAgZ2V0QWxsU2hpcHMsXG4gICAgZ2V0U2hpcENvb3JkaW5hdGVzLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgZ2V0TWlzc2VkQXR0YWNrcyxcbiAgICBnZXRBdHRhY2tlZENvb3JkaW5hdGVzLFxuICAgIGFsbFNoaXBzU3VuayxcbiAgICByZXNldCxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBQbGF5ZXJGYWN0b3J5ID0gKG5hbWUsIGN1cnJlbnREaXJlY3Rpb24sIGxhc3RIaXRDb29yZGluYXRlKSA9PiB7XG4gIGNvbnN0IGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBuZXcgU2V0KCk7IC8vIFNldCB0byBrZWVwIHRyYWNrIG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG5cbiAgY29uc3QgZ2V0TmV4dENvb3JkaW5hdGVJbkRpcmVjdGlvbiA9IChjb29yZGluYXRlLCBkaXJlY3Rpb24pID0+IHtcbiAgICBjb25zdCBbcm93LCBjb2xdID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvSW5kaWNlcyhjb29yZGluYXRlKTtcblxuICAgIGxldCBuZXh0Um93ID0gcm93O1xuICAgIGxldCBuZXh0Q29sID0gY29sO1xuXG4gICAgLy8gVXBkYXRlIHRoZSBuZXh0Um93IGFuZCBuZXh0Q29sIGJhc2VkIG9uIHRoZSBnaXZlbiBkaXJlY3Rpb25cbiAgICBzd2l0Y2ggKGRpcmVjdGlvbikge1xuICAgICAgY2FzZSBcInVwXCI6XG4gICAgICAgIG5leHRSb3cgLT0gMTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZG93blwiOlxuICAgICAgICBuZXh0Um93ICs9IDE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImxlZnRcIjpcbiAgICAgICAgbmV4dENvbCAtPSAxO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICBuZXh0Q29sICs9IDE7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgcmV0dXJuIEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbbmV4dFJvdywgbmV4dENvbF0pO1xuICB9O1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1zaGFkb3dcbiAgY29uc3QgYXR0YWNrID0gKGVuZW15R2FtZWJvYXJkLCBsYXN0SGl0Q29vcmRpbmF0ZSwgY3VycmVudERpcmVjdGlvbikgPT4ge1xuICAgIGNvbnN0IGdyaWRTaXplID0gZW5lbXlHYW1lYm9hcmQuZ2V0R3JpZCgpLmxlbmd0aDtcbiAgICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gRmFjdG9yeUhlbHBlcnMuZ2V0QWxsVmFsaWRDb29yZGluYXRlcyhncmlkU2l6ZSk7XG5cbiAgICBsZXQgY29vcmRpbmF0ZSA9IFwiXCI7XG5cbiAgICBpZiAobGFzdEhpdENvb3JkaW5hdGUgJiYgY3VycmVudERpcmVjdGlvbikge1xuICAgICAgLy8gR2V0IHRoZSBuZXh0IGRpcmVjdGlvbnMgdG8gdHJ5XG4gICAgICBjb25zdCBkaXJlY3Rpb25zVG9UcnkgPSBbXCJ1cFwiLCBcImRvd25cIiwgXCJsZWZ0XCIsIFwicmlnaHRcIl07XG5cbiAgICAgIC8vIFRyeSBlYWNoIGRpcmVjdGlvbiB1bnRpbCBhIHZhbGlkIGNvb3JkaW5hdGUgaXMgZm91bmRcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLXN5bnRheFxuICAgICAgZm9yIChjb25zdCBkaXJlY3Rpb24gb2YgZGlyZWN0aW9uc1RvVHJ5KSB7XG4gICAgICAgIGNvb3JkaW5hdGUgPSBnZXROZXh0Q29vcmRpbmF0ZUluRGlyZWN0aW9uKGxhc3RIaXRDb29yZGluYXRlLCBkaXJlY3Rpb24pO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgbmV4dCBjb29yZGluYXRlIGluIHRoZSBjdXJyZW50IGRpcmVjdGlvbiBpcyBhIHZhbGlkLCB1bmF0dGFja2VkIGNvb3JkaW5hdGVcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHZhbGlkQ29vcmRpbmF0ZXMuaW5jbHVkZXMoY29vcmRpbmF0ZSkgJiZcbiAgICAgICAgICAhYXR0YWNrZWRDb29yZGluYXRlcy5oYXMoY29vcmRpbmF0ZSkgJiZcbiAgICAgICAgICAhZW5lbXlHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIEFkZCB0aGUgYXR0YWNrZWQgY29vcmRpbmF0ZSB0byB0aGUgcGxheWVyJ3Mgc2V0IG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG4gICAgICAgICAgYXR0YWNrZWRDb29yZGluYXRlcy5hZGQoY29vcmRpbmF0ZSk7XG4gICAgICAgICAgLy8gVXBkYXRlIGxhc3RIaXRDb29yZGluYXRlIGFuZCBjdXJyZW50RGlyZWN0aW9uXG5cbiAgICAgICAgICBsYXN0SGl0Q29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG4gICAgICAgICAgY3VycmVudERpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgICAgICAgICByZXR1cm4gY29vcmRpbmF0ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIElmIG5vIHZhbGlkIG5leHQgY29vcmRpbmF0ZSBpbiB0aGUgY3VycmVudCBkaXJlY3Rpb24sIG9yIGlmIHRoZSBsYXN0SGl0Q29vcmRpbmF0ZSBvciBjdXJyZW50RGlyZWN0aW9uIGlzIG5vdCBzZXQsXG4gICAgLy8gYXR0YWNrIHJhbmRvbWx5IGxpa2UgYmVmb3JlXG4gICAgZG8ge1xuICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZENvb3JkaW5hdGVzLmxlbmd0aCk7XG4gICAgICBjb29yZGluYXRlID0gdmFsaWRDb29yZGluYXRlc1tyYW5kb21JbmRleF07XG4gICAgfSB3aGlsZSAoXG4gICAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmhhcyhjb29yZGluYXRlKSB8fFxuICAgICAgZW5lbXlHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpXG4gICAgKTtcblxuICAgIC8vIEFkZCB0aGUgYXR0YWNrZWQgY29vcmRpbmF0ZSB0byB0aGUgcGxheWVyJ3Mgc2V0IG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5hZGQoY29vcmRpbmF0ZSk7XG5cbiAgICByZXR1cm4gY29vcmRpbmF0ZTtcbiAgfTtcblxuICBjb25zdCBnZXRBdHRhY2tlZFNldCA9ICgpID0+IGF0dGFja2VkQ29vcmRpbmF0ZXM7XG5cbiAgY29uc3QgY2xlYXJTZXQgPSAoKSA9PiB7XG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5jbGVhcigpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICBsYXN0SGl0Q29vcmRpbmF0ZSxcbiAgICBjdXJyZW50RGlyZWN0aW9uLFxuICAgIGF0dGFjayxcbiAgICBnZXRBdHRhY2tlZFNldCxcbiAgICBjbGVhclNldCxcbiAgfTtcbn07XG4iLCJleHBvcnQgY29uc3QgRmFjdG9yeUhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gW107XG5cbiAgY29uc3QgY29udmVydFRvSW5kaWNlcyA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgY29sdW1uID0gY29vcmRpbmF0ZS5jaGFyQ29kZUF0KDApIC0gNjU7IC8vIENvbnZlcnQgY29sdW1uIGxldHRlciB0byBpbmRleFxuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKTsgLy8gQ29udmVydCByb3cgbnVtYmVyIHRvIGluZGV4IHdpdGggcmFkaXggMTBcbiAgICByZXR1cm4gW3JvdywgY29sdW1uXTtcbiAgfTtcblxuICBjb25zdCBjb252ZXJ0VG9BbHBoYW51bWVyaWMgPSAoW3JvdywgY29sdW1uXSkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvbHVtbiArIDY1KTsgLy8gQ29udmVydCBjb2x1bW4gaW5kZXggdG8gbGV0dGVyXG4gICAgcmV0dXJuIGNvb3JkaW5hdGUgKyByb3c7IC8vIENvbnZlcnQgcm93IGluZGV4IHRvIG51bWJlclxuICB9O1xuXG4gIGNvbnN0IGdldEFsbFZhbGlkQ29vcmRpbmF0ZXMgPSAoZ3JpZFNpemUpID0+IHtcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBhbHBoYW51bWVyaWNDb29yZGluYXRlID0gY29udmVydFRvQWxwaGFudW1lcmljKFtyb3csIGNvbF0pO1xuICAgICAgICB2YWxpZENvb3JkaW5hdGVzLnB1c2goYWxwaGFudW1lcmljQ29vcmRpbmF0ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkQ29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBjb252ZXJ0VG9JbmRpY2VzLFxuICAgIGNvbnZlcnRUb0FscGhhbnVtZXJpYyxcbiAgICBnZXRBbGxWYWxpZENvb3JkaW5hdGVzLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGNvbnN0IEFwcEhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCBzaGlwVHlwZXMgPSBbXG4gICAgeyB0eXBlOiBcImNhcnJpZXJcIiwgbGVuZ3RoOiA1IH0sXG4gICAgeyB0eXBlOiBcImJhdHRsZXNoaXBcIiwgbGVuZ3RoOiA0IH0sXG4gICAgeyB0eXBlOiBcImRlc3Ryb3llclwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwic3VibWFyaW5lXCIsIGxlbmd0aDogMyB9LFxuICAgIHsgdHlwZTogXCJwYXRyb2wgYm9hdFwiLCBsZW5ndGg6IDIgfSxcbiAgXTtcblxuICBjb25zdCB0b2dnbGVNb2RhbCA9IChtb2RhbCwgY2hvaWNlKSA9PiB7XG4gICAgY29uc3QgdG9nZ2xlZE1vZGFsID0gbW9kYWw7XG5cbiAgICBjb25zdCBvdmVybGF5ID0gbW9kYWwuY2xvc2VzdChcIi5vdmVybGF5XCIpO1xuICAgIGNvbnN0IGRpc3BsYXlWYWx1ZSA9IGNob2ljZSA9PT0gXCJzaG93XCIgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVZhbHVlO1xuICAgIHRvZ2dsZWRNb2RhbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVZhbHVlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgc2hpcFR5cGVzLFxuICAgIHRvZ2dsZU1vZGFsLFxuICB9O1xufSkoKTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDM4MCk7XG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc3Nik7XG4iXSwibmFtZXMiOlsiY29udGFpbmVyRWxlbWVudCIsImNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50Iiwicm93IiwiY29sIiwiY29vcmRpbmF0ZSIsImNvbnZlcnRUb0FscGhhbnVtZXJpYyIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkYXRhc2V0IiwiYXBwZW5kQ2hpbGQiLCJldmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRUeXBlIiwiaGFuZGxlciIsIndpbm5lciIsImNsYXNzTmFtZSIsInBsYXllckdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwiY29tcHV0ZXIiLCJjdXJyZW50U2hpcEluZGV4Iiwic2hpcFBsYWNlbWVudE1vZGUiLCJpc1ZlcnRpY2FsIiwicGxheWVyQXR0YWNrIiwiZSIsInRhcmdldCIsImdldEF0dGFja2VkQ29vcmRpbmF0ZXMiLCJpbmNsdWRlcyIsInJlY2VpdmVBdHRhY2siLCJhbGxTaGlwc1N1bmsiLCJ0b2dnbGVNb2RhbCIsImF0dGFjayIsImxhc3RIaXRDb29yZGluYXRlIiwiY3VycmVudERpcmVjdGlvbiIsImF0dGFja2VkU2hpcCIsImNvbXB1dGVyQXR0YWNrIiwicm90YXRlU2hpcHMiLCJsZW5ndGgiLCJzaGlwVHlwZXMiLCJzdGFydFJvdyIsInN0YXJ0Q29sIiwiY29udmVydFRvSW5kaWNlcyIsIkFycmF5IiwiZnJvbSIsIl8iLCJpIiwiaW5pdGlhbFNxdWFyZSIsImhvdmVyZWRTcXVhcmUiLCJyZW1vdmUiLCJzaGlwQ29vcmRpbmF0ZXMiLCJzaGlwIiwicGxhY2VTaGlwIiwic2hpcFR5cGUiLCJncmlkU2l6ZSIsImNvb3JkaW5hdGVzIiwicGxhY2VkIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicGxhY2VDb21wdXRlclNoaXBzIiwic2V0VGltZW91dCIsIm5leHRTaGlwVHlwZSIsInR5cGUiLCJpbml0IiwicmVzZXQiLCJjbGVhclNldCIsIlNoaXBGYWN0b3J5IiwiaGl0cyIsImhpdCIsImlzU3VuayIsIkdhbWVib2FyZEZhY3RvcnkiLCJncmlkIiwiZmlsbCIsImF0dGFja2VkQ29vcmRpbmF0ZXMiLCJtaXNzZWRBdHRhY2tzIiwiZ2V0U2hpcHMiLCJzaGlwcyIsImNlbGwiLCJwdXNoIiwiZ2V0R3JpZCIsIndpdGhpbkJvdW5kYXJpZXMiLCJldmVyeSIsImNvbmZsaWN0cyIsInNvbWUiLCJhZGphY2VudENvbmZsaWN0cyIsImFkalJvdyIsImFkakNvbCIsInNoaXBJbmZvIiwiZ2V0QWxsU2hpcHMiLCJnZXRTaGlwQ29vcmRpbmF0ZXMiLCJjb2x1bW5MZXR0ZXIiLCJyb3dOdW1iZXIiLCJwYXJzZUludCIsImNoYXJDb2RlQXQiLCJnZXRNaXNzZWRBdHRhY2tzIiwicm93SW5kZXgiLCJjb2xJbmRleCIsIlBsYXllckZhY3RvcnkiLCJuYW1lIiwiU2V0IiwiZ2V0TmV4dENvb3JkaW5hdGVJbkRpcmVjdGlvbiIsImRpcmVjdGlvbiIsIm5leHRSb3ciLCJuZXh0Q29sIiwiZW5lbXlHYW1lYm9hcmQiLCJ2YWxpZENvb3JkaW5hdGVzIiwiZ2V0QWxsVmFsaWRDb29yZGluYXRlcyIsImRpcmVjdGlvbnNUb1RyeSIsImhhcyIsImdldEF0dGFja2VkU2V0IiwiY2xlYXIiLCJGYWN0b3J5SGVscGVycyIsImNvbHVtbiIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInNsaWNlIiwiYWxwaGFudW1lcmljQ29vcmRpbmF0ZSIsIkFwcEhlbHBlcnMiLCJtb2RhbCIsImNob2ljZSIsInRvZ2dsZWRNb2RhbCIsImRpc3BsYXlWYWx1ZSIsImNsb3Nlc3QiLCJzdHlsZSIsImRpc3BsYXkiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwic291cmNlUm9vdCI6IiJ9