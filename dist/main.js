(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const n=(e,t)=>{const r=document.querySelector(`${e}`);r.textContent="";for(let e=0;e<10;e+=1)for(let o=0;o<10;o+=1){const n=document.createElement("div");n.classList.add("square"),n.dataset.row=e,n.dataset.col=o,t.forEach((e=>{n.addEventListener(e.eventType,e.handler)})),r.appendChild(n)}};var s=r(776);(()=>{const e=(0,s.Br)(),t=[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}];let r=0,a=!0;const l=[{eventType:"mouseover",handler:e=>{if(a){const o=e.target,n=parseInt(o.dataset.row,10),s=parseInt(o.dataset.col,10),{length:a}=t[r];Array.from({length:a},((e,t)=>{const r=n,o=s+t;return document.querySelector(`[data-row="${r}"][data-col="${o}"]`)})).forEach((e=>{e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:n=>{if(a){const l=n.target,c=parseInt(l.dataset.row,10),i=parseInt(l.dataset.col,10),{length:d}=t[r],h=Array.from({length:d},((e,t)=>[c,i+t])),p=(0,s._V)(d);if(e.placeShip(p,h))if(l.classList.add("placed"),h.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),r+=1,r===t.length)a=!1,setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide"),console.log("Placed ships:"),e.getShips().forEach(((t,r)=>{console.log(`Ship ${r+1} - Length: ${t.length}`);const o=e.getShipCoordinates(t);console.log("Coordinates:",o)}))}),1e3);else{const e=t[r].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),n(".gameboard.initial",l)}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>s,_V:()=>n});var o=r(555);const n=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},s=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null))),r=[],n=[],s=()=>{const r=[];for(let o=0;o<e;o+=1)for(let n=0;n<e;n+=1){const e=t[o][n];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const n=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),s=o.some((([e,r])=>null!==t[e][r]));if(n&&!s){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:s,getShipCoordinates:r=>{const n=[];for(let s=0;s<e;s+=1)for(let a=0;a<e;a+=1){const e=t[s][a];e&&e.ship===r&&n.push(o.r.convertToAlphanumeric([s,a]))}return n},receiveAttack:e=>{const[s,a]=o.r.convertToIndices(e),l=t[s][a],c=l&&l.ship;c?c.hit():n.push(e),r.push(e)},getMissedAttacks:()=>n,getAttackedCoordinates:()=>r,allShipsSunk:()=>s().every((e=>e.isSunk()))}}},555:(e,t,r)=>{r.d(t,{U:()=>n,r:()=>o});const o=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let r=0;r<t;r+=1)for(let n=0;n<t;n+=1){const t=o.convertToAlphanumeric([r,n]);e.push(t)}return e}}})(),n={toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcmVuZGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYXBwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBtb2R1bGUgY2FuIGJlIHJlc3BvbnNpYmxlIGZvciByZW5kZXJpbmcgY29udGVudCBvbiB0aGUgcGFnZS5cbi8vIEl0IGNhbiBpbmNsdWRlIGZ1bmN0aW9ucyB0byB1cGRhdGUgdGhlIERPTSBlbGVtZW50cyByZXByZXNlbnRpbmcgdGhlXG4vLyBnYW1lIGJvYXJkcywgc2hpcHMsIGF0dGFja3MsIG1lc3NhZ2VzLCBhbmQgb3RoZXIgVUkgY29tcG9uZW50cy4gSXQgc2hvdWxkXG4vLyBlbmNhcHN1bGF0ZSB0aGUgRE9NIG1hbmlwdWxhdGlvbiBjb2RlIGFuZCBwcm92aWRlIGEgY2xlYW4gaW50ZXJmYWNlIGZvclxuLy8gdXBkYXRpbmcgdGhlIFVJIGJhc2VkIG9uIHRoZSBnYW1lIHN0YXRlLiBJdCBjYW4gYmUgdGhlIGJyaWRnZSBiZXR3ZWVuIHRoZVxuLy8gZ2FtZSBsb2dpYyBhbmQgdGhlIGFjdHVhbCBET00gbWFuaXB1bGF0aW9uLlxuXG5jb25zdCBSZW5kZXJlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHJlbmRlckdhbWVib2FyZCA9IChjb250YWluZXJFbGVtZW50LCBldmVudExpc3RlbmVycykgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCR7Y29udGFpbmVyRWxlbWVudH1gKTtcblxuICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9IFwiXCI7XG5cbiAgICAvLyBDcmVhdGUgdGhlIDEweDEwIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IDEwOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInNxdWFyZVwiKTtcbiAgICAgICAgc3F1YXJlLmRhdGFzZXQucm93ID0gcm93O1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5jb2wgPSBjb2w7XG5cbiAgICAgICAgLy8gQXR0YWNoIGV2ZW50IGxpc3RlbmVycyB0byBlYWNoIHNxdWFyZVxuICAgICAgICBldmVudExpc3RlbmVycy5mb3JFYWNoKChsaXN0ZW5lcikgPT4ge1xuICAgICAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKGxpc3RlbmVyLmV2ZW50VHlwZSwgbGlzdGVuZXIuaGFuZGxlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckdhbWVib2FyZCxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFJlbmRlcmVyO1xuIiwiaW1wb3J0IHsgQXBwSGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSBcIi4vcmVuZGVyXCI7XG5pbXBvcnQgeyBTaGlwRmFjdG9yeSwgR2FtZWJvYXJkRmFjdG9yeSB9IGZyb20gXCIuL2ZhY3Rvcmllc1wiO1xuXG4vLyBUaGlzIG1vZHVsZSBjYW4gaGFuZGxlIHRoZSBnYW1lIGxvb3AgYW5kIGNvb3JkaW5hdGUgdGhlIG92ZXJhbGwgZmxvdyBvZlxuLy8gdGhlIGdhbWUuIEl0IGNhbiBjcmVhdGUgaW5zdGFuY2VzIG9mIHBsYXllcnMgYW5kIGdhbWVib2FyZHMsIG1hbmFnZSB0dXJucyxcbi8vIGFuZCBkZXRlcm1pbmUgd2hlbiB0aGUgZ2FtZSBlbmRzLiBJdCBzaG91bGQgcHJpbWFyaWx5IGZvY3VzIG9uIHRoZSBnYW1lXG4vLyBsb2dpYyBhbmQgb3JjaGVzdHJhdGlvbiByYXRoZXIgdGhhbiBkaXJlY3RseSBpbnRlcmFjdGluZyB3aXRoIHRoZSBET00uXG5cbi8vIEV2ZW50IExpc3RlbmVyczogWW91IGNhbiBoYXZlIGV2ZW50IGxpc3RlbmVycyBpbiBhIHNlcGFyYXRlIG1vZHVsZSBvclxuLy8gZGlyZWN0bHkgd2l0aGluIGFwcC5qcywgZGVwZW5kaW5nIG9uIHlvdXIgcHJlZmVyZW5jZSBhbmQgdGhlIGNvbXBsZXhpdHlcbi8vIG9mIHRoZSBpbnRlcmFjdGlvbnMuIElmIHlvdSBoYXZlIGEgbGFyZ2UgbnVtYmVyIG9mIGV2ZW50IGxpc3RlbmVycyBvclxuLy8gY29tcGxleCBldmVudCBoYW5kbGluZywgaXQgbWlnaHQgYmUgYmVuZWZpY2lhbCB0byBzZXBhcmF0ZSB0aGVtIGludG8gYVxuLy8gZGVkaWNhdGVkIG1vZHVsZSB0byBrZWVwIHRoZSBjb2RlIG9yZ2FuaXplZC4gVGhlIGV2ZW50IGxpc3RlbmVycyBzaG91bGRcbi8vIGNhbGwgYXBwcm9wcmlhdGUgZnVuY3Rpb25zIGluIGFwcC5qcyBvciByZW5kZXIuanMgdG8gdHJpZ2dlciB0aGVcbi8vIGNvcnJlc3BvbmRpbmcgYWN0aW9ucyBhbmQgVUkgdXBkYXRlcy5cblxuLy8gMS4gLS0tXG4vLyAyLiAtLS1cbi8vIDMuIC0tLVxuLy8gNC4gLS0tXG4vLyA1LiBJbXBsZW1lbnQgZHJhZyBhbmQgZHJvcCBmb3IgZWFjaCBzaGlwIHR5cGVcbi8vIDYuIEltcGxlbWVudCByb3RhdGUgYnV0dG9uXG4vLyA3LiBIaWRlIGluaXRpYWwgbW9kYWwgd2hlbiBhbGwgc2hpcHMgYXJlIHBsYWNlZFxuXG5jb25zdCBDb250cm9sbGVyID0gKCgpID0+IHtcbiAgLy8gY29uc3Qgc2hpcEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gIC8vICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gIC8vICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgLy8gICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gIC8vICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAvLyAgICAgY29uc3Qgc2hpcExlbmd0aCA9IFNoaXBGYWN0b3J5KHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XSkubGVuZ3RoO1xuXG4gIC8vICAgICBjb25zdCBob3ZlcmVkU3F1YXJlcyA9IFtdO1xuICAvLyAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgLy8gICAgICAgY29uc3Qgcm93ID0gc3RhcnRSb3c7XG4gIC8vICAgICAgIGNvbnN0IGNvbCA9IHN0YXJ0Q29sICsgaTtcbiAgLy8gICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIC8vICAgICAgICAgYFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgLy8gICAgICAgKTtcbiAgLy8gICAgICAgaG92ZXJlZFNxdWFyZXMucHVzaChob3ZlcmVkU3F1YXJlKTtcbiAgLy8gICAgIH1cblxuICAvLyAgICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAvLyAgICAgICBob3ZlcmVkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJob3ZlcmVkXCIpO1xuICAvLyAgICAgfSk7XG4gIC8vICAgfVxuICAvLyB9O1xuXG4gIGNvbnN0IHBsYXllckdhbWVib2FyZCA9IEdhbWVib2FyZEZhY3RvcnkoKTtcblxuICBjb25zdCBzaGlwVHlwZXMgPSBbXG4gICAgeyB0eXBlOiBcImNhcnJpZXJcIiwgbGVuZ3RoOiA1IH0sXG4gICAgeyB0eXBlOiBcImJhdHRsZXNoaXBcIiwgbGVuZ3RoOiA0IH0sXG4gICAgeyB0eXBlOiBcImRlc3Ryb3llclwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwic3VibWFyaW5lXCIsIGxlbmd0aDogMyB9LFxuICAgIHsgdHlwZTogXCJwYXRyb2wgYm9hdFwiLCBsZW5ndGg6IDIgfSxcbiAgXTtcblxuICBsZXQgY3VycmVudFNoaXBJbmRleCA9IDA7XG4gIGxldCBzaGlwUGxhY2VtZW50TW9kZSA9IHRydWU7XG5cbiAgY29uc3Qgc2hpcFBsYWNlbWVudEhhbmRsZXIgPSAoZSkgPT4ge1xuICAgIGlmIChzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCBzdGFydFJvdyA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LnJvdywgMTApO1xuICAgICAgY29uc3Qgc3RhcnRDb2wgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5jb2wsIDEwKTtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBzaGlwVHlwZXNbY3VycmVudFNoaXBJbmRleF07XG5cbiAgICAgIGNvbnN0IHNoaXBDb29yZGluYXRlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGkpID0+IHtcbiAgICAgICAgY29uc3Qgcm93ID0gc3RhcnRSb3c7XG4gICAgICAgIGNvbnN0IGNvbCA9IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIFtyb3csIGNvbF07XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2hpcCA9IFNoaXBGYWN0b3J5KGxlbmd0aCk7XG4gICAgICBjb25zdCBwbGFjZWQgPSBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHNoaXBDb29yZGluYXRlcyk7IC8vIFVzZSB0aGUgZ2FtZWJvYXJkIG9iamVjdFxuXG4gICAgICBpZiAocGxhY2VkKSB7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICBzaGlwQ29vcmRpbmF0ZXMuZm9yRWFjaCgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHBsYWNlZFNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgcGxhY2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGN1cnJlbnRTaGlwSW5kZXggKz0gMTtcblxuICAgICAgICBpZiAoY3VycmVudFNoaXBJbmRleCA9PT0gc2hpcFR5cGVzLmxlbmd0aCkge1xuICAgICAgICAgIC8vIEFsbCBzaGlwcyBoYXZlIGJlZW4gcGxhY2VkXG4gICAgICAgICAgc2hpcFBsYWNlbWVudE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoXG4gICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuaW5pdGlhbFwiKSxcbiAgICAgICAgICAgICAgXCJoaWRlXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBsYWNlZCBzaGlwczpcIik7XG4gICAgICAgICAgICBjb25zdCBzaGlwcyA9IHBsYXllckdhbWVib2FyZC5nZXRTaGlwcygpO1xuICAgICAgICAgICAgc2hpcHMuZm9yRWFjaCgoYWRkZWRTaGlwLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU2hpcCAke2luZGV4ICsgMX0gLSBMZW5ndGg6ICR7YWRkZWRTaGlwLmxlbmd0aH1gKTtcbiAgICAgICAgICAgICAgY29uc3Qgc2hpcHNDb29yZGluYXRlcyA9XG4gICAgICAgICAgICAgICAgcGxheWVyR2FtZWJvYXJkLmdldFNoaXBDb29yZGluYXRlcyhhZGRlZFNoaXApO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvb3JkaW5hdGVzOlwiLCBzaGlwc0Nvb3JkaW5hdGVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgIC8vIFN0YXJ0IHRoZSBnYW1lIGhlcmVcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBuZXh0U2hpcFR5cGUgPSBzaGlwVHlwZXNbY3VycmVudFNoaXBJbmRleF0udHlwZTtcbiAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNoaXAtdHlwZVwiKS50ZXh0Q29udGVudCA9IG5leHRTaGlwVHlwZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgPSAoZSkgPT4ge1xuICAgIGlmIChzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCBzdGFydFJvdyA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LnJvdywgMTApO1xuICAgICAgY29uc3Qgc3RhcnRDb2wgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5jb2wsIDEwKTtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBzaGlwVHlwZXNbY3VycmVudFNoaXBJbmRleF07XG5cbiAgICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBjb25zdCByb3cgPSBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYCk7XG4gICAgICB9KTtcblxuICAgICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgICBob3ZlcmVkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJob3ZlcmVkXCIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lYm9hcmQgLmhvdmVyZWRcIik7XG4gICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgaG92ZXJlZFNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBldmVudExpc3RlbmVycyA9IFtcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZW92ZXJcIiwgaGFuZGxlcjogZ2FtZWJvYXJkSG92ZXJIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwibW91c2VsZWF2ZVwiLCBoYW5kbGVyOiBnYW1lYm9hcmRNb3VzZUxlYXZlSGFuZGxlciB9LFxuICAgIHsgZXZlbnRUeXBlOiBcImNsaWNrXCIsIGhhbmRsZXI6IHNoaXBQbGFjZW1lbnRIYW5kbGVyIH0sXG4gIF07XG5cbiAgY29uc3QgaW5pdCA9ICgpID0+IHtcbiAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSwgXCJoaWRlXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuaW5pdGlhbFwiLCBldmVudExpc3RlbmVycyk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0LFxuICB9O1xufSkoKTtcblxuQ29udHJvbGxlci5pbml0KCk7XG4iLCJpbXBvcnQgeyBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5cbmV4cG9ydCBjb25zdCBTaGlwRmFjdG9yeSA9IChsZW5ndGgpID0+IHtcbiAgbGV0IGhpdHMgPSAwO1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzICs9IDE7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4gaGl0cyA+PSBsZW5ndGg7IC8vIFJldHVybiB0cnVlIGlmIGhpdHMgaXMgZXF1YWwgdG8gb3IgZ3JlYXRlciB0aGFuIGxlbmd0aFxuXG4gIHJldHVybiB7XG4gICAgbGVuZ3RoLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gICAgZ2V0IGhpdHMoKSB7XG4gICAgICAvLyBHZXR0ZXIgZnVuY3Rpb24gZm9yIGhpdHMuIFVzaW5nIGZ1bmN0aW9uIGRlY2xhcmF0aW9uIHRvIGVuc3VyZSBpdCBoYXMgYWNjZXNzIHRvIHRoZVxuICAgICAgLy8gYGhpdHNgIHZhcmlhYmxlIGR5bmFtaWNhbGx5LCBzaW5jZSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgYXJlIGhvaXN0ZWQgYW5kIGNhbiBiZSB1c2VkXG4gICAgICAvLyBiZWZvcmUgdGhleSBhcmUgZGVmaW5lZC4gVGhpcyBhbGxvd3MgYWNjZXNzaW5nIHRoZSBjdXJyZW50IHZhbHVlIG9mIGBoaXRzYCBldmVuIGJlZm9yZVxuICAgICAgLy8gY2FsbGluZyB0aGUgYGhpdGAgZnVuY3Rpb25cbiAgICAgIHJldHVybiBoaXRzO1xuICAgIH0sXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgR2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgY29uc3QgZ3JpZFNpemUgPSAxMDtcbiAgY29uc3QgZ3JpZCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IGdyaWRTaXplIH0sICgpID0+XG4gICAgQXJyYXkoZ3JpZFNpemUpLmZpbGwobnVsbClcbiAgKTtcblxuICBjb25zdCBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gIGNvbnN0IG1pc3NlZEF0dGFja3MgPSBbXTtcblxuICBjb25zdCBnZXRHcmlkID0gKCkgPT4gZ3JpZDtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcCwgY29vcmRpbmF0ZXMpID0+IHtcbiAgICAvLyBDaGVjayBpZiBhbGwgY29vcmRpbmF0ZXMgYXJlIHdpdGhpbiB0aGUgYm91bmRhcmllcyBvZiB0aGUgZ3JpZFxuICAgIGNvbnN0IHdpdGhpbkJvdW5kYXJpZXMgPSBjb29yZGluYXRlcy5ldmVyeShcbiAgICAgIChbcm93LCBjb2xdKSA9PiByb3cgPj0gMCAmJiByb3cgPCBncmlkU2l6ZSAmJiBjb2wgPj0gMCAmJiBjb2wgPCBncmlkU2l6ZVxuICAgICk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGNvbmZsaWN0cyA9IGNvb3JkaW5hdGVzLnNvbWUoKFtyb3csIGNvbF0pID0+IGdyaWRbcm93XVtjb2xdICE9PSBudWxsKTtcblxuICAgIC8vIElmIHRoZSBzaGlwIHBsYWNlbWVudCBpcyB3aXRoaW4gYm91bmRhcmllcyBhbmQgaGFzIG5vIGNvbmZsaWN0cy4uLlxuICAgIGlmICh3aXRoaW5Cb3VuZGFyaWVzICYmICFjb25mbGljdHMpIHtcbiAgICAgIC8vIENyZWF0ZSBhbiBvYmplY3QgY29udGFpbmluZyBzaGlwIGluZm9ybWF0aW9uIGFuZCBjb29yZGluYXRlc1xuICAgICAgY29uc3Qgc2hpcEluZm8gPSB7XG4gICAgICAgIHNoaXAsXG4gICAgICAgIGNvb3JkaW5hdGVzLFxuICAgICAgfTtcblxuICAgICAgLy8gUGxhY2UgdGhlIHNoaXAgb24gdGhlIGdyaWQgYnkgdXBkYXRpbmcgdGhlIGNvcnJlc3BvbmRpbmcgY2VsbHNcbiAgICAgIHNoaXBJbmZvLmNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgZ3JpZFtyb3ddW2NvbF0gPSBzaGlwSW5mbztcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdHJ1ZTsgLy8gU2hpcCBwbGFjZW1lbnQgc3VjY2Vzc2Z1bFxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTsgLy8gT3RoZXJ3aXNlLCBzaGlwIHBsYWNlbWVudCBmYWlsZWRcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgY29udGFpbnMgYSBzaGlwIGFuZCBpdCdzIG5vdCBhbHJlYWR5IGluY2x1ZGVkIGluIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICBpZiAoXG4gICAgICAgICAgY2VsbCAhPT0gbnVsbCAmJlxuICAgICAgICAgIGNlbGwuc2hpcCAmJlxuICAgICAgICAgICFzaGlwcy5pbmNsdWRlcyhjZWxsLnNoaXApICYmXG4gICAgICAgICAgIWNlbGwuc2hpcC5pc1N1bmsoKVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBBZGQgdGhlIHNoaXAgdG8gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgICAgc2hpcHMucHVzaChjZWxsLnNoaXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNoaXBzO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBDb29yZGluYXRlcyA9IChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGV4aXN0cyBhbmQgY29udGFpbnMgdGhlIHNwZWNpZmllZCBzaGlwXG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwuc2hpcCA9PT0gc2hpcCkge1xuICAgICAgICAgIC8vIENvbnZlcnQgdGhlIHJvdyBhbmQgY29sdW1uIGluZGljZXMgdG8gYWxwaGFudW1lcmljIGNvb3JkaW5hdGVzIGFuZCBhZGQgdGhlbSB0b1xuICAgICAgICAgIC8vIHRoZSBjb29yZGluYXRlcyBhcnJheVxuICAgICAgICAgIGNvb3JkaW5hdGVzLnB1c2goRmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtyb3csIGNvbF0pKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb29yZGluYXRlcztcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBjb25zdCBbcm93LCBjb2xdID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvSW5kaWNlcyhjb29yZGluYXRlKTtcbiAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG5cbiAgICBjb25zdCBzaGlwID0gY2VsbCAmJiBjZWxsLnNoaXA7IC8vIEFjY2VzcyB0aGUgc2hpcCBwcm9wZXJ0eSBvZiB0aGUgY2VsbCBvYmplY3RcblxuICAgIGlmIChzaGlwKSB7XG4gICAgICBzaGlwLmhpdCgpOyAvLyBJbmNyZW1lbnQgaGl0IGNvdW50IG9mIHRoZSBzaGlwXG4gICAgfSBlbHNlIHtcbiAgICAgIG1pc3NlZEF0dGFja3MucHVzaChjb29yZGluYXRlKTsgLy8gUmVjb3JkIG1pc3NlZCBhdHRhY2sgY29vcmRpbmF0ZXNcbiAgICB9XG5cbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLnB1c2goY29vcmRpbmF0ZSk7XG4gIH07XG5cbiAgY29uc3QgZ2V0TWlzc2VkQXR0YWNrcyA9ICgpID0+IG1pc3NlZEF0dGFja3M7XG5cbiAgY29uc3QgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyA9ICgpID0+IGF0dGFja2VkQ29vcmRpbmF0ZXM7XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gZ2V0U2hpcHMoKTsgLy8gUmV0cmlldmUgYWxsIHRoZSBzaGlwcyBvbiB0aGUgZ2FtZWJvYXJkXG5cbiAgICAvLyBDaGVjayBpZiBhbGwgc2hpcHMgYXJlIHN1bmssIHJldHVybiB0cnVlIGlmIHllcywgYW5kIHJldHVybiBmYWxzZSBpZiBub1xuICAgIHJldHVybiBzaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRHcmlkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRTaGlwcyxcbiAgICBnZXRTaGlwQ29vcmRpbmF0ZXMsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBnZXRNaXNzZWRBdHRhY2tzLFxuICAgIGdldEF0dGFja2VkQ29vcmRpbmF0ZXMsXG4gICAgYWxsU2hpcHNTdW5rLFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IFBsYXllckZhY3RvcnkgPSAobmFtZSkgPT4ge1xuICBjb25zdCBhdHRhY2tlZENvb3JkaW5hdGVzID0gbmV3IFNldCgpOyAvLyBTZXQgdG8ga2VlcCB0cmFjayBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuXG4gIGNvbnN0IGF0dGFjayA9IChlbmVteUdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IGdyaWRTaXplID0gZW5lbXlHYW1lYm9hcmQuZ2V0R3JpZCgpLmxlbmd0aDtcbiAgICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gRmFjdG9yeUhlbHBlcnMuZ2V0QWxsVmFsaWRDb29yZGluYXRlcyhncmlkU2l6ZSk7XG5cbiAgICBsZXQgY29vcmRpbmF0ZSA9IFwiXCI7XG5cbiAgICAvLyBQZXJmb3JtIGEgZG8td2hpbGUgbG9vcCB1bnRpbCBhIHVuaXF1ZSBjb29yZGluYXRlIGlzIGZvdW5kXG4gICAgZG8ge1xuICAgICAgLy8gR2VuZXJhdGUgYSByYW5kb20gaW5kZXggYmFzZWQgb24gdGhlIGxlbmd0aCBvZiB2YWxpZENvb3JkaW5hdGVzIGFycmF5XG4gICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkQ29vcmRpbmF0ZXMubGVuZ3RoKTtcblxuICAgICAgLy8gR2V0IHRoZSBjb29yZGluYXRlIGF0IHRoZSByYW5kb20gaW5kZXhcbiAgICAgIGNvb3JkaW5hdGUgPSB2YWxpZENvb3JkaW5hdGVzW3JhbmRvbUluZGV4XTtcbiAgICB9IHdoaWxlIChcbiAgICAgIC8vIENvbnRpbnVlIGxvb3Bpbmcgd2l0aG91dCBwZXJmb3JtaW5nIGFueSBhY3Rpb25zIGlmIHRoZSBjb29yZGluYXRlIGlzIGFscmVhZHlcbiAgICAgIC8vIGluIHRoZSBwbGF5ZXJzIGF0dGFja2VkQ29vcmRpbmF0ZXMgc2V0IG9yIGlzIGluY2x1ZGVkIGluIHRoZSBlbmVteUdhbWVib2FyZHNcbiAgICAgIC8vIGF0dGFja2VkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuaGFzKGNvb3JkaW5hdGUpIHx8XG4gICAgICBlbmVteUdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSlcbiAgICApO1xuXG4gICAgLy8gQWRkIHRoZSBhdHRhY2tlZCBjb29yZGluYXRlIHRvIHRoZSBwbGF5ZXJzIHNldCBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuYWRkKGNvb3JkaW5hdGUpO1xuXG4gICAgLy8gUGVyZm9ybSB0aGUgYXR0YWNrIG9uIHRoZSBlbmVteSBnYW1lYm9hcmRcbiAgICBlbmVteUdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICBhdHRhY2ssXG4gIH07XG59O1xuIiwiZXhwb3J0IGNvbnN0IEZhY3RvcnlIZWxwZXJzID0gKCgpID0+IHtcbiAgY29uc3QgdmFsaWRDb29yZGluYXRlcyA9IFtdO1xuXG4gIGNvbnN0IGNvbnZlcnRUb0luZGljZXMgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IGNvbHVtbiA9IGNvb3JkaW5hdGUuY2hhckNvZGVBdCgwKSAtIDY1OyAvLyBDb252ZXJ0IGNvbHVtbiBsZXR0ZXIgdG8gaW5kZXhcbiAgICBjb25zdCByb3cgPSBwYXJzZUludChjb29yZGluYXRlLnNsaWNlKDEpLCAxMCkgLSAxOyAvLyBDb252ZXJ0IHJvdyBudW1iZXIgdG8gaW5kZXggd2l0aCByYWRpeCAxMFxuICAgIHJldHVybiBbcm93LCBjb2x1bW5dO1xuICB9O1xuXG4gIGNvbnN0IGNvbnZlcnRUb0FscGhhbnVtZXJpYyA9IChbcm93LCBjb2x1bW5dKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY29sdW1uICsgNjUpOyAvLyBDb252ZXJ0IGNvbHVtbiBpbmRleCB0byBsZXR0ZXJcbiAgICByZXR1cm4gY29vcmRpbmF0ZSArIChyb3cgKyAxKTsgLy8gQ29udmVydCByb3cgaW5kZXggdG8gbnVtYmVyXG4gIH07XG5cbiAgY29uc3QgZ2V0QWxsVmFsaWRDb29yZGluYXRlcyA9IChncmlkU2l6ZSkgPT4ge1xuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGFscGhhbnVtZXJpY0Nvb3JkaW5hdGUgPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW1xuICAgICAgICAgIHJvdyxcbiAgICAgICAgICBjb2wsXG4gICAgICAgIF0pO1xuICAgICAgICB2YWxpZENvb3JkaW5hdGVzLnB1c2goYWxwaGFudW1lcmljQ29vcmRpbmF0ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkQ29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBjb252ZXJ0VG9JbmRpY2VzLFxuICAgIGNvbnZlcnRUb0FscGhhbnVtZXJpYyxcbiAgICBnZXRBbGxWYWxpZENvb3JkaW5hdGVzLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGNvbnN0IEFwcEhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB0b2dnbGVNb2RhbCA9IChtb2RhbCwgY2hvaWNlKSA9PiB7XG4gICAgY29uc3QgdG9nZ2xlZE1vZGFsID0gbW9kYWw7XG5cbiAgICBjb25zdCBvdmVybGF5ID0gbW9kYWwuY2xvc2VzdChcIi5vdmVybGF5XCIpO1xuICAgIGNvbnN0IGRpc3BsYXlWYWx1ZSA9IGNob2ljZSA9PT0gXCJzaG93XCIgPyBcImZsZXhcIiA6IFwibm9uZVwiO1xuXG4gICAgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVZhbHVlO1xuICAgIHRvZ2dsZWRNb2RhbC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVZhbHVlO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgdG9nZ2xlTW9kYWwsXG4gIH07XG59KSgpO1xuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCIvLyBzdGFydHVwXG4vLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18oMzgwKTtcbi8vIFRoaXMgZW50cnkgbW9kdWxlIGlzIHJlZmVyZW5jZWQgYnkgb3RoZXIgbW9kdWxlcyBzbyBpdCBjYW4ndCBiZSBpbmxpbmVkXG52YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNzc2KTtcbiJdLCJuYW1lcyI6WyJjb250YWluZXJFbGVtZW50IiwiZXZlbnRMaXN0ZW5lcnMiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsInJvdyIsImNvbCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkYXRhc2V0IiwiZm9yRWFjaCIsImxpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50VHlwZSIsImhhbmRsZXIiLCJhcHBlbmRDaGlsZCIsInBsYXllckdhbWVib2FyZCIsInNoaXBUeXBlcyIsInR5cGUiLCJsZW5ndGgiLCJjdXJyZW50U2hpcEluZGV4Iiwic2hpcFBsYWNlbWVudE1vZGUiLCJlIiwidGFyZ2V0Iiwic3RhcnRSb3ciLCJwYXJzZUludCIsInN0YXJ0Q29sIiwiQXJyYXkiLCJmcm9tIiwiXyIsImkiLCJob3ZlcmVkU3F1YXJlIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbW92ZSIsInNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJwbGFjZVNoaXAiLCJzZXRUaW1lb3V0IiwidG9nZ2xlTW9kYWwiLCJjb25zb2xlIiwibG9nIiwiZ2V0U2hpcHMiLCJhZGRlZFNoaXAiLCJpbmRleCIsInNoaXBzQ29vcmRpbmF0ZXMiLCJnZXRTaGlwQ29vcmRpbmF0ZXMiLCJuZXh0U2hpcFR5cGUiLCJpbml0IiwiU2hpcEZhY3RvcnkiLCJoaXRzIiwiaGl0IiwiaXNTdW5rIiwiR2FtZWJvYXJkRmFjdG9yeSIsImdyaWRTaXplIiwiZ3JpZCIsImZpbGwiLCJhdHRhY2tlZENvb3JkaW5hdGVzIiwibWlzc2VkQXR0YWNrcyIsInNoaXBzIiwiY2VsbCIsImluY2x1ZGVzIiwicHVzaCIsImdldEdyaWQiLCJjb29yZGluYXRlcyIsIndpdGhpbkJvdW5kYXJpZXMiLCJldmVyeSIsImNvbmZsaWN0cyIsInNvbWUiLCJzaGlwSW5mbyIsImNvbnZlcnRUb0FscGhhbnVtZXJpYyIsInJlY2VpdmVBdHRhY2siLCJjb29yZGluYXRlIiwiY29udmVydFRvSW5kaWNlcyIsImdldE1pc3NlZEF0dGFja3MiLCJnZXRBdHRhY2tlZENvb3JkaW5hdGVzIiwiYWxsU2hpcHNTdW5rIiwiRmFjdG9yeUhlbHBlcnMiLCJ2YWxpZENvb3JkaW5hdGVzIiwiY29sdW1uIiwiY2hhckNvZGVBdCIsInNsaWNlIiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwiZ2V0QWxsVmFsaWRDb29yZGluYXRlcyIsImFscGhhbnVtZXJpY0Nvb3JkaW5hdGUiLCJBcHBIZWxwZXJzIiwibW9kYWwiLCJjaG9pY2UiLCJ0b2dnbGVkTW9kYWwiLCJkaXNwbGF5VmFsdWUiLCJjbG9zZXN0Iiwic3R5bGUiLCJkaXNwbGF5IiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkIiwiZGVmaW5pdGlvbiIsImtleSIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImVudW1lcmFibGUiLCJnZXQiLCJvYmoiLCJwcm9wIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIl0sInNvdXJjZVJvb3QiOiIifQ==