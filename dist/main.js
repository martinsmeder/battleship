(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let r=0;r<10;r+=1){const o=document.createElement("div");o.classList.add("square"),o.dataset.row=e,o.dataset.col=r,t.appendChild(o)}},n=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))};var l=r(776);(()=>{const e=(0,l.Br)(),t=(0,l.Br)(),r=((0,l.oP)("computer"),[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}]);let s=0,c=!0,i=!1;const d=e=>{if(!c){const r=e.target,a=parseInt(r.dataset.row,10),n=parseInt(r.dataset.col,10),l=o.r.convertToAlphanumeric([a,n]);if(!t.getAttackedCoordinates().includes(l)){const e=t.receiveAttack(l);e?(r.classList.add("hit"),console.log("Player hit a ship!"),e.isSunk()&&console.log(`Player sank the ${e.length}-unit ship!`)):(r.classList.add("miss"),console.log("Player missed!")),t.allShipsSunk()&&console.log("Player wins!")}}},u=()=>{i=!i},h=[{eventType:"mouseover",handler:e=>{if(c){const t=e.target,o=parseInt(t.dataset.row,10),a=parseInt(t.dataset.col,10),{length:n}=r[s];Array.from({length:n},((e,t)=>{const r=i?o+t:o,n=i?a:a+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-row="${r}"][data-col="${n}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:a=>{if(c){const n=a.target,d=parseInt(n.dataset.row,10),u=parseInt(n.dataset.col,10),{length:h}=r[s],p=Array.from({length:h},((e,t)=>[i?d+t:d,i?u:u+t])),m=(0,l._V)(h);if(e.placeShip(m,p))if(n.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),s+=1,s===r.length)c=!1,(()=>{const e=r.map((e=>{const{length:r}=e;let o=[],a=!1;for(;!a;){const e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());i=Math.random()<.5,o=[],i?e+r-1<10&&(o=Array.from({length:r},((t,r)=>[e+r,n]))):n+r-1<10&&(o=Array.from({length:r},((t,r)=>[e,n+r]))),o.length>0&&(a=t.placeShip((0,l._V)(r),o))}return o.forEach((([e,t])=>{document.querySelector(`.gameboard.computer [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),{type:e.type,coordinates:o}}));console.log("Computer ships:",e)})(),setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=r[s].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),n(".gameboard.initial",h),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",d)})),document.querySelector("#rotateBtn").addEventListener("click",u)}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>n,_V:()=>a,oP:()=>l});var o=r(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},n=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null))),r=[],a=[],n=()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const a=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),n=o.some((([e,r])=>null!==t[e][r])),l=o.some((([r,o])=>[[r-1,o],[r+1,o],[r,o-1],[r,o+1],[r-1,o-1],[r-1,o+1],[r+1,o-1],[r+1,o+1]].some((([r,o])=>r>=0&&r<e&&o>=0&&o<e&&null!==t[r]?.[o]))));if(a&&!n&&!l){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:n,getShipCoordinates:r=>{const a=[];for(let n=0;n<e;n+=1)for(let l=0;l<e;l+=1){const e=t[n][l];e&&e.ship===r&&a.push(o.r.convertToAlphanumeric([n,l]))}return a},receiveAttack:e=>{const[n,l]=o.r.convertToIndices(e),s=t[n][l];if(null!==s){const{ship:t}=s;return t.hit(),r.push(e),t}return console.log("miss"),a.push(e),r.push(e),null},getMissedAttacks:()=>a,getAttackedCoordinates:()=>r,allShipsSunk:()=>{const e=n().every((e=>e.isSunk()));return console.log("All ships sunk:",e),e}}},l=e=>{const t=new Set;return{name:e,attack:e=>{const r=e.getGrid().length,a=o.r.getAllValidCoordinates(r);let n="";do{n=a[Math.floor(Math.random()*a.length)]}while(t.has(n)||e.getAttackedCoordinates().includes(n));t.add(n),e.receiveAttack(n)}}}},555:(e,t,r)=>{r.d(t,{U:()=>a,r:()=>o});const o=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let r=0;r<t;r+=1)for(let a=0;a<t;a+=1){const t=o.convertToAlphanumeric([r,a]);e.push(t)}return e}}})(),a={toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWFFLFFBR3JCLElBQUlDLEVBQVNOLEVBQXlCRSxHQUFZLENBR2pERyxRQUFTLENBQUMsR0FPWCxPQUhBRSxFQUFvQkwsR0FBVUksRUFBUUEsRUFBT0QsUUFBU0osR0FHL0NLLEVBQU9ELE9BQ2YsQ0NyQkFKLEVBQW9CTyxFQUFJLENBQUNILEVBQVNJLEtBQ2pDLElBQUksSUFBSUMsS0FBT0QsRUFDWFIsRUFBb0JVLEVBQUVGLEVBQVlDLEtBQVNULEVBQW9CVSxFQUFFTixFQUFTSyxJQUM1RUUsT0FBT0MsZUFBZVIsRUFBU0ssRUFBSyxDQUFFSSxZQUFZLEVBQU1DLElBQUtOLEVBQVdDLElBRTFFLEVDTkRULEVBQW9CVSxFQUFJLENBQUNLLEVBQUtDLElBQVVMLE9BQU9NLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDRWxGaEIsRUFBb0IsS0FFTUEsRUFBb0IsSSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcmVuZGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYXBwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhpcyBtb2R1bGUgY2FuIGJlIHJlc3BvbnNpYmxlIGZvciByZW5kZXJpbmcgY29udGVudCBvbiB0aGUgcGFnZS5cbi8vIEl0IGNhbiBpbmNsdWRlIGZ1bmN0aW9ucyB0byB1cGRhdGUgdGhlIERPTSBlbGVtZW50cyByZXByZXNlbnRpbmcgdGhlXG4vLyBnYW1lIGJvYXJkcywgc2hpcHMsIGF0dGFja3MsIG1lc3NhZ2VzLCBhbmQgb3RoZXIgVUkgY29tcG9uZW50cy4gSXQgc2hvdWxkXG4vLyBlbmNhcHN1bGF0ZSB0aGUgRE9NIG1hbmlwdWxhdGlvbiBjb2RlIGFuZCBwcm92aWRlIGEgY2xlYW4gaW50ZXJmYWNlIGZvclxuLy8gdXBkYXRpbmcgdGhlIFVJIGJhc2VkIG9uIHRoZSBnYW1lIHN0YXRlLiBJdCBjYW4gYmUgdGhlIGJyaWRnZSBiZXR3ZWVuIHRoZVxuLy8gZ2FtZSBsb2dpYyBhbmQgdGhlIGFjdHVhbCBET00gbWFuaXB1bGF0aW9uLlxuXG5jb25zdCBSZW5kZXJlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHJlbmRlckdhbWVib2FyZCA9IChjb250YWluZXJFbGVtZW50KSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcblxuICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9IFwiXCI7XG5cbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IDEwOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInNxdWFyZVwiKTtcbiAgICAgICAgc3F1YXJlLmRhdGFzZXQucm93ID0gcm93O1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5jb2wgPSBjb2w7XG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGF0dGFjaEV2ZW50TGlzdGVuZXJzID0gKGNvbnRhaW5lckVsZW1lbnQsIGV2ZW50TGlzdGVuZXJzKSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcblxuICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiLnNxdWFyZVwiKS5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XG4gICAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKGxpc3RlbmVyLmV2ZW50VHlwZSwgbGlzdGVuZXIuaGFuZGxlcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckdhbWVib2FyZCxcbiAgICBhdHRhY2hFdmVudExpc3RlbmVycyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFJlbmRlcmVyO1xuIiwiLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG5pbXBvcnQgeyBBcHBIZWxwZXJzLCBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSBcIi4vcmVuZGVyXCI7XG5pbXBvcnQgeyBTaGlwRmFjdG9yeSwgR2FtZWJvYXJkRmFjdG9yeSwgUGxheWVyRmFjdG9yeSB9IGZyb20gXCIuL2ZhY3Rvcmllc1wiO1xuXG4vLyAxLiAtLS1cbi8vIDIuIC0tLVxuLy8gMy4gLS0tXG4vLyA0LiAtLS1cbi8vIDUuIGhhbmRsZSBjb21wdXRlciBhdHRhY2tzXG4vLyA2LiBkaXNwbGF5IGNvbXB1dGVyIGF0dGFja3Ncbi8vIDcuIGhhbmRsZSB3aW5uZXJcbi8vIDguIGRpc3BsYXkgd2lubmVyXG5cbmNvbnN0IENvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmRGYWN0b3J5KCk7XG4gIGNvbnN0IGNvbXB1dGVyR2FtZWJvYXJkID0gR2FtZWJvYXJkRmFjdG9yeSgpO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICBjb25zdCBjb21wdXRlciA9IFBsYXllckZhY3RvcnkoXCJjb21wdXRlclwiKTtcblxuICBjb25zdCBzaGlwVHlwZXMgPSBbXG4gICAgeyB0eXBlOiBcImNhcnJpZXJcIiwgbGVuZ3RoOiA1IH0sXG4gICAgeyB0eXBlOiBcImJhdHRsZXNoaXBcIiwgbGVuZ3RoOiA0IH0sXG4gICAgeyB0eXBlOiBcImRlc3Ryb3llclwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwic3VibWFyaW5lXCIsIGxlbmd0aDogMyB9LFxuICAgIHsgdHlwZTogXCJwYXRyb2wgYm9hdFwiLCBsZW5ndGg6IDIgfSxcbiAgXTtcblxuICBsZXQgY3VycmVudFNoaXBJbmRleCA9IDA7XG4gIGxldCBzaGlwUGxhY2VtZW50TW9kZSA9IHRydWU7XG4gIGxldCBpc1ZlcnRpY2FsID0gZmFsc2U7XG5cbiAgY29uc3QgcGxhY2VDb21wdXRlclNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvbXB1dGVyU2hpcHMgPSBzaGlwVHlwZXMubWFwKChzaGlwVHlwZSkgPT4ge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlO1xuICAgICAgbGV0IGNvb3JkaW5hdGVzID0gW107XG4gICAgICBsZXQgcGxhY2VkID0gZmFsc2U7XG5cbiAgICAgIHdoaWxlICghcGxhY2VkKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0Um93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICBjb25zdCBzdGFydENvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgaXNWZXJ0aWNhbCA9IE1hdGgucmFuZG9tKCkgPCAwLjU7XG4gICAgICAgIGNvb3JkaW5hdGVzID0gW107XG5cbiAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBlbm91Z2ggc3BhY2UgdmVydGljYWxseVxuICAgICAgICAgIGlmIChzdGFydFJvdyArIGxlbmd0aCAtIDEgPCAxMCkge1xuICAgICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiBbXG4gICAgICAgICAgICAgIHN0YXJ0Um93ICsgaSxcbiAgICAgICAgICAgICAgc3RhcnRDb2wsXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgZW5vdWdoIHNwYWNlIGhvcml6b250YWxseVxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1sb25lbHktaWZcbiAgICAgICAgICBpZiAoc3RhcnRDb2wgKyBsZW5ndGggLSAxIDwgMTApIHtcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4gW1xuICAgICAgICAgICAgICBzdGFydFJvdyxcbiAgICAgICAgICAgICAgc3RhcnRDb2wgKyBpLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwbGFjZWQgPSBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoXG4gICAgICAgICAgICBTaGlwRmFjdG9yeShsZW5ndGgpLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIHBsYWNlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7IHR5cGU6IHNoaXBUeXBlLnR5cGUsIGNvb3JkaW5hdGVzIH07XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIHNoaXBzOlwiLCBjb21wdXRlclNoaXBzKTtcbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50SGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIGNvbnN0IGNvbCA9IGlzVmVydGljYWwgPyBzdGFydENvbCA6IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIFtyb3csIGNvbF07XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2hpcCA9IFNoaXBGYWN0b3J5KGxlbmd0aCk7XG4gICAgICBjb25zdCBwbGFjZWQgPSBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHNoaXBDb29yZGluYXRlcyk7XG5cbiAgICAgIGlmIChwbGFjZWQpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjdXJyZW50U2hpcEluZGV4ICs9IDE7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRTaGlwSW5kZXggPT09IHNoaXBUeXBlcy5sZW5ndGgpIHtcbiAgICAgICAgICBzaGlwUGxhY2VtZW50TW9kZSA9IGZhbHNlO1xuICAgICAgICAgIHBsYWNlQ29tcHV0ZXJTaGlwcygpO1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLFxuICAgICAgICAgICAgICBcImhpZGVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XS50eXBlO1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gbmV4dFNoaXBUeXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluaXRpYWxTcXVhcmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLmdhbWVib2FyZC5pbml0aWFsIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgICApLFxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGhvdmVyZWRTcXVhcmVzLmZvckVhY2goKHsgaW5pdGlhbFNxdWFyZSB9KSA9PiB7XG4gICAgICAgIGlmIChpbml0aWFsU3F1YXJlKSB7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lYm9hcmQgLmhvdmVyZWRcIik7XG4gICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgaG92ZXJlZFNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBjb25zdCBjb21wdXRlckF0dGFjayA9ICgpID0+IHtcbiAgLy8gICBpZiAoIXNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gIC8vICAgICBjb21wdXRlci5hdHRhY2socGxheWVyR2FtZWJvYXJkKTtcblxuICAvLyAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gcGxheWVyR2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG4gIC8vICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAvLyAgICAgICBgLmdhbWVib2FyZC5wbGF5ZXIgW2RhdGEtcm93PVwiJHtjb29yZGluYXRlWzBdfVwiXVtkYXRhLWNvbD1cIiR7Y29vcmRpbmF0ZVsxXX1cIl1gXG4gIC8vICAgICApO1xuICAvLyAgICAgaWYgKGF0dGFja2VkU2hpcCkge1xuICAvLyAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgLy8gICAgICAgY29uc29sZS5sb2coXCJDb21wdXRlciBoaXQgYSBzaGlwIVwiKTtcblxuICAvLyAgICAgICBpZiAoYXR0YWNrZWRTaGlwLmlzU3VuaygpKSB7XG4gIC8vICAgICAgICAgY29uc29sZS5sb2coYENvbXB1dGVyIHNhbmsgdGhlICR7YXR0YWNrZWRTaGlwLmxlbmd0aH0tdW5pdCBzaGlwIWApO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9IGVsc2Uge1xuICAvLyAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gIC8vICAgICAgIGNvbnNvbGUubG9nKFwiQ29tcHV0ZXIgbWlzc2VkIVwiKTtcbiAgLy8gICAgIH1cblxuICAvLyAgICAgaWYgKHBsYXllckdhbWVib2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuICAvLyAgICAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIHdpbnMhXCIpO1xuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gfTtcblxuICBjb25zdCBjb21wdXRlckdhbWVib2FyZENsaWNrSGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKCFzaGlwUGxhY2VtZW50TW9kZSkge1xuICAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7XG4gICAgICBjb25zdCByb3cgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5yb3csIDEwKTtcbiAgICAgIGNvbnN0IGNvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKTtcblxuICAgICAgaWYgKCFjb21wdXRlckdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSkpIHtcbiAgICAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gY29tcHV0ZXJHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcblxuICAgICAgICBpZiAoYXR0YWNrZWRTaGlwKSB7XG4gICAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJQbGF5ZXIgaGl0IGEgc2hpcCFcIik7XG5cbiAgICAgICAgICBpZiAoYXR0YWNrZWRTaGlwLmlzU3VuaygpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgUGxheWVyIHNhbmsgdGhlICR7YXR0YWNrZWRTaGlwLmxlbmd0aH0tdW5pdCBzaGlwIWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJQbGF5ZXIgbWlzc2VkIVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21wdXRlckdhbWVib2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiUGxheWVyIHdpbnMhXCIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJvdGF0ZVNoaXBzID0gKCkgPT4ge1xuICAgIGlzVmVydGljYWwgPSAhaXNWZXJ0aWNhbDtcbiAgfTtcblxuICBjb25zdCBldmVudExpc3RlbmVycyA9IFtcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZW92ZXJcIiwgaGFuZGxlcjogZ2FtZWJvYXJkSG92ZXJIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwibW91c2VsZWF2ZVwiLCBoYW5kbGVyOiBnYW1lYm9hcmRNb3VzZUxlYXZlSGFuZGxlciB9LFxuICAgIHsgZXZlbnRUeXBlOiBcImNsaWNrXCIsIGhhbmRsZXI6IHNoaXBQbGFjZW1lbnRIYW5kbGVyIH0sXG4gIF07XG5cbiAgY29uc3QgaW5pdCA9ICgpID0+IHtcbiAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSwgXCJoaWRlXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuaW5pdGlhbFwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLnBsYXllclwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmNvbXB1dGVyXCIpO1xuICAgIFJlbmRlcmVyLmF0dGFjaEV2ZW50TGlzdGVuZXJzKFwiLmdhbWVib2FyZC5pbml0aWFsXCIsIGV2ZW50TGlzdGVuZXJzKTtcblxuICAgIGNvbnN0IGNvbXB1dGVyU3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBcIi5nYW1lYm9hcmQuY29tcHV0ZXIgLnNxdWFyZVwiXG4gICAgKTtcbiAgICBjb21wdXRlclNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNvbXB1dGVyR2FtZWJvYXJkQ2xpY2tIYW5kbGVyKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHJvdGF0ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcm90YXRlQnRuXCIpO1xuICAgIHJvdGF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcm90YXRlU2hpcHMpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgaW5pdCxcbiAgfTtcbn0pKCk7XG5cbkNvbnRyb2xsZXIuaW5pdCgpO1xuXG4vLyAvLyBQZXJmb3JtIHRoZSBjb21wdXRlcidzIHR1cm5cbi8vIGNvbXB1dGVyLmF0dGFjayhwbGF5ZXJHYW1lYm9hcmQpO1xuXG4vLyBjb25zdCBtaXNzZWRBdHRhY2tzID0gY29tcHV0ZXJHYW1lYm9hcmQuZ2V0TWlzc2VkQXR0YWNrcygpO1xuLy8gbWlzc2VkQXR0YWNrcy5mb3JFYWNoKChtaXNzZWRBdHRhY2spID0+IHtcbi8vICAgY29uc3QgbWlzc2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihcbi8vICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1jb29yZGluYXRlPVwiJHttaXNzZWRBdHRhY2t9XCJdYFxuLy8gICApO1xuLy8gICBtaXNzZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4vLyB9KTtcblxuLy8gY29uc3QgY29tcHV0ZXJBdHRhY2tlZENvb3JkaW5hdGVzID1cbi8vICAgY29tcHV0ZXJHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpO1xuLy8gY29uc3QgbGFzdENvb3JkaW5hdGUgPVxuLy8gICBjb21wdXRlckF0dGFja2VkQ29vcmRpbmF0ZXNbY29tcHV0ZXJBdHRhY2tlZENvb3JkaW5hdGVzLmxlbmd0aCAtIDFdO1xuLy8gY29uc3QgYXR0YWNrZWRTaGlwT25Db21wdXRlciA9IHBsYXllckdhbWVib2FyZFxuLy8gICAuZ2V0U2hpcHMoKVxuLy8gICAuZmluZCgoc2hpcCkgPT5cbi8vICAgICBjb21wdXRlckdhbWVib2FyZC5nZXRTaGlwQ29vcmRpbmF0ZXMoc2hpcCkuaW5jbHVkZXMobGFzdENvb3JkaW5hdGUpXG4vLyAgICk7XG5cbi8vIGlmIChhdHRhY2tlZFNoaXBPbkNvbXB1dGVyKSB7XG4vLyAgIGNvbnN0IHNoaXBDb29yZGluYXRlcyA9IGNvbXB1dGVyR2FtZWJvYXJkLmdldFNoaXBDb29yZGluYXRlcyhcbi8vICAgICBhdHRhY2tlZFNoaXBPbkNvbXB1dGVyXG4vLyAgICk7XG4vLyAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChjb29yZCkgPT4ge1xuLy8gICAgIGNvbnN0IGF0dGFja2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihcbi8vICAgICAgIGAuZ2FtZWJvYXJkLmNvbXB1dGVyIFtkYXRhLWNvb3JkaW5hdGU9XCIke2Nvb3JkfVwiXWBcbi8vICAgICApO1xuLy8gICAgIGF0dGFja2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4vLyAgIH0pO1xuXG4vLyAgIGlmIChhdHRhY2tlZFNoaXBPbkNvbXB1dGVyLmlzU3VuaygpKSB7XG4vLyAgICAgaWYgKGNvbXB1dGVyR2FtZWJvYXJkLmFsbFNoaXBzU3VuaygpKSB7XG4vLyAgICAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIHdpbnMhXCIpO1xuLy8gICAgIH0gZWxzZSB7XG4vLyAgICAgICBjb25zb2xlLmxvZyhcbi8vICAgICAgICAgYENvbXB1dGVyIHNhbmsgdGhlICR7YXR0YWNrZWRTaGlwT25Db21wdXRlci5sZW5ndGh9LXVuaXQgc2hpcCFgXG4vLyAgICAgICApO1xuLy8gICAgIH1cbi8vICAgfSBlbHNlIHtcbi8vICAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIGhpdCBhIHNoaXAhXCIpO1xuLy8gICB9XG4vLyB9IGVsc2Uge1xuLy8gICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIG1pc3NlZCFcIik7XG4vLyB9XG4iLCJpbXBvcnQgeyBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5cbmV4cG9ydCBjb25zdCBTaGlwRmFjdG9yeSA9IChsZW5ndGgpID0+IHtcbiAgbGV0IGhpdHMgPSAwO1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzICs9IDE7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4gaGl0cyA+PSBsZW5ndGg7IC8vIFJldHVybiB0cnVlIGlmIGhpdHMgaXMgZXF1YWwgdG8gb3IgZ3JlYXRlciB0aGFuIGxlbmd0aFxuXG4gIHJldHVybiB7XG4gICAgbGVuZ3RoLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gICAgZ2V0IGhpdHMoKSB7XG4gICAgICAvLyBHZXR0ZXIgZnVuY3Rpb24gZm9yIGhpdHMuIFVzaW5nIGZ1bmN0aW9uIGRlY2xhcmF0aW9uIHRvIGVuc3VyZSBpdCBoYXMgYWNjZXNzIHRvIHRoZVxuICAgICAgLy8gYGhpdHNgIHZhcmlhYmxlIGR5bmFtaWNhbGx5LCBzaW5jZSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgYXJlIGhvaXN0ZWQgYW5kIGNhbiBiZSB1c2VkXG4gICAgICAvLyBiZWZvcmUgdGhleSBhcmUgZGVmaW5lZC4gVGhpcyBhbGxvd3MgYWNjZXNzaW5nIHRoZSBjdXJyZW50IHZhbHVlIG9mIGBoaXRzYCBldmVuIGJlZm9yZVxuICAgICAgLy8gY2FsbGluZyB0aGUgYGhpdGAgZnVuY3Rpb25cbiAgICAgIHJldHVybiBoaXRzO1xuICAgIH0sXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgR2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgY29uc3QgZ3JpZFNpemUgPSAxMDtcbiAgY29uc3QgZ3JpZCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IGdyaWRTaXplIH0sICgpID0+XG4gICAgQXJyYXkoZ3JpZFNpemUpLmZpbGwobnVsbClcbiAgKTtcblxuICBjb25zdCBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gIGNvbnN0IG1pc3NlZEF0dGFja3MgPSBbXTtcblxuICBjb25zdCBnZXRHcmlkID0gKCkgPT4gZ3JpZDtcblxuICBjb25zdCBwbGFjZVNoaXAgPSAoc2hpcCwgY29vcmRpbmF0ZXMpID0+IHtcbiAgICAvLyBDaGVjayBpZiBhbGwgY29vcmRpbmF0ZXMgYXJlIHdpdGhpbiB0aGUgYm91bmRhcmllcyBvZiB0aGUgZ3JpZFxuICAgIGNvbnN0IHdpdGhpbkJvdW5kYXJpZXMgPSBjb29yZGluYXRlcy5ldmVyeShcbiAgICAgIChbcm93LCBjb2xdKSA9PiByb3cgPj0gMCAmJiByb3cgPCBncmlkU2l6ZSAmJiBjb2wgPj0gMCAmJiBjb2wgPCBncmlkU2l6ZVxuICAgICk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGNvbmZsaWN0cyA9IGNvb3JkaW5hdGVzLnNvbWUoKFtyb3csIGNvbF0pID0+IGdyaWRbcm93XVtjb2xdICE9PSBudWxsKTtcblxuICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgYWRqYWNlbnQgY29uZmxpY3RzIHdpdGggZXhpc3Rpbmcgc2hpcCBwbGFjZW1lbnRzIG9uIHRoZSBncmlkXG4gICAgY29uc3QgYWRqYWNlbnRDb25mbGljdHMgPSBjb29yZGluYXRlcy5zb21lKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICBjb25zdCBhZGphY2VudENvb3JkaW5hdGVzID0gW1xuICAgICAgICBbcm93IC0gMSwgY29sXSwgLy8gVXBcbiAgICAgICAgW3JvdyArIDEsIGNvbF0sIC8vIERvd25cbiAgICAgICAgW3JvdywgY29sIC0gMV0sIC8vIExlZnRcbiAgICAgICAgW3JvdywgY29sICsgMV0sIC8vIFJpZ2h0XG4gICAgICAgIFtyb3cgLSAxLCBjb2wgLSAxXSwgLy8gRGlhZ29uYWwgVXAtTGVmdFxuICAgICAgICBbcm93IC0gMSwgY29sICsgMV0sIC8vIERpYWdvbmFsIFVwLVJpZ2h0XG4gICAgICAgIFtyb3cgKyAxLCBjb2wgLSAxXSwgLy8gRGlhZ29uYWwgRG93bi1MZWZ0XG4gICAgICAgIFtyb3cgKyAxLCBjb2wgKyAxXSwgLy8gRGlhZ29uYWwgRG93bi1SaWdodFxuICAgICAgXTtcblxuICAgICAgcmV0dXJuIGFkamFjZW50Q29vcmRpbmF0ZXMuc29tZShcbiAgICAgICAgKFthZGpSb3csIGFkakNvbF0pID0+XG4gICAgICAgICAgYWRqUm93ID49IDAgJiZcbiAgICAgICAgICBhZGpSb3cgPCBncmlkU2l6ZSAmJlxuICAgICAgICAgIGFkakNvbCA+PSAwICYmXG4gICAgICAgICAgYWRqQ29sIDwgZ3JpZFNpemUgJiZcbiAgICAgICAgICBncmlkW2FkalJvd10/LlthZGpDb2xdICE9PSBudWxsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgLy8gSWYgdGhlIHNoaXAgcGxhY2VtZW50IGlzIHdpdGhpbiBncmlkIGJvdW5kYXJpZXMsIGhhcyBubyBjb25mbGljdHMgYW5kIG5vIGFkamFjZW50XG4gICAgLy8gY29uZmxpY3RzLi4uXG4gICAgaWYgKHdpdGhpbkJvdW5kYXJpZXMgJiYgIWNvbmZsaWN0cyAmJiAhYWRqYWNlbnRDb25mbGljdHMpIHtcbiAgICAgIC8vIENyZWF0ZSBhbiBvYmplY3QgY29udGFpbmluZyBzaGlwIGluZm9ybWF0aW9uIGFuZCBjb29yZGluYXRlc1xuICAgICAgY29uc3Qgc2hpcEluZm8gPSB7XG4gICAgICAgIHNoaXAsXG4gICAgICAgIGNvb3JkaW5hdGVzLFxuICAgICAgfTtcblxuICAgICAgLy8gUGxhY2UgdGhlIHNoaXAgb24gdGhlIGdyaWQgYnkgdXBkYXRpbmcgdGhlIGNvcnJlc3BvbmRpbmcgY2VsbHNcbiAgICAgIHNoaXBJbmZvLmNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgZ3JpZFtyb3ddW2NvbF0gPSBzaGlwSW5mbztcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdHJ1ZTsgLy8gU2hpcCBwbGFjZW1lbnQgc3VjY2Vzc2Z1bFxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTsgLy8gT3RoZXJ3aXNlLCBzaGlwIHBsYWNlbWVudCBmYWlsZWRcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgY29udGFpbnMgYSBzaGlwIGFuZCBpdCdzIG5vdCBhbHJlYWR5IGluY2x1ZGVkIGluIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICBpZiAoXG4gICAgICAgICAgY2VsbCAhPT0gbnVsbCAmJlxuICAgICAgICAgIGNlbGwuc2hpcCAmJlxuICAgICAgICAgICFzaGlwcy5pbmNsdWRlcyhjZWxsLnNoaXApICYmXG4gICAgICAgICAgIWNlbGwuc2hpcC5pc1N1bmsoKVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBBZGQgdGhlIHNoaXAgdG8gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgICAgc2hpcHMucHVzaChjZWxsLnNoaXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNoaXBzO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBDb29yZGluYXRlcyA9IChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGV4aXN0cyBhbmQgY29udGFpbnMgdGhlIHNwZWNpZmllZCBzaGlwXG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwuc2hpcCA9PT0gc2hpcCkge1xuICAgICAgICAgIC8vIENvbnZlcnQgdGhlIHJvdyBhbmQgY29sdW1uIGluZGljZXMgdG8gYWxwaGFudW1lcmljIGNvb3JkaW5hdGVzIGFuZCBhZGQgdGhlbSB0b1xuICAgICAgICAgIC8vIHRoZSBjb29yZGluYXRlcyBhcnJheVxuICAgICAgICAgIGNvb3JkaW5hdGVzLnB1c2goRmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtyb3csIGNvbF0pKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb29yZGluYXRlcztcbiAgfTtcblxuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBjb25zdCBbcm93LCBjb2xdID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvSW5kaWNlcyhjb29yZGluYXRlKTtcbiAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG5cbiAgICBpZiAoY2VsbCAhPT0gbnVsbCkge1xuICAgICAgLy8gU2hpcCBhdCBjb29yZGluYXRlLCBpdCdzIGEgaGl0XG4gICAgICBjb25zdCB7IHNoaXAgfSA9IGNlbGw7XG4gICAgICBzaGlwLmhpdCgpOyAvLyBJbmNyZW1lbnQgaGl0IGNvdW50IG9mIHRoZSBzaGlwXG4gICAgICBhdHRhY2tlZENvb3JkaW5hdGVzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgICByZXR1cm4gc2hpcDsgLy8gUmV0dXJuIHRoZSBzaGlwIG9iamVjdCB3aGVuIGl0IGlzIGhpdFxuICAgIH1cbiAgICAvLyBObyBzaGlwIGF0IGNvb3JkaW5hdGUsIGl0J3MgYSBtaXNzXG4gICAgY29uc29sZS5sb2coXCJtaXNzXCIpO1xuICAgIG1pc3NlZEF0dGFja3MucHVzaChjb29yZGluYXRlKTtcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgcmV0dXJuIG51bGw7IC8vIFJldHVybiBudWxsIHdoZW4gaXQncyBhIG1pc3NcbiAgfTtcblxuICBjb25zdCBnZXRNaXNzZWRBdHRhY2tzID0gKCkgPT4gbWlzc2VkQXR0YWNrcztcblxuICBjb25zdCBnZXRBdHRhY2tlZENvb3JkaW5hdGVzID0gKCkgPT4gYXR0YWNrZWRDb29yZGluYXRlcztcblxuICBjb25zdCBhbGxTaGlwc1N1bmsgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBnZXRTaGlwcygpOyAvLyBSZXRyaWV2ZSBhbGwgdGhlIHNoaXBzIG9uIHRoZSBnYW1lYm9hcmRcblxuICAgIC8vIENoZWNrIGlmIGFsbCBzaGlwcyBhcmUgc3VuaywgcmV0dXJuIHRydWUgaWYgeWVzLCBhbmQgcmV0dXJuIGZhbHNlIGlmIG5vXG4gICAgY29uc3QgcmVzdWx0ID0gc2hpcHMuZXZlcnkoKHNoaXApID0+IHNoaXAuaXNTdW5rKCkpO1xuXG4gICAgY29uc29sZS5sb2coXCJBbGwgc2hpcHMgc3VuazpcIiwgcmVzdWx0KTsgLy8gTG9nIHRoZSByZXN1bHQgdG8gdGVzdFxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldEdyaWQsXG4gICAgcGxhY2VTaGlwLFxuICAgIGdldFNoaXBzLFxuICAgIGdldFNoaXBDb29yZGluYXRlcyxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGdldE1pc3NlZEF0dGFja3MsXG4gICAgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyxcbiAgICBhbGxTaGlwc1N1bmssXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgUGxheWVyRmFjdG9yeSA9IChuYW1lKSA9PiB7XG4gIGNvbnN0IGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBuZXcgU2V0KCk7IC8vIFNldCB0byBrZWVwIHRyYWNrIG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG5cbiAgY29uc3QgYXR0YWNrID0gKGVuZW15R2FtZWJvYXJkKSA9PiB7XG4gICAgY29uc3QgZ3JpZFNpemUgPSBlbmVteUdhbWVib2FyZC5nZXRHcmlkKCkubGVuZ3RoO1xuICAgIGNvbnN0IHZhbGlkQ29vcmRpbmF0ZXMgPSBGYWN0b3J5SGVscGVycy5nZXRBbGxWYWxpZENvb3JkaW5hdGVzKGdyaWRTaXplKTtcblxuICAgIGxldCBjb29yZGluYXRlID0gXCJcIjtcblxuICAgIC8vIFBlcmZvcm0gYSBkby13aGlsZSBsb29wIHVudGlsIGEgdW5pcXVlIGNvb3JkaW5hdGUgaXMgZm91bmRcbiAgICBkbyB7XG4gICAgICAvLyBHZW5lcmF0ZSBhIHJhbmRvbSBpbmRleCBiYXNlZCBvbiB0aGUgbGVuZ3RoIG9mIHZhbGlkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdmFsaWRDb29yZGluYXRlcy5sZW5ndGgpO1xuXG4gICAgICAvLyBHZXQgdGhlIGNvb3JkaW5hdGUgYXQgdGhlIHJhbmRvbSBpbmRleFxuICAgICAgY29vcmRpbmF0ZSA9IHZhbGlkQ29vcmRpbmF0ZXNbcmFuZG9tSW5kZXhdO1xuICAgIH0gd2hpbGUgKFxuICAgICAgLy8gQ29udGludWUgbG9vcGluZyB3aXRob3V0IHBlcmZvcm1pbmcgYW55IGFjdGlvbnMgaWYgdGhlIGNvb3JkaW5hdGUgaXMgYWxyZWFkeVxuICAgICAgLy8gaW4gdGhlIHBsYXllcnMgYXR0YWNrZWRDb29yZGluYXRlcyBzZXQgb3IgaXMgaW5jbHVkZWQgaW4gdGhlIGVuZW15R2FtZWJvYXJkc1xuICAgICAgLy8gYXR0YWNrZWRDb29yZGluYXRlcyBhcnJheVxuICAgICAgYXR0YWNrZWRDb29yZGluYXRlcy5oYXMoY29vcmRpbmF0ZSkgfHxcbiAgICAgIGVuZW15R2FtZWJvYXJkLmdldEF0dGFja2VkQ29vcmRpbmF0ZXMoKS5pbmNsdWRlcyhjb29yZGluYXRlKVxuICAgICk7XG5cbiAgICAvLyBBZGQgdGhlIGF0dGFja2VkIGNvb3JkaW5hdGUgdG8gdGhlIHBsYXllcnMgc2V0IG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5hZGQoY29vcmRpbmF0ZSk7XG5cbiAgICAvLyBQZXJmb3JtIHRoZSBhdHRhY2sgb24gdGhlIGVuZW15IGdhbWVib2FyZFxuICAgIGVuZW15R2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGF0dGFjayxcbiAgfTtcbn07XG4iLCJleHBvcnQgY29uc3QgRmFjdG9yeUhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gW107XG5cbiAgY29uc3QgY29udmVydFRvSW5kaWNlcyA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgY29sdW1uID0gY29vcmRpbmF0ZS5jaGFyQ29kZUF0KDApIC0gNjU7IC8vIENvbnZlcnQgY29sdW1uIGxldHRlciB0byBpbmRleFxuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7IC8vIENvbnZlcnQgcm93IG51bWJlciB0byBpbmRleCB3aXRoIHJhZGl4IDEwXG4gICAgcmV0dXJuIFtyb3csIGNvbHVtbl07XG4gIH07XG5cbiAgY29uc3QgY29udmVydFRvQWxwaGFudW1lcmljID0gKFtyb3csIGNvbHVtbl0pID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2x1bW4gKyA2NSk7IC8vIENvbnZlcnQgY29sdW1uIGluZGV4IHRvIGxldHRlclxuICAgIHJldHVybiBjb29yZGluYXRlICsgKHJvdyArIDEpOyAvLyBDb252ZXJ0IHJvdyBpbmRleCB0byBudW1iZXJcbiAgfTtcblxuICBjb25zdCBnZXRBbGxWYWxpZENvb3JkaW5hdGVzID0gKGdyaWRTaXplKSA9PiB7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgYWxwaGFudW1lcmljQ29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbXG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGNvbCxcbiAgICAgICAgXSk7XG4gICAgICAgIHZhbGlkQ29vcmRpbmF0ZXMucHVzaChhbHBoYW51bWVyaWNDb29yZGluYXRlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRDb29yZGluYXRlcztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNvbnZlcnRUb0luZGljZXMsXG4gICAgY29udmVydFRvQWxwaGFudW1lcmljLFxuICAgIGdldEFsbFZhbGlkQ29vcmRpbmF0ZXMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgY29uc3QgQXBwSGVscGVycyA9ICgoKSA9PiB7XG4gIGNvbnN0IHRvZ2dsZU1vZGFsID0gKG1vZGFsLCBjaG9pY2UpID0+IHtcbiAgICBjb25zdCB0b2dnbGVkTW9kYWwgPSBtb2RhbDtcblxuICAgIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5jbG9zZXN0KFwiLm92ZXJsYXlcIik7XG4gICAgY29uc3QgZGlzcGxheVZhbHVlID0gY2hvaWNlID09PSBcInNob3dcIiA/IFwiZmxleFwiIDogXCJub25lXCI7XG5cbiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gICAgdG9nZ2xlZE1vZGFsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICB0b2dnbGVNb2RhbCxcbiAgfTtcbn0pKCk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXygzODApO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzYpO1xuIl0sIm5hbWVzIjpbImNvbnRhaW5lckVsZW1lbnQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsInJvdyIsImNvbCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkYXRhc2V0IiwiYXBwZW5kQ2hpbGQiLCJldmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRUeXBlIiwiaGFuZGxlciIsInBsYXllckdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwic2hpcFR5cGVzIiwidHlwZSIsImxlbmd0aCIsImN1cnJlbnRTaGlwSW5kZXgiLCJzaGlwUGxhY2VtZW50TW9kZSIsImlzVmVydGljYWwiLCJjb21wdXRlckdhbWVib2FyZENsaWNrSGFuZGxlciIsImUiLCJ0YXJnZXQiLCJwYXJzZUludCIsImNvb3JkaW5hdGUiLCJjb252ZXJ0VG9BbHBoYW51bWVyaWMiLCJnZXRBdHRhY2tlZENvb3JkaW5hdGVzIiwiaW5jbHVkZXMiLCJhdHRhY2tlZFNoaXAiLCJyZWNlaXZlQXR0YWNrIiwiY29uc29sZSIsImxvZyIsImlzU3VuayIsImFsbFNoaXBzU3VuayIsInJvdGF0ZVNoaXBzIiwic3RhcnRSb3ciLCJzdGFydENvbCIsIkFycmF5IiwiZnJvbSIsIl8iLCJpIiwiaW5pdGlhbFNxdWFyZSIsImhvdmVyZWRTcXVhcmUiLCJyZW1vdmUiLCJzaGlwQ29vcmRpbmF0ZXMiLCJzaGlwIiwicGxhY2VTaGlwIiwiY29tcHV0ZXJTaGlwcyIsIm1hcCIsInNoaXBUeXBlIiwiY29vcmRpbmF0ZXMiLCJwbGFjZWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJwbGFjZUNvbXB1dGVyU2hpcHMiLCJzZXRUaW1lb3V0IiwidG9nZ2xlTW9kYWwiLCJuZXh0U2hpcFR5cGUiLCJpbml0IiwiU2hpcEZhY3RvcnkiLCJoaXRzIiwiaGl0IiwiR2FtZWJvYXJkRmFjdG9yeSIsImdyaWRTaXplIiwiZ3JpZCIsImZpbGwiLCJhdHRhY2tlZENvb3JkaW5hdGVzIiwibWlzc2VkQXR0YWNrcyIsImdldFNoaXBzIiwic2hpcHMiLCJjZWxsIiwicHVzaCIsImdldEdyaWQiLCJ3aXRoaW5Cb3VuZGFyaWVzIiwiZXZlcnkiLCJjb25mbGljdHMiLCJzb21lIiwiYWRqYWNlbnRDb25mbGljdHMiLCJhZGpSb3ciLCJhZGpDb2wiLCJzaGlwSW5mbyIsImdldFNoaXBDb29yZGluYXRlcyIsImNvbnZlcnRUb0luZGljZXMiLCJnZXRNaXNzZWRBdHRhY2tzIiwicmVzdWx0IiwiUGxheWVyRmFjdG9yeSIsIm5hbWUiLCJTZXQiLCJhdHRhY2siLCJlbmVteUdhbWVib2FyZCIsInZhbGlkQ29vcmRpbmF0ZXMiLCJnZXRBbGxWYWxpZENvb3JkaW5hdGVzIiwiaGFzIiwiRmFjdG9yeUhlbHBlcnMiLCJjb2x1bW4iLCJjaGFyQ29kZUF0Iiwic2xpY2UiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhbHBoYW51bWVyaWNDb29yZGluYXRlIiwiQXBwSGVscGVycyIsIm1vZGFsIiwiY2hvaWNlIiwidG9nZ2xlZE1vZGFsIiwiZGlzcGxheVZhbHVlIiwiY2xvc2VzdCIsInN0eWxlIiwiZGlzcGxheSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=