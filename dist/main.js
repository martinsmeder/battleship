(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const n=(e,t)=>{const r=document.querySelector(`${e}`);r.textContent="";for(let e=0;e<10;e+=1)for(let o=0;o<10;o+=1){const n=document.createElement("div");n.classList.add("square"),n.dataset.row=e,n.dataset.col=o,t.forEach((e=>{n.addEventListener(e.eventType,e.handler)})),r.appendChild(n)}};var s=r(776);(()=>{const e=(0,s.Br)(),t=[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}];let r=0,a=!0,l=!1;const c=()=>{l=!l},i=[{eventType:"mouseover",handler:e=>{if(a){const o=e.target,n=parseInt(o.dataset.row,10),s=parseInt(o.dataset.col,10),{length:a}=t[r];Array.from({length:a},((e,t)=>{const r=l?n+t:n,o=l?s:s+t;return document.querySelector(`[data-row="${r}"][data-col="${o}"]`)})).forEach((e=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:n=>{if(a){const c=n.target,i=parseInt(c.dataset.row,10),d=parseInt(c.dataset.col,10),{length:h}=t[r],p=Array.from({length:h},((e,t)=>[l?i+t:i,l?d:d+t])),u=(0,s._V)(h);if(e.placeShip(u,p))if(c.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),r+=1,r===t.length)a=!1,setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide"),console.log("Placed ships:"),e.getShips().forEach(((t,r)=>{console.log(`Ship ${r+1} - Length: ${t.length}`);const o=e.getShipCoordinates(t);console.log("Coordinates:",o)}))}),1e3);else{const e=t[r].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),n(".gameboard.initial",i),document.querySelector("#rotateBtn").addEventListener("click",c)}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>s,_V:()=>n});var o=r(555);const n=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},s=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null))),r=[],n=[],s=()=>{const r=[];for(let o=0;o<e;o+=1)for(let n=0;n<e;n+=1){const e=t[o][n];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const n=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),s=o.some((([e,r])=>null!==t[e][r]));if(n&&!s){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:s,getShipCoordinates:r=>{const n=[];for(let s=0;s<e;s+=1)for(let a=0;a<e;a+=1){const e=t[s][a];e&&e.ship===r&&n.push(o.r.convertToAlphanumeric([s,a]))}return n},receiveAttack:e=>{const[s,a]=o.r.convertToIndices(e),l=t[s][a],c=l&&l.ship;c?c.hit():n.push(e),r.push(e)},getMissedAttacks:()=>n,getAttackedCoordinates:()=>r,allShipsSunk:()=>s().every((e=>e.isSunk()))}}},555:(e,t,r)=>{r.d(t,{U:()=>n,r:()=>o});const o=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let r=0;r<t;r+=1)for(let n=0;n<t;n+=1){const t=o.convertToAlphanumeric([r,n]);e.push(t)}return e}}})(),n={toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={exports:{}};return e[o](s,s.exports,r),s.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UixFQUFTSyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JVLEVBQUksQ0FBQ0ssRUFBS0MsSUFBVUwsT0FBT00sVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NFbEZoQixFQUFvQixLQUVNQSxFQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9yZW5kZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hcHAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy91dGlscy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGlzIG1vZHVsZSBjYW4gYmUgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBjb250ZW50IG9uIHRoZSBwYWdlLlxuLy8gSXQgY2FuIGluY2x1ZGUgZnVuY3Rpb25zIHRvIHVwZGF0ZSB0aGUgRE9NIGVsZW1lbnRzIHJlcHJlc2VudGluZyB0aGVcbi8vIGdhbWUgYm9hcmRzLCBzaGlwcywgYXR0YWNrcywgbWVzc2FnZXMsIGFuZCBvdGhlciBVSSBjb21wb25lbnRzLiBJdCBzaG91bGRcbi8vIGVuY2Fwc3VsYXRlIHRoZSBET00gbWFuaXB1bGF0aW9uIGNvZGUgYW5kIHByb3ZpZGUgYSBjbGVhbiBpbnRlcmZhY2UgZm9yXG4vLyB1cGRhdGluZyB0aGUgVUkgYmFzZWQgb24gdGhlIGdhbWUgc3RhdGUuIEl0IGNhbiBiZSB0aGUgYnJpZGdlIGJldHdlZW4gdGhlXG4vLyBnYW1lIGxvZ2ljIGFuZCB0aGUgYWN0dWFsIERPTSBtYW5pcHVsYXRpb24uXG5cbmNvbnN0IFJlbmRlcmVyID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQsIGV2ZW50TGlzdGVuZXJzKSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtjb250YWluZXJFbGVtZW50fWApO1xuXG4gICAgY29udGFpbmVyLnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIC8vIENyZWF0ZSB0aGUgMTB4MTAgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgMTA7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlXCIpO1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5yb3cgPSByb3c7XG4gICAgICAgIHNxdWFyZS5kYXRhc2V0LmNvbCA9IGNvbDtcblxuICAgICAgICAvLyBBdHRhY2ggZXZlbnQgbGlzdGVuZXJzIHRvIGVhY2ggc3F1YXJlXG4gICAgICAgIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XG4gICAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIobGlzdGVuZXIuZXZlbnRUeXBlLCBsaXN0ZW5lci5oYW5kbGVyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgUmVuZGVyZXI7XG4iLCJpbXBvcnQgeyBBcHBIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCBSZW5kZXJlciBmcm9tIFwiLi9yZW5kZXJcIjtcbmltcG9ydCB7IFNoaXBGYWN0b3J5LCBHYW1lYm9hcmRGYWN0b3J5IH0gZnJvbSBcIi4vZmFjdG9yaWVzXCI7XG5cbi8vIFRoaXMgbW9kdWxlIGNhbiBoYW5kbGUgdGhlIGdhbWUgbG9vcCBhbmQgY29vcmRpbmF0ZSB0aGUgb3ZlcmFsbCBmbG93IG9mXG4vLyB0aGUgZ2FtZS4gSXQgY2FuIGNyZWF0ZSBpbnN0YW5jZXMgb2YgcGxheWVycyBhbmQgZ2FtZWJvYXJkcywgbWFuYWdlIHR1cm5zLFxuLy8gYW5kIGRldGVybWluZSB3aGVuIHRoZSBnYW1lIGVuZHMuIEl0IHNob3VsZCBwcmltYXJpbHkgZm9jdXMgb24gdGhlIGdhbWVcbi8vIGxvZ2ljIGFuZCBvcmNoZXN0cmF0aW9uIHJhdGhlciB0aGFuIGRpcmVjdGx5IGludGVyYWN0aW5nIHdpdGggdGhlIERPTS5cblxuLy8gRXZlbnQgTGlzdGVuZXJzOiBZb3UgY2FuIGhhdmUgZXZlbnQgbGlzdGVuZXJzIGluIGEgc2VwYXJhdGUgbW9kdWxlIG9yXG4vLyBkaXJlY3RseSB3aXRoaW4gYXBwLmpzLCBkZXBlbmRpbmcgb24geW91ciBwcmVmZXJlbmNlIGFuZCB0aGUgY29tcGxleGl0eVxuLy8gb2YgdGhlIGludGVyYWN0aW9ucy4gSWYgeW91IGhhdmUgYSBsYXJnZSBudW1iZXIgb2YgZXZlbnQgbGlzdGVuZXJzIG9yXG4vLyBjb21wbGV4IGV2ZW50IGhhbmRsaW5nLCBpdCBtaWdodCBiZSBiZW5lZmljaWFsIHRvIHNlcGFyYXRlIHRoZW0gaW50byBhXG4vLyBkZWRpY2F0ZWQgbW9kdWxlIHRvIGtlZXAgdGhlIGNvZGUgb3JnYW5pemVkLiBUaGUgZXZlbnQgbGlzdGVuZXJzIHNob3VsZFxuLy8gY2FsbCBhcHByb3ByaWF0ZSBmdW5jdGlvbnMgaW4gYXBwLmpzIG9yIHJlbmRlci5qcyB0byB0cmlnZ2VyIHRoZVxuLy8gY29ycmVzcG9uZGluZyBhY3Rpb25zIGFuZCBVSSB1cGRhdGVzLlxuXG4vLyAxLiAtLS1cbi8vIDIuIC0tLVxuLy8gMy4gLS0tXG4vLyA0LiAtLS1cbi8vIDUuIC0tLVxuLy8gNi4gLS0tXG4vLyA3LiBHZXQgZGF0YSBmcm9tIGluaXRpYWwgZ2FtZWJvYXJkIHRvIHBsYXllcmdhbWVib2FyZFxuLy8gOC4gUmVmYWN0b3IgLyBjbGVhbiB1cCBjb2RlIC0tPiBOZXcgbGlzdFxuXG5jb25zdCBDb250cm9sbGVyID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyR2FtZWJvYXJkID0gR2FtZWJvYXJkRmFjdG9yeSgpO1xuXG4gIGNvbnN0IHNoaXBUeXBlcyA9IFtcbiAgICB7IHR5cGU6IFwiY2FycmllclwiLCBsZW5ndGg6IDUgfSxcbiAgICB7IHR5cGU6IFwiYmF0dGxlc2hpcFwiLCBsZW5ndGg6IDQgfSxcbiAgICB7IHR5cGU6IFwiZGVzdHJveWVyXCIsIGxlbmd0aDogMyB9LFxuICAgIHsgdHlwZTogXCJzdWJtYXJpbmVcIiwgbGVuZ3RoOiAzIH0sXG4gICAgeyB0eXBlOiBcInBhdHJvbCBib2F0XCIsIGxlbmd0aDogMiB9LFxuICBdO1xuXG4gIGxldCBjdXJyZW50U2hpcEluZGV4ID0gMDtcbiAgbGV0IHNoaXBQbGFjZW1lbnRNb2RlID0gdHJ1ZTtcbiAgbGV0IGlzVmVydGljYWwgPSBmYWxzZTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50SGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIGNvbnN0IGNvbCA9IGlzVmVydGljYWwgPyBzdGFydENvbCA6IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIFtyb3csIGNvbF07XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2hpcCA9IFNoaXBGYWN0b3J5KGxlbmd0aCk7XG4gICAgICBjb25zdCBwbGFjZWQgPSBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHNoaXBDb29yZGluYXRlcyk7XG5cbiAgICAgIGlmIChwbGFjZWQpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY3VycmVudFNoaXBJbmRleCArPSAxO1xuXG4gICAgICAgIGlmIChjdXJyZW50U2hpcEluZGV4ID09PSBzaGlwVHlwZXMubGVuZ3RoKSB7XG4gICAgICAgICAgc2hpcFBsYWNlbWVudE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoXG4gICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuaW5pdGlhbFwiKSxcbiAgICAgICAgICAgICAgXCJoaWRlXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBsYWNlZCBzaGlwczpcIik7XG4gICAgICAgICAgICBjb25zdCBzaGlwcyA9IHBsYXllckdhbWVib2FyZC5nZXRTaGlwcygpO1xuICAgICAgICAgICAgc2hpcHMuZm9yRWFjaCgoYWRkZWRTaGlwLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgU2hpcCAke2luZGV4ICsgMX0gLSBMZW5ndGg6ICR7YWRkZWRTaGlwLmxlbmd0aH1gKTtcbiAgICAgICAgICAgICAgY29uc3Qgc2hpcHNDb29yZGluYXRlcyA9XG4gICAgICAgICAgICAgICAgcGxheWVyR2FtZWJvYXJkLmdldFNoaXBDb29yZGluYXRlcyhhZGRlZFNoaXApO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvb3JkaW5hdGVzOlwiLCBzaGlwc0Nvb3JkaW5hdGVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XS50eXBlO1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gbmV4dFNoaXBUeXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYCk7XG4gICAgICB9KTtcblxuICAgICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgICBpZiAoaG92ZXJlZFNxdWFyZSkge1xuICAgICAgICAgIGhvdmVyZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcImhvdmVyZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBnYW1lYm9hcmRNb3VzZUxlYXZlSGFuZGxlciA9ICgpID0+IHtcbiAgICBjb25zdCBob3ZlcmVkU3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuZ2FtZWJvYXJkIC5ob3ZlcmVkXCIpO1xuICAgIGhvdmVyZWRTcXVhcmVzLmZvckVhY2goKGhvdmVyZWRTcXVhcmUpID0+IHtcbiAgICAgIGhvdmVyZWRTcXVhcmUuY2xhc3NMaXN0LnJlbW92ZShcImhvdmVyZWRcIik7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3Qgcm90YXRlU2hpcHMgPSAoKSA9PiB7XG4gICAgaXNWZXJ0aWNhbCA9ICFpc1ZlcnRpY2FsO1xuICB9O1xuXG4gIGNvbnN0IGV2ZW50TGlzdGVuZXJzID0gW1xuICAgIHsgZXZlbnRUeXBlOiBcIm1vdXNlb3ZlclwiLCBoYW5kbGVyOiBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgfSxcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZWxlYXZlXCIsIGhhbmRsZXI6IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwiY2xpY2tcIiwgaGFuZGxlcjogc2hpcFBsYWNlbWVudEhhbmRsZXIgfSxcbiAgXTtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLCBcImhpZGVcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5pbml0aWFsXCIsIGV2ZW50TGlzdGVuZXJzKTtcbiAgICBjb25zdCByb3RhdGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JvdGF0ZUJ0blwiKTtcbiAgICByb3RhdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJvdGF0ZVNoaXBzKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gIH07XG59KSgpO1xuXG5Db250cm9sbGVyLmluaXQoKTtcbiIsImltcG9ydCB7IEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGNvbnN0IFNoaXBGYWN0b3J5ID0gKGxlbmd0aCkgPT4ge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdHMgKz0gMTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBoaXRzID49IGxlbmd0aDsgLy8gUmV0dXJuIHRydWUgaWYgaGl0cyBpcyBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gbGVuZ3RoXG5cbiAgcmV0dXJuIHtcbiAgICBsZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXQgaGl0cygpIHtcbiAgICAgIC8vIEdldHRlciBmdW5jdGlvbiBmb3IgaGl0cy4gVXNpbmcgZnVuY3Rpb24gZGVjbGFyYXRpb24gdG8gZW5zdXJlIGl0IGhhcyBhY2Nlc3MgdG8gdGhlXG4gICAgICAvLyBgaGl0c2AgdmFyaWFibGUgZHluYW1pY2FsbHksIHNpbmNlIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBhcmUgaG9pc3RlZCBhbmQgY2FuIGJlIHVzZWRcbiAgICAgIC8vIGJlZm9yZSB0aGV5IGFyZSBkZWZpbmVkLiBUaGlzIGFsbG93cyBhY2Nlc3NpbmcgdGhlIGN1cnJlbnQgdmFsdWUgb2YgYGhpdHNgIGV2ZW4gYmVmb3JlXG4gICAgICAvLyBjYWxsaW5nIHRoZSBgaGl0YCBmdW5jdGlvblxuICAgICAgcmV0dXJuIGhpdHM7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBHYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBjb25zdCBncmlkU2l6ZSA9IDEwO1xuICBjb25zdCBncmlkID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogZ3JpZFNpemUgfSwgKCkgPT5cbiAgICBBcnJheShncmlkU2l6ZSkuZmlsbChudWxsKVxuICApO1xuXG4gIGNvbnN0IGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBbXTtcbiAgY29uc3QgbWlzc2VkQXR0YWNrcyA9IFtdO1xuXG4gIGNvbnN0IGdldEdyaWQgPSAoKSA9PiBncmlkO1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb29yZGluYXRlcykgPT4ge1xuICAgIC8vIENoZWNrIGlmIGFsbCBjb29yZGluYXRlcyBhcmUgd2l0aGluIHRoZSBib3VuZGFyaWVzIG9mIHRoZSBncmlkXG4gICAgY29uc3Qgd2l0aGluQm91bmRhcmllcyA9IGNvb3JkaW5hdGVzLmV2ZXJ5KFxuICAgICAgKFtyb3csIGNvbF0pID0+IHJvdyA+PSAwICYmIHJvdyA8IGdyaWRTaXplICYmIGNvbCA+PSAwICYmIGNvbCA8IGdyaWRTaXplXG4gICAgKTtcblxuICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgY29uZmxpY3RzIHdpdGggZXhpc3Rpbmcgc2hpcCBwbGFjZW1lbnRzIG9uIHRoZSBncmlkXG4gICAgY29uc3QgY29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4gZ3JpZFtyb3ddW2NvbF0gIT09IG51bGwpO1xuXG4gICAgLy8gSWYgdGhlIHNoaXAgcGxhY2VtZW50IGlzIHdpdGhpbiBib3VuZGFyaWVzIGFuZCBoYXMgbm8gY29uZmxpY3RzLi4uXG4gICAgaWYgKHdpdGhpbkJvdW5kYXJpZXMgJiYgIWNvbmZsaWN0cykge1xuICAgICAgLy8gQ3JlYXRlIGFuIG9iamVjdCBjb250YWluaW5nIHNoaXAgaW5mb3JtYXRpb24gYW5kIGNvb3JkaW5hdGVzXG4gICAgICBjb25zdCBzaGlwSW5mbyA9IHtcbiAgICAgICAgc2hpcCxcbiAgICAgICAgY29vcmRpbmF0ZXMsXG4gICAgICB9O1xuXG4gICAgICAvLyBQbGFjZSB0aGUgc2hpcCBvbiB0aGUgZ3JpZCBieSB1cGRhdGluZyB0aGUgY29ycmVzcG9uZGluZyBjZWxsc1xuICAgICAgc2hpcEluZm8uY29vcmRpbmF0ZXMuZm9yRWFjaCgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgICBncmlkW3Jvd11bY29sXSA9IHNoaXBJbmZvO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cnVlOyAvLyBTaGlwIHBsYWNlbWVudCBzdWNjZXNzZnVsXG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBPdGhlcndpc2UsIHNoaXAgcGxhY2VtZW50IGZhaWxlZFxuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gW107XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBjZWxsIG9mIHRoZSBncmlkXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2VsbCBjb250YWlucyBhIHNoaXAgYW5kIGl0J3Mgbm90IGFscmVhZHkgaW5jbHVkZWQgaW4gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjZWxsICE9PSBudWxsICYmXG4gICAgICAgICAgY2VsbC5zaGlwICYmXG4gICAgICAgICAgIXNoaXBzLmluY2x1ZGVzKGNlbGwuc2hpcCkgJiZcbiAgICAgICAgICAhY2VsbC5zaGlwLmlzU3VuaygpXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIEFkZCB0aGUgc2hpcCB0byB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgICBzaGlwcy5wdXNoKGNlbGwuc2hpcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc2hpcHM7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcENvb3JkaW5hdGVzID0gKHNoaXApID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgZXhpc3RzIGFuZCBjb250YWlucyB0aGUgc3BlY2lmaWVkIHNoaXBcbiAgICAgICAgaWYgKGNlbGwgJiYgY2VsbC5zaGlwID09PSBzaGlwKSB7XG4gICAgICAgICAgLy8gQ29udmVydCB0aGUgcm93IGFuZCBjb2x1bW4gaW5kaWNlcyB0byBhbHBoYW51bWVyaWMgY29vcmRpbmF0ZXMgYW5kIGFkZCB0aGVtIHRvXG4gICAgICAgICAgLy8gdGhlIGNvb3JkaW5hdGVzIGFycmF5XG4gICAgICAgICAgY29vcmRpbmF0ZXMucHVzaChGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW3JvdywgY29sXSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IFtyb3csIGNvbF0gPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9JbmRpY2VzKGNvb3JkaW5hdGUpO1xuICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcblxuICAgIGNvbnN0IHNoaXAgPSBjZWxsICYmIGNlbGwuc2hpcDsgLy8gQWNjZXNzIHRoZSBzaGlwIHByb3BlcnR5IG9mIHRoZSBjZWxsIG9iamVjdFxuXG4gICAgaWYgKHNoaXApIHtcbiAgICAgIHNoaXAuaGl0KCk7IC8vIEluY3JlbWVudCBoaXQgY291bnQgb2YgdGhlIHNoaXBcbiAgICB9IGVsc2Uge1xuICAgICAgbWlzc2VkQXR0YWNrcy5wdXNoKGNvb3JkaW5hdGUpOyAvLyBSZWNvcmQgbWlzc2VkIGF0dGFjayBjb29yZGluYXRlc1xuICAgIH1cblxuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMucHVzaChjb29yZGluYXRlKTtcbiAgfTtcblxuICBjb25zdCBnZXRNaXNzZWRBdHRhY2tzID0gKCkgPT4gbWlzc2VkQXR0YWNrcztcblxuICBjb25zdCBnZXRBdHRhY2tlZENvb3JkaW5hdGVzID0gKCkgPT4gYXR0YWNrZWRDb29yZGluYXRlcztcblxuICBjb25zdCBhbGxTaGlwc1N1bmsgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBnZXRTaGlwcygpOyAvLyBSZXRyaWV2ZSBhbGwgdGhlIHNoaXBzIG9uIHRoZSBnYW1lYm9hcmRcblxuICAgIC8vIENoZWNrIGlmIGFsbCBzaGlwcyBhcmUgc3VuaywgcmV0dXJuIHRydWUgaWYgeWVzLCBhbmQgcmV0dXJuIGZhbHNlIGlmIG5vXG4gICAgcmV0dXJuIHNoaXBzLmV2ZXJ5KChzaGlwKSA9PiBzaGlwLmlzU3VuaygpKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldEdyaWQsXG4gICAgcGxhY2VTaGlwLFxuICAgIGdldFNoaXBzLFxuICAgIGdldFNoaXBDb29yZGluYXRlcyxcbiAgICByZWNlaXZlQXR0YWNrLFxuICAgIGdldE1pc3NlZEF0dGFja3MsXG4gICAgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyxcbiAgICBhbGxTaGlwc1N1bmssXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgUGxheWVyRmFjdG9yeSA9IChuYW1lKSA9PiB7XG4gIGNvbnN0IGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBuZXcgU2V0KCk7IC8vIFNldCB0byBrZWVwIHRyYWNrIG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG5cbiAgY29uc3QgYXR0YWNrID0gKGVuZW15R2FtZWJvYXJkKSA9PiB7XG4gICAgY29uc3QgZ3JpZFNpemUgPSBlbmVteUdhbWVib2FyZC5nZXRHcmlkKCkubGVuZ3RoO1xuICAgIGNvbnN0IHZhbGlkQ29vcmRpbmF0ZXMgPSBGYWN0b3J5SGVscGVycy5nZXRBbGxWYWxpZENvb3JkaW5hdGVzKGdyaWRTaXplKTtcblxuICAgIGxldCBjb29yZGluYXRlID0gXCJcIjtcblxuICAgIC8vIFBlcmZvcm0gYSBkby13aGlsZSBsb29wIHVudGlsIGEgdW5pcXVlIGNvb3JkaW5hdGUgaXMgZm91bmRcbiAgICBkbyB7XG4gICAgICAvLyBHZW5lcmF0ZSBhIHJhbmRvbSBpbmRleCBiYXNlZCBvbiB0aGUgbGVuZ3RoIG9mIHZhbGlkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdmFsaWRDb29yZGluYXRlcy5sZW5ndGgpO1xuXG4gICAgICAvLyBHZXQgdGhlIGNvb3JkaW5hdGUgYXQgdGhlIHJhbmRvbSBpbmRleFxuICAgICAgY29vcmRpbmF0ZSA9IHZhbGlkQ29vcmRpbmF0ZXNbcmFuZG9tSW5kZXhdO1xuICAgIH0gd2hpbGUgKFxuICAgICAgLy8gQ29udGludWUgbG9vcGluZyB3aXRob3V0IHBlcmZvcm1pbmcgYW55IGFjdGlvbnMgaWYgdGhlIGNvb3JkaW5hdGUgaXMgYWxyZWFkeVxuICAgICAgLy8gaW4gdGhlIHBsYXllcnMgYXR0YWNrZWRDb29yZGluYXRlcyBzZXQgb3IgaXMgaW5jbHVkZWQgaW4gdGhlIGVuZW15R2FtZWJvYXJkc1xuICAgICAgLy8gYXR0YWNrZWRDb29yZGluYXRlcyBhcnJheVxuICAgICAgYXR0YWNrZWRDb29yZGluYXRlcy5oYXMoY29vcmRpbmF0ZSkgfHxcbiAgICAgIGVuZW15R2FtZWJvYXJkLmdldEF0dGFja2VkQ29vcmRpbmF0ZXMoKS5pbmNsdWRlcyhjb29yZGluYXRlKVxuICAgICk7XG5cbiAgICAvLyBBZGQgdGhlIGF0dGFja2VkIGNvb3JkaW5hdGUgdG8gdGhlIHBsYXllcnMgc2V0IG9mIGF0dGFja2VkIGNvb3JkaW5hdGVzXG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5hZGQoY29vcmRpbmF0ZSk7XG5cbiAgICAvLyBQZXJmb3JtIHRoZSBhdHRhY2sgb24gdGhlIGVuZW15IGdhbWVib2FyZFxuICAgIGVuZW15R2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGF0dGFjayxcbiAgfTtcbn07XG4iLCJleHBvcnQgY29uc3QgRmFjdG9yeUhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gW107XG5cbiAgY29uc3QgY29udmVydFRvSW5kaWNlcyA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgY29sdW1uID0gY29vcmRpbmF0ZS5jaGFyQ29kZUF0KDApIC0gNjU7IC8vIENvbnZlcnQgY29sdW1uIGxldHRlciB0byBpbmRleFxuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7IC8vIENvbnZlcnQgcm93IG51bWJlciB0byBpbmRleCB3aXRoIHJhZGl4IDEwXG4gICAgcmV0dXJuIFtyb3csIGNvbHVtbl07XG4gIH07XG5cbiAgY29uc3QgY29udmVydFRvQWxwaGFudW1lcmljID0gKFtyb3csIGNvbHVtbl0pID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2x1bW4gKyA2NSk7IC8vIENvbnZlcnQgY29sdW1uIGluZGV4IHRvIGxldHRlclxuICAgIHJldHVybiBjb29yZGluYXRlICsgKHJvdyArIDEpOyAvLyBDb252ZXJ0IHJvdyBpbmRleCB0byBudW1iZXJcbiAgfTtcblxuICBjb25zdCBnZXRBbGxWYWxpZENvb3JkaW5hdGVzID0gKGdyaWRTaXplKSA9PiB7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgYWxwaGFudW1lcmljQ29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbXG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGNvbCxcbiAgICAgICAgXSk7XG4gICAgICAgIHZhbGlkQ29vcmRpbmF0ZXMucHVzaChhbHBoYW51bWVyaWNDb29yZGluYXRlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRDb29yZGluYXRlcztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNvbnZlcnRUb0luZGljZXMsXG4gICAgY29udmVydFRvQWxwaGFudW1lcmljLFxuICAgIGdldEFsbFZhbGlkQ29vcmRpbmF0ZXMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgY29uc3QgQXBwSGVscGVycyA9ICgoKSA9PiB7XG4gIGNvbnN0IHRvZ2dsZU1vZGFsID0gKG1vZGFsLCBjaG9pY2UpID0+IHtcbiAgICBjb25zdCB0b2dnbGVkTW9kYWwgPSBtb2RhbDtcblxuICAgIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5jbG9zZXN0KFwiLm92ZXJsYXlcIik7XG4gICAgY29uc3QgZGlzcGxheVZhbHVlID0gY2hvaWNlID09PSBcInNob3dcIiA/IFwiZmxleFwiIDogXCJub25lXCI7XG5cbiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gICAgdG9nZ2xlZE1vZGFsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICB0b2dnbGVNb2RhbCxcbiAgfTtcbn0pKCk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXygzODApO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzYpO1xuIl0sIm5hbWVzIjpbImNvbnRhaW5lckVsZW1lbnQiLCJldmVudExpc3RlbmVycyIsImNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50Iiwicm93IiwiY29sIiwic3F1YXJlIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImRhdGFzZXQiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRUeXBlIiwiaGFuZGxlciIsImFwcGVuZENoaWxkIiwicGxheWVyR2FtZWJvYXJkIiwic2hpcFR5cGVzIiwidHlwZSIsImxlbmd0aCIsImN1cnJlbnRTaGlwSW5kZXgiLCJzaGlwUGxhY2VtZW50TW9kZSIsImlzVmVydGljYWwiLCJyb3RhdGVTaGlwcyIsImUiLCJ0YXJnZXQiLCJzdGFydFJvdyIsInBhcnNlSW50Iiwic3RhcnRDb2wiLCJBcnJheSIsImZyb20iLCJfIiwiaSIsImhvdmVyZWRTcXVhcmUiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVtb3ZlIiwic2hpcENvb3JkaW5hdGVzIiwic2hpcCIsInBsYWNlU2hpcCIsInNldFRpbWVvdXQiLCJ0b2dnbGVNb2RhbCIsImNvbnNvbGUiLCJsb2ciLCJnZXRTaGlwcyIsImFkZGVkU2hpcCIsImluZGV4Iiwic2hpcHNDb29yZGluYXRlcyIsImdldFNoaXBDb29yZGluYXRlcyIsIm5leHRTaGlwVHlwZSIsImluaXQiLCJTaGlwRmFjdG9yeSIsImhpdHMiLCJoaXQiLCJpc1N1bmsiLCJHYW1lYm9hcmRGYWN0b3J5IiwiZ3JpZFNpemUiLCJncmlkIiwiZmlsbCIsImF0dGFja2VkQ29vcmRpbmF0ZXMiLCJtaXNzZWRBdHRhY2tzIiwic2hpcHMiLCJjZWxsIiwiaW5jbHVkZXMiLCJwdXNoIiwiZ2V0R3JpZCIsImNvb3JkaW5hdGVzIiwid2l0aGluQm91bmRhcmllcyIsImV2ZXJ5IiwiY29uZmxpY3RzIiwic29tZSIsInNoaXBJbmZvIiwiY29udmVydFRvQWxwaGFudW1lcmljIiwicmVjZWl2ZUF0dGFjayIsImNvb3JkaW5hdGUiLCJjb252ZXJ0VG9JbmRpY2VzIiwiZ2V0TWlzc2VkQXR0YWNrcyIsImdldEF0dGFja2VkQ29vcmRpbmF0ZXMiLCJhbGxTaGlwc1N1bmsiLCJGYWN0b3J5SGVscGVycyIsInZhbGlkQ29vcmRpbmF0ZXMiLCJjb2x1bW4iLCJjaGFyQ29kZUF0Iiwic2xpY2UiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJnZXRBbGxWYWxpZENvb3JkaW5hdGVzIiwiYWxwaGFudW1lcmljQ29vcmRpbmF0ZSIsIkFwcEhlbHBlcnMiLCJtb2RhbCIsImNob2ljZSIsInRvZ2dsZWRNb2RhbCIsImRpc3BsYXlWYWx1ZSIsImNsb3Nlc3QiLCJzdHlsZSIsImRpc3BsYXkiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwic291cmNlUm9vdCI6IiJ9