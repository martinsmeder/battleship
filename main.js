(()=>{"use strict";var e={380:(e,t,o)=>{var r=o(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let o=0;o<10;o+=1){const r=document.createElement("div");r.classList.add("square"),r.dataset.row=e,r.dataset.col=o,t.appendChild(r)}},l=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))},n=e=>{document.querySelector("#winner").textContent=`${e} won!`},s=e=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{e.className="square"}))};var c=o(776);(()=>{const e=(0,c.Br)(),t=(0,c.Br)(),o=(0,c.oP)("computer"),d=[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}];let i=0,u=!0,h=!1,p=null;const m=a=>{if(!u){const l=a.target,s=parseInt(l.dataset.row,10),c=parseInt(l.dataset.col,10),d=r.r.convertToAlphanumeric([s,c]);if(!t.getAttackedCoordinates().includes(d)){const a=t.receiveAttack(d);console.log(a),a?(l.classList.add("hit"),console.log(`Player hit Computer at: ${d}`),a.isSunk()&&console.log(`Player sank Computer's ${a}!`)):(l.classList.add("miss"),console.log(`Player missed at: ${d}`)),t.allShipsSunk()&&(p="You",n(p),r.U.toggleModal(document.querySelector(".modal.endgame"),"show"),console.log("Player wins!")),(()=>{if(!u){const t=o.attack(e),a=e.receiveAttack(t),l=parseInt(t.slice(1),10)-1,s=t[0].charCodeAt(0)-65,c=document.querySelector(`.gameboard.player [data-row="${l}"][data-col="${s}"]`);a?(c.classList.add("hit"),console.log(`Computer hit Player at: ${t}`),a.isSunk()&&console.log(`Computer sank Player's ${a}!`)):(c.classList.add("miss"),console.log(`Computer missed at: ${t}`)),e.allShipsSunk()&&(p="The computer",n(p),r.U.toggleModal(document.querySelector(".modal.endgame"),"show"),console.log("Computer wins!"))}})()}}},g=()=>{h=!h},y=[{eventType:"mouseover",handler:e=>{if(u){const t=e.target,o=parseInt(t.dataset.row,10),r=parseInt(t.dataset.col,10),{length:a}=d[i];Array.from({length:a},((e,t)=>{const a=h?o+t:o,l=h?r:r+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-row="${a}"][data-col="${l}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:o=>{if(u){const a=o.target,l=parseInt(a.dataset.row,10),n=parseInt(a.dataset.col,10),{length:s}=d[i],p=Array.from({length:s},((e,t)=>[h?l+t:l,h?n:n+t])),m=(0,c._V)(s);if(e.placeShip(m,p))if(a.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),i+=1,i===d.length)u=!1,(()=>{const e=[];for(let o=0;o<d.length;o+=1){const{type:r,length:a}=d[o];let l=[],n=!1;for(;!n;){const e=Math.floor(10*Math.random()),o=Math.floor(10*Math.random());h=Math.random()<.5,l=[],h?e+a-1<10&&(l=Array.from({length:a},((t,r)=>[e+r,o]))):o+a-1<10&&(l=Array.from({length:a},((t,r)=>[e,o+r]))),l.length>0&&(n=t.placeShip((0,c._V)(a),l))}l.forEach((([e,t])=>{document.querySelector(`.gameboard.computer [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),e.push({type:r,coordinates:l})}})(),setTimeout((()=>{r.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=d[i].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{r.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),l(".gameboard.initial",y),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",m)})),document.querySelector("#rotateBtn").addEventListener("click",g),document.querySelector("#newGame").addEventListener("click",(()=>{i=0,u=!0,h=!1,p=null,e.reset(),t.reset(),o.clearSet(),s(".gameboard.initial"),s(".gameboard.player"),s(".gameboard.computer"),document.querySelector(".ship-type").textContent=d[0].type,r.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),r.U.toggleModal(document.querySelector(".modal.initial"),"show")}))}}})().init()},776:(e,t,o)=>{o.d(t,{Br:()=>l,_V:()=>a,oP:()=>n});var r=o(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},l=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null)));let o=[],a=[];const l=()=>{const o=[];for(let r=0;r<e;r+=1)for(let a=0;a<e;a+=1){const e=t[r][a];null===e||!e.ship||o.includes(e.ship)||e.ship.isSunk()||o.push(e.ship)}return o};return{getGrid:()=>t,placeShip:(o,r)=>{const a=r.every((([e,t])=>e>0&&e<9&&t>0&&t<9)),l=r.some((([e,o])=>null!==t[e][o])),n=r.some((([o,r])=>[[o-1,r],[o+1,r],[o,r-1],[o,r+1],[o-1,r-1],[o-1,r+1],[o+1,r-1],[o+1,r+1]].some((([o,r])=>o>=0&&o<e&&r>=0&&r<e&&null!==t[o]?.[r]))));if(a&&!l&&!n){const e={ship:o,coordinates:r};return e.coordinates.forEach((([o,r])=>{t[o][r]=e})),!0}return!1},getShips:l,getAllShips:()=>{const o=[];for(let r=0;r<e;r+=1)for(let a=0;a<e;a+=1){const e=t[r][a];null!==e&&e.ship&&!o.includes(e.ship)&&o.push(e.ship)}return console.log(o),o},getShipCoordinates:o=>{const a=[];for(let l=0;l<e;l+=1)for(let n=0;n<e;n+=1){const e=t[l][n];e&&e.ship===o&&a.push(r.r.convertToAlphanumeric([l,n]))}return a},receiveAttack:e=>{const[r,l]=e,n=parseInt(l,10)-1,s=r.charCodeAt(0)-65,c=t[n][s];if(null!==c){const{ship:t}=c;return t.hit(),o.push(e),t}return a.push(e),o.push(e),null},getMissedAttacks:()=>a,getAttackedCoordinates:()=>o,allShipsSunk:()=>{const e=l().every((e=>e.isSunk()));return console.log("All ships sunk:",e),e},reset:()=>{t.forEach(((e,o)=>{e.forEach(((e,r)=>{t[o][r]=null}))})),o=[],a=[]}}},n=e=>{const t=new Set;return{name:e,attack:e=>{const o=e.getGrid().length,a=r.r.getAllValidCoordinates(o);let l="";do{l=a[Math.floor(Math.random()*a.length)]}while(t.has(l)||e.getAttackedCoordinates().includes(l));return t.add(l),l},getAttackedSet:()=>t,clearSet:()=>{t.clear()}}}},555:(e,t,o)=>{o.d(t,{U:()=>a,r:()=>r});const r=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let o=0;o<t;o+=1)for(let a=0;a<t;a+=1){const t=r.convertToAlphanumeric([o,a]);e.push(t)}return e}}})(),a={toggleModal:(e,t)=>{const o=e,r="show"===t?"flex":"none";e.closest(".overlay").style.display=r,o.style.display=r}}}},t={};function o(r){var a=t[r];if(void 0!==a)return a.exports;var l=t[r]={exports:{}};return e[r](l,l.exports,o),l.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o(380),o(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVNLLEVBQUssQ0FBRUksWUFBWSxFQUFNQyxJQUFLTixFQUFXQyxJQUUxRSxFQ05EVCxFQUFvQlUsRUFBSSxDQUFDSyxFQUFLQyxJQUFVTCxPQUFPTSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxHQ0VsRmhCLEVBQW9CLEtBRU1BLEVBQW9CLEkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3JlbmRlci5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2FwcC5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL2ZhY3Rvcmllcy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwLy4vc3JjL3V0aWxzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9zdGFydHVwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoaXMgbW9kdWxlIGNhbiBiZSByZXNwb25zaWJsZSBmb3IgcmVuZGVyaW5nIGNvbnRlbnQgb24gdGhlIHBhZ2UuXG4vLyBJdCBjYW4gaW5jbHVkZSBmdW5jdGlvbnMgdG8gdXBkYXRlIHRoZSBET00gZWxlbWVudHMgcmVwcmVzZW50aW5nIHRoZVxuLy8gZ2FtZSBib2FyZHMsIHNoaXBzLCBhdHRhY2tzLCBtZXNzYWdlcywgYW5kIG90aGVyIFVJIGNvbXBvbmVudHMuIEl0IHNob3VsZFxuLy8gZW5jYXBzdWxhdGUgdGhlIERPTSBtYW5pcHVsYXRpb24gY29kZSBhbmQgcHJvdmlkZSBhIGNsZWFuIGludGVyZmFjZSBmb3Jcbi8vIHVwZGF0aW5nIHRoZSBVSSBiYXNlZCBvbiB0aGUgZ2FtZSBzdGF0ZS4gSXQgY2FuIGJlIHRoZSBicmlkZ2UgYmV0d2VlbiB0aGVcbi8vIGdhbWUgbG9naWMgYW5kIHRoZSBhY3R1YWwgRE9NIG1hbmlwdWxhdGlvbi5cblxuY29uc3QgUmVuZGVyZXIgPSAoKCkgPT4ge1xuICBjb25zdCByZW5kZXJHYW1lYm9hcmQgPSAoY29udGFpbmVyRWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyRWxlbWVudCk7XG5cbiAgICBjb250YWluZXIudGV4dENvbnRlbnQgPSBcIlwiO1xuXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgMTA7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCAxMDsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJzcXVhcmVcIik7XG4gICAgICAgIHNxdWFyZS5kYXRhc2V0LnJvdyA9IHJvdztcbiAgICAgICAgc3F1YXJlLmRhdGFzZXQuY29sID0gY29sO1xuXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzcXVhcmUpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBhdHRhY2hFdmVudExpc3RlbmVycyA9IChjb250YWluZXJFbGVtZW50LCBldmVudExpc3RlbmVycykgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyRWxlbWVudCk7XG5cbiAgICBjb250YWluZXIucXVlcnlTZWxlY3RvckFsbChcIi5zcXVhcmVcIikuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgICBldmVudExpc3RlbmVycy5mb3JFYWNoKChsaXN0ZW5lcikgPT4ge1xuICAgICAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihsaXN0ZW5lci5ldmVudFR5cGUsIGxpc3RlbmVyLmhhbmRsZXIpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3Qgc2V0V2lubmVySGVhZGluZyA9ICh3aW5uZXIpID0+IHtcbiAgICBjb25zdCB3aW5uZXJIZWFkaW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN3aW5uZXJcIik7XG4gICAgd2lubmVySGVhZGluZy50ZXh0Q29udGVudCA9IGAke3dpbm5lcn0gd29uIWA7XG4gIH07XG5cbiAgY29uc3QgY2xlYXJHYW1lYm9hcmQgPSAoY29udGFpbmVyRWxlbWVudCkgPT4ge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyRWxlbWVudCk7XG4gICAgY29uc3Qgc3F1YXJlcyA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiLnNxdWFyZVwiKTtcblxuICAgIHNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgICBjb25zdCByZXNldFNxdWFyZSA9IHNxdWFyZTtcbiAgICAgIHJlc2V0U3F1YXJlLmNsYXNzTmFtZSA9IFwic3F1YXJlXCI7IC8vIFJlc2V0IHRoZSBjbGFzc05hbWUgdG8gcmVtb3ZlIGFsbCBjbGFzc2VzXG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICByZW5kZXJHYW1lYm9hcmQsXG4gICAgYXR0YWNoRXZlbnRMaXN0ZW5lcnMsXG4gICAgc2V0V2lubmVySGVhZGluZyxcbiAgICBjbGVhckdhbWVib2FyZCxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBkZWZhdWx0IFJlbmRlcmVyO1xuIiwiaW1wb3J0IHsgQXBwSGVscGVycywgRmFjdG9yeUhlbHBlcnMgfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IFJlbmRlcmVyIGZyb20gXCIuL3JlbmRlclwiO1xuaW1wb3J0IHsgU2hpcEZhY3RvcnksIEdhbWVib2FyZEZhY3RvcnksIFBsYXllckZhY3RvcnkgfSBmcm9tIFwiLi9mYWN0b3JpZXNcIjtcblxuY29uc3QgQ29udHJvbGxlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHBsYXllckdhbWVib2FyZCA9IEdhbWVib2FyZEZhY3RvcnkoKTtcbiAgY29uc3QgY29tcHV0ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmRGYWN0b3J5KCk7XG5cbiAgY29uc3QgY29tcHV0ZXIgPSBQbGF5ZXJGYWN0b3J5KFwiY29tcHV0ZXJcIik7XG5cbiAgY29uc3Qgc2hpcFR5cGVzID0gW1xuICAgIHsgdHlwZTogXCJjYXJyaWVyXCIsIGxlbmd0aDogNSB9LFxuICAgIHsgdHlwZTogXCJiYXR0bGVzaGlwXCIsIGxlbmd0aDogNCB9LFxuICAgIHsgdHlwZTogXCJkZXN0cm95ZXJcIiwgbGVuZ3RoOiAzIH0sXG4gICAgeyB0eXBlOiBcInN1Ym1hcmluZVwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwicGF0cm9sIGJvYXRcIiwgbGVuZ3RoOiAyIH0sXG4gIF07XG5cbiAgbGV0IGN1cnJlbnRTaGlwSW5kZXggPSAwO1xuICBsZXQgc2hpcFBsYWNlbWVudE1vZGUgPSB0cnVlO1xuICBsZXQgaXNWZXJ0aWNhbCA9IGZhbHNlO1xuICBsZXQgd2lubmVyID0gbnVsbDtcblxuICBjb25zdCBwbGFjZUNvbXB1dGVyU2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3QgY29tcHV0ZXJTaGlwcyA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGlwVHlwZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgIGNvbnN0IHsgdHlwZSwgbGVuZ3RoIH0gPSBzaGlwVHlwZXNbaV07XG4gICAgICBsZXQgY29vcmRpbmF0ZXMgPSBbXTtcbiAgICAgIGxldCBwbGFjZWQgPSBmYWxzZTtcblxuICAgICAgd2hpbGUgKCFwbGFjZWQpIHtcbiAgICAgICAgY29uc3Qgc3RhcnRSb3cgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMCk7XG4gICAgICAgIGNvbnN0IHN0YXJ0Q29sID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICBpc1ZlcnRpY2FsID0gTWF0aC5yYW5kb20oKSA8IDAuNTtcbiAgICAgICAgY29vcmRpbmF0ZXMgPSBbXTtcblxuICAgICAgICBpZiAoaXNWZXJ0aWNhbCkge1xuICAgICAgICAgIGlmIChzdGFydFJvdyArIGxlbmd0aCAtIDEgPCAxMCkge1xuICAgICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBqKSA9PiBbXG4gICAgICAgICAgICAgIHN0YXJ0Um93ICsgaixcbiAgICAgICAgICAgICAgc3RhcnRDb2wsXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhcnRDb2wgKyBsZW5ndGggLSAxIDwgMTApIHtcbiAgICAgICAgICBjb29yZGluYXRlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGopID0+IFtcbiAgICAgICAgICAgIHN0YXJ0Um93LFxuICAgICAgICAgICAgc3RhcnRDb2wgKyBqLFxuICAgICAgICAgIF0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwbGFjZWQgPSBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoXG4gICAgICAgICAgICBTaGlwRmFjdG9yeShsZW5ndGgpLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIHBsYWNlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbXB1dGVyU2hpcHMucHVzaCh7IHR5cGUsIGNvb3JkaW5hdGVzIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50SGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIGNvbnN0IGNvbCA9IGlzVmVydGljYWwgPyBzdGFydENvbCA6IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIFtyb3csIGNvbF07XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2hpcCA9IFNoaXBGYWN0b3J5KGxlbmd0aCk7XG4gICAgICBjb25zdCBwbGFjZWQgPSBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHNoaXBDb29yZGluYXRlcyk7XG5cbiAgICAgIGlmIChwbGFjZWQpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjdXJyZW50U2hpcEluZGV4ICs9IDE7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRTaGlwSW5kZXggPT09IHNoaXBUeXBlcy5sZW5ndGgpIHtcbiAgICAgICAgICBzaGlwUGxhY2VtZW50TW9kZSA9IGZhbHNlO1xuICAgICAgICAgIHBsYWNlQ29tcHV0ZXJTaGlwcygpO1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLFxuICAgICAgICAgICAgICBcImhpZGVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XS50eXBlO1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gbmV4dFNoaXBUeXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluaXRpYWxTcXVhcmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLmdhbWVib2FyZC5pbml0aWFsIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgICApLFxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGhvdmVyZWRTcXVhcmVzLmZvckVhY2goKHsgaW5pdGlhbFNxdWFyZSB9KSA9PiB7XG4gICAgICAgIGlmIChpbml0aWFsU3F1YXJlKSB7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lYm9hcmQgLmhvdmVyZWRcIik7XG4gICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgaG92ZXJlZFNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBjb21wdXRlckF0dGFjayA9ICgpID0+IHtcbiAgICBpZiAoIXNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBjb29yZGluYXRlID0gY29tcHV0ZXIuYXR0YWNrKHBsYXllckdhbWVib2FyZCk7XG4gICAgICBjb25zdCBhdHRhY2tlZFNoaXAgPSBwbGF5ZXJHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcbiAgICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7XG4gICAgICBjb25zdCBjb2wgPSBjb29yZGluYXRlWzBdLmNoYXJDb2RlQXQoMCkgLSA2NTtcblxuICAgICAgY29uc3Qgc3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgYC5nYW1lYm9hcmQucGxheWVyIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICk7XG5cbiAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICAgIGNvbnNvbGUubG9nKGBDb21wdXRlciBoaXQgUGxheWVyIGF0OiAke2Nvb3JkaW5hdGV9YCk7XG5cbiAgICAgICAgaWYgKGF0dGFja2VkU2hpcC5pc1N1bmsoKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBDb21wdXRlciBzYW5rIFBsYXllcidzICR7YXR0YWNrZWRTaGlwfSFgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJtaXNzXCIpO1xuICAgICAgICBjb25zb2xlLmxvZyhgQ29tcHV0ZXIgbWlzc2VkIGF0OiAke2Nvb3JkaW5hdGV9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwbGF5ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgd2lubmVyID0gXCJUaGUgY29tcHV0ZXJcIjtcbiAgICAgICAgUmVuZGVyZXIuc2V0V2lubmVySGVhZGluZyh3aW5uZXIpO1xuICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSxcbiAgICAgICAgICBcInNob3dcIlxuICAgICAgICApO1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIHdpbnMhXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBwbGF5ZXJBdHRhY2sgPSAoZSkgPT4ge1xuICAgIGlmICghc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0O1xuICAgICAgY29uc3Qgcm93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBjb2wgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5jb2wsIDEwKTtcbiAgICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW3JvdywgY29sXSk7XG5cbiAgICAgIGlmICghY29tcHV0ZXJHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpKSB7XG4gICAgICAgIGNvbnN0IGF0dGFja2VkU2hpcCA9IGNvbXB1dGVyR2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG4gICAgICAgIGNvbnNvbGUubG9nKGF0dGFja2VkU2hpcCk7XG4gICAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgUGxheWVyIGhpdCBDb21wdXRlciBhdDogJHtjb29yZGluYXRlfWApO1xuXG4gICAgICAgICAgaWYgKGF0dGFja2VkU2hpcC5pc1N1bmsoKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFBsYXllciBzYW5rIENvbXB1dGVyJ3MgJHthdHRhY2tlZFNoaXB9IWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICAgICAgY29uc29sZS5sb2coYFBsYXllciBtaXNzZWQgYXQ6ICR7Y29vcmRpbmF0ZX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb21wdXRlckdhbWVib2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICAgIHdpbm5lciA9IFwiWW91XCI7XG4gICAgICAgICAgUmVuZGVyZXIuc2V0V2lubmVySGVhZGluZyh3aW5uZXIpO1xuICAgICAgICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmVuZGdhbWVcIiksXG4gICAgICAgICAgICBcInNob3dcIlxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJQbGF5ZXIgd2lucyFcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb21wdXRlckF0dGFjaygpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByb3RhdGVTaGlwcyA9ICgpID0+IHtcbiAgICBpc1ZlcnRpY2FsID0gIWlzVmVydGljYWw7XG4gIH07XG5cbiAgY29uc3QgZXZlbnRMaXN0ZW5lcnMgPSBbXG4gICAgeyBldmVudFR5cGU6IFwibW91c2VvdmVyXCIsIGhhbmRsZXI6IGdhbWVib2FyZEhvdmVySGFuZGxlciB9LFxuICAgIHsgZXZlbnRUeXBlOiBcIm1vdXNlbGVhdmVcIiwgaGFuZGxlcjogZ2FtZWJvYXJkTW91c2VMZWF2ZUhhbmRsZXIgfSxcbiAgICB7IGV2ZW50VHlwZTogXCJjbGlja1wiLCBoYW5kbGVyOiBzaGlwUGxhY2VtZW50SGFuZGxlciB9LFxuICBdO1xuXG4gIGNvbnN0IHJlc2V0R2FtZSA9ICgpID0+IHtcbiAgICAvLyBSZXNldCBnYW1lLXJlbGF0ZWQgdmFyaWFibGVzXG4gICAgY3VycmVudFNoaXBJbmRleCA9IDA7XG4gICAgc2hpcFBsYWNlbWVudE1vZGUgPSB0cnVlO1xuICAgIGlzVmVydGljYWwgPSBmYWxzZTtcbiAgICB3aW5uZXIgPSBudWxsO1xuXG4gICAgLy8gUmVzZXQgZ2FtZWJvYXJkIG9iamVjdHNcbiAgICBwbGF5ZXJHYW1lYm9hcmQucmVzZXQoKTtcbiAgICBjb21wdXRlckdhbWVib2FyZC5yZXNldCgpO1xuXG4gICAgLy8gQ2xlYXIgcGxheWVyIG9iamVjdHMgYXR0YWNrZWRDb29yZGluYXRlcyBzZXRcbiAgICBjb21wdXRlci5jbGVhclNldCgpO1xuXG4gICAgLy8gUmVtb3ZlIGhpdCBhbmQgbWlzcyBjbGFzc2VzIGZyb20gYWxsIHNxdWFyZXNcbiAgICBSZW5kZXJlci5jbGVhckdhbWVib2FyZChcIi5nYW1lYm9hcmQuaW5pdGlhbFwiKTtcbiAgICBSZW5kZXJlci5jbGVhckdhbWVib2FyZChcIi5nYW1lYm9hcmQucGxheWVyXCIpO1xuICAgIFJlbmRlcmVyLmNsZWFyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5jb21wdXRlclwiKTtcblxuICAgIC8vIFJlc2V0IHNoaXBUeXBlc1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gc2hpcFR5cGVzWzBdLnR5cGU7XG4gIH07XG5cbiAgY29uc3QgaW5pdCA9ICgpID0+IHtcbiAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSwgXCJoaWRlXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuaW5pdGlhbFwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLnBsYXllclwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmNvbXB1dGVyXCIpO1xuICAgIFJlbmRlcmVyLmF0dGFjaEV2ZW50TGlzdGVuZXJzKFwiLmdhbWVib2FyZC5pbml0aWFsXCIsIGV2ZW50TGlzdGVuZXJzKTtcblxuICAgIGNvbnN0IGNvbXB1dGVyU3F1YXJlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXG4gICAgICBcIi5nYW1lYm9hcmQuY29tcHV0ZXIgLnNxdWFyZVwiXG4gICAgKTtcbiAgICBjb21wdXRlclNxdWFyZXMuZm9yRWFjaCgoc3F1YXJlKSA9PiB7XG4gICAgICBzcXVhcmUuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHBsYXllckF0dGFjayk7XG4gICAgfSk7XG5cbiAgICBjb25zdCByb3RhdGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JvdGF0ZUJ0blwiKTtcbiAgICByb3RhdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJvdGF0ZVNoaXBzKTtcblxuICAgIGNvbnN0IHBsYXlBZ2FpbkJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3R2FtZVwiKTtcbiAgICBwbGF5QWdhaW5CdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHJlc2V0R2FtZSgpO1xuICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmVuZGdhbWVcIiksIFwiaGlkZVwiKTtcbiAgICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLCBcInNob3dcIik7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBpbml0LFxuICB9O1xufSkoKTtcblxuQ29udHJvbGxlci5pbml0KCk7XG4iLCJpbXBvcnQgeyBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5cbmV4cG9ydCBjb25zdCBTaGlwRmFjdG9yeSA9IChsZW5ndGgpID0+IHtcbiAgbGV0IGhpdHMgPSAwO1xuXG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBoaXRzICs9IDE7XG4gIH07XG5cbiAgY29uc3QgaXNTdW5rID0gKCkgPT4gaGl0cyA+PSBsZW5ndGg7IC8vIFJldHVybiB0cnVlIGlmIGhpdHMgaXMgZXF1YWwgdG8gb3IgZ3JlYXRlciB0aGFuIGxlbmd0aFxuXG4gIHJldHVybiB7XG4gICAgbGVuZ3RoLFxuICAgIGhpdCxcbiAgICBpc1N1bmssXG4gICAgZ2V0IGhpdHMoKSB7XG4gICAgICAvLyBHZXR0ZXIgZnVuY3Rpb24gZm9yIGhpdHMuIFVzaW5nIGZ1bmN0aW9uIGRlY2xhcmF0aW9uIHRvIGVuc3VyZSBpdCBoYXMgYWNjZXNzIHRvIHRoZVxuICAgICAgLy8gYGhpdHNgIHZhcmlhYmxlIGR5bmFtaWNhbGx5LCBzaW5jZSBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgYXJlIGhvaXN0ZWQgYW5kIGNhbiBiZSB1c2VkXG4gICAgICAvLyBiZWZvcmUgdGhleSBhcmUgZGVmaW5lZC4gVGhpcyBhbGxvd3MgYWNjZXNzaW5nIHRoZSBjdXJyZW50IHZhbHVlIG9mIGBoaXRzYCBldmVuIGJlZm9yZVxuICAgICAgLy8gY2FsbGluZyB0aGUgYGhpdGAgZnVuY3Rpb25cbiAgICAgIHJldHVybiBoaXRzO1xuICAgIH0sXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgR2FtZWJvYXJkRmFjdG9yeSA9ICgpID0+IHtcbiAgY29uc3QgZ3JpZFNpemUgPSAxMDtcbiAgY29uc3QgZ3JpZCA9IEFycmF5LmZyb20oeyBsZW5ndGg6IGdyaWRTaXplIH0sICgpID0+XG4gICAgQXJyYXkoZ3JpZFNpemUpLmZpbGwobnVsbClcbiAgKTtcblxuICBsZXQgYXR0YWNrZWRDb29yZGluYXRlcyA9IFtdO1xuICBsZXQgbWlzc2VkQXR0YWNrcyA9IFtdO1xuXG4gIGNvbnN0IGdldEdyaWQgPSAoKSA9PiBncmlkO1xuXG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb29yZGluYXRlcykgPT4ge1xuICAgIC8vIENoZWNrIGlmIGFsbCBjb29yZGluYXRlcyBhcmUgd2l0aGluIHRoZSBib3VuZGFyaWVzIG9mIHRoZSBncmlkXG4gICAgY29uc3Qgd2l0aGluQm91bmRhcmllcyA9IGNvb3JkaW5hdGVzLmV2ZXJ5KFxuICAgICAgKFtyb3csIGNvbF0pID0+XG4gICAgICAgIHJvdyA+IDAgJiYgcm93IDwgZ3JpZFNpemUgLSAxICYmIGNvbCA+IDAgJiYgY29sIDwgZ3JpZFNpemUgLSAxXG4gICAgKTtcblxuICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgY29uZmxpY3RzIHdpdGggZXhpc3Rpbmcgc2hpcCBwbGFjZW1lbnRzIG9uIHRoZSBncmlkXG4gICAgY29uc3QgY29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4gZ3JpZFtyb3ddW2NvbF0gIT09IG51bGwpO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBhZGphY2VudCBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBhZGphY2VudENvbmZsaWN0cyA9IGNvb3JkaW5hdGVzLnNvbWUoKFtyb3csIGNvbF0pID0+IHtcbiAgICAgIC8vIERlZmluZSB0aGUgYWRqYWNlbnQgY29vcmRpbmF0ZXMgYXJvdW5kIHRoZSBjdXJyZW50IGNvb3JkaW5hdGVcbiAgICAgIGNvbnN0IGFkamFjZW50Q29vcmRpbmF0ZXMgPSBbXG4gICAgICAgIFtyb3cgLSAxLCBjb2xdLCAvLyBVcFxuICAgICAgICBbcm93ICsgMSwgY29sXSwgLy8gRG93blxuICAgICAgICBbcm93LCBjb2wgLSAxXSwgLy8gTGVmdFxuICAgICAgICBbcm93LCBjb2wgKyAxXSwgLy8gUmlnaHRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCAtIDFdLCAvLyBEaWFnb25hbCBVcC1MZWZ0XG4gICAgICAgIFtyb3cgLSAxLCBjb2wgKyAxXSwgLy8gRGlhZ29uYWwgVXAtUmlnaHRcbiAgICAgICAgW3JvdyArIDEsIGNvbCAtIDFdLCAvLyBEaWFnb25hbCBEb3duLUxlZnRcbiAgICAgICAgW3JvdyArIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBEb3duLVJpZ2h0XG4gICAgICBdO1xuXG4gICAgICAvLyBDaGVjayBpZiBhbnkgYWRqYWNlbnQgY29vcmRpbmF0ZSBoYXMgYSBzaGlwIHBsYWNlZCBvbiBpdFxuICAgICAgcmV0dXJuIGFkamFjZW50Q29vcmRpbmF0ZXMuc29tZShcbiAgICAgICAgKFthZGpSb3csIGFkakNvbF0pID0+XG4gICAgICAgICAgYWRqUm93ID49IDAgJiZcbiAgICAgICAgICBhZGpSb3cgPCBncmlkU2l6ZSAmJlxuICAgICAgICAgIGFkakNvbCA+PSAwICYmXG4gICAgICAgICAgYWRqQ29sIDwgZ3JpZFNpemUgJiZcbiAgICAgICAgICBncmlkW2FkalJvd10/LlthZGpDb2xdICE9PSBudWxsXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgLy8gSWYgdGhlIHNoaXAgcGxhY2VtZW50IGlzIHdpdGhpbiBncmlkIGJvdW5kYXJpZXMsIGhhcyBubyBjb25mbGljdHMsIGFuZCBubyBhZGphY2VudCBjb25mbGljdHMuLi5cbiAgICBpZiAod2l0aGluQm91bmRhcmllcyAmJiAhY29uZmxpY3RzICYmICFhZGphY2VudENvbmZsaWN0cykge1xuICAgICAgLy8gQ3JlYXRlIGFuIG9iamVjdCBjb250YWluaW5nIHNoaXAgaW5mb3JtYXRpb24gYW5kIGNvb3JkaW5hdGVzXG4gICAgICBjb25zdCBzaGlwSW5mbyA9IHtcbiAgICAgICAgc2hpcCxcbiAgICAgICAgY29vcmRpbmF0ZXMsXG4gICAgICB9O1xuXG4gICAgICAvLyBQbGFjZSB0aGUgc2hpcCBvbiB0aGUgZ3JpZCBieSB1cGRhdGluZyB0aGUgY29ycmVzcG9uZGluZyBjZWxsc1xuICAgICAgc2hpcEluZm8uY29vcmRpbmF0ZXMuZm9yRWFjaCgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgICBncmlkW3Jvd11bY29sXSA9IHNoaXBJbmZvO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cnVlOyAvLyBTaGlwIHBsYWNlbWVudCBzdWNjZXNzZnVsXG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBPdGhlcndpc2UsIHNoaXAgcGxhY2VtZW50IGZhaWxlZFxuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gW107XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBjZWxsIG9mIHRoZSBncmlkXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2VsbCBjb250YWlucyBhIHNoaXAgYW5kIGl0J3Mgbm90IGFscmVhZHkgaW5jbHVkZWQgaW4gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjZWxsICE9PSBudWxsICYmXG4gICAgICAgICAgY2VsbC5zaGlwICYmXG4gICAgICAgICAgIXNoaXBzLmluY2x1ZGVzKGNlbGwuc2hpcCkgJiZcbiAgICAgICAgICAhY2VsbC5zaGlwLmlzU3VuaygpXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIEFkZCB0aGUgc2hpcCB0byB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgICBzaGlwcy5wdXNoKGNlbGwuc2hpcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gc2hpcHM7XG4gIH07XG5cbiAgY29uc3QgZ2V0QWxsU2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGNvbnRhaW5zIGEgc2hpcCBhbmQgaXQncyBub3QgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgaWYgKGNlbGwgIT09IG51bGwgJiYgY2VsbC5zaGlwICYmICFzaGlwcy5pbmNsdWRlcyhjZWxsLnNoaXApKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSBzaGlwIHRvIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICAgIHNoaXBzLnB1c2goY2VsbC5zaGlwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKHNoaXBzKTtcbiAgICByZXR1cm4gc2hpcHM7XG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcENvb3JkaW5hdGVzID0gKHNoaXApID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgZXhpc3RzIGFuZCBjb250YWlucyB0aGUgc3BlY2lmaWVkIHNoaXBcbiAgICAgICAgaWYgKGNlbGwgJiYgY2VsbC5zaGlwID09PSBzaGlwKSB7XG4gICAgICAgICAgLy8gQ29udmVydCB0aGUgcm93IGFuZCBjb2x1bW4gaW5kaWNlcyB0byBhbHBoYW51bWVyaWMgY29vcmRpbmF0ZXMgYW5kIGFkZCB0aGVtIHRvXG4gICAgICAgICAgLy8gdGhlIGNvb3JkaW5hdGVzIGFycmF5XG4gICAgICAgICAgY29vcmRpbmF0ZXMucHVzaChGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW3JvdywgY29sXSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzO1xuICB9O1xuXG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IFtjb2x1bW5MZXR0ZXIsIHJvd051bWJlcl0gPSBjb29yZGluYXRlO1xuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KHJvd051bWJlciwgMTApIC0gMTtcbiAgICBjb25zdCBjb2wgPSBjb2x1bW5MZXR0ZXIuY2hhckNvZGVBdCgwKSAtIDY1O1xuICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcblxuICAgIGlmIChjZWxsICE9PSBudWxsKSB7XG4gICAgICAvLyBTaGlwIGF0IGNvb3JkaW5hdGUsIGl0J3MgYSBoaXRcbiAgICAgIGNvbnN0IHsgc2hpcCB9ID0gY2VsbDtcbiAgICAgIHNoaXAuaGl0KCk7IC8vIEluY3JlbWVudCBoaXQgY291bnQgb2YgdGhlIHNoaXBcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMucHVzaChjb29yZGluYXRlKTtcbiAgICAgIHJldHVybiBzaGlwOyAvLyBSZXR1cm4gdGhlIHNoaXAgb2JqZWN0IHdoZW4gaXQgaXMgaGl0XG4gICAgfVxuICAgIC8vIE5vIHNoaXAgYXQgY29vcmRpbmF0ZSwgaXQncyBhIG1pc3NcbiAgICBtaXNzZWRBdHRhY2tzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5wdXNoKGNvb3JkaW5hdGUpO1xuICAgIHJldHVybiBudWxsOyAvLyBSZXR1cm4gbnVsbCB3aGVuIGl0J3MgYSBtaXNzXG4gIH07XG5cbiAgY29uc3QgYWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBzID0gZ2V0U2hpcHMoKTsgLy8gUmV0cmlldmUgYWxsIHRoZSBzaGlwcyBvbiB0aGUgZ2FtZWJvYXJkXG5cbiAgICAvLyBDaGVjayBpZiBhbGwgc2hpcHMgYXJlIHN1bmssIHJldHVybiB0cnVlIGlmIHllcywgYW5kIHJldHVybiBmYWxzZSBpZiBub1xuICAgIGNvbnN0IHJlc3VsdCA9IHNoaXBzLmV2ZXJ5KChzaGlwKSA9PiBzaGlwLmlzU3VuaygpKTtcblxuICAgIGNvbnNvbGUubG9nKFwiQWxsIHNoaXBzIHN1bms6XCIsIHJlc3VsdCk7IC8vIExvZyB0aGUgcmVzdWx0IHRvIHRlc3RcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgY29uc3QgcmVzZXQgPSAoKSA9PiB7XG4gICAgLy8gQ2xlYXIgdGhlIGdyaWQgYnkgc2V0dGluZyBhbGwgY2VsbHMgdG8gbnVsbFxuICAgIGdyaWQuZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4ge1xuICAgICAgcm93LmZvckVhY2goKF8sIGNvbEluZGV4KSA9PiB7XG4gICAgICAgIGdyaWRbcm93SW5kZXhdW2NvbEluZGV4XSA9IG51bGw7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIFJlYXNzaWduIGVtcHR5IGFycmF5cyB0byBjbGVhciB0aGUgY29udGVudHMgb2YgYXR0YWNrZWRDb29yZGluYXRlcyBhbmQgbWlzc2VkQXR0YWNrc1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICBtaXNzZWRBdHRhY2tzID0gW107XG4gIH07XG5cbiAgY29uc3QgZ2V0TWlzc2VkQXR0YWNrcyA9ICgpID0+IG1pc3NlZEF0dGFja3M7XG5cbiAgY29uc3QgZ2V0QXR0YWNrZWRDb29yZGluYXRlcyA9ICgpID0+IGF0dGFja2VkQ29vcmRpbmF0ZXM7XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRHcmlkLFxuICAgIHBsYWNlU2hpcCxcbiAgICBnZXRTaGlwcyxcbiAgICBnZXRBbGxTaGlwcyxcbiAgICBnZXRTaGlwQ29vcmRpbmF0ZXMsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBnZXRNaXNzZWRBdHRhY2tzLFxuICAgIGdldEF0dGFja2VkQ29vcmRpbmF0ZXMsXG4gICAgYWxsU2hpcHNTdW5rLFxuICAgIHJlc2V0LFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IFBsYXllckZhY3RvcnkgPSAobmFtZSkgPT4ge1xuICBjb25zdCBhdHRhY2tlZENvb3JkaW5hdGVzID0gbmV3IFNldCgpOyAvLyBTZXQgdG8ga2VlcCB0cmFjayBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuXG4gIGNvbnN0IGF0dGFjayA9IChlbmVteUdhbWVib2FyZCkgPT4ge1xuICAgIGNvbnN0IGdyaWRTaXplID0gZW5lbXlHYW1lYm9hcmQuZ2V0R3JpZCgpLmxlbmd0aDtcbiAgICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gRmFjdG9yeUhlbHBlcnMuZ2V0QWxsVmFsaWRDb29yZGluYXRlcyhncmlkU2l6ZSk7XG5cbiAgICBsZXQgY29vcmRpbmF0ZSA9IFwiXCI7XG5cbiAgICAvLyBQZXJmb3JtIGEgZG8td2hpbGUgbG9vcCB1bnRpbCBhIHVuaXF1ZSBjb29yZGluYXRlIGlzIGZvdW5kXG4gICAgZG8ge1xuICAgICAgLy8gR2VuZXJhdGUgYSByYW5kb20gaW5kZXggYmFzZWQgb24gdGhlIGxlbmd0aCBvZiB2YWxpZENvb3JkaW5hdGVzIGFycmF5XG4gICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHZhbGlkQ29vcmRpbmF0ZXMubGVuZ3RoKTtcblxuICAgICAgLy8gR2V0IHRoZSBjb29yZGluYXRlIGF0IHRoZSByYW5kb20gaW5kZXhcbiAgICAgIGNvb3JkaW5hdGUgPSB2YWxpZENvb3JkaW5hdGVzW3JhbmRvbUluZGV4XTtcbiAgICB9IHdoaWxlIChcbiAgICAgIC8vIENvbnRpbnVlIGxvb3Bpbmcgd2l0aG91dCBwZXJmb3JtaW5nIGFueSBhY3Rpb25zIGlmIHRoZSBjb29yZGluYXRlIGlzIGFscmVhZHlcbiAgICAgIC8vIGluIHRoZSBwbGF5ZXJzIGF0dGFja2VkQ29vcmRpbmF0ZXMgc2V0IG9yIGlzIGluY2x1ZGVkIGluIHRoZSBlbmVteUdhbWVib2FyZHNcbiAgICAgIC8vIGF0dGFja2VkQ29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuaGFzKGNvb3JkaW5hdGUpIHx8XG4gICAgICBlbmVteUdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSlcbiAgICApO1xuXG4gICAgLy8gQWRkIHRoZSBhdHRhY2tlZCBjb29yZGluYXRlIHRvIHRoZSBwbGF5ZXJzIHNldCBvZiBhdHRhY2tlZCBjb29yZGluYXRlc1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMuYWRkKGNvb3JkaW5hdGUpO1xuXG4gICAgLy8gLy8gUGVyZm9ybSB0aGUgYXR0YWNrIG9uIHRoZSBlbmVteSBnYW1lYm9hcmRcbiAgICAvLyBlbmVteUdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuXG4gICAgcmV0dXJuIGNvb3JkaW5hdGU7IC8vIFJldHVybiB0aGUgY29vcmRpbmF0ZSBhcyBhbiBhcnJheVxuICB9O1xuXG4gIGNvbnN0IGdldEF0dGFja2VkU2V0ID0gKCkgPT4gYXR0YWNrZWRDb29yZGluYXRlcztcblxuICBjb25zdCBjbGVhclNldCA9ICgpID0+IHtcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmNsZWFyKCk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGF0dGFjayxcbiAgICBnZXRBdHRhY2tlZFNldCxcbiAgICBjbGVhclNldCxcbiAgfTtcbn07XG4iLCJleHBvcnQgY29uc3QgRmFjdG9yeUhlbHBlcnMgPSAoKCkgPT4ge1xuICBjb25zdCB2YWxpZENvb3JkaW5hdGVzID0gW107XG5cbiAgY29uc3QgY29udmVydFRvSW5kaWNlcyA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgY29sdW1uID0gY29vcmRpbmF0ZS5jaGFyQ29kZUF0KDApIC0gNjU7IC8vIENvbnZlcnQgY29sdW1uIGxldHRlciB0byBpbmRleFxuICAgIGNvbnN0IHJvdyA9IHBhcnNlSW50KGNvb3JkaW5hdGUuc2xpY2UoMSksIDEwKSAtIDE7IC8vIENvbnZlcnQgcm93IG51bWJlciB0byBpbmRleCB3aXRoIHJhZGl4IDEwXG4gICAgcmV0dXJuIFtyb3csIGNvbHVtbl07XG4gIH07XG5cbiAgY29uc3QgY29udmVydFRvQWxwaGFudW1lcmljID0gKFtyb3csIGNvbHVtbl0pID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2x1bW4gKyA2NSk7IC8vIENvbnZlcnQgY29sdW1uIGluZGV4IHRvIGxldHRlclxuICAgIHJldHVybiBjb29yZGluYXRlICsgKHJvdyArIDEpOyAvLyBDb252ZXJ0IHJvdyBpbmRleCB0byBudW1iZXJcbiAgfTtcblxuICBjb25zdCBnZXRBbGxWYWxpZENvb3JkaW5hdGVzID0gKGdyaWRTaXplKSA9PiB7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgYWxwaGFudW1lcmljQ29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbXG4gICAgICAgICAgcm93LFxuICAgICAgICAgIGNvbCxcbiAgICAgICAgXSk7XG4gICAgICAgIHZhbGlkQ29vcmRpbmF0ZXMucHVzaChhbHBoYW51bWVyaWNDb29yZGluYXRlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRDb29yZGluYXRlcztcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGNvbnZlcnRUb0luZGljZXMsXG4gICAgY29udmVydFRvQWxwaGFudW1lcmljLFxuICAgIGdldEFsbFZhbGlkQ29vcmRpbmF0ZXMsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgY29uc3QgQXBwSGVscGVycyA9ICgoKSA9PiB7XG4gIGNvbnN0IHRvZ2dsZU1vZGFsID0gKG1vZGFsLCBjaG9pY2UpID0+IHtcbiAgICBjb25zdCB0b2dnbGVkTW9kYWwgPSBtb2RhbDtcblxuICAgIGNvbnN0IG92ZXJsYXkgPSBtb2RhbC5jbG9zZXN0KFwiLm92ZXJsYXlcIik7XG4gICAgY29uc3QgZGlzcGxheVZhbHVlID0gY2hvaWNlID09PSBcInNob3dcIiA/IFwiZmxleFwiIDogXCJub25lXCI7XG5cbiAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gICAgdG9nZ2xlZE1vZGFsLnN0eWxlLmRpc3BsYXkgPSBkaXNwbGF5VmFsdWU7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICB0b2dnbGVNb2RhbCxcbiAgfTtcbn0pKCk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXygzODApO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzYpO1xuIl0sIm5hbWVzIjpbImNvbnRhaW5lckVsZW1lbnQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsInJvdyIsImNvbCIsInNxdWFyZSIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJkYXRhc2V0IiwiYXBwZW5kQ2hpbGQiLCJldmVudExpc3RlbmVycyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwibGlzdGVuZXIiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnRUeXBlIiwiaGFuZGxlciIsIndpbm5lciIsImNsYXNzTmFtZSIsInBsYXllckdhbWVib2FyZCIsImNvbXB1dGVyR2FtZWJvYXJkIiwiY29tcHV0ZXIiLCJzaGlwVHlwZXMiLCJ0eXBlIiwibGVuZ3RoIiwiY3VycmVudFNoaXBJbmRleCIsInNoaXBQbGFjZW1lbnRNb2RlIiwiaXNWZXJ0aWNhbCIsInBsYXllckF0dGFjayIsImUiLCJ0YXJnZXQiLCJwYXJzZUludCIsImNvb3JkaW5hdGUiLCJjb252ZXJ0VG9BbHBoYW51bWVyaWMiLCJnZXRBdHRhY2tlZENvb3JkaW5hdGVzIiwiaW5jbHVkZXMiLCJhdHRhY2tlZFNoaXAiLCJyZWNlaXZlQXR0YWNrIiwiY29uc29sZSIsImxvZyIsImlzU3VuayIsImFsbFNoaXBzU3VuayIsInRvZ2dsZU1vZGFsIiwiYXR0YWNrIiwic2xpY2UiLCJjaGFyQ29kZUF0IiwiY29tcHV0ZXJBdHRhY2siLCJyb3RhdGVTaGlwcyIsInN0YXJ0Um93Iiwic3RhcnRDb2wiLCJBcnJheSIsImZyb20iLCJfIiwiaSIsImluaXRpYWxTcXVhcmUiLCJob3ZlcmVkU3F1YXJlIiwicmVtb3ZlIiwic2hpcENvb3JkaW5hdGVzIiwic2hpcCIsInBsYWNlU2hpcCIsImNvbXB1dGVyU2hpcHMiLCJjb29yZGluYXRlcyIsInBsYWNlZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImoiLCJwdXNoIiwicGxhY2VDb21wdXRlclNoaXBzIiwic2V0VGltZW91dCIsIm5leHRTaGlwVHlwZSIsImluaXQiLCJyZXNldCIsImNsZWFyU2V0IiwiU2hpcEZhY3RvcnkiLCJoaXRzIiwiaGl0IiwiR2FtZWJvYXJkRmFjdG9yeSIsImdyaWRTaXplIiwiZ3JpZCIsImZpbGwiLCJhdHRhY2tlZENvb3JkaW5hdGVzIiwibWlzc2VkQXR0YWNrcyIsImdldFNoaXBzIiwic2hpcHMiLCJjZWxsIiwiZ2V0R3JpZCIsIndpdGhpbkJvdW5kYXJpZXMiLCJldmVyeSIsImNvbmZsaWN0cyIsInNvbWUiLCJhZGphY2VudENvbmZsaWN0cyIsImFkalJvdyIsImFkakNvbCIsInNoaXBJbmZvIiwiZ2V0QWxsU2hpcHMiLCJnZXRTaGlwQ29vcmRpbmF0ZXMiLCJjb2x1bW5MZXR0ZXIiLCJyb3dOdW1iZXIiLCJnZXRNaXNzZWRBdHRhY2tzIiwicmVzdWx0Iiwicm93SW5kZXgiLCJjb2xJbmRleCIsIlBsYXllckZhY3RvcnkiLCJuYW1lIiwiU2V0IiwiZW5lbXlHYW1lYm9hcmQiLCJ2YWxpZENvb3JkaW5hdGVzIiwiZ2V0QWxsVmFsaWRDb29yZGluYXRlcyIsImhhcyIsImdldEF0dGFja2VkU2V0IiwiY2xlYXIiLCJGYWN0b3J5SGVscGVycyIsImNvbnZlcnRUb0luZGljZXMiLCJjb2x1bW4iLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhbHBoYW51bWVyaWNDb29yZGluYXRlIiwiQXBwSGVscGVycyIsIm1vZGFsIiwiY2hvaWNlIiwidG9nZ2xlZE1vZGFsIiwiZGlzcGxheVZhbHVlIiwiY2xvc2VzdCIsInN0eWxlIiwiZGlzcGxheSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=