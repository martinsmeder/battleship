(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let r=0;r<10;r+=1){const o=document.createElement("div");o.classList.add("square"),o.dataset.row=e,o.dataset.col=r,t.appendChild(o)}},n=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))};var l=r(776);(()=>{const e=(0,l.Br)(),t=(0,l.Br)(),r=((0,l.oP)("computer"),[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}]);let s=0,c=!0,d=!1;const i=()=>{d=!d},h=[{eventType:"mouseover",handler:e=>{if(c){const t=e.target,o=parseInt(t.dataset.row,10),a=parseInt(t.dataset.col,10),{length:n}=r[s];Array.from({length:n},((e,t)=>{const r=d?o+t:o,n=d?a:a+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-row="${r}"][data-col="${n}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:a=>{if(c){const n=a.target,i=parseInt(n.dataset.row,10),h=parseInt(n.dataset.col,10),{length:u}=r[s],p=Array.from({length:u},((e,t)=>[d?i+t:i,d?h:h+t])),m=(0,l._V)(u);if(e.placeShip(m,p))if(n.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-row="${e}"][data-col="${t}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),s+=1,s===r.length)c=!1,(()=>{const e=r.map((e=>{const{length:r}=e;let o=[],a=!1;for(;!a;){const e=Math.floor(10*Math.random()),n=Math.floor(10*Math.random());d=Math.random()<.5,o=[],d?e+r-1<10&&(o=Array.from({length:r},((t,r)=>[e+r,n]))):n+r-1<10&&(o=Array.from({length:r},((t,r)=>[e,n+r]))),o.length>0&&(a=t.placeShip((0,l._V)(r),o))}return o.forEach((([e,t])=>{document.querySelector(`.gameboard.computer [data-row="${e}"][data-col="${t}"]`).classList.add("placed")})),{type:e.type,coordinates:o}}));console.log("Computer ships:",e)})(),setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=r[s].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),n(".gameboard.initial",h),document.querySelector("#rotateBtn").addEventListener("click",i)}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>n,_V:()=>a,oP:()=>l});var o=r(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},n=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null))),r=[],a=[],n=()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const a=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),n=o.some((([e,r])=>null!==t[e][r])),l=o.some((([r,o])=>[[r-1,o],[r+1,o],[r,o-1],[r,o+1],[r-1,o-1],[r-1,o+1],[r+1,o-1],[r+1,o+1]].some((([r,o])=>r>=0&&r<e&&o>=0&&o<e&&null!==t[r]?.[o]))));if(a&&!n&&!l){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:n,getShipCoordinates:r=>{const a=[];for(let n=0;n<e;n+=1)for(let l=0;l<e;l+=1){const e=t[n][l];e&&e.ship===r&&a.push(o.r.convertToAlphanumeric([n,l]))}return a},receiveAttack:e=>{const[n,l]=o.r.convertToIndices(e),s=t[n][l],c=s&&s.ship;c?c.hit():a.push(e),r.push(e)},getMissedAttacks:()=>a,getAttackedCoordinates:()=>r,allShipsSunk:()=>n().every((e=>e.isSunk()))}},l=e=>{const t=new Set;return{name:e,attack:e=>{const r=e.getGrid().length,a=o.r.getAllValidCoordinates(r);let n="";do{n=a[Math.floor(Math.random()*a.length)]}while(t.has(n)||e.getAttackedCoordinates().includes(n));t.add(n),e.receiveAttack(n)}}}},555:(e,t,r)=>{r.d(t,{U:()=>a,r:()=>o});const o=(()=>{const e=[];return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10)-1,t]},convertToAlphanumeric:([e,t])=>String.fromCharCode(t+65)+(e+1),getAllValidCoordinates:t=>{for(let r=0;r<t;r+=1)for(let a=0;a<t;a+=1){const t=o.convertToAlphanumeric([r,a]);e.push(t)}return e}}})(),a={toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVhrQixDQUFDbUQsRUFBT0MsS0FDMUIsTUFBTUMsRUFBZUYsRUFHZkcsRUFBMEIsU0FBWEYsRUFBb0IsT0FBUyxPQURsQ0QsRUFBTUksUUFBUSxZQUd0QkMsTUFBTUMsUUFBVUgsRUFDeEJELEVBQWFHLE1BQU1DLFFBQVVILENBQVksRSxHQzFDekNJLEVBQTJCLENBQUMsRUFHaEMsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYUUsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJFLEdBQVksQ0FHakRHLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CTCxHQUFVSSxFQUFRQSxFQUFPRCxRQUFTSixHQUcvQ0ssRUFBT0QsT0FDZixDQ3JCQUosRUFBb0JPLEVBQUksQ0FBQ0gsRUFBU0ksS0FDakMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYUixFQUFvQlUsRUFBRUYsRUFBWUMsS0FBU1QsRUFBb0JVLEVBQUVOLEVBQVNLLElBQzVFRSxPQUFPQyxlQUFlUixFQUFTSyxFQUFLLENBQUVJLFlBQVksRUFBTUMsSUFBS04sRUFBV0MsSUFFMUUsRUNORFQsRUFBb0JVLEVBQUksQ0FBQ0ssRUFBS0MsSUFBVUwsT0FBT00sVUFBVUMsZUFBZUMsS0FBS0osRUFBS0MsR0NFbEZoQixFQUFvQixLQUVNQSxFQUFvQixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9yZW5kZXIuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9hcHAuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy9mYWN0b3JpZXMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC8uL3NyYy91dGlscy5qcyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL2JhdHRsZXNoaXAvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGlzIG1vZHVsZSBjYW4gYmUgcmVzcG9uc2libGUgZm9yIHJlbmRlcmluZyBjb250ZW50IG9uIHRoZSBwYWdlLlxuLy8gSXQgY2FuIGluY2x1ZGUgZnVuY3Rpb25zIHRvIHVwZGF0ZSB0aGUgRE9NIGVsZW1lbnRzIHJlcHJlc2VudGluZyB0aGVcbi8vIGdhbWUgYm9hcmRzLCBzaGlwcywgYXR0YWNrcywgbWVzc2FnZXMsIGFuZCBvdGhlciBVSSBjb21wb25lbnRzLiBJdCBzaG91bGRcbi8vIGVuY2Fwc3VsYXRlIHRoZSBET00gbWFuaXB1bGF0aW9uIGNvZGUgYW5kIHByb3ZpZGUgYSBjbGVhbiBpbnRlcmZhY2UgZm9yXG4vLyB1cGRhdGluZyB0aGUgVUkgYmFzZWQgb24gdGhlIGdhbWUgc3RhdGUuIEl0IGNhbiBiZSB0aGUgYnJpZGdlIGJldHdlZW4gdGhlXG4vLyBnYW1lIGxvZ2ljIGFuZCB0aGUgYWN0dWFsIERPTSBtYW5pcHVsYXRpb24uXG5cbmNvbnN0IFJlbmRlcmVyID0gKCgpID0+IHtcbiAgY29uc3QgcmVuZGVyR2FtZWJvYXJkID0gKGNvbnRhaW5lckVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnRleHRDb250ZW50ID0gXCJcIjtcblxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDEwOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgMTA7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHNxdWFyZS5jbGFzc0xpc3QuYWRkKFwic3F1YXJlXCIpO1xuICAgICAgICBzcXVhcmUuZGF0YXNldC5yb3cgPSByb3c7XG4gICAgICAgIHNxdWFyZS5kYXRhc2V0LmNvbCA9IGNvbDtcblxuICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoc3F1YXJlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3QgYXR0YWNoRXZlbnRMaXN0ZW5lcnMgPSAoY29udGFpbmVyRWxlbWVudCwgZXZlbnRMaXN0ZW5lcnMpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lckVsZW1lbnQpO1xuXG4gICAgY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3F1YXJlXCIpLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgICAgZXZlbnRMaXN0ZW5lcnMuZm9yRWFjaCgobGlzdGVuZXIpID0+IHtcbiAgICAgICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIobGlzdGVuZXIuZXZlbnRUeXBlLCBsaXN0ZW5lci5oYW5kbGVyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgcmVuZGVyR2FtZWJvYXJkLFxuICAgIGF0dGFjaEV2ZW50TGlzdGVuZXJzLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgUmVuZGVyZXI7XG4iLCIvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbmltcG9ydCB7IEFwcEhlbHBlcnMsIEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCBSZW5kZXJlciBmcm9tIFwiLi9yZW5kZXJcIjtcbmltcG9ydCB7IFNoaXBGYWN0b3J5LCBHYW1lYm9hcmRGYWN0b3J5LCBQbGF5ZXJGYWN0b3J5IH0gZnJvbSBcIi4vZmFjdG9yaWVzXCI7XG5cbi8vIDEuIC0tLVxuLy8gMi4gLS0tXG4vLyAzLiBoYW5kbGUgcGxheWVyIGF0dGFja3Ncbi8vIDQuIGRpc3BsYXkgcGxheWVyIGF0dGFja3Ncbi8vIDUuIGhhbmRsZSBjb21wdXRlciBhdHRhY2tzXG4vLyA2LiBkaXNwbGF5IGNvbXB1dGVyIGF0dGFja3Ncbi8vIDcuIGhhbmRsZSB3aW5uZXJcbi8vIDguIGRpc3BsYXkgd2lubmVyXG5cbmNvbnN0IENvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmRGYWN0b3J5KCk7XG4gIGNvbnN0IGNvbXB1dGVyR2FtZWJvYXJkID0gR2FtZWJvYXJkRmFjdG9yeSgpO1xuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICBjb25zdCBjb21wdXRlciA9IFBsYXllckZhY3RvcnkoXCJjb21wdXRlclwiKTtcblxuICBjb25zdCBzaGlwVHlwZXMgPSBbXG4gICAgeyB0eXBlOiBcImNhcnJpZXJcIiwgbGVuZ3RoOiA1IH0sXG4gICAgeyB0eXBlOiBcImJhdHRsZXNoaXBcIiwgbGVuZ3RoOiA0IH0sXG4gICAgeyB0eXBlOiBcImRlc3Ryb3llclwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwic3VibWFyaW5lXCIsIGxlbmd0aDogMyB9LFxuICAgIHsgdHlwZTogXCJwYXRyb2wgYm9hdFwiLCBsZW5ndGg6IDIgfSxcbiAgXTtcblxuICBsZXQgY3VycmVudFNoaXBJbmRleCA9IDA7XG4gIGxldCBzaGlwUGxhY2VtZW50TW9kZSA9IHRydWU7XG4gIGxldCBpc1ZlcnRpY2FsID0gZmFsc2U7XG5cbiAgY29uc3QgcGxhY2VDb21wdXRlclNoaXBzID0gKCkgPT4ge1xuICAgIGNvbnN0IGNvbXB1dGVyU2hpcHMgPSBzaGlwVHlwZXMubWFwKChzaGlwVHlwZSkgPT4ge1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlO1xuICAgICAgbGV0IGNvb3JkaW5hdGVzID0gW107XG4gICAgICBsZXQgcGxhY2VkID0gZmFsc2U7XG5cbiAgICAgIHdoaWxlICghcGxhY2VkKSB7XG4gICAgICAgIGNvbnN0IHN0YXJ0Um93ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgICAgICBjb25zdCBzdGFydENvbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKTtcbiAgICAgICAgaXNWZXJ0aWNhbCA9IE1hdGgucmFuZG9tKCkgPCAwLjU7XG4gICAgICAgIGNvb3JkaW5hdGVzID0gW107XG5cbiAgICAgICAgaWYgKGlzVmVydGljYWwpIHtcbiAgICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBlbm91Z2ggc3BhY2UgdmVydGljYWxseVxuICAgICAgICAgIGlmIChzdGFydFJvdyArIGxlbmd0aCAtIDEgPCAxMCkge1xuICAgICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiBbXG4gICAgICAgICAgICAgIHN0YXJ0Um93ICsgaSxcbiAgICAgICAgICAgICAgc3RhcnRDb2wsXG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgZW5vdWdoIHNwYWNlIGhvcml6b250YWxseVxuICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1sb25lbHktaWZcbiAgICAgICAgICBpZiAoc3RhcnRDb2wgKyBsZW5ndGggLSAxIDwgMTApIHtcbiAgICAgICAgICAgIGNvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4gW1xuICAgICAgICAgICAgICBzdGFydFJvdyxcbiAgICAgICAgICAgICAgc3RhcnRDb2wgKyBpLFxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvb3JkaW5hdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBwbGFjZWQgPSBjb21wdXRlckdhbWVib2FyZC5wbGFjZVNoaXAoXG4gICAgICAgICAgICBTaGlwRmFjdG9yeShsZW5ndGgpLFxuICAgICAgICAgICAgY29vcmRpbmF0ZXNcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvb3JkaW5hdGVzLmZvckVhY2goKFtyb3csIGNvbF0pID0+IHtcbiAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICk7XG4gICAgICAgIHBsYWNlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7IHR5cGU6IHNoaXBUeXBlLnR5cGUsIGNvb3JkaW5hdGVzIH07XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhcIkNvbXB1dGVyIHNoaXBzOlwiLCBjb21wdXRlclNoaXBzKTtcbiAgfTtcblxuICBjb25zdCBzaGlwUGxhY2VtZW50SGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIGNvbnN0IGNvbCA9IGlzVmVydGljYWwgPyBzdGFydENvbCA6IHN0YXJ0Q29sICsgaTtcbiAgICAgICAgcmV0dXJuIFtyb3csIGNvbF07XG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc2hpcCA9IFNoaXBGYWN0b3J5KGxlbmd0aCk7XG4gICAgICBjb25zdCBwbGFjZWQgPSBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIHNoaXBDb29yZGluYXRlcyk7XG5cbiAgICAgIGlmIChwbGFjZWQpIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1yb3c9XCIke3Jvd31cIl1bZGF0YS1jb2w9XCIke2NvbH1cIl1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICBwbGFjZWRTcXVhcmUuY2xhc3NMaXN0LmFkZChcInBsYWNlZFwiKTtcbiAgICAgICAgICBjb25zdCBpbml0aWFsU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmluaXRpYWwgW2RhdGEtcm93PVwiJHtyb3d9XCJdW2RhdGEtY29sPVwiJHtjb2x9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjdXJyZW50U2hpcEluZGV4ICs9IDE7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRTaGlwSW5kZXggPT09IHNoaXBUeXBlcy5sZW5ndGgpIHtcbiAgICAgICAgICBzaGlwUGxhY2VtZW50TW9kZSA9IGZhbHNlO1xuICAgICAgICAgIHBsYWNlQ29tcHV0ZXJTaGlwcygpO1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChcbiAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5pbml0aWFsXCIpLFxuICAgICAgICAgICAgICBcImhpZGVcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IG5leHRTaGlwVHlwZSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XS50eXBlO1xuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gbmV4dFNoaXBUeXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICBjb25zdCBzcXVhcmUgPSBlLnRhcmdldDtcbiAgICAgIGNvbnN0IHN0YXJ0Um93ID0gcGFyc2VJbnQoc3F1YXJlLmRhdGFzZXQucm93LCAxMCk7XG4gICAgICBjb25zdCBzdGFydENvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IHNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiB7XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluaXRpYWxTcXVhcmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLmdhbWVib2FyZC5pbml0aWFsIFtkYXRhLXJvdz1cIiR7cm93fVwiXVtkYXRhLWNvbD1cIiR7Y29sfVwiXWBcbiAgICAgICAgICApLFxuICAgICAgICB9O1xuICAgICAgfSk7XG5cbiAgICAgIGhvdmVyZWRTcXVhcmVzLmZvckVhY2goKHsgaW5pdGlhbFNxdWFyZSB9KSA9PiB7XG4gICAgICAgIGlmIChpbml0aWFsU3F1YXJlKSB7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGhvdmVyZWRTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5nYW1lYm9hcmQgLmhvdmVyZWRcIik7XG4gICAgaG92ZXJlZFNxdWFyZXMuZm9yRWFjaCgoaG92ZXJlZFNxdWFyZSkgPT4ge1xuICAgICAgaG92ZXJlZFNxdWFyZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG92ZXJlZFwiKTtcbiAgICB9KTtcbiAgfTtcblxuICAvLyBjb25zdCBjb21wdXRlckdhbWVib2FyZENsaWNrSGFuZGxlciA9IChlKSA9PiB7XG4gIC8vICAgaWYgKCFzaGlwUGxhY2VtZW50TW9kZSkge1xuICAvLyAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7XG4gIC8vICAgICBjb25zdCByb3cgPSBwYXJzZUludChzcXVhcmUuZGF0YXNldC5yb3csIDEwKTtcbiAgLy8gICAgIGNvbnN0IGNvbCA9IHBhcnNlSW50KHNxdWFyZS5kYXRhc2V0LmNvbCwgMTApO1xuICAvLyAgICAgY29uc3QgY29vcmRpbmF0ZSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKTtcblxuICAvLyAgICAgaWYgKCFjb21wdXRlckdhbWVib2FyZC5nZXRBdHRhY2tlZENvb3JkaW5hdGVzKCkuaW5jbHVkZXMoY29vcmRpbmF0ZSkpIHtcbiAgLy8gICAgICAgY29tcHV0ZXJHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcbiAgLy8gICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJhdHRhY2tlZFwiKTtcbiAgLy8gICAgICAgY29uc29sZS5sb2coXCJjb21wdXRlckdhbWVib2FyZCBhdHRhY2tlZFwiKTtcblxuICAvLyAgICAgICBjb25zdCBzaGlwcyA9IGNvbXB1dGVyR2FtZWJvYXJkLmdldFNoaXBzKCk7XG4gIC8vICAgICAgIGNvbnN0IGF0dGFja2VkU2hpcCA9IHNoaXBzLmZpbmQoKHNoaXApID0+XG4gIC8vICAgICAgICAgY29tcHV0ZXJHYW1lYm9hcmQuZ2V0U2hpcENvb3JkaW5hdGVzKHNoaXApLmluY2x1ZGVzKGNvb3JkaW5hdGUpXG4gIC8vICAgICAgICk7XG5cbiAgLy8gICAgICAgaWYgKGF0dGFja2VkU2hpcCkge1xuICAvLyAgICAgICAgIGNvbnN0IHNoaXBDb29yZGluYXRlcyA9XG4gIC8vICAgICAgICAgICBjb21wdXRlckdhbWVib2FyZC5nZXRTaGlwQ29vcmRpbmF0ZXMoYXR0YWNrZWRTaGlwKTtcbiAgLy8gICAgICAgICBzaGlwQ29vcmRpbmF0ZXMuZm9yRWFjaCgoW3IsIGNdKSA9PiB7XG4gIC8vICAgICAgICAgICBjb25zdCBhdHRhY2tlZFNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIC8vICAgICAgICAgICAgIGAuZ2FtZWJvYXJkLmNvbXB1dGVyIFtkYXRhLXJvdz1cIiR7cn1cIl1bZGF0YS1jb2w9XCIke2N9XCJdYFxuICAvLyAgICAgICAgICAgKTtcblxuICAvLyAgICAgICAgICAgaWYgKGF0dGFja2VkU3F1YXJlKSB7XG4gIC8vICAgICAgICAgICAgIGF0dGFja2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gIC8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29tcHV0ZXIgc2hpcCBoaXRcIik7XG4gIC8vICAgICAgICAgICB9XG4gIC8vICAgICAgICAgfSk7XG5cbiAgLy8gICAgICAgICBpZiAoYXR0YWNrZWRTaGlwLmlzU3VuaygpKSB7XG4gIC8vICAgICAgICAgICBpZiAoY29tcHV0ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJQbGF5ZXIgd2lucyFcIik7XG4gIC8vICAgICAgICAgICB9IGVsc2Uge1xuICAvLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhgUGxheWVyIHNhbmsgdGhlICR7YXR0YWNrZWRTaGlwLmxlbmd0aH0tdW5pdCBzaGlwIWApO1xuICAvLyAgICAgICAgICAgfVxuICAvLyAgICAgICAgIH0gZWxzZSB7XG4gIC8vICAgICAgICAgICBjb25zb2xlLmxvZyhcIlBsYXllciBoaXQgYSBzaGlwIVwiKTtcbiAgLy8gICAgICAgICB9XG4gIC8vICAgICAgIH0gZWxzZSB7XG4gIC8vICAgICAgICAgY29uc29sZS5sb2coXCJQbGF5ZXIgbWlzc2VkIVwiKTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfVxuICAvLyAgIH1cbiAgLy8gfTtcblxuICBjb25zdCByb3RhdGVTaGlwcyA9ICgpID0+IHtcbiAgICBpc1ZlcnRpY2FsID0gIWlzVmVydGljYWw7XG4gIH07XG5cbiAgY29uc3QgZXZlbnRMaXN0ZW5lcnMgPSBbXG4gICAgeyBldmVudFR5cGU6IFwibW91c2VvdmVyXCIsIGhhbmRsZXI6IGdhbWVib2FyZEhvdmVySGFuZGxlciB9LFxuICAgIHsgZXZlbnRUeXBlOiBcIm1vdXNlbGVhdmVcIiwgaGFuZGxlcjogZ2FtZWJvYXJkTW91c2VMZWF2ZUhhbmRsZXIgfSxcbiAgICB7IGV2ZW50VHlwZTogXCJjbGlja1wiLCBoYW5kbGVyOiBzaGlwUGxhY2VtZW50SGFuZGxlciB9LFxuICBdO1xuXG4gIGNvbnN0IGluaXQgPSAoKSA9PiB7XG4gICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmVuZGdhbWVcIiksIFwiaGlkZVwiKTtcbiAgICBSZW5kZXJlci5yZW5kZXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmluaXRpYWxcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5wbGF5ZXJcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5jb21wdXRlclwiKTtcbiAgICBSZW5kZXJlci5hdHRhY2hFdmVudExpc3RlbmVycyhcIi5nYW1lYm9hcmQuaW5pdGlhbFwiLCBldmVudExpc3RlbmVycyk7XG5cbiAgICAvLyBjb25zdCBjb21wdXRlclNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxuICAgIC8vICAgXCIuZ2FtZWJvYXJkLmNvbXB1dGVyIC5zcXVhcmVcIlxuICAgIC8vICk7XG4gICAgLy8gY29tcHV0ZXJTcXVhcmVzLmZvckVhY2goKHNxdWFyZSkgPT4ge1xuICAgIC8vICAgc3F1YXJlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjb21wdXRlckdhbWVib2FyZENsaWNrSGFuZGxlcik7XG4gICAgLy8gfSk7XG5cbiAgICBjb25zdCByb3RhdGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3JvdGF0ZUJ0blwiKTtcbiAgICByb3RhdGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJvdGF0ZVNoaXBzKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gIH07XG59KSgpO1xuXG5Db250cm9sbGVyLmluaXQoKTtcblxuLy8gLy8gUGVyZm9ybSB0aGUgY29tcHV0ZXIncyB0dXJuXG4vLyBjb21wdXRlci5hdHRhY2socGxheWVyR2FtZWJvYXJkKTtcblxuLy8gY29uc3QgbWlzc2VkQXR0YWNrcyA9IGNvbXB1dGVyR2FtZWJvYXJkLmdldE1pc3NlZEF0dGFja3MoKTtcbi8vIG1pc3NlZEF0dGFja3MuZm9yRWFjaCgobWlzc2VkQXR0YWNrKSA9PiB7XG4vLyAgIGNvbnN0IG1pc3NlZFNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4vLyAgICAgYC5nYW1lYm9hcmQuY29tcHV0ZXIgW2RhdGEtY29vcmRpbmF0ZT1cIiR7bWlzc2VkQXR0YWNrfVwiXWBcbi8vICAgKTtcbi8vICAgbWlzc2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJtaXNzXCIpO1xuLy8gfSk7XG5cbi8vIGNvbnN0IGNvbXB1dGVyQXR0YWNrZWRDb29yZGluYXRlcyA9XG4vLyAgIGNvbXB1dGVyR2FtZWJvYXJkLmdldEF0dGFja2VkQ29vcmRpbmF0ZXMoKTtcbi8vIGNvbnN0IGxhc3RDb29yZGluYXRlID1cbi8vICAgY29tcHV0ZXJBdHRhY2tlZENvb3JkaW5hdGVzW2NvbXB1dGVyQXR0YWNrZWRDb29yZGluYXRlcy5sZW5ndGggLSAxXTtcbi8vIGNvbnN0IGF0dGFja2VkU2hpcE9uQ29tcHV0ZXIgPSBwbGF5ZXJHYW1lYm9hcmRcbi8vICAgLmdldFNoaXBzKClcbi8vICAgLmZpbmQoKHNoaXApID0+XG4vLyAgICAgY29tcHV0ZXJHYW1lYm9hcmQuZ2V0U2hpcENvb3JkaW5hdGVzKHNoaXApLmluY2x1ZGVzKGxhc3RDb29yZGluYXRlKVxuLy8gICApO1xuXG4vLyBpZiAoYXR0YWNrZWRTaGlwT25Db21wdXRlcikge1xuLy8gICBjb25zdCBzaGlwQ29vcmRpbmF0ZXMgPSBjb21wdXRlckdhbWVib2FyZC5nZXRTaGlwQ29vcmRpbmF0ZXMoXG4vLyAgICAgYXR0YWNrZWRTaGlwT25Db21wdXRlclxuLy8gICApO1xuLy8gICBzaGlwQ29vcmRpbmF0ZXMuZm9yRWFjaCgoY29vcmQpID0+IHtcbi8vICAgICBjb25zdCBhdHRhY2tlZFNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4vLyAgICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1jb29yZGluYXRlPVwiJHtjb29yZH1cIl1gXG4vLyAgICAgKTtcbi8vICAgICBhdHRhY2tlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwiaGl0XCIpO1xuLy8gICB9KTtcblxuLy8gICBpZiAoYXR0YWNrZWRTaGlwT25Db21wdXRlci5pc1N1bmsoKSkge1xuLy8gICAgIGlmIChjb21wdXRlckdhbWVib2FyZC5hbGxTaGlwc1N1bmsoKSkge1xuLy8gICAgICAgY29uc29sZS5sb2coXCJDb21wdXRlciB3aW5zIVwiKTtcbi8vICAgICB9IGVsc2Uge1xuLy8gICAgICAgY29uc29sZS5sb2coXG4vLyAgICAgICAgIGBDb21wdXRlciBzYW5rIHRoZSAke2F0dGFja2VkU2hpcE9uQ29tcHV0ZXIubGVuZ3RofS11bml0IHNoaXAhYFxuLy8gICAgICAgKTtcbi8vICAgICB9XG4vLyAgIH0gZWxzZSB7XG4vLyAgICAgY29uc29sZS5sb2coXCJDb21wdXRlciBoaXQgYSBzaGlwIVwiKTtcbi8vICAgfVxuLy8gfSBlbHNlIHtcbi8vICAgY29uc29sZS5sb2coXCJDb21wdXRlciBtaXNzZWQhXCIpO1xuLy8gfVxuIiwiaW1wb3J0IHsgRmFjdG9yeUhlbHBlcnMgfSBmcm9tIFwiLi91dGlsc1wiO1xuXG5leHBvcnQgY29uc3QgU2hpcEZhY3RvcnkgPSAobGVuZ3RoKSA9PiB7XG4gIGxldCBoaXRzID0gMDtcblxuICBjb25zdCBoaXQgPSAoKSA9PiB7XG4gICAgaGl0cyArPSAxO1xuICB9O1xuXG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IGhpdHMgPj0gbGVuZ3RoOyAvLyBSZXR1cm4gdHJ1ZSBpZiBoaXRzIGlzIGVxdWFsIHRvIG9yIGdyZWF0ZXIgdGhhbiBsZW5ndGhcblxuICByZXR1cm4ge1xuICAgIGxlbmd0aCxcbiAgICBoaXQsXG4gICAgaXNTdW5rLFxuICAgIGdldCBoaXRzKCkge1xuICAgICAgLy8gR2V0dGVyIGZ1bmN0aW9uIGZvciBoaXRzLiBVc2luZyBmdW5jdGlvbiBkZWNsYXJhdGlvbiB0byBlbnN1cmUgaXQgaGFzIGFjY2VzcyB0byB0aGVcbiAgICAgIC8vIGBoaXRzYCB2YXJpYWJsZSBkeW5hbWljYWxseSwgc2luY2UgZnVuY3Rpb24gZGVjbGFyYXRpb25zIGFyZSBob2lzdGVkIGFuZCBjYW4gYmUgdXNlZFxuICAgICAgLy8gYmVmb3JlIHRoZXkgYXJlIGRlZmluZWQuIFRoaXMgYWxsb3dzIGFjY2Vzc2luZyB0aGUgY3VycmVudCB2YWx1ZSBvZiBgaGl0c2AgZXZlbiBiZWZvcmVcbiAgICAgIC8vIGNhbGxpbmcgdGhlIGBoaXRgIGZ1bmN0aW9uXG4gICAgICByZXR1cm4gaGl0cztcbiAgICB9LFxuICB9O1xufTtcblxuZXhwb3J0IGNvbnN0IEdhbWVib2FyZEZhY3RvcnkgPSAoKSA9PiB7XG4gIGNvbnN0IGdyaWRTaXplID0gMTA7XG4gIGNvbnN0IGdyaWQgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBncmlkU2l6ZSB9LCAoKSA9PlxuICAgIEFycmF5KGdyaWRTaXplKS5maWxsKG51bGwpXG4gICk7XG5cbiAgY29uc3QgYXR0YWNrZWRDb29yZGluYXRlcyA9IFtdO1xuICBjb25zdCBtaXNzZWRBdHRhY2tzID0gW107XG5cbiAgY29uc3QgZ2V0R3JpZCA9ICgpID0+IGdyaWQ7XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgYWxsIGNvb3JkaW5hdGVzIGFyZSB3aXRoaW4gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIGdyaWRcbiAgICBjb25zdCB3aXRoaW5Cb3VuZGFyaWVzID0gY29vcmRpbmF0ZXMuZXZlcnkoXG4gICAgICAoW3JvdywgY29sXSkgPT4gcm93ID49IDAgJiYgcm93IDwgZ3JpZFNpemUgJiYgY29sID49IDAgJiYgY29sIDwgZ3JpZFNpemVcbiAgICApO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBjb25mbGljdHMgPSBjb29yZGluYXRlcy5zb21lKChbcm93LCBjb2xdKSA9PiBncmlkW3Jvd11bY29sXSAhPT0gbnVsbCk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGFkamFjZW50IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGFkamFjZW50Q29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgY29uc3QgYWRqYWNlbnRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3JvdyAtIDEsIGNvbF0sIC8vIFVwXG4gICAgICAgIFtyb3cgKyAxLCBjb2xdLCAvLyBEb3duXG4gICAgICAgIFtyb3csIGNvbCAtIDFdLCAvLyBMZWZ0XG4gICAgICAgIFtyb3csIGNvbCArIDFdLCAvLyBSaWdodFxuICAgICAgICBbcm93IC0gMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIFVwLUxlZnRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBVcC1SaWdodFxuICAgICAgICBbcm93ICsgMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIERvd24tTGVmdFxuICAgICAgICBbcm93ICsgMSwgY29sICsgMV0sIC8vIERpYWdvbmFsIERvd24tUmlnaHRcbiAgICAgIF07XG5cbiAgICAgIHJldHVybiBhZGphY2VudENvb3JkaW5hdGVzLnNvbWUoXG4gICAgICAgIChbYWRqUm93LCBhZGpDb2xdKSA9PlxuICAgICAgICAgIGFkalJvdyA+PSAwICYmXG4gICAgICAgICAgYWRqUm93IDwgZ3JpZFNpemUgJiZcbiAgICAgICAgICBhZGpDb2wgPj0gMCAmJlxuICAgICAgICAgIGFkakNvbCA8IGdyaWRTaXplICYmXG4gICAgICAgICAgZ3JpZFthZGpSb3ddPy5bYWRqQ29sXSAhPT0gbnVsbFxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIC8vIElmIHRoZSBzaGlwIHBsYWNlbWVudCBpcyB3aXRoaW4gZ3JpZCBib3VuZGFyaWVzLCBoYXMgbm8gY29uZmxpY3RzIGFuZCBubyBhZGphY2VudFxuICAgIC8vIGNvbmZsaWN0cy4uLlxuICAgIGlmICh3aXRoaW5Cb3VuZGFyaWVzICYmICFjb25mbGljdHMgJiYgIWFkamFjZW50Q29uZmxpY3RzKSB7XG4gICAgICAvLyBDcmVhdGUgYW4gb2JqZWN0IGNvbnRhaW5pbmcgc2hpcCBpbmZvcm1hdGlvbiBhbmQgY29vcmRpbmF0ZXNcbiAgICAgIGNvbnN0IHNoaXBJbmZvID0ge1xuICAgICAgICBzaGlwLFxuICAgICAgICBjb29yZGluYXRlcyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFBsYWNlIHRoZSBzaGlwIG9uIHRoZSBncmlkIGJ5IHVwZGF0aW5nIHRoZSBjb3JyZXNwb25kaW5nIGNlbGxzXG4gICAgICBzaGlwSW5mby5jb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgIGdyaWRbcm93XVtjb2xdID0gc2hpcEluZm87XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRydWU7IC8vIFNoaXAgcGxhY2VtZW50IHN1Y2Nlc3NmdWxcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIE90aGVyd2lzZSwgc2hpcCBwbGFjZW1lbnQgZmFpbGVkXG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGNvbnRhaW5zIGEgc2hpcCBhbmQgaXQncyBub3QgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNlbGwgIT09IG51bGwgJiZcbiAgICAgICAgICBjZWxsLnNoaXAgJiZcbiAgICAgICAgICAhc2hpcHMuaW5jbHVkZXMoY2VsbC5zaGlwKSAmJlxuICAgICAgICAgICFjZWxsLnNoaXAuaXNTdW5rKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSBzaGlwIHRvIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICAgIHNoaXBzLnB1c2goY2VsbC5zaGlwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzaGlwcztcbiAgfTtcblxuICBjb25zdCBnZXRTaGlwQ29vcmRpbmF0ZXMgPSAoc2hpcCkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGVzID0gW107XG5cbiAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBjZWxsIG9mIHRoZSBncmlkXG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2VsbCBleGlzdHMgYW5kIGNvbnRhaW5zIHRoZSBzcGVjaWZpZWQgc2hpcFxuICAgICAgICBpZiAoY2VsbCAmJiBjZWxsLnNoaXAgPT09IHNoaXApIHtcbiAgICAgICAgICAvLyBDb252ZXJ0IHRoZSByb3cgYW5kIGNvbHVtbiBpbmRpY2VzIHRvIGFscGhhbnVtZXJpYyBjb29yZGluYXRlcyBhbmQgYWRkIHRoZW0gdG9cbiAgICAgICAgICAvLyB0aGUgY29vcmRpbmF0ZXMgYXJyYXlcbiAgICAgICAgICBjb29yZGluYXRlcy5wdXNoKEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgW3JvdywgY29sXSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0luZGljZXMoY29vcmRpbmF0ZSk7XG4gICAgY29uc3QgY2VsbCA9IGdyaWRbcm93XVtjb2xdO1xuXG4gICAgY29uc3Qgc2hpcCA9IGNlbGwgJiYgY2VsbC5zaGlwOyAvLyBBY2Nlc3MgdGhlIHNoaXAgcHJvcGVydHkgb2YgdGhlIGNlbGwgb2JqZWN0XG5cbiAgICBpZiAoc2hpcCkge1xuICAgICAgc2hpcC5oaXQoKTsgLy8gSW5jcmVtZW50IGhpdCBjb3VudCBvZiB0aGUgc2hpcFxuICAgIH0gZWxzZSB7XG4gICAgICBtaXNzZWRBdHRhY2tzLnB1c2goY29vcmRpbmF0ZSk7IC8vIFJlY29yZCBtaXNzZWQgYXR0YWNrIGNvb3JkaW5hdGVzXG4gICAgfVxuXG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5wdXNoKGNvb3JkaW5hdGUpO1xuICB9O1xuXG4gIGNvbnN0IGdldE1pc3NlZEF0dGFja3MgPSAoKSA9PiBtaXNzZWRBdHRhY2tzO1xuXG4gIGNvbnN0IGdldEF0dGFja2VkQ29vcmRpbmF0ZXMgPSAoKSA9PiBhdHRhY2tlZENvb3JkaW5hdGVzO1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IGdldFNoaXBzKCk7IC8vIFJldHJpZXZlIGFsbCB0aGUgc2hpcHMgb24gdGhlIGdhbWVib2FyZFxuXG4gICAgLy8gQ2hlY2sgaWYgYWxsIHNoaXBzIGFyZSBzdW5rLCByZXR1cm4gdHJ1ZSBpZiB5ZXMsIGFuZCByZXR1cm4gZmFsc2UgaWYgbm9cbiAgICByZXR1cm4gc2hpcHMuZXZlcnkoKHNoaXApID0+IHNoaXAuaXNTdW5rKCkpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0R3JpZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgZ2V0U2hpcHMsXG4gICAgZ2V0U2hpcENvb3JkaW5hdGVzLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgZ2V0TWlzc2VkQXR0YWNrcyxcbiAgICBnZXRBdHRhY2tlZENvb3JkaW5hdGVzLFxuICAgIGFsbFNoaXBzU3VuayxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBQbGF5ZXJGYWN0b3J5ID0gKG5hbWUpID0+IHtcbiAgY29uc3QgYXR0YWNrZWRDb29yZGluYXRlcyA9IG5ldyBTZXQoKTsgLy8gU2V0IHRvIGtlZXAgdHJhY2sgb2YgYXR0YWNrZWQgY29vcmRpbmF0ZXNcblxuICBjb25zdCBhdHRhY2sgPSAoZW5lbXlHYW1lYm9hcmQpID0+IHtcbiAgICBjb25zdCBncmlkU2l6ZSA9IGVuZW15R2FtZWJvYXJkLmdldEdyaWQoKS5sZW5ndGg7XG4gICAgY29uc3QgdmFsaWRDb29yZGluYXRlcyA9IEZhY3RvcnlIZWxwZXJzLmdldEFsbFZhbGlkQ29vcmRpbmF0ZXMoZ3JpZFNpemUpO1xuXG4gICAgbGV0IGNvb3JkaW5hdGUgPSBcIlwiO1xuXG4gICAgLy8gUGVyZm9ybSBhIGRvLXdoaWxlIGxvb3AgdW50aWwgYSB1bmlxdWUgY29vcmRpbmF0ZSBpcyBmb3VuZFxuICAgIGRvIHtcbiAgICAgIC8vIEdlbmVyYXRlIGEgcmFuZG9tIGluZGV4IGJhc2VkIG9uIHRoZSBsZW5ndGggb2YgdmFsaWRDb29yZGluYXRlcyBhcnJheVxuICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZENvb3JkaW5hdGVzLmxlbmd0aCk7XG5cbiAgICAgIC8vIEdldCB0aGUgY29vcmRpbmF0ZSBhdCB0aGUgcmFuZG9tIGluZGV4XG4gICAgICBjb29yZGluYXRlID0gdmFsaWRDb29yZGluYXRlc1tyYW5kb21JbmRleF07XG4gICAgfSB3aGlsZSAoXG4gICAgICAvLyBDb250aW51ZSBsb29waW5nIHdpdGhvdXQgcGVyZm9ybWluZyBhbnkgYWN0aW9ucyBpZiB0aGUgY29vcmRpbmF0ZSBpcyBhbHJlYWR5XG4gICAgICAvLyBpbiB0aGUgcGxheWVycyBhdHRhY2tlZENvb3JkaW5hdGVzIHNldCBvciBpcyBpbmNsdWRlZCBpbiB0aGUgZW5lbXlHYW1lYm9hcmRzXG4gICAgICAvLyBhdHRhY2tlZENvb3JkaW5hdGVzIGFycmF5XG4gICAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmhhcyhjb29yZGluYXRlKSB8fFxuICAgICAgZW5lbXlHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpXG4gICAgKTtcblxuICAgIC8vIEFkZCB0aGUgYXR0YWNrZWQgY29vcmRpbmF0ZSB0byB0aGUgcGxheWVycyBzZXQgb2YgYXR0YWNrZWQgY29vcmRpbmF0ZXNcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmFkZChjb29yZGluYXRlKTtcblxuICAgIC8vIFBlcmZvcm0gdGhlIGF0dGFjayBvbiB0aGUgZW5lbXkgZ2FtZWJvYXJkXG4gICAgZW5lbXlHYW1lYm9hcmQucmVjZWl2ZUF0dGFjayhjb29yZGluYXRlKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIG5hbWUsXG4gICAgYXR0YWNrLFxuICB9O1xufTtcbiIsImV4cG9ydCBjb25zdCBGYWN0b3J5SGVscGVycyA9ICgoKSA9PiB7XG4gIGNvbnN0IHZhbGlkQ29vcmRpbmF0ZXMgPSBbXTtcblxuICBjb25zdCBjb252ZXJ0VG9JbmRpY2VzID0gKGNvb3JkaW5hdGUpID0+IHtcbiAgICBjb25zdCBjb2x1bW4gPSBjb29yZGluYXRlLmNoYXJDb2RlQXQoMCkgLSA2NTsgLy8gQ29udmVydCBjb2x1bW4gbGV0dGVyIHRvIGluZGV4XG4gICAgY29uc3Qgcm93ID0gcGFyc2VJbnQoY29vcmRpbmF0ZS5zbGljZSgxKSwgMTApIC0gMTsgLy8gQ29udmVydCByb3cgbnVtYmVyIHRvIGluZGV4IHdpdGggcmFkaXggMTBcbiAgICByZXR1cm4gW3JvdywgY29sdW1uXTtcbiAgfTtcblxuICBjb25zdCBjb252ZXJ0VG9BbHBoYW51bWVyaWMgPSAoW3JvdywgY29sdW1uXSkgPT4ge1xuICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvbHVtbiArIDY1KTsgLy8gQ29udmVydCBjb2x1bW4gaW5kZXggdG8gbGV0dGVyXG4gICAgcmV0dXJuIGNvb3JkaW5hdGUgKyAocm93ICsgMSk7IC8vIENvbnZlcnQgcm93IGluZGV4IHRvIG51bWJlclxuICB9O1xuXG4gIGNvbnN0IGdldEFsbFZhbGlkQ29vcmRpbmF0ZXMgPSAoZ3JpZFNpemUpID0+IHtcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBhbHBoYW51bWVyaWNDb29yZGluYXRlID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtcbiAgICAgICAgICByb3csXG4gICAgICAgICAgY29sLFxuICAgICAgICBdKTtcbiAgICAgICAgdmFsaWRDb29yZGluYXRlcy5wdXNoKGFscGhhbnVtZXJpY0Nvb3JkaW5hdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWxpZENvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY29udmVydFRvSW5kaWNlcyxcbiAgICBjb252ZXJ0VG9BbHBoYW51bWVyaWMsXG4gICAgZ2V0QWxsVmFsaWRDb29yZGluYXRlcyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBjb25zdCBBcHBIZWxwZXJzID0gKCgpID0+IHtcbiAgY29uc3QgdG9nZ2xlTW9kYWwgPSAobW9kYWwsIGNob2ljZSkgPT4ge1xuICAgIGNvbnN0IHRvZ2dsZWRNb2RhbCA9IG1vZGFsO1xuXG4gICAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLmNsb3Nlc3QoXCIub3ZlcmxheVwiKTtcbiAgICBjb25zdCBkaXNwbGF5VmFsdWUgPSBjaG9pY2UgPT09IFwic2hvd1wiID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcblxuICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlWYWx1ZTtcbiAgICB0b2dnbGVkTW9kYWwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlWYWx1ZTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHRvZ2dsZU1vZGFsLFxuICB9O1xufSkoKTtcbiIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fKDM4MCk7XG4vLyBUaGlzIGVudHJ5IG1vZHVsZSBpcyByZWZlcmVuY2VkIGJ5IG90aGVyIG1vZHVsZXMgc28gaXQgY2FuJ3QgYmUgaW5saW5lZFxudmFyIF9fd2VicGFja19leHBvcnRzX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc3Nik7XG4iXSwibmFtZXMiOlsiY29udGFpbmVyRWxlbWVudCIsImNvbnRhaW5lciIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInRleHRDb250ZW50Iiwicm93IiwiY29sIiwic3F1YXJlIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImRhdGFzZXQiLCJhcHBlbmRDaGlsZCIsImV2ZW50TGlzdGVuZXJzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJsaXN0ZW5lciIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudFR5cGUiLCJoYW5kbGVyIiwicGxheWVyR2FtZWJvYXJkIiwiY29tcHV0ZXJHYW1lYm9hcmQiLCJzaGlwVHlwZXMiLCJ0eXBlIiwibGVuZ3RoIiwiY3VycmVudFNoaXBJbmRleCIsInNoaXBQbGFjZW1lbnRNb2RlIiwiaXNWZXJ0aWNhbCIsInJvdGF0ZVNoaXBzIiwiZSIsInRhcmdldCIsInN0YXJ0Um93IiwicGFyc2VJbnQiLCJzdGFydENvbCIsIkFycmF5IiwiZnJvbSIsIl8iLCJpIiwiaW5pdGlhbFNxdWFyZSIsImhvdmVyZWRTcXVhcmUiLCJyZW1vdmUiLCJzaGlwQ29vcmRpbmF0ZXMiLCJzaGlwIiwicGxhY2VTaGlwIiwiY29tcHV0ZXJTaGlwcyIsIm1hcCIsInNoaXBUeXBlIiwiY29vcmRpbmF0ZXMiLCJwbGFjZWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjb25zb2xlIiwibG9nIiwicGxhY2VDb21wdXRlclNoaXBzIiwic2V0VGltZW91dCIsInRvZ2dsZU1vZGFsIiwibmV4dFNoaXBUeXBlIiwiaW5pdCIsIlNoaXBGYWN0b3J5IiwiaGl0cyIsImhpdCIsImlzU3VuayIsIkdhbWVib2FyZEZhY3RvcnkiLCJncmlkU2l6ZSIsImdyaWQiLCJmaWxsIiwiYXR0YWNrZWRDb29yZGluYXRlcyIsIm1pc3NlZEF0dGFja3MiLCJnZXRTaGlwcyIsInNoaXBzIiwiY2VsbCIsImluY2x1ZGVzIiwicHVzaCIsImdldEdyaWQiLCJ3aXRoaW5Cb3VuZGFyaWVzIiwiZXZlcnkiLCJjb25mbGljdHMiLCJzb21lIiwiYWRqYWNlbnRDb25mbGljdHMiLCJhZGpSb3ciLCJhZGpDb2wiLCJzaGlwSW5mbyIsImdldFNoaXBDb29yZGluYXRlcyIsImNvbnZlcnRUb0FscGhhbnVtZXJpYyIsInJlY2VpdmVBdHRhY2siLCJjb29yZGluYXRlIiwiY29udmVydFRvSW5kaWNlcyIsImdldE1pc3NlZEF0dGFja3MiLCJnZXRBdHRhY2tlZENvb3JkaW5hdGVzIiwiYWxsU2hpcHNTdW5rIiwiUGxheWVyRmFjdG9yeSIsIm5hbWUiLCJTZXQiLCJhdHRhY2siLCJlbmVteUdhbWVib2FyZCIsInZhbGlkQ29vcmRpbmF0ZXMiLCJnZXRBbGxWYWxpZENvb3JkaW5hdGVzIiwiaGFzIiwiRmFjdG9yeUhlbHBlcnMiLCJjb2x1bW4iLCJjaGFyQ29kZUF0Iiwic2xpY2UiLCJTdHJpbmciLCJmcm9tQ2hhckNvZGUiLCJhbHBoYW51bWVyaWNDb29yZGluYXRlIiwiQXBwSGVscGVycyIsIm1vZGFsIiwiY2hvaWNlIiwidG9nZ2xlZE1vZGFsIiwiZGlzcGxheVZhbHVlIiwiY2xvc2VzdCIsInN0eWxlIiwiZGlzcGxheSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsImV4cG9ydHMiLCJtb2R1bGUiLCJfX3dlYnBhY2tfbW9kdWxlc19fIiwiZCIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCJdLCJzb3VyY2VSb290IjoiIn0=