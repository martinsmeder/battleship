(()=>{"use strict";var e={380:(e,t,r)=>{var o=r(555);const a=e=>{const t=document.querySelector(e);t.textContent="";for(let e=0;e<10;e+=1)for(let r=0;r<10;r+=1){const a=o.r.convertToAlphanumeric([e,r]),n=document.createElement("div");n.classList.add("square"),n.dataset.coordinate=a,t.appendChild(n)}},n=(e,t)=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{t.forEach((t=>{e.addEventListener(t.eventType,t.handler)}))}))},l=e=>{document.querySelector("#winner").textContent=`${e} won!`},c=e=>{document.querySelector(e).querySelectorAll(".square").forEach((e=>{e.className="square"}))};var s=r(776);(()=>{const e=(0,s.Br)(),t=(0,s.Br)(),r=(0,s.oP)("computer");let d=0,i=!0,u=!1,h=null;const p=a=>{if(!i){const n=a.target,c=n.dataset.coordinate;console.log(`playerAttack() at: ${c}`),t.getAttackedCoordinates().includes(c)||(t.receiveAttack(c)?n.classList.add("hit"):n.classList.add("miss"),t.allShipsSunk()&&(h="You",l(h),o.U.toggleModal(document.querySelector(".modal.endgame"),"show")),(()=>{if(!i){const t=r.attack(e),a=e.receiveAttack(t);console.log(`computerAttack() at: ${t}`);const n=document.querySelector(`.gameboard.player [data-coordinate="${t}"]`);a?n.classList.add("hit"):n.classList.add("miss"),e.allShipsSunk()&&(h="The computer",l(h),o.U.toggleModal(document.querySelector(".modal.endgame"),"show"))}})())}},m=()=>{u=!u},g=[{eventType:"mouseover",handler:e=>{if(i){const t=e.target.dataset.coordinate,{length:r}=o.U.shipTypes[d],[a,n]=o.r.convertToIndices(t);Array.from({length:r},((e,t)=>{const r=u?a+t:a,l=u?n:n+t;return{initialSquare:document.querySelector(`.gameboard.initial [data-coordinate="${o.r.convertToAlphanumeric([r,l])}"]`)}})).forEach((({initialSquare:e})=>{e&&e.classList.add("hovered")}))}}},{eventType:"mouseleave",handler:()=>{document.querySelectorAll(".gameboard .hovered").forEach((e=>{e.classList.remove("hovered")}))}},{eventType:"click",handler:r=>{if(i){const a=r.target,{coordinate:n}=a.dataset,{length:l}=o.U.shipTypes[d],[c,h]=o.r.convertToIndices(n),p=Array.from({length:l},((e,t)=>[u?c+t:c,u?h:h+t])),m=(0,s._V)(l);if(e.placeShip(m,p))if(a.classList.add("placed"),p.forEach((([e,t])=>{document.querySelector(`[data-coordinate="${o.r.convertToAlphanumeric([e,t])}"]`).classList.add("placed"),document.querySelector(`.gameboard.initial [data-coordinate="${o.r.convertToAlphanumeric([e,t])}"]`).classList.add("placed")})),d+=1,d===o.U.shipTypes.length)i=!1,(()=>{for(const e of o.U.shipTypes){const{length:r}=e,a=(0,s._V)(r),n=10;let l,c=!1;for(;!c;){const e=Math.floor(Math.random()*n),o=Math.floor(Math.random()*n);u=Math.random()<.5,u&&e+r<=n?l=Array.from({length:r},((t,r)=>[e+r,o])):!u&&o+r<=n&&(l=Array.from({length:r},((t,r)=>[e,o+r]))),l&&(c=t.placeShip(a,l))}const d=t.getShipCoordinates(a);for(const[e,t]of d){const r=o.r.convertToAlphanumeric([e,t]);document.querySelector(`.gameboard.computer [data-coordinate="${r}"]`).classList.add("placed")}}})(),setTimeout((()=>{o.U.toggleModal(document.querySelector(".modal.initial"),"hide")}),500);else{const e=o.U.shipTypes[d].type;document.querySelector(".ship-type").textContent=e}}}}];return{init:()=>{o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),a(".gameboard.initial"),a(".gameboard.player"),a(".gameboard.computer"),n(".gameboard.initial",g),document.querySelectorAll(".gameboard.computer .square").forEach((e=>{e.addEventListener("click",p)})),document.querySelector("#rotateBtn").addEventListener("click",m),document.querySelector("#newGame").addEventListener("click",(()=>{d=0,i=!0,u=!1,h=null,e.reset(),t.reset(),r.clearSet(),c(".gameboard.initial"),c(".gameboard.player"),c(".gameboard.computer"),document.querySelector(".ship-type").textContent=o.U.shipTypes[0].type,o.U.toggleModal(document.querySelector(".modal.endgame"),"hide"),o.U.toggleModal(document.querySelector(".modal.initial"),"show")}))}}})().init()},776:(e,t,r)=>{r.d(t,{Br:()=>n,_V:()=>a,oP:()=>l});var o=r(555);const a=e=>{let t=0;return{length:e,hit:()=>{t+=1},isSunk:()=>t>=e,get hits(){return t}}},n=()=>{const e=10,t=Array.from({length:e},(()=>Array(e).fill(null)));let r=[],o=[];const a=()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null===e||!e.ship||r.includes(e.ship)||e.ship.isSunk()||r.push(e.ship)}return r};return{getGrid:()=>t,placeShip:(r,o)=>{const a=o.every((([t,r])=>t>=0&&t<e&&r>=0&&r<e)),n=o.some((([e,r])=>null!==t[e][r])),l=o.some((([r,o])=>[[r-1,o],[r+1,o],[r,o-1],[r,o+1],[r-1,o-1],[r-1,o+1],[r+1,o-1],[r+1,o+1]].some((([r,o])=>r>=0&&r<e&&o>=0&&o<e&&null!==t[r]?.[o]))));if(a&&!n&&!l){const e={ship:r,coordinates:o};return e.coordinates.forEach((([r,o])=>{t[r][o]=e})),!0}return!1},getShips:a,getAllShips:()=>{const r=[];for(let o=0;o<e;o+=1)for(let a=0;a<e;a+=1){const e=t[o][a];null!==e&&e.ship&&!r.includes(e.ship)&&r.push(e.ship)}return r},getShipCoordinates:r=>{const o=[];for(let a=0;a<e;a+=1)for(let n=0;n<e;n+=1){const e=t[a][n];e&&e.ship===r&&o.push([a,n])}return o},receiveAttack:e=>{const[a,n]=e,l=parseInt(n,10),c=a.charCodeAt(0)-65,s=t[l][c];if(null!==s){const{ship:t}=s;return t.hit(),r.push(e),t}return o.push(e),r.push(e),null},getMissedAttacks:()=>o,getAttackedCoordinates:()=>r,allShipsSunk:()=>a().every((e=>e.isSunk())),reset:()=>{t.forEach(((e,r)=>{e.forEach(((e,o)=>{t[r][o]=null}))})),r=[],o=[]}}},l=e=>{const t=new Set;return{name:e,attack:e=>{const r=e.getGrid().length,a=o.r.getAllValidCoordinates(r);let n="";do{n=a[Math.floor(Math.random()*a.length)]}while(t.has(n)||e.getAttackedCoordinates().includes(n));return t.add(n),n},getAttackedSet:()=>t,clearSet:()=>{t.clear()}}}},555:(e,t,r)=>{r.d(t,{U:()=>a,r:()=>o});const o=(()=>{const e=[],t=([e,t])=>String.fromCharCode(t+65)+e;return{convertToIndices:e=>{const t=e.charCodeAt(0)-65;return[parseInt(e.slice(1),10),t]},convertToAlphanumeric:t,getAllValidCoordinates:r=>{for(let o=0;o<r;o+=1)for(let a=0;a<r;a+=1){const r=t([o,a]);e.push(r)}return e}}})(),a={shipTypes:[{type:"carrier",length:5},{type:"battleship",length:4},{type:"destroyer",length:3},{type:"submarine",length:3},{type:"patrol boat",length:2}],toggleModal:(e,t)=>{const r=e,o="show"===t?"flex":"none";e.closest(".overlay").style.display=o,r.style.display=o}}}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(380),r(776)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTBCLFNBQVhGLEVBQW9CLE9BQVMsT0FEbENELEVBQU1JLFFBQVEsWUFHdEJDLE1BQU1DLFFBQVVILEVBQ3hCRCxFQUFhRyxNQUFNQyxRQUFVSCxDQUFZLEUsR0MvQ3pDSSxFQUEyQixDQUFDLEVBR2hDLFNBQVNDLEVBQW9CQyxHQUU1QixJQUFJQyxFQUFlSCxFQUF5QkUsR0FDNUMsUUFBcUJFLElBQWpCRCxFQUNILE9BQU9BLEVBQWFFLFFBR3JCLElBQUlDLEVBQVNOLEVBQXlCRSxHQUFZLENBR2pERyxRQUFTLENBQUMsR0FPWCxPQUhBRSxFQUFvQkwsR0FBVUksRUFBUUEsRUFBT0QsUUFBU0osR0FHL0NLLEVBQU9ELE9BQ2YsQ0NyQkFKLEVBQW9CTyxFQUFJLENBQUNILEVBQVNJLEtBQ2pDLElBQUksSUFBSUMsS0FBT0QsRUFDWFIsRUFBb0JVLEVBQUVGLEVBQVlDLEtBQVNULEVBQW9CVSxFQUFFTixFQUFTSyxJQUM1RUUsT0FBT0MsZUFBZVIsRUFBU0ssRUFBSyxDQUFFSSxZQUFZLEVBQU1DLElBQUtOLEVBQVdDLElBRTFFLEVDTkRULEVBQW9CVSxFQUFJLENBQUNLLEVBQUtDLElBQVVMLE9BQU9NLFVBQVVDLGVBQWVDLEtBQUtKLEVBQUtDLEdDRWxGaEIsRUFBb0IsS0FFTUEsRUFBb0IsSSIsInNvdXJjZXMiOlsid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvcmVuZGVyLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvYXBwLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvZmFjdG9yaWVzLmpzIiwid2VicGFjazovL2JhdHRsZXNoaXAvLi9zcmMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL2Jvb3RzdHJhcCIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9iYXR0bGVzaGlwL3dlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQiLCJ3ZWJwYWNrOi8vYmF0dGxlc2hpcC93ZWJwYWNrL3N0YXJ0dXAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRmFjdG9yeUhlbHBlcnMgfSBmcm9tIFwiLi91dGlsc1wiO1xuXG5jb25zdCBSZW5kZXJlciA9ICgoKSA9PiB7XG4gIGNvbnN0IHJlbmRlckdhbWVib2FyZCA9IChjb250YWluZXJFbGVtZW50KSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcblxuICAgIGNvbnRhaW5lci50ZXh0Q29udGVudCA9IFwiXCI7XG5cbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCAxMDsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IDEwOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjb29yZGluYXRlID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtyb3csIGNvbF0pO1xuICAgICAgICBjb25zdCBzcXVhcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcInNxdWFyZVwiKTtcbiAgICAgICAgc3F1YXJlLmRhdGFzZXQuY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG5cbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNxdWFyZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGF0dGFjaEV2ZW50TGlzdGVuZXJzID0gKGNvbnRhaW5lckVsZW1lbnQsIGV2ZW50TGlzdGVuZXJzKSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcblxuICAgIGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKFwiLnNxdWFyZVwiKS5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIGV2ZW50TGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyKSA9PiB7XG4gICAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKGxpc3RlbmVyLmV2ZW50VHlwZSwgbGlzdGVuZXIuaGFuZGxlcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBzZXRXaW5uZXJIZWFkaW5nID0gKHdpbm5lcikgPT4ge1xuICAgIGNvbnN0IHdpbm5lckhlYWRpbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3dpbm5lclwiKTtcbiAgICB3aW5uZXJIZWFkaW5nLnRleHRDb250ZW50ID0gYCR7d2lubmVyfSB3b24hYDtcbiAgfTtcblxuICBjb25zdCBjbGVhckdhbWVib2FyZCA9IChjb250YWluZXJFbGVtZW50KSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJFbGVtZW50KTtcbiAgICBjb25zdCBzcXVhcmVzID0gY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc3F1YXJlXCIpO1xuXG4gICAgc3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIGNvbnN0IHJlc2V0U3F1YXJlID0gc3F1YXJlO1xuICAgICAgcmVzZXRTcXVhcmUuY2xhc3NOYW1lID0gXCJzcXVhcmVcIjsgLy8gUmVzZXQgdGhlIGNsYXNzTmFtZSB0byByZW1vdmUgYWxsIGNsYXNzZXNcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlbmRlckdhbWVib2FyZCxcbiAgICBhdHRhY2hFdmVudExpc3RlbmVycyxcbiAgICBzZXRXaW5uZXJIZWFkaW5nLFxuICAgIGNsZWFyR2FtZWJvYXJkLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IGRlZmF1bHQgUmVuZGVyZXI7XG4iLCIvKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLXN5bnRheCAqL1xuLyogZXNsaW50LWRpc2FibGUgbm8tbG9uZWx5LWlmICovXG5pbXBvcnQgeyBBcHBIZWxwZXJzLCBGYWN0b3J5SGVscGVycyB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgUmVuZGVyZXIgZnJvbSBcIi4vcmVuZGVyXCI7XG5pbXBvcnQgeyBTaGlwRmFjdG9yeSwgR2FtZWJvYXJkRmFjdG9yeSwgUGxheWVyRmFjdG9yeSB9IGZyb20gXCIuL2ZhY3Rvcmllc1wiO1xuXG4vLyAxLiAtLS1cbi8vIDIuIC0tLVxuLy8gMy4gLS0tXG4vLyA0LiBNYWtlIHRoZSBjb21wdXRlciB0cnkgYWRqYWNlbnQgbG9jYXRpb25zIGlmIGdldHRpbmcgYSBoaXRcbi8vIDQuIFN0eWxlID0+IE1vZGFsc1xuLy8gNS4gUHVzaCB0byBnaC1wYWdlcyBhbmQgYWRkIHJlYWRtZVxuXG5jb25zdCBDb250cm9sbGVyID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVyR2FtZWJvYXJkID0gR2FtZWJvYXJkRmFjdG9yeSgpO1xuICBjb25zdCBjb21wdXRlckdhbWVib2FyZCA9IEdhbWVib2FyZEZhY3RvcnkoKTtcblxuICBjb25zdCBjb21wdXRlciA9IFBsYXllckZhY3RvcnkoXCJjb21wdXRlclwiKTtcblxuICBsZXQgY3VycmVudFNoaXBJbmRleCA9IDA7XG4gIGxldCBzaGlwUGxhY2VtZW50TW9kZSA9IHRydWU7XG4gIGxldCBpc1ZlcnRpY2FsID0gZmFsc2U7XG4gIGxldCB3aW5uZXIgPSBudWxsO1xuXG4gIGNvbnN0IHBsYWNlQ29tcHV0ZXJTaGlwcyA9ICgpID0+IHtcbiAgICBmb3IgKGNvbnN0IHNoaXBUeXBlIG9mIEFwcEhlbHBlcnMuc2hpcFR5cGVzKSB7XG4gICAgICBjb25zdCB7IGxlbmd0aCB9ID0gc2hpcFR5cGU7XG4gICAgICBjb25zdCBzaGlwID0gU2hpcEZhY3RvcnkobGVuZ3RoKTtcblxuICAgICAgY29uc3QgZ3JpZFNpemUgPSAxMDtcbiAgICAgIGxldCBjb29yZGluYXRlcztcbiAgICAgIGxldCBwbGFjZWQgPSBmYWxzZTtcblxuICAgICAgd2hpbGUgKCFwbGFjZWQpIHtcbiAgICAgICAgLy8gR2VuZXJhdGUgcmFuZG9tIHN0YXJ0Um93IGFuZCBzdGFydENvbCB3aXRoaW4gdGhlIGdyaWQgYm91bmRhcmllc1xuICAgICAgICBjb25zdCBzdGFydFJvdyA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGdyaWRTaXplKTtcbiAgICAgICAgY29uc3Qgc3RhcnRDb2wgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBncmlkU2l6ZSk7XG5cbiAgICAgICAgLy8gUmFuZG9tbHkgY2hvb3NlIHdoZXRoZXIgdGhlIHNoaXAgd2lsbCBiZSBwbGFjZWQgdmVydGljYWxseSBvciBob3Jpem9udGFsbHlcbiAgICAgICAgaXNWZXJ0aWNhbCA9IE1hdGgucmFuZG9tKCkgPCAwLjU7XG5cbiAgICAgICAgaWYgKGlzVmVydGljYWwgJiYgc3RhcnRSb3cgKyBsZW5ndGggPD0gZ3JpZFNpemUpIHtcbiAgICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgY29vcmRpbmF0ZXMgZm9yIGEgdmVydGljYWxseSBwbGFjZWQgc2hpcFxuICAgICAgICAgIGNvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4gW1xuICAgICAgICAgICAgc3RhcnRSb3cgKyBpLFxuICAgICAgICAgICAgc3RhcnRDb2wsXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIWlzVmVydGljYWwgJiYgc3RhcnRDb2wgKyBsZW5ndGggPD0gZ3JpZFNpemUpIHtcbiAgICAgICAgICAvLyBHZW5lcmF0ZSB0aGUgY29vcmRpbmF0ZXMgZm9yIGEgaG9yaXpvbnRhbGx5IHBsYWNlZCBzaGlwXG4gICAgICAgICAgY29vcmRpbmF0ZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoIH0sIChfLCBpKSA9PiBbXG4gICAgICAgICAgICBzdGFydFJvdyxcbiAgICAgICAgICAgIHN0YXJ0Q29sICsgaSxcbiAgICAgICAgICBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjb29yZGluYXRlcykge1xuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBzaGlwIGNhbiBiZSBwbGFjZWQgYXQgdGhlIGdlbmVyYXRlZCBjb29yZGluYXRlc1xuICAgICAgICAgIHBsYWNlZCA9IGNvbXB1dGVyR2FtZWJvYXJkLnBsYWNlU2hpcChzaGlwLCBjb29yZGluYXRlcyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHRoZSBzaGlwIGNvb3JkaW5hdGVzXG4gICAgICBjb25zdCBjb29yZGluYXRlID0gY29tcHV0ZXJHYW1lYm9hcmQuZ2V0U2hpcENvb3JkaW5hdGVzKHNoaXApO1xuXG4gICAgICAvLyBMb29wIHRocm91Z2ggdGhlbSBhbmQgYWRkIGEgcGxhY2VkIGNsYXNzXG4gICAgICBmb3IgKGNvbnN0IFtyb3csIGNvbF0gb2YgY29vcmRpbmF0ZSkge1xuICAgICAgICBjb25zdCBjb252ZXJ0ZWRDb29yZGluYXRlID0gRmFjdG9yeUhlbHBlcnMuY29udmVydFRvQWxwaGFudW1lcmljKFtcbiAgICAgICAgICByb3csXG4gICAgICAgICAgY29sLFxuICAgICAgICBdKTtcbiAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLmdhbWVib2FyZC5jb21wdXRlciBbZGF0YS1jb29yZGluYXRlPVwiJHtjb252ZXJ0ZWRDb29yZGluYXRlfVwiXWBcbiAgICAgICAgKTtcbiAgICAgICAgcGxhY2VkU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHNoaXBQbGFjZW1lbnRIYW5kbGVyID0gKGUpID0+IHtcbiAgICBpZiAoc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0O1xuICAgICAgY29uc3QgeyBjb29yZGluYXRlIH0gPSBzcXVhcmUuZGF0YXNldDtcbiAgICAgIGNvbnN0IHsgbGVuZ3RoIH0gPSBBcHBIZWxwZXJzLnNoaXBUeXBlc1tjdXJyZW50U2hpcEluZGV4XTtcblxuICAgICAgY29uc3QgW3N0YXJ0Um93LCBzdGFydENvbF0gPSBGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9JbmRpY2VzKGNvb3JkaW5hdGUpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSBhbiBhcnJheSBvZiBzaGlwIGNvb3JkaW5hdGVzIGJhc2VkIG9uIHRoZSBzaGlwIGxlbmd0aFxuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gQXJyYXkuZnJvbSh7IGxlbmd0aCB9LCAoXywgaSkgPT4ge1xuICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIHJvdyBjb29yZGluYXRlIGJhc2VkIG9uIHZlcnRpY2FsIG9yIGhvcml6b250YWwgcGxhY2VtZW50XG4gICAgICAgIGNvbnN0IHJvdyA9IGlzVmVydGljYWwgPyBzdGFydFJvdyArIGkgOiBzdGFydFJvdztcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBjb2x1bW4gY29vcmRpbmF0ZSBiYXNlZCBvbiB2ZXJ0aWNhbCBvciBob3Jpem9udGFsIHBsYWNlbWVudFxuICAgICAgICBjb25zdCBjb2wgPSBpc1ZlcnRpY2FsID8gc3RhcnRDb2wgOiBzdGFydENvbCArIGk7XG4gICAgICAgIHJldHVybiBbcm93LCBjb2xdOyAvLyBSZXR1cm4gdGhlIGNvb3JkaW5hdGUgcGFpclxuICAgICAgfSk7XG5cbiAgICAgIC8vIEF0dGVtcHQgdG8gcGxhY2UgdGhlIHNoaXAgb24gdGhlIHBsYXllciBnYW1lYm9hcmRcbiAgICAgIGNvbnN0IHNoaXAgPSBTaGlwRmFjdG9yeShsZW5ndGgpO1xuICAgICAgY29uc3QgcGxhY2VkID0gcGxheWVyR2FtZWJvYXJkLnBsYWNlU2hpcChzaGlwLCBzaGlwQ29vcmRpbmF0ZXMpO1xuXG4gICAgICBpZiAocGxhY2VkKSB7XG4gICAgICAgIC8vIElmIHNoaXAgcGxhY2VtZW50IGlzIHN1Y2Nlc3NmdWxcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJwbGFjZWRcIik7XG4gICAgICAgIHNoaXBDb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGxhY2VkU3F1YXJlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgIGBbZGF0YS1jb29yZGluYXRlPVwiJHtGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoW1xuICAgICAgICAgICAgICByb3csXG4gICAgICAgICAgICAgIGNvbCxcbiAgICAgICAgICAgIF0pfVwiXWBcbiAgICAgICAgICApO1xuICAgICAgICAgIHBsYWNlZFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICAgIGNvbnN0IGluaXRpYWxTcXVhcmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgICAgYC5nYW1lYm9hcmQuaW5pdGlhbCBbZGF0YS1jb29yZGluYXRlPVwiJHtGYWN0b3J5SGVscGVycy5jb252ZXJ0VG9BbHBoYW51bWVyaWMoXG4gICAgICAgICAgICAgIFtyb3csIGNvbF1cbiAgICAgICAgICAgICl9XCJdYFxuICAgICAgICAgICk7XG4gICAgICAgICAgaW5pdGlhbFNxdWFyZS5jbGFzc0xpc3QuYWRkKFwicGxhY2VkXCIpO1xuICAgICAgICB9KTtcblxuICAgICAgICBjdXJyZW50U2hpcEluZGV4ICs9IDE7IC8vIEluY3JlbWVudCB0aGUgY3VycmVudFNoaXBJbmRleCB0byBtb3ZlIHRvIHRoZSBuZXh0IHNoaXBcblxuICAgICAgICBpZiAoY3VycmVudFNoaXBJbmRleCA9PT0gQXBwSGVscGVycy5zaGlwVHlwZXMubGVuZ3RoKSB7XG4gICAgICAgICAgLy8gSWYgYWxsIHNoaXBzIGhhdmUgYmVlbiBwbGFjZWRcbiAgICAgICAgICBzaGlwUGxhY2VtZW50TW9kZSA9IGZhbHNlOyAvLyBEaXNhYmxlIHNoaXAgcGxhY2VtZW50IG1vZGVcbiAgICAgICAgICBwbGFjZUNvbXB1dGVyU2hpcHMoKTsgLy8gUGxhY2UgdGhlIGNvbXB1dGVyJ3Mgc2hpcHNcbiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIC8vIFNldCBhIHRpbWVvdXQgdG8gZGVsYXkgaGlkaW5nIHRoZSBpbml0aWFsIHNoaXAgcGxhY2VtZW50IG1vZGFsXG4gICAgICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmluaXRpYWxcIiksXG4gICAgICAgICAgICAgIFwiaGlkZVwiXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gSWYgdGhlcmUgYXJlIHN0aWxsIHNoaXBzIHRvIGJlIHBsYWNlZFxuICAgICAgICAgIC8vIEdldCB0aGUgdHlwZSBvZiB0aGUgbmV4dCBzaGlwIGJhc2VkIG9uIHRoZSBjdXJyZW50U2hpcEluZGV4XG4gICAgICAgICAgY29uc3QgbmV4dFNoaXBUeXBlID0gQXBwSGVscGVycy5zaGlwVHlwZXNbY3VycmVudFNoaXBJbmRleF0udHlwZTtcbiAgICAgICAgICAvLyBVcGRhdGUgdGhlIHNoaXAgdHlwZSB0ZXh0IG9uIHRoZSBVSVxuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuc2hpcC10eXBlXCIpLnRleHRDb250ZW50ID0gbmV4dFNoaXBUeXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGdhbWVib2FyZEhvdmVySGFuZGxlciA9IChlKSA9PiB7XG4gICAgaWYgKHNoaXBQbGFjZW1lbnRNb2RlKSB7XG4gICAgICAvLyBDaGVjayBpZiBzaGlwIHBsYWNlbWVudCBtb2RlIGlzIGFjdGl2ZVxuICAgICAgY29uc3Qgc3F1YXJlID0gZS50YXJnZXQ7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJlZmVyLWRlc3RydWN0dXJpbmdcbiAgICAgIGNvbnN0IGNvb3JkaW5hdGUgPSBzcXVhcmUuZGF0YXNldC5jb29yZGluYXRlO1xuICAgICAgY29uc3QgeyBsZW5ndGggfSA9IEFwcEhlbHBlcnMuc2hpcFR5cGVzW2N1cnJlbnRTaGlwSW5kZXhdOyAvLyBHZXQgdGhlIGxlbmd0aCBvZiB0aGUgc2hpcFxuXG4gICAgICBjb25zdCBbc3RhcnRSb3csIHN0YXJ0Q29sXSA9IEZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0luZGljZXMoY29vcmRpbmF0ZSk7XG4gICAgICAvLyBHZW5lcmF0ZSBhbiBhcnJheSBvZiBob3ZlcmVkIHNxdWFyZXMgYmFzZWQgb24gdGhlIHNoaXAgbGVuZ3RoXG4gICAgICBjb25zdCBob3ZlcmVkU3F1YXJlcyA9IEFycmF5LmZyb20oeyBsZW5ndGggfSwgKF8sIGkpID0+IHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSByb3cgY29vcmRpbmF0ZSBiYXNlZCBvbiB2ZXJ0aWNhbCBvciBob3Jpem9udGFsIHBsYWNlbWVudFxuICAgICAgICBjb25zdCByb3cgPSBpc1ZlcnRpY2FsID8gc3RhcnRSb3cgKyBpIDogc3RhcnRSb3c7XG4gICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgY29sdW1uIGNvb3JkaW5hdGUgYmFzZWQgb24gdmVydGljYWwgb3IgaG9yaXpvbnRhbCBwbGFjZW1lbnRcbiAgICAgICAgY29uc3QgY29sID0gaXNWZXJ0aWNhbCA/IHN0YXJ0Q29sIDogc3RhcnRDb2wgKyBpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGluaXRpYWxTcXVhcmU6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgICBgLmdhbWVib2FyZC5pbml0aWFsIFtkYXRhLWNvb3JkaW5hdGU9XCIke0ZhY3RvcnlIZWxwZXJzLmNvbnZlcnRUb0FscGhhbnVtZXJpYyhcbiAgICAgICAgICAgICAgW3JvdywgY29sXVxuICAgICAgICAgICAgKX1cIl1gXG4gICAgICAgICAgKSxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICBob3ZlcmVkU3F1YXJlcy5mb3JFYWNoKCh7IGluaXRpYWxTcXVhcmUgfSkgPT4ge1xuICAgICAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIGhvdmVyZWQgc3F1YXJlc1xuICAgICAgICBpZiAoaW5pdGlhbFNxdWFyZSkge1xuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBpbml0aWFsIHNxdWFyZSBleGlzdHNcbiAgICAgICAgICBpbml0aWFsU3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJob3ZlcmVkXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2FtZWJvYXJkTW91c2VMZWF2ZUhhbmRsZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgaG92ZXJlZFNxdWFyZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWVib2FyZCAuaG92ZXJlZFwiKTtcbiAgICBob3ZlcmVkU3F1YXJlcy5mb3JFYWNoKChob3ZlcmVkU3F1YXJlKSA9PiB7XG4gICAgICBob3ZlcmVkU3F1YXJlLmNsYXNzTGlzdC5yZW1vdmUoXCJob3ZlcmVkXCIpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNvbXB1dGVyQXR0YWNrID0gKCkgPT4ge1xuICAgIGlmICghc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIC8vIFBlcmZvcm0gYSBjb21wdXRlciBhdHRhY2sgYW5kIGdldCB0aGUgY29vcmRpbmF0ZVxuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IGNvbXB1dGVyLmF0dGFjayhwbGF5ZXJHYW1lYm9hcmQpO1xuICAgICAgLy8gUmVjZWl2ZSB0aGUgYXR0YWNrIG9uIHRoZSBwbGF5ZXIncyBnYW1lYm9hcmQgYW5kIGdldCB0aGUgYXR0YWNrZWQgc2hpcCAoaWYgYW55KVxuICAgICAgY29uc3QgYXR0YWNrZWRTaGlwID0gcGxheWVyR2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBjb21wdXRlckF0dGFjaygpIGF0OiAke2Nvb3JkaW5hdGV9YCk7XG5cbiAgICAgIGNvbnN0IHNxdWFyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgIGAuZ2FtZWJvYXJkLnBsYXllciBbZGF0YS1jb29yZGluYXRlPVwiJHtjb29yZGluYXRlfVwiXWBcbiAgICAgICk7IC8vIEdldCB0aGUgY29ycmVzcG9uZGluZyBzcXVhcmUgZWxlbWVudCBvbiB0aGUgcGxheWVyJ3MgZ2FtZWJvYXJkXG5cbiAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgc3F1YXJlLmNsYXNzTGlzdC5hZGQoXCJoaXRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICB9XG5cbiAgICAgIGlmIChwbGF5ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgd2lubmVyID0gXCJUaGUgY29tcHV0ZXJcIjtcbiAgICAgICAgUmVuZGVyZXIuc2V0V2lubmVySGVhZGluZyh3aW5uZXIpO1xuICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSxcbiAgICAgICAgICBcInNob3dcIlxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBwbGF5ZXJBdHRhY2sgPSAoZSkgPT4ge1xuICAgIGlmICghc2hpcFBsYWNlbWVudE1vZGUpIHtcbiAgICAgIGNvbnN0IHNxdWFyZSA9IGUudGFyZ2V0OyAvLyBHZXQgdGhlIGNsaWNrZWQgc3F1YXJlIGVsZW1lbnRcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcmVmZXItZGVzdHJ1Y3R1cmluZ1xuICAgICAgY29uc3QgY29vcmRpbmF0ZSA9IHNxdWFyZS5kYXRhc2V0LmNvb3JkaW5hdGU7XG4gICAgICAvLyBDb252ZXJ0IHRoZSByb3cgYW5kIGNvbHVtbiBpbmRpY2VzIHRvIGFuIGFscGhhbnVtZXJpYyBjb29yZGluYXRlXG5cbiAgICAgIGNvbnNvbGUubG9nKGBwbGF5ZXJBdHRhY2soKSBhdDogJHtjb29yZGluYXRlfWApO1xuICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNvb3JkaW5hdGUgaGFzIG5vdCBiZWVuIHByZXZpb3VzbHkgYXR0YWNrZWRcbiAgICAgIGlmICghY29tcHV0ZXJHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpKSB7XG4gICAgICAgIC8vIFJlY2VpdmUgdGhlIGF0dGFjayBvbiB0aGUgY29tcHV0ZXIncyBnYW1lYm9hcmQgYW5kIGdldCB0aGUgYXR0YWNrZWQgc2hpcCAoaWYgYW55KVxuICAgICAgICBjb25zdCBhdHRhY2tlZFNoaXAgPSBjb21wdXRlckdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGUpO1xuXG4gICAgICAgIGlmIChhdHRhY2tlZFNoaXApIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcImhpdFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzcXVhcmUuY2xhc3NMaXN0LmFkZChcIm1pc3NcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29tcHV0ZXJHYW1lYm9hcmQuYWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgICB3aW5uZXIgPSBcIllvdVwiO1xuICAgICAgICAgIFJlbmRlcmVyLnNldFdpbm5lckhlYWRpbmcod2lubmVyKTtcbiAgICAgICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKFxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLFxuICAgICAgICAgICAgXCJzaG93XCJcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgY29tcHV0ZXJBdHRhY2soKTsgLy8gUGVyZm9ybSB0aGUgY29tcHV0ZXIncyBhdHRhY2tcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgcm90YXRlU2hpcHMgPSAoKSA9PiB7XG4gICAgaXNWZXJ0aWNhbCA9ICFpc1ZlcnRpY2FsO1xuICB9O1xuXG4gIGNvbnN0IGV2ZW50TGlzdGVuZXJzID0gW1xuICAgIHsgZXZlbnRUeXBlOiBcIm1vdXNlb3ZlclwiLCBoYW5kbGVyOiBnYW1lYm9hcmRIb3ZlckhhbmRsZXIgfSxcbiAgICB7IGV2ZW50VHlwZTogXCJtb3VzZWxlYXZlXCIsIGhhbmRsZXI6IGdhbWVib2FyZE1vdXNlTGVhdmVIYW5kbGVyIH0sXG4gICAgeyBldmVudFR5cGU6IFwiY2xpY2tcIiwgaGFuZGxlcjogc2hpcFBsYWNlbWVudEhhbmRsZXIgfSxcbiAgXTtcblxuICBjb25zdCByZXNldEdhbWUgPSAoKSA9PiB7XG4gICAgLy8gUmVzZXQgZ2FtZS1yZWxhdGVkIHZhcmlhYmxlc1xuICAgIGN1cnJlbnRTaGlwSW5kZXggPSAwO1xuICAgIHNoaXBQbGFjZW1lbnRNb2RlID0gdHJ1ZTtcbiAgICBpc1ZlcnRpY2FsID0gZmFsc2U7XG4gICAgd2lubmVyID0gbnVsbDtcblxuICAgIC8vIFJlc2V0IGdhbWVib2FyZCBvYmplY3RzXG4gICAgcGxheWVyR2FtZWJvYXJkLnJlc2V0KCk7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQucmVzZXQoKTtcblxuICAgIC8vIENsZWFyIGNvbXB1dGVycyBhdHRhY2tlZENvb3JkaW5hdGVzIHNldFxuICAgIGNvbXB1dGVyLmNsZWFyU2V0KCk7XG5cbiAgICAvLyBSZW1vdmUgaGl0IGFuZCBtaXNzIGNsYXNzZXMgZnJvbSBhbGwgc3F1YXJlc1xuICAgIFJlbmRlcmVyLmNsZWFyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5pbml0aWFsXCIpO1xuICAgIFJlbmRlcmVyLmNsZWFyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5wbGF5ZXJcIik7XG4gICAgUmVuZGVyZXIuY2xlYXJHYW1lYm9hcmQoXCIuZ2FtZWJvYXJkLmNvbXB1dGVyXCIpO1xuXG4gICAgLy8gUmVzZXQgc2hpcFR5cGVzXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zaGlwLXR5cGVcIikudGV4dENvbnRlbnQgPVxuICAgICAgQXBwSGVscGVycy5zaGlwVHlwZXNbMF0udHlwZTtcbiAgfTtcblxuICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgIEFwcEhlbHBlcnMudG9nZ2xlTW9kYWwoZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbC5lbmRnYW1lXCIpLCBcImhpZGVcIik7XG4gICAgUmVuZGVyZXIucmVuZGVyR2FtZWJvYXJkKFwiLmdhbWVib2FyZC5pbml0aWFsXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQucGxheWVyXCIpO1xuICAgIFJlbmRlcmVyLnJlbmRlckdhbWVib2FyZChcIi5nYW1lYm9hcmQuY29tcHV0ZXJcIik7XG4gICAgUmVuZGVyZXIuYXR0YWNoRXZlbnRMaXN0ZW5lcnMoXCIuZ2FtZWJvYXJkLmluaXRpYWxcIiwgZXZlbnRMaXN0ZW5lcnMpO1xuXG4gICAgY29uc3QgY29tcHV0ZXJTcXVhcmVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcbiAgICAgIFwiLmdhbWVib2FyZC5jb21wdXRlciAuc3F1YXJlXCJcbiAgICApO1xuICAgIGNvbXB1dGVyU3F1YXJlcy5mb3JFYWNoKChzcXVhcmUpID0+IHtcbiAgICAgIHNxdWFyZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcGxheWVyQXR0YWNrKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHJvdGF0ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcm90YXRlQnRuXCIpO1xuICAgIHJvdGF0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgcm90YXRlU2hpcHMpO1xuXG4gICAgY29uc3QgcGxheUFnYWluQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXdHYW1lXCIpO1xuICAgIHBsYXlBZ2FpbkJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgcmVzZXRHYW1lKCk7XG4gICAgICBBcHBIZWxwZXJzLnRvZ2dsZU1vZGFsKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwuZW5kZ2FtZVwiKSwgXCJoaWRlXCIpO1xuICAgICAgQXBwSGVscGVycy50b2dnbGVNb2RhbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLmluaXRpYWxcIiksIFwic2hvd1wiKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGluaXQsXG4gIH07XG59KSgpO1xuXG5Db250cm9sbGVyLmluaXQoKTtcbiIsImltcG9ydCB7IEZhY3RvcnlIZWxwZXJzIH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuZXhwb3J0IGNvbnN0IFNoaXBGYWN0b3J5ID0gKGxlbmd0aCkgPT4ge1xuICBsZXQgaGl0cyA9IDA7XG5cbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGhpdHMgKz0gMTtcbiAgfTtcblxuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBoaXRzID49IGxlbmd0aDsgLy8gUmV0dXJuIHRydWUgaWYgaGl0cyBpcyBlcXVhbCB0byBvciBncmVhdGVyIHRoYW4gbGVuZ3RoXG5cbiAgcmV0dXJuIHtcbiAgICBsZW5ndGgsXG4gICAgaGl0LFxuICAgIGlzU3VuayxcbiAgICBnZXQgaGl0cygpIHtcbiAgICAgIC8vIEdldHRlciBmdW5jdGlvbiBmb3IgaGl0cy4gVXNpbmcgZnVuY3Rpb24gZGVjbGFyYXRpb24gdG8gZW5zdXJlIGl0IGhhcyBhY2Nlc3MgdG8gdGhlXG4gICAgICAvLyBgaGl0c2AgdmFyaWFibGUgZHluYW1pY2FsbHksIHNpbmNlIGZ1bmN0aW9uIGRlY2xhcmF0aW9ucyBhcmUgaG9pc3RlZCBhbmQgY2FuIGJlIHVzZWRcbiAgICAgIC8vIGJlZm9yZSB0aGV5IGFyZSBkZWZpbmVkLiBUaGlzIGFsbG93cyBhY2Nlc3NpbmcgdGhlIGN1cnJlbnQgdmFsdWUgb2YgYGhpdHNgIGV2ZW4gYmVmb3JlXG4gICAgICAvLyBjYWxsaW5nIHRoZSBgaGl0YCBmdW5jdGlvblxuICAgICAgcmV0dXJuIGhpdHM7XG4gICAgfSxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBHYW1lYm9hcmRGYWN0b3J5ID0gKCkgPT4ge1xuICBjb25zdCBncmlkU2l6ZSA9IDEwO1xuICBjb25zdCBncmlkID0gQXJyYXkuZnJvbSh7IGxlbmd0aDogZ3JpZFNpemUgfSwgKCkgPT5cbiAgICBBcnJheShncmlkU2l6ZSkuZmlsbChudWxsKVxuICApO1xuXG4gIGxldCBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gIGxldCBtaXNzZWRBdHRhY2tzID0gW107XG5cbiAgY29uc3QgZ2V0R3JpZCA9ICgpID0+IGdyaWQ7XG5cbiAgY29uc3QgcGxhY2VTaGlwID0gKHNoaXAsIGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgYWxsIGNvb3JkaW5hdGVzIGFyZSB3aXRoaW4gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIGdyaWRcbiAgICBjb25zdCB3aXRoaW5Cb3VuZGFyaWVzID0gY29vcmRpbmF0ZXMuZXZlcnkoXG4gICAgICAoW3JvdywgY29sXSkgPT4gcm93ID49IDAgJiYgcm93IDwgZ3JpZFNpemUgJiYgY29sID49IDAgJiYgY29sIDwgZ3JpZFNpemVcbiAgICApO1xuXG4gICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBjb25mbGljdHMgd2l0aCBleGlzdGluZyBzaGlwIHBsYWNlbWVudHMgb24gdGhlIGdyaWRcbiAgICBjb25zdCBjb25mbGljdHMgPSBjb29yZGluYXRlcy5zb21lKChbcm93LCBjb2xdKSA9PiBncmlkW3Jvd11bY29sXSAhPT0gbnVsbCk7XG5cbiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGFkamFjZW50IGNvbmZsaWN0cyB3aXRoIGV4aXN0aW5nIHNoaXAgcGxhY2VtZW50cyBvbiB0aGUgZ3JpZFxuICAgIGNvbnN0IGFkamFjZW50Q29uZmxpY3RzID0gY29vcmRpbmF0ZXMuc29tZSgoW3JvdywgY29sXSkgPT4ge1xuICAgICAgLy8gRGVmaW5lIHRoZSBhZGphY2VudCBjb29yZGluYXRlcyBhcm91bmQgdGhlIGN1cnJlbnQgY29vcmRpbmF0ZVxuICAgICAgY29uc3QgYWRqYWNlbnRDb29yZGluYXRlcyA9IFtcbiAgICAgICAgW3JvdyAtIDEsIGNvbF0sIC8vIFVwXG4gICAgICAgIFtyb3cgKyAxLCBjb2xdLCAvLyBEb3duXG4gICAgICAgIFtyb3csIGNvbCAtIDFdLCAvLyBMZWZ0XG4gICAgICAgIFtyb3csIGNvbCArIDFdLCAvLyBSaWdodFxuICAgICAgICBbcm93IC0gMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIFVwLUxlZnRcbiAgICAgICAgW3JvdyAtIDEsIGNvbCArIDFdLCAvLyBEaWFnb25hbCBVcC1SaWdodFxuICAgICAgICBbcm93ICsgMSwgY29sIC0gMV0sIC8vIERpYWdvbmFsIERvd24tTGVmdFxuICAgICAgICBbcm93ICsgMSwgY29sICsgMV0sIC8vIERpYWdvbmFsIERvd24tUmlnaHRcbiAgICAgIF07XG5cbiAgICAgIC8vIENoZWNrIGlmIGFueSBhZGphY2VudCBjb29yZGluYXRlIGhhcyBhIHNoaXAgcGxhY2VkIG9uIGl0XG4gICAgICByZXR1cm4gYWRqYWNlbnRDb29yZGluYXRlcy5zb21lKFxuICAgICAgICAoW2FkalJvdywgYWRqQ29sXSkgPT5cbiAgICAgICAgICBhZGpSb3cgPj0gMCAmJlxuICAgICAgICAgIGFkalJvdyA8IGdyaWRTaXplICYmXG4gICAgICAgICAgYWRqQ29sID49IDAgJiZcbiAgICAgICAgICBhZGpDb2wgPCBncmlkU2l6ZSAmJlxuICAgICAgICAgIGdyaWRbYWRqUm93XT8uW2FkakNvbF0gIT09IG51bGxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICAvLyBJZiB0aGUgc2hpcCBwbGFjZW1lbnQgaXMgd2l0aGluIGdyaWQgYm91bmRhcmllcywgaGFzIG5vIGNvbmZsaWN0cywgYW5kIG5vIGFkamFjZW50IGNvbmZsaWN0cy4uLlxuICAgIGlmICh3aXRoaW5Cb3VuZGFyaWVzICYmICFjb25mbGljdHMgJiYgIWFkamFjZW50Q29uZmxpY3RzKSB7XG4gICAgICAvLyBDcmVhdGUgYW4gb2JqZWN0IGNvbnRhaW5pbmcgc2hpcCBpbmZvcm1hdGlvbiBhbmQgY29vcmRpbmF0ZXNcbiAgICAgIGNvbnN0IHNoaXBJbmZvID0ge1xuICAgICAgICBzaGlwLFxuICAgICAgICBjb29yZGluYXRlcyxcbiAgICAgIH07XG5cbiAgICAgIC8vIFBsYWNlIHRoZSBzaGlwIG9uIHRoZSBncmlkIGJ5IHVwZGF0aW5nIHRoZSBjb3JyZXNwb25kaW5nIGNlbGxzXG4gICAgICBzaGlwSW5mby5jb29yZGluYXRlcy5mb3JFYWNoKChbcm93LCBjb2xdKSA9PiB7XG4gICAgICAgIGdyaWRbcm93XVtjb2xdID0gc2hpcEluZm87XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHRydWU7IC8vIFNoaXAgcGxhY2VtZW50IHN1Y2Nlc3NmdWxcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7IC8vIE90aGVyd2lzZSwgc2hpcCBwbGFjZW1lbnQgZmFpbGVkXG4gIH07XG5cbiAgY29uc3QgZ2V0U2hpcHMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcHMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGNvbnRhaW5zIGEgc2hpcCBhbmQgaXQncyBub3QgYWxyZWFkeSBpbmNsdWRlZCBpbiB0aGUgc2hpcHMgYXJyYXlcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGNlbGwgIT09IG51bGwgJiZcbiAgICAgICAgICBjZWxsLnNoaXAgJiZcbiAgICAgICAgICAhc2hpcHMuaW5jbHVkZXMoY2VsbC5zaGlwKSAmJlxuICAgICAgICAgICFjZWxsLnNoaXAuaXNTdW5rKClcbiAgICAgICAgKSB7XG4gICAgICAgICAgLy8gQWRkIHRoZSBzaGlwIHRvIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICAgIHNoaXBzLnB1c2goY2VsbC5zaGlwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzaGlwcztcbiAgfTtcblxuICBjb25zdCBnZXRBbGxTaGlwcyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IFtdO1xuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggY2VsbCBvZiB0aGUgZ3JpZFxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IGdyaWRTaXplOyByb3cgKz0gMSkge1xuICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgZ3JpZFNpemU7IGNvbCArPSAxKSB7XG4gICAgICAgIGNvbnN0IGNlbGwgPSBncmlkW3Jvd11bY29sXTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNlbGwgY29udGFpbnMgYSBzaGlwIGFuZCBpdCdzIG5vdCBhbHJlYWR5IGluY2x1ZGVkIGluIHRoZSBzaGlwcyBhcnJheVxuICAgICAgICBpZiAoY2VsbCAhPT0gbnVsbCAmJiBjZWxsLnNoaXAgJiYgIXNoaXBzLmluY2x1ZGVzKGNlbGwuc2hpcCkpIHtcbiAgICAgICAgICAvLyBBZGQgdGhlIHNoaXAgdG8gdGhlIHNoaXBzIGFycmF5XG4gICAgICAgICAgc2hpcHMucHVzaChjZWxsLnNoaXApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNoaXBzO1xuICB9O1xuXG4gIGNvbnN0IGdldFNoaXBDb29yZGluYXRlcyA9IChzaGlwKSA9PiB7XG4gICAgY29uc3QgY29vcmRpbmF0ZXMgPSBbXTtcblxuICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNlbGwgb2YgdGhlIGdyaWRcbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBncmlkU2l6ZTsgcm93ICs9IDEpIHtcbiAgICAgIGZvciAobGV0IGNvbCA9IDA7IGNvbCA8IGdyaWRTaXplOyBjb2wgKz0gMSkge1xuICAgICAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIGV4aXN0cyBhbmQgY29udGFpbnMgdGhlIHNwZWNpZmllZCBzaGlwXG4gICAgICAgIGlmIChjZWxsICYmIGNlbGwuc2hpcCA9PT0gc2hpcCkge1xuICAgICAgICAgIC8vIEFkZCB0byBjb29yZGluYXRlcyBhcnJheVxuICAgICAgICAgIGNvb3JkaW5hdGVzLnB1c2goW3JvdywgY29sXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29vcmRpbmF0ZXM7XG4gIH07XG5cbiAgY29uc3QgcmVjZWl2ZUF0dGFjayA9IChjb29yZGluYXRlKSA9PiB7XG4gICAgY29uc3QgW2NvbHVtbkxldHRlciwgcm93TnVtYmVyXSA9IGNvb3JkaW5hdGU7XG4gICAgY29uc3Qgcm93ID0gcGFyc2VJbnQocm93TnVtYmVyLCAxMCk7XG4gICAgY29uc3QgY29sID0gY29sdW1uTGV0dGVyLmNoYXJDb2RlQXQoMCkgLSA2NTtcbiAgICBjb25zdCBjZWxsID0gZ3JpZFtyb3ddW2NvbF07XG5cbiAgICBpZiAoY2VsbCAhPT0gbnVsbCkge1xuICAgICAgLy8gU2hpcCBhdCBjb29yZGluYXRlLCBpdCdzIGEgaGl0XG4gICAgICBjb25zdCB7IHNoaXAgfSA9IGNlbGw7XG4gICAgICBzaGlwLmhpdCgpOyAvLyBJbmNyZW1lbnQgaGl0IGNvdW50IG9mIHRoZSBzaGlwXG4gICAgICBhdHRhY2tlZENvb3JkaW5hdGVzLnB1c2goY29vcmRpbmF0ZSk7XG4gICAgICByZXR1cm4gc2hpcDsgLy8gUmV0dXJuIHRoZSBzaGlwIG9iamVjdCB3aGVuIGl0IGlzIGhpdFxuICAgIH1cbiAgICAvLyBObyBzaGlwIGF0IGNvb3JkaW5hdGUsIGl0J3MgYSBtaXNzXG4gICAgbWlzc2VkQXR0YWNrcy5wdXNoKGNvb3JkaW5hdGUpO1xuICAgIGF0dGFja2VkQ29vcmRpbmF0ZXMucHVzaChjb29yZGluYXRlKTtcbiAgICByZXR1cm4gbnVsbDsgLy8gUmV0dXJuIG51bGwgd2hlbiBpdCdzIGEgbWlzc1xuICB9O1xuXG4gIGNvbnN0IGFsbFNoaXBzU3VuayA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwcyA9IGdldFNoaXBzKCk7IC8vIFJldHJpZXZlIGFsbCB0aGUgc2hpcHMgb24gdGhlIGdhbWVib2FyZFxuXG4gICAgLy8gQ2hlY2sgaWYgYWxsIHNoaXBzIGFyZSBzdW5rLCByZXR1cm4gdHJ1ZSBpZiB5ZXMsIGFuZCByZXR1cm4gZmFsc2UgaWYgbm9cbiAgICBjb25zdCByZXN1bHQgPSBzaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGNvbnN0IHJlc2V0ID0gKCkgPT4ge1xuICAgIC8vIENsZWFyIHRoZSBncmlkIGJ5IHNldHRpbmcgYWxsIGNlbGxzIHRvIG51bGxcbiAgICBncmlkLmZvckVhY2goKHJvdywgcm93SW5kZXgpID0+IHtcbiAgICAgIHJvdy5mb3JFYWNoKChfLCBjb2xJbmRleCkgPT4ge1xuICAgICAgICBncmlkW3Jvd0luZGV4XVtjb2xJbmRleF0gPSBudWxsO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBSZWFzc2lnbiBlbXB0eSBhcnJheXMgdG8gY2xlYXIgdGhlIGNvbnRlbnRzIG9mIGF0dGFja2VkQ29vcmRpbmF0ZXMgYW5kIG1pc3NlZEF0dGFja3NcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzID0gW107XG4gICAgbWlzc2VkQXR0YWNrcyA9IFtdO1xuICB9O1xuXG4gIGNvbnN0IGdldE1pc3NlZEF0dGFja3MgPSAoKSA9PiBtaXNzZWRBdHRhY2tzO1xuXG4gIGNvbnN0IGdldEF0dGFja2VkQ29vcmRpbmF0ZXMgPSAoKSA9PiBhdHRhY2tlZENvb3JkaW5hdGVzO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0R3JpZCxcbiAgICBwbGFjZVNoaXAsXG4gICAgZ2V0U2hpcHMsXG4gICAgZ2V0QWxsU2hpcHMsXG4gICAgZ2V0U2hpcENvb3JkaW5hdGVzLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgZ2V0TWlzc2VkQXR0YWNrcyxcbiAgICBnZXRBdHRhY2tlZENvb3JkaW5hdGVzLFxuICAgIGFsbFNoaXBzU3VuayxcbiAgICByZXNldCxcbiAgfTtcbn07XG5cbmV4cG9ydCBjb25zdCBQbGF5ZXJGYWN0b3J5ID0gKG5hbWUpID0+IHtcbiAgY29uc3QgYXR0YWNrZWRDb29yZGluYXRlcyA9IG5ldyBTZXQoKTsgLy8gU2V0IHRvIGtlZXAgdHJhY2sgb2YgYXR0YWNrZWQgY29vcmRpbmF0ZXNcblxuICBjb25zdCBhdHRhY2sgPSAoZW5lbXlHYW1lYm9hcmQpID0+IHtcbiAgICBjb25zdCBncmlkU2l6ZSA9IGVuZW15R2FtZWJvYXJkLmdldEdyaWQoKS5sZW5ndGg7XG4gICAgY29uc3QgdmFsaWRDb29yZGluYXRlcyA9IEZhY3RvcnlIZWxwZXJzLmdldEFsbFZhbGlkQ29vcmRpbmF0ZXMoZ3JpZFNpemUpO1xuXG4gICAgbGV0IGNvb3JkaW5hdGUgPSBcIlwiO1xuXG4gICAgLy8gUGVyZm9ybSBhIGRvLXdoaWxlIGxvb3AgdW50aWwgYSB1bmlxdWUgY29vcmRpbmF0ZSBpcyBmb3VuZFxuICAgIGRvIHtcbiAgICAgIC8vIEdlbmVyYXRlIGEgcmFuZG9tIGluZGV4IGJhc2VkIG9uIHRoZSBsZW5ndGggb2YgdmFsaWRDb29yZGluYXRlcyBhcnJheVxuICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB2YWxpZENvb3JkaW5hdGVzLmxlbmd0aCk7XG5cbiAgICAgIC8vIEdldCB0aGUgY29vcmRpbmF0ZSBhdCB0aGUgcmFuZG9tIGluZGV4XG4gICAgICBjb29yZGluYXRlID0gdmFsaWRDb29yZGluYXRlc1tyYW5kb21JbmRleF07XG4gICAgfSB3aGlsZSAoXG4gICAgICAvLyBDb250aW51ZSBsb29waW5nIHdpdGhvdXQgcGVyZm9ybWluZyBhbnkgYWN0aW9ucyBpZiB0aGUgY29vcmRpbmF0ZSBpcyBhbHJlYWR5XG4gICAgICAvLyBpbiB0aGUgcGxheWVycyBhdHRhY2tlZENvb3JkaW5hdGVzIHNldCBvciBpcyBpbmNsdWRlZCBpbiB0aGUgZW5lbXlHYW1lYm9hcmRzXG4gICAgICAvLyBhdHRhY2tlZENvb3JkaW5hdGVzIGFycmF5XG4gICAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmhhcyhjb29yZGluYXRlKSB8fFxuICAgICAgZW5lbXlHYW1lYm9hcmQuZ2V0QXR0YWNrZWRDb29yZGluYXRlcygpLmluY2x1ZGVzKGNvb3JkaW5hdGUpXG4gICAgKTtcblxuICAgIC8vIEFkZCB0aGUgYXR0YWNrZWQgY29vcmRpbmF0ZSB0byB0aGUgcGxheWVycyBzZXQgb2YgYXR0YWNrZWQgY29vcmRpbmF0ZXNcbiAgICBhdHRhY2tlZENvb3JkaW5hdGVzLmFkZChjb29yZGluYXRlKTtcblxuICAgIHJldHVybiBjb29yZGluYXRlOyAvLyBSZXR1cm4gdGhlIGNvb3JkaW5hdGUgYXMgYW4gYXJyYXlcbiAgfTtcblxuICBjb25zdCBnZXRBdHRhY2tlZFNldCA9ICgpID0+IGF0dGFja2VkQ29vcmRpbmF0ZXM7XG5cbiAgY29uc3QgY2xlYXJTZXQgPSAoKSA9PiB7XG4gICAgYXR0YWNrZWRDb29yZGluYXRlcy5jbGVhcigpO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSxcbiAgICBhdHRhY2ssXG4gICAgZ2V0QXR0YWNrZWRTZXQsXG4gICAgY2xlYXJTZXQsXG4gIH07XG59O1xuIiwiZXhwb3J0IGNvbnN0IEZhY3RvcnlIZWxwZXJzID0gKCgpID0+IHtcbiAgY29uc3QgdmFsaWRDb29yZGluYXRlcyA9IFtdO1xuXG4gIGNvbnN0IGNvbnZlcnRUb0luZGljZXMgPSAoY29vcmRpbmF0ZSkgPT4ge1xuICAgIGNvbnN0IGNvbHVtbiA9IGNvb3JkaW5hdGUuY2hhckNvZGVBdCgwKSAtIDY1OyAvLyBDb252ZXJ0IGNvbHVtbiBsZXR0ZXIgdG8gaW5kZXhcbiAgICBjb25zdCByb3cgPSBwYXJzZUludChjb29yZGluYXRlLnNsaWNlKDEpLCAxMCk7IC8vIENvbnZlcnQgcm93IG51bWJlciB0byBpbmRleCB3aXRoIHJhZGl4IDEwXG4gICAgcmV0dXJuIFtyb3csIGNvbHVtbl07XG4gIH07XG5cbiAgY29uc3QgY29udmVydFRvQWxwaGFudW1lcmljID0gKFtyb3csIGNvbHVtbl0pID0+IHtcbiAgICBjb25zdCBjb29yZGluYXRlID0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2x1bW4gKyA2NSk7IC8vIENvbnZlcnQgY29sdW1uIGluZGV4IHRvIGxldHRlclxuICAgIHJldHVybiBjb29yZGluYXRlICsgcm93OyAvLyBDb252ZXJ0IHJvdyBpbmRleCB0byBudW1iZXJcbiAgfTtcblxuICBjb25zdCBnZXRBbGxWYWxpZENvb3JkaW5hdGVzID0gKGdyaWRTaXplKSA9PiB7XG4gICAgZm9yIChsZXQgcm93ID0gMDsgcm93IDwgZ3JpZFNpemU7IHJvdyArPSAxKSB7XG4gICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCBncmlkU2l6ZTsgY29sICs9IDEpIHtcbiAgICAgICAgY29uc3QgYWxwaGFudW1lcmljQ29vcmRpbmF0ZSA9IGNvbnZlcnRUb0FscGhhbnVtZXJpYyhbcm93LCBjb2xdKTtcbiAgICAgICAgdmFsaWRDb29yZGluYXRlcy5wdXNoKGFscGhhbnVtZXJpY0Nvb3JkaW5hdGUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWxpZENvb3JkaW5hdGVzO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgY29udmVydFRvSW5kaWNlcyxcbiAgICBjb252ZXJ0VG9BbHBoYW51bWVyaWMsXG4gICAgZ2V0QWxsVmFsaWRDb29yZGluYXRlcyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCBjb25zdCBBcHBIZWxwZXJzID0gKCgpID0+IHtcbiAgY29uc3Qgc2hpcFR5cGVzID0gW1xuICAgIHsgdHlwZTogXCJjYXJyaWVyXCIsIGxlbmd0aDogNSB9LFxuICAgIHsgdHlwZTogXCJiYXR0bGVzaGlwXCIsIGxlbmd0aDogNCB9LFxuICAgIHsgdHlwZTogXCJkZXN0cm95ZXJcIiwgbGVuZ3RoOiAzIH0sXG4gICAgeyB0eXBlOiBcInN1Ym1hcmluZVwiLCBsZW5ndGg6IDMgfSxcbiAgICB7IHR5cGU6IFwicGF0cm9sIGJvYXRcIiwgbGVuZ3RoOiAyIH0sXG4gIF07XG5cbiAgY29uc3QgdG9nZ2xlTW9kYWwgPSAobW9kYWwsIGNob2ljZSkgPT4ge1xuICAgIGNvbnN0IHRvZ2dsZWRNb2RhbCA9IG1vZGFsO1xuXG4gICAgY29uc3Qgb3ZlcmxheSA9IG1vZGFsLmNsb3Nlc3QoXCIub3ZlcmxheVwiKTtcbiAgICBjb25zdCBkaXNwbGF5VmFsdWUgPSBjaG9pY2UgPT09IFwic2hvd1wiID8gXCJmbGV4XCIgOiBcIm5vbmVcIjtcblxuICAgIG92ZXJsYXkuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlWYWx1ZTtcbiAgICB0b2dnbGVkTW9kYWwuc3R5bGUuZGlzcGxheSA9IGRpc3BsYXlWYWx1ZTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHNoaXBUeXBlcyxcbiAgICB0b2dnbGVNb2RhbCxcbiAgfTtcbn0pKCk7XG4iLCIvLyBUaGUgbW9kdWxlIGNhY2hlXG52YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307XG5cbi8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG5mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuXHR2YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTtcblx0aWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0cmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzO1xuXHR9XG5cdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG5cdHZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0ge1xuXHRcdC8vIG5vIG1vZHVsZS5pZCBuZWVkZWRcblx0XHQvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZFxuXHRcdGV4cG9ydHM6IHt9XG5cdH07XG5cblx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG5cdF9fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG5cdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG5cdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbn1cblxuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApKSIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXygzODApO1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NzYpO1xuIl0sIm5hbWVzIjpbImNvbnRhaW5lckVsZW1lbnQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0ZXh0Q29udGVudCIsInJvdyIsImNvbCIsImNvb3JkaW5hdGUiLCJjb252ZXJ0VG9BbHBoYW51bWVyaWMiLCJzcXVhcmUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiZGF0YXNldCIsImFwcGVuZENoaWxkIiwiZXZlbnRMaXN0ZW5lcnMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImxpc3RlbmVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50VHlwZSIsImhhbmRsZXIiLCJ3aW5uZXIiLCJjbGFzc05hbWUiLCJwbGF5ZXJHYW1lYm9hcmQiLCJjb21wdXRlckdhbWVib2FyZCIsImNvbXB1dGVyIiwiY3VycmVudFNoaXBJbmRleCIsInNoaXBQbGFjZW1lbnRNb2RlIiwiaXNWZXJ0aWNhbCIsInBsYXllckF0dGFjayIsImUiLCJ0YXJnZXQiLCJjb25zb2xlIiwibG9nIiwiZ2V0QXR0YWNrZWRDb29yZGluYXRlcyIsImluY2x1ZGVzIiwicmVjZWl2ZUF0dGFjayIsImFsbFNoaXBzU3VuayIsInRvZ2dsZU1vZGFsIiwiYXR0YWNrIiwiYXR0YWNrZWRTaGlwIiwiY29tcHV0ZXJBdHRhY2siLCJyb3RhdGVTaGlwcyIsImxlbmd0aCIsInNoaXBUeXBlcyIsInN0YXJ0Um93Iiwic3RhcnRDb2wiLCJjb252ZXJ0VG9JbmRpY2VzIiwiQXJyYXkiLCJmcm9tIiwiXyIsImkiLCJpbml0aWFsU3F1YXJlIiwiaG92ZXJlZFNxdWFyZSIsInJlbW92ZSIsInNoaXBDb29yZGluYXRlcyIsInNoaXAiLCJwbGFjZVNoaXAiLCJzaGlwVHlwZSIsImdyaWRTaXplIiwiY29vcmRpbmF0ZXMiLCJwbGFjZWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJnZXRTaGlwQ29vcmRpbmF0ZXMiLCJjb252ZXJ0ZWRDb29yZGluYXRlIiwicGxhY2VDb21wdXRlclNoaXBzIiwic2V0VGltZW91dCIsIm5leHRTaGlwVHlwZSIsInR5cGUiLCJpbml0IiwicmVzZXQiLCJjbGVhclNldCIsIlNoaXBGYWN0b3J5IiwiaGl0cyIsImhpdCIsImlzU3VuayIsIkdhbWVib2FyZEZhY3RvcnkiLCJncmlkIiwiZmlsbCIsImF0dGFja2VkQ29vcmRpbmF0ZXMiLCJtaXNzZWRBdHRhY2tzIiwiZ2V0U2hpcHMiLCJzaGlwcyIsImNlbGwiLCJwdXNoIiwiZ2V0R3JpZCIsIndpdGhpbkJvdW5kYXJpZXMiLCJldmVyeSIsImNvbmZsaWN0cyIsInNvbWUiLCJhZGphY2VudENvbmZsaWN0cyIsImFkalJvdyIsImFkakNvbCIsInNoaXBJbmZvIiwiZ2V0QWxsU2hpcHMiLCJjb2x1bW5MZXR0ZXIiLCJyb3dOdW1iZXIiLCJwYXJzZUludCIsImNoYXJDb2RlQXQiLCJnZXRNaXNzZWRBdHRhY2tzIiwicm93SW5kZXgiLCJjb2xJbmRleCIsIlBsYXllckZhY3RvcnkiLCJuYW1lIiwiU2V0IiwiZW5lbXlHYW1lYm9hcmQiLCJ2YWxpZENvb3JkaW5hdGVzIiwiZ2V0QWxsVmFsaWRDb29yZGluYXRlcyIsImhhcyIsImdldEF0dGFja2VkU2V0IiwiY2xlYXIiLCJGYWN0b3J5SGVscGVycyIsImNvbHVtbiIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInNsaWNlIiwiYWxwaGFudW1lcmljQ29vcmRpbmF0ZSIsIkFwcEhlbHBlcnMiLCJtb2RhbCIsImNob2ljZSIsInRvZ2dsZWRNb2RhbCIsImRpc3BsYXlWYWx1ZSIsImNsb3Nlc3QiLCJzdHlsZSIsImRpc3BsYXkiLCJfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18iLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJjYWNoZWRNb2R1bGUiLCJ1bmRlZmluZWQiLCJleHBvcnRzIiwibW9kdWxlIiwiX193ZWJwYWNrX21vZHVsZXNfXyIsImQiLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwic291cmNlUm9vdCI6IiJ9